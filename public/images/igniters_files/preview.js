window.zmPreviewTemplate=function(){"use strict";var a,b={},c="",d=zmText.get("preview"),e=function(){a=zmUtil.isChildWindow()?zmWindow:zmPrev},f=function(a){1===a?(zmPreviewTemplate.currentWorkSpace=1,b=$.parseJSON($("#zmWindowWrapper").attr("data-detail")),c="W"):(b=0===zmTab.currentTab.indexOf("zm_srch")?zmSearchUtil.getSearchViewDetails():zmsuite.getCenterOuter().$el.data("data-detail"),b&&"search"===b.view?(c="S",zmPreviewTemplate.currentWorkSpace=zmail.mailOpt.isPopup):0===a?(b=zmInit.getListingDetObj(),c="P",zmPreviewTemplate.currentWorkSpace=0):2===a?(c="T",zmPreviewTemplate.currentWorkSpace=2):3===a&&(c="N"))},g=function(a){var b=!1,c=zmConUtil.parseContacts(a);return 1===c.length&&c[0].invalid!==!0&&(a=a.toLowerCase(),a.indexOf("undisclosed-recipients")!==-1&&(b=!0)),b},h=function(a,b){b=b||{};var c,d,e,f,g,h,i,j=[],k=$("<div>"),l=" ";a=a||"";var m=zmConUtil.splitncheck(a,"object")||[];for(c in m)d=m[c],g=d.eid||"",g=g.trim(),i=$("<span>"),i.addClass("zm_eadd"),g&&(b.hideEmail&&i.attr("title",g),e=(d.fn||"").trim(),e=zmUtil.replaceHTMLEntities(e),e=e||g,f=(d.nn||"").trim(),f=zmUtil.replaceHTMLEntities(f),e===f&&(f=""),f=f?l+"("+f+")":"",e+=f,b.hideEmail||(e='"'+e+'"'),i.attr("data-eid",g),g="<"+g+">",h=e,b.hideEmail||(h+=l+g),i.text(h.trim()),k.html("").append(i),j.push(k.html()));return j.join(", ")},i=function(a,b){var c=b.find(".SC_pct").length;(c>1||b.find(".SCS-post").length)&&(b.find(".SC_pct").removeClass("SC_Tfcs"),$(a).closest(".SC_pct").addClass("SC_Tfcs"),zmUtil.isChildWindow()&&zmWindow.updateHeaderIcons("default"))},j=function(a){var b,c,e,f=$(a).closest(".zmPCon"),g="";b=f[0].id,b&&(e=b.substring(3),b=e.substring(1),c=zmail.prevMails[b]?zmail.prevMails[b].data.mdata:"",c&&c.SHRINKED&&c.BLCKCON&&c.CONTENT.length<c.BLCKCON.length&&(g=$("#vfc"+e).parent())),$(a).next().is(":visible")?($(a).next().hide(),$(a).attr("data-tooltip",d.contentOptions.showquote),g&&g.hide()):($(a).next().show(),$(a).attr("data-tooltip",d.contentOptions.hidequote),g&&g.show()),zmUtil.applyLBDots(g)},k=function(b){var c=$(b),d=c.parents(".SC_Twpr").find(".SC_pct");d.length>1&&(d.removeClass("SC_Tfcs"),c.parents(".SC_pct").addClass("SC_Tfcs")),c.is(".zm_fgG,.zm_fgB,.zm_fgR")?a.flagMail(c,"0"):a.flagMail(c,"2")},l=function(a,b,c){var e=zmPreviewTemplate.attPrevInr(a),f=a.fn;f=f.replace(/</gi,"&lt;"),f=f.replace(/>/gi,"&gt;");var g,h,i=zmUtil.getSubString(45,f),j=zmUtil.fileTyp(a.fn),k=j[1],l="";l=a.fn.toLowerCase();var m=zmUtil.isAddToCloudAllowed(),n=m?'<font data-msg="addtocloud">'+d.attachmentmenu.addtocloud+"</font>":"",o='<font data-msg="download">'+d.attachmentmenu.download+" </font>",p='<font data-msg="view">'+d.attachmentmenu.view+"</font>",q=zmUtil.sizeValueUnround(a.fs)||"";return("msi-attvideo"!==k||"mp4"!==j[2]&&"flv"!==j[2]&&"mov"!==j[2])&&"msi-attdoc"!==k&&"msi-attppt"!==k&&"msi-attsheet"!==k&&"msi-attpdf"!==k&&"msi-attimg"!==k&&"msi-attaudio"!==k&&("msi-attothers"!==k||l.indexOf(".txt")===-1&&l.indexOf(".htm")===-1&&l.indexOf(".xml")===-1)?(g='<div class="zmSub">',g+=l.indexOf(".ics")===-1||c?o+n+"</div>":'<font data-msg="addEvent">'+d.attachmentmenu.addevent+"</font>"+o+n+"</div>",h=['<div data-atid="'+a.Id+'" class="zmL zmAch" data-detail="'+b+'"data-eId="'+a.e+'">','<div class="zmLst">','<div class="zmDtl">','<div class="zmFrm"><span title="'+zmUtil.encodeFileName(a.fn)+'">'+i+"</span></div>"+g,'<div class="zmImg">'+e+"</div>",'<div class="zmSze"><span class="sum">'+q+"</span></div>","</div>","</div></div>"].join("")):(g='<div class="zmSub">'+o+p+n+"</div>",h=['<div data-atid="'+a.Id+'" class="zmL zmAch" data-detail="'+b+'"data-eId="'+a.e+'">','<div class="zmLst">','<div class="zmDtl">','<div class="zmFrm"><span title="'+zmUtil.encodeFileName(a.fn)+'" data-msg="view">'+i+"</span></div>"+g,'<div class="zmImg">'+e+"</div>",'<div class="zmSze"><span class="sum">'+q+"</span></div>","</div>","</div></div>"].join("")),h},m=function(a,b){var c,d=[],e={},f=a.length;for(c=0;c<f;c++)e=a[c],d.push(l(e,c,b));return d.join("")},n=function(a){if(zmail.folTree[0][a])return zmail.folTree[0][a].FN;var b,c=zmail.folTree[1];for(var d in c)if(b=c[d].CH,b[a])return b[a].FN;return""},o=function(a){var b;return b='<span class="SC_ldot zm_folname js-fnHolder">'+a+"</span>"},p=function(a,b){var c="";return a=parseInt(a),c=1===a?"<div class='zm_icn zmflg zm_fgB'></div>":2===a?"<div class='zm_icn zmflg zm_fgR'></div>":3===a?"<div class='zm_icn zmflg zm_fgG'></div>":"s"===b?"":"<div class='zm_icn zmflg'></div>"},q=function(){var a=zmAdHocSettings.getMailViewSettings();return a.headerState},r=function(){var a=zmAdHocSettings.getMailViewSettings();a.headerState="c"===a.headerState?"e":"c",zmAdHocSettings.setMailViewSettings(a)},s=function(a,b,c){var d,e,f=$(a),g=f.attr("data-mid");b&&_zm.stopEvents(b);var h=c||q();if(f.hasClass("zm_tm")&&(h="c"),"e"===h){if(e="msi-zmPle",zmail.prevMails[g]&&zmail.prevMails[g].data.mdata)if(f.length){var i=f.closest(".SC_Twpr");d=!i.length||zmail.prevMails[g].data.mdata.streams||zmUtil.isZohoAccount(zmail.accId)?zmail.prevMails[g].data.mdata.RDT:zmail.prevMails[g].data.mdata.SENTTIME||""}else d=zmail.prevMails[g].data.mdata.RDT;f.addClass("zms")}else"c"===h&&(e="msi-zmPme",zmail.mailObj[g]&&(d=zmail.mailObj[g].DT),f.removeClass("zms"));f.find(".msi-zmPme, .msi-zmPle").attr("class",e),d&&f.find(".sum").html(d)},t=function(a){var b,c="",e=[],f={reply:d.contextmenu.reply,replyall:d.contextmenu.replyall,fwdi:d.contextmenu.forward,eanew:d.contextmenu.editasnew,outbox:d.contextmenu.edit},g=["reply","replyall","fwdi","eanew"],h=["outbox"],i=["reply","replyall","fwdi"];return b=zmail.mailObj[a].FD===zmail.folId.oId?h:zmUtil.isChildWindow()?i:g,b.forEach(function(a){e.push('<span data-type="'+a+'">'+f[a]+"</span>")}),e=e.join(""),c=['<div class="zm_ry"'+(zmUtil.hasInlineDraft(a)?' style="display: none"':"")+">",e,"</div>"].join("")},u=function(a){var c,e,f,i,j=a.elemId,k=a.msgId,l="",m="",q=[];if(a.elemObj&&$(a.elemObj.prevElem).find("#zmHdr"+j).length&&!$(a.elemObj.prevElem).find("#zmC"+j).length||"print"!==a.rFrom&&!a.elemObj&&$("#zmHdr"+j).length&&!$("#zmC"+j).length){var r="",t="",u="";return c=a.elemObj?$(a.elemObj.prevElem).find("#zmHdr"+j):$("#zmHdr"+j),c.removeClass("zm_tm"),zmail.mailObj[k].S||c.find(".zmPT").addClass("zm_urd"),c.find(".sum").html(zmail.mailObj[a.msgId].DT),""!==a.isReadable&&void 0!==a.isReadable&&c.find(".sum").after("<span class='SC_ldot'>"+a.isReadable+"</span>"),e="<span>",a.to&&!g(a.to)&&q.push(h(a.to,{hideEmail:!0})),a.cc&&q.push(h(a.cc,{hideEmail:!0})),a.bcc&&q.push(h(a.bcc,{hideEmail:!0})),e+=q.join(", "),e+="</span>",c.find(".zmpr").eq(1).find("font:first").after(e),a.to&&!g(a.to)&&(c.find("#zmTO"+a.elemId).remove(),r='<div id="zmTO'+a.elemId+'" class="zmpdtl"><div><div class="zmpr"><span><em>'+d.contentOptions.to+"</em> "+h(a.to)+"</span></div></div></div>"),a.cc&&(t='<div id="zmCC'+a.elemId+'" class="zmpdtl"><div><div class="zmpr"><span><em>'+d.contentOptions.cc+"</em> "+h(a.cc)+"</span></div></div></div>"),a.bcc&&(u='<div id="zmBCC'+a.elemId+'" class="zmpdtl"><div><div class="zmpr"><span><em>'+d.contentOptions.bcc+"</em> "+h(a.bcc)+"</span></div></div></div>"),a.to||a.cc||a.bcc||c.find("#zmTO"+a.elemId).length||(r='<div id="zmTO'+a.elemId+'" class="zmpdtl"><div><div class="zmpr"><span><em>'+d.contentOptions.to+"</em></span></div></div></div>"),f=zmPreviewTemplate._rPath(a,"via"),i=zmPreviewTemplate._rPath(a),$("#zmLBL"+a.elemId).length?$("#zmLBL"+a.elemId).before(r+t+u):c.find(".zmPT").append(r+t+u),i._str&&c.find(".zmPT")&&(c.find(".zmPT").find('div[data-zmvia="less"]').append(f._str),c.find(".zmPT").append(i._str)),s(c),c[0].outerHTML}var v,w,x="",y=zmail.mailObj[a.msgId].FD||"",z=!0,A="zmPHdr",B={},C=a.isSharedDraft||!1,D=a.isDraftEditable||!1,E="";zmail.mailObj[a.msgId].streams&&(E="default"),a.sm||(a.sm=""),a.thd&&(A+=" zm_tm",y===zmail.folId.sId&&zmail.mailObj[k]&&zmail.mailObj[k].TH&&(A+=" zmsnt")),l+='<div id="zmHdr'+a.elemId+'" class="'+A+'" data-mid="'+a.msgId+'">',l+=0===zmail.mailObj[a.msgId].S&&zmail.mailObj[a.msgId].FD!==zmail.folId.oId?'<div class="zmPT zm_urd">':'<div class="zmPT">',l+='<div class="zmpr"><div class="SCmb"><div class="SC_frt">',(zmUtil.isSharedFolder(y)&&"91"===zmail.shrTree[0][y].RT||3===a.opentype||C&&!D)&&(z=!1);var F=!1;if(zmUtil.isChildWindow()){if(zmail.mailObj&&zmail.mailObj[k]&&zmail.mailObj[k].RMOBJ&&!$.isEmptyObject(zmail.mailObj[k].RMOBJ)){var G=zmail.mailObj[k].RMOBJ.WT;1!==G&&2!==G&&3!==G||(F=!0)}zmail.folId.dId!==zmail.mailObj[k].FD&&zmail.folId.spId!==zmail.mailObj[k].FD&&zmail.folId.tId!==zmail.mailObj[k].FD&&zmail.folId.teId!==zmail.mailObj[k].FD||(F=!1)}else F=zmList.isRMOBJ(k);zmUtil.isZohoAccount(zmail.accId)||(F=!1),F?(l+='<ul id="zmprv_header_'+a.msgId+'_remind"><li><b>',l+='<i class="msi-mailReminder SC_thm" data-detail="prvHdr"></i></b></li></ul>'):(l+='<ul id="zmprv_header_'+a.msgId+'_remind" class="SC_dyn"><li><b>',l+='<i class="msi-mailReminder  SC_thm" data-detail="prvHdr"></i></b></li></ul>'),z&&(l+=zmail.mailObj[a.msgId].FD===zmail.folId.oId?['<ul class="SC_ldot"><li><b>','<i class="msi-edit" data-detail="prvHdr"></i>',"</b></li></ul>"].join(""):zmail.mailObj[a.msgId].FD===zmail.folId.dId?['<ul class="SC_ldot"><li><b>','<div class="SC_hd"></div>','<span><i class="msi-edit" data-detail="prvHdr"></i><i class="msi-barrow"></i></span>',"</b></li></ul>"].join(""):D?['<ul class="SC_ldot"><li><b>','<i class="msi-edit" data-detail="prvHdr"></i></b></li></ul>'].join(""):['<ul class="SC_ldot"><li title="'+d.contextmenu.reply+'"><b>','<div class="SC_hd"></div>','<span><i data-detail="prvHdr" class="msi-reply"></i></span>',"</b></li>",'<li title="'+d.contextmenu.replyall+'"><b>','<div class="SC_hd"></div>','<span><i data-detail="prvHdr" class="msi-replyall"></i></span>',"</b></li>",'<li title="'+d.contextmenu.forward+'"><b>','<div class="SC_hd"></div>','<span><i data-detail="prvHdr" class="msi-forward"></i></span>',"</b></li></ul>",'<ul><li class="SC_lbr" title="'+d.iconTooltip.moreact+'"><b>','<div class="SC_hd"></div>','<span><i data-detail="prvHdr" class="msi-barrow"></i></span>',"</b></li></ul>"].join("")),l+="</div></div>",l+='<ul class="SC_pvul"><li><img src=""></img>';var H=a.frm,I=zmail.mailObj[a.msgId].SN||a.sender;try{zmail.mailObj[a.msgId].F===zmail.aInfo[zmail.accId].mailId&&(I="Me")}catch(J){}B["data-eid"]=H,v={attr:B,name:I,img:!1,eid:H};var K=zmail.mailObj[a.msgId].PR;if(1===K||2===K?l+="<i class='msi-priority SC_red'></i>":4!==K&&5!==K||(l+="<i class='msi-priority SC_blue'></i>"),w=zmConUtil.bubbleUtil(v),l+=w,f=zmPreviewTemplate._rPath(a,"less",H),f._str&&(l+=f._str),l+='<span class="SC_lnk SC_ldot zm_unsub" style="display:none;">'+d.newsletter.unsubscribe+"</span>",zmUtil.isZohoAccount(zmail.accId)&&zmail.isSmartFilterEnabled&&zmail.mailObj[k].SFT&&!zmUtil.isSharedFolder(zmail.mailObj[k].FD)&&(!zmUtil.isChildWindow()||zmUtil.isChildWindow()&&opener)&&(l+='<span class="SC_lnk SC_ldot zm_exclude" title="'+d.smartfilter.exclude_tip+'">'+d.contentOptions.exclude+"</span>"),l+="<div>",1===a.hasAtt&&(l+='<i class="msi-attachment"></i>'),zmail.mailObj[a.msgId].FD!==zmail.folId.spId&&zmail.mailObj[a.msgId].FD!==zmail.folId.oId&&zmail.mailObj[a.msgId].FD!==zmail.folId.dId&&(zmail.mailObj[a.msgId].streams&&zmail.mailObj[a.msgId].groupId===zmail.zuid&&"0"!==zmail.mailObj[a.msgId].NFG||!zmail.mailObj[a.msgId].streams)&&(l+=p(a.flag)),zmail.mailObj[a.msgId].DT||(zmail.mailObj[a.msgId].DT=a.date),l+='<span class="sum">'+zmail.mailObj[a.msgId].DT+"</span>",!a.label&&zmail.mailObj[a.msgId].TAG&&(a.label=zmail.mailObj[a.msgId].TAG),a.label&&a.label.length?zmail.mailObj[a.msgId].FD!==zmail.folId.spId&&zmail.mailObj[a.msgId].FD!==zmail.folId.dId&&(x=zmsTemplates.constructTagListHTML(a.label,!1,"",E),x+='<i class="msi-plus zmst_lbl"></i>'):x='<i class="msi-label"></i>',l+='<div class="SC_ldot zm_lbl">'+x+"</div>",zmail.mailObj[a.msgId].streams&&!zmUtil.isChildWindow()){var L;L=zmail.mailObj[a.msgId].isFav?'<i class="msi-fav SC_fav"></i>':'<i class="msi-fav"></i>',l+='<div class="SC_ldot">'+L+"</div>"}if(""!==a.isReadable&&void 0!==a.isReadable&&(l+='<span class="SC_ldot">'+a.isReadable+"</span>"),m=n(y),m&&zmail.mailObj[a.msgId].AR&&(m+=" ("+d.contentOptions.archived+")"),0!==a.opentype||b&&"search"===b.view?l+=o(m):!b||b.fId&&1!==zmail.mailObj[a.msgId].TH||(l+=o(m)),l+="</div></li></ul>",l+='<i class="msi-zmPme"></i>',l+='<i style="display:none;" class="msi-share js-shareicon"></i>',l+="</div>",e="<font>"+a.sm+"</font>",a.thd||(e+="<span>",a.to&&!g(a.to)&&q.push(h(a.to,{hideEmail:!0})),a.cc&&q.push(h(a.cc,{hideEmail:!0})),a.bcc&&q.push(h(a.bcc,{hideEmail:!0})),e+=q.join(", "),e+="</span>"),l+='<div class="zmpr zmpsrt">',l+=e+"</div>",a.to&&!g(a.to)&&(l+='<div id="zmTO'+a.elemId+'" class="zmpdtl"><div><div class="zmpr"><span><em>'+d.contentOptions.to+"</em> "+h(a.to)+"</span></div></div></div>"),a.cc&&(l+='<div id="zmCC'+a.elemId+'" class="zmpdtl"><div><div class="zmpr"><span><em>'+d.contentOptions.cc+"</em> "+h(a.cc)+"</span></div></div></div>"),a.bcc&&(l+='<div id="zmBCC'+a.elemId+'" class="zmpdtl"><div><div class="zmpr"><span><em>'+d.contentOptions.bcc+"</em> "+h(a.bcc)+"</span></div></div></div>"),a.to||a.cc||a.bcc||(l+='<div id="zmTO'+a.elemId+'" class="zmpdtl"><div><div class="zmpr"><span><em>'+d.contentOptions.to+"</em></span></div></div></div>"),a.label&&a.label.length?zmail.mailObj[a.msgId].FD!==zmail.folId.spId&&zmail.mailObj[a.msgId].FD!==zmail.folId.dId&&(l+=['<div id="zmLBL'+a.elemId+'" class="zmpdtl"><div>','<div class="zmpr"><span><em>Tags</em> <div class="zm_lbl">',zmsTemplates.constructTagListHTML(a.label,!0,"",E),"</div></span></div></div></div>"].join("")):l+=['<div id="zmLBL'+a.elemId+'" class="zmpdtl"><div>','<div class="zmpr"><span><em>Tags</em> <div class="zm_lbl">','<i class="msi-label"></i></div></span></div></div></div>'].join(""),i=zmPreviewTemplate._rPath(a),l+=i._str,l+="</div>",l+='<div class="zmmre">',a.showIndex&&zmail.mailObj[k].TH&&zmail.listObj[zmail.mailObj[k].T]){var M,N;if(zmUtil.isChildWindow())N=zmail.listObj[zmail.mailObj[k].T].MO,M=N.length;else{N=zmList.getListForAllMailsView(b,zmail.mailObj[k].T,!0);var O=zmList.getDupThdRowId(k,zmUtil.getFolId());M=zmail.mailObj[O]&&zmail.mailObj[O].TC||N.length}var P=N.indexOf(k);P!==-1&&(P+=1,l+='<span id="zm_readtitle">'+d.contentOptions.readingindex+"<em>"+P+"</em>/<em>"+M+"</em></span>")}l+="</div></div>";var Q=$(l);return s(Q),Q[0].outerHTML},v=function(a,c){var e,f="",g=' style="display:none"',h="",i=c.msgId||a.msgId||"",j=""!==a.SENDER?a.SENDER:a.FROM,k=c.att||0,l=c.tg||null,m=c.flg||null,n=c.sm||"",o=a.TO||"",p=a.CC||"",q=a.BCC||"",r=a.RDT||"",s=a.READSTATUS||"",v=a.CONTENT?a.CONTENT:"",w=c.opentype,x="";zmail.showFeature&&(x=zmUtil.textReadTime(v));var y=$("<div>").html(v),z=y.find("#zmail_block");o=o.replace(/&lt;/gi,"<"),o=o.replace(/&gt;/gi,">"),p=p.replace(/&lt;/gi,"<"),p=p.replace(/&gt;/gi,">"),q=q.replace(/&lt;/gi,"<"),q=q.replace(/&gt;/gi,">"),a.BLCKCON&&(z.length?(z.addClass("zm_icn zm_sqt SC_ttip"),z.after("<div style='display:none'>"+a.BLCKCON+"</div>"),v=y[0].innerHTML):v+=y.text().trim().length?"<div class='zm_icn zm_sqt SC_ttip' data-tooltip='"+d.contentOptions.showquote+"'></div><div style='display:none'>"+a.BLCKCON+"</div>":"<div>"+a.BLCKCON+"</div>"),b&&"search"===b.view?e="S"+i:0===w?e="P"+i:2===w?e="T"+i:1===w?e="W"+i:3===w&&(e="N"+i),f+=zmail.mailObj[i].TH?!b||b.fId!==zmail.mailObj[i].FD&&""!==b.fId?'<div class="SC_pct SC_Tfcs SC_Tfdr">':'<div class="SC_pct SC_Tfcs">':'<div class="SC_pct">';var A={msgId:i,frm:a.FROM,sender:j,hasAtt:k,to:o,cc:p,bcc:q,label:l,flag:m,date:r,sm:n,elemId:e,opentype:c.opentype,src:c.src,readsts:s,isSharedDraft:c.isDraftMail,isDraftEditable:c.isDraftEditable,isReadable:x,showIndex:c.showIndex,rFrom:c.rFrom};if(A.rPath=a.RETURNPATH,A.delegate=a.DELEGATE,f+=u(A),f+='<div id="zmCon'+e+'">',f+='<div id="zmC'+e+'" class="zmPCon">',a.EXTIMG&&"none"!==a.EXTIMG.link){var B=zmText.applyArgs(d.contentOptions.alwaysshow,{emailid:zmail.mailObj[i].F}),C=zmText.applyArgs(d.contentOptions.hideimage,{emailid:zmail.mailObj[i].F});f+=['<div class="SC_simg" id="ImgDis'+e+'">','<a style="display:none;" href="javascript:void(0)" data-mode="temporary">',d.contentOptions.display,"</a>",'<a style="display:none;" href="javascript:void(0)" data-mode="whitelist">',B,"</a>",'<a style="display:none;" href="javascript:void(0)" data-mode="blacklist">',C,"</a>",'<span style="display:none;" data-mode="message">',d.contentOptions.imagehidden," </span></div>"].join("")}if(f+='<div class="zmPCnt"><table cellpadding="0" cellspacing="0" border="0"><tr><td>'+v+"</td></tr></table></div>",a.SHRINKED&&(f+=a.BLCKCON&&a.CONTENT.length<a.BLCKCON.length?'<div class="SC_simg" style="display:none;"><font id="vfc'+e+'">'+d.contentOptions.viewfullcontent+"</font><span>[ "+d.contentOptions.truncated+" ]</span></div>":'<div class="SC_simg"><font id="vfc'+e+'">'+d.contentOptions.viewfullcontent+"</font><span>[ "+d.contentOptions.truncated+" ]</span></div>"),a.NEWATT){var D=!1;a.CALCONTENT&&(D=!0),g="",h='<div class="SC_tp10"> '+zmText.applyArgs(d.attachmentmenu.attachcount,{count:a.NEWATT.length})+' <span class="SC_plnk" data-detail="downloadall">'+d.attachmentmenu.downloadaszip+"</span></div>",h+=zmAttach.build(a.NEWATT,D)}return f+='<div class="zmPAtt"'+g+">",f+=h,f+="</div>",f+="</div>",3===w||c.isDraftMail||(f+=t(i)),f+="</div>"},w=function(a,b){if(a){zmail.mailObj[a].TAG=zmail.mailObj[a].TAG||[];var c,d=zmail.mailObj[a].TAG,e="";zmail.mailObj[a].streams&&(e="default");var f=zmsTemplates.constructTagListHTML(d,!0,"",e),g=zmsTemplates.constructTagListHTML(d,!1,"",e),h=g;f.length||(f='<i class="msi-label"></i>'),b&&b.length&&(c=b[0].id,c.indexOf("t")||(c=c.substring(1)));var i=["","t","zmHdrP","zmHdrT","zmHdrW","zmHdrS","zmHdrN"];for(var j in i){var k;k="1"===j&&c?$("[id="+i[j]+c+"]"):$("[id="+i[j]+a+"]");for(var l=0;l<k.length;l++){var m,n=k.eq(l),o=n.find(".zm_lbl");switch(o.remove(),i[j]){case"":n.find(".SC_icn").after("<div class='zm_lbl'></div>");break;case"t":n.find(".SC_icn").after("<div class='zm_lbl'></div>"),c&&zmail.mailObj[c]&&(zmail.mailObj[c].TTAGS=zmail.mailObj[c].TTAGS||[],d=zmail.mailObj[c].TTAGS||d,h=zmsTemplates.constructTagListHTML(d,!1,4,e));break;case"zmHdrP":m="zmLBLP"+a;break;case"zmHdrT":m="zmLBLT"+a;break;case"zmHdrW":m="zmLBLW"+a;break;case"zmHdrS":m="zmLBLS"+a;break;case"zmHdrN":m="zmLBLN"+a}if(m){h=d.length?g+'<i class="msi-plus zmst_lbl"></i>':'<i class="msi-label zmst_lbl"></i>',$("#"+m).remove();var p='<div id="'+m+'" class="zmpdtl"><div><div class="zmpr"><span><em>Tags</em></span></div></div></div>';n.find(".zmvia").length?$(p).insertBefore(n.find(".zmvia").eq(0)):n.find(".zmPT").append(p),$("#"+m).find("span").append("<div class='zm_lbl'></div>"),n.find(".zmpr").eq(0).find(".sum").after("<div class='SC_ldot zm_lbl'></div>")}o=n.find(".zm_lbl"),o.length&&(2===o.length?(o.eq(0).html(h),o.eq(1).html(f)):1===o.length?o.html(h):o.html(f))}"t"===i[j]&&(d=zmail.mailObj[a].TAG,h=zmsTemplates.constructTagListHTML(d,!1,"",e))}}},x=function(a){if(zmail.mailObj[a]&&zmail.mailObj[a].FD===zmail.folId.sId){var b,c=["","t","zmHdrP","zmHdrT","zmHdrW","zmHdrS"];c.forEach(function(c){b=$(String("[id="+c)+a+"]"),b.each(function(a,b){$(b).removeClass("zmsnt"),$(b).hasClass("zm_tm")&&$(b).addClass("zmsnt")})})}},y=function(a,b){var c,d=[],e=[];"t"===a.charAt(0)?(a=a.substring(1),e.push(a)):d.push(a);var f="";zmail.mailObj[a]&&zmail.mailObj[a].streams&&(f="default");var g=zmUtil.getTagList(f),h={};h.parentDOM=$(b),h.displayAs="popup",h.accType=f,h.labelState={mailList:[{id:a,ttag:Boolean(e.length)}]},h.onStateChange=function(a,b){zmUtil.isChildWindow()?zmWindow.applyActions("label","click",{msgId:d,thd:e,lA:b?"add":"delete",lId:a,accType:f,disp:g[a].dispName}):zmmailAct.applyActions("label","click",{msgId:d,thd:e,lA:b?"add":"delete",lId:a,accType:f,disp:g[a].dispName})},zmUtil.isChildWindow()||(h.onCreate=function(a){zmlab.isValidName(a,"",f)&&zmlab.labelCreate(a,f,{reqDoneClbk:function(a,b){a&&(h.onStateChange(b,!0,function(){}),c.hide())}})}),c=zmUtil.createFLComp("label",h),c.show()},z=function(b,e,f){var g,h=b.target||b.srcElement,l="",m="",n="";if(h=$(h),l=$(h).closest(".SC_pct").children(":first").attr("data-mid"),m=c+l,g=$(h).attr("class")||"",g.indexOf("SC_big")!==-1?g="SC_big":g.indexOf("zmflg")!==-1?g="zmflg":g.indexOf("zm_unsub")!==-1?g="zm_unsub":g.indexOf("msi-fav")!==-1?g="msi-fav":g.indexOf("zm_exclude")!==-1&&(g="zm_exclude"),g||!h.parent().hasClass("SC_cs")||h.closest(".SC_pct").hasClass("SC_Drft")||(h=h.parent(),g=h.attr("class")),h.closest(".zm_lbl").length&&(g="zm_lbl"),"IMG"===h[0].tagName&&"A"===h.parent()[0].tagName){var o,p,q,t,u,v=[/(?:https?:\/\/)?[^.\s]+\.youtube\.[^.\/]+\/[^\s]*watch\?[^\s]*v=([^\s&#\/]+)(?:&t=([^\s&#]+))*[^\s]*/g,/(?:https?:\/\/)?[^.\s]+\.youtube\.[^.\/]+\/v\/([^\s&#\/]+)(?:&t=([^\s&#]+))*[^\s]*/g,/(?:https?:\/\/)?youtu\.be\/([^\s&#\/]+)(?:&t=([^\s&#]+))*[^\s]*/g],w=v.length,x=h.parent()[0].href,z="",A="//www.youtube.com/embed/{{videoID}}{{extraParams}}",B=/(?:([0-9]*)h)*(?:([0-9]*)m)*(?:([0-9]*)s)*/gi;for(o=0;o<w;o++)if(p=v[o],null!==(q=p.exec(x))&&q[1]){t=q[1],u=q[2]||"",g="youtubeurl";break}if(t){if(z=A.replace(/\{\{videoID\}\}/,t),u){B=A.timeParseRegex,B.lastIndex=0;var C=B.exec(u);C[1]=parseInt(C[1])||0,C[2]=parseInt(C[2])||0,C[3]=parseInt(C[3])||0;var D=3600*C[1]+60*C[2]+C[3];z=z.replace(/\{\{extraParams\}\}/,"?start="+D)}else z=z.replace(/\{\{extraParams\}\}/,"");n=z}}switch(g||"prvHdr"!==h.find("i").attr("data-detail")||(h=h.find("i"),g=h.attr("class")),g=g.replace("SC_ldot","").trim(),g=g.replace("SC_thm","").trim(),"2"===zmail.collabVersion&&(g=g.replace("msi-share","").replace("shd","").trim()),g){case"msi-zmPme":case"msi-zmPle":r(),s($("#zmHdr"+m),b);break;case"msi-reply":case"msi-replyall":case"msi-forward":var E={"msi-reply":"reply","msi-replyall":"replyall","msi-forward":"forward"};"prvHdr"===h.attr("data-detail")&&(i(h,e),a.bindAction({action:E[g]},h,{containerDOM:$(h).closest(".SC_pct").parent()})),_zm.stopEvents(b);break;case"msi-mailReminder":zmWatch.showWatch({msgId:l,elem:h,openWatch:"preview_header",loadType:"popup"}),_zm.stopEvents(b);break;case"msi-download":a.show("zm_dldLst",h);break;case"msi-barrow":i(h,e),h.parents("ul").attr("cmprid")?a.show("zm_prvRepLst",h):"prvHdr"===h.attr("data-detail")?a.show("zm_preaLst",h):h.prev().hasClass("msi-edit")?a.show("zm_preaLst",h):h.prev().hasClass("msi-download")&&a.show("zm_dldLst",h);break;case"msi-attachment":a.posAView(m),_zm.stopEvents(b);break;case"zm_icn zm_sqt SC_ttip":j(h);break;case"zmflg":k(h),_zm.stopEvents(b);break;case"msi-edit":zmUtil.isChildWindow()||"prvHdr"!==h.attr("data-detail")||zmUtil.invokeComposer({mode:"outbox",msgId:l});break;case"SC_cs":case"zm_eadd":var F=[{htm:d.contactbubble.addcontact,id:"zms_add",clk:zmConUtil.handleAddToContact}];zmUtil.isChildWindow()||(F=F.concat([{htm:d.contactbubble.sendmail,clk:zmConUtil.loadCompose},{htm:d.contactbubble.chat,clk:zmConUtil.createChat,show:"chat",value:!0},{htm:d.contactbubble.listmails,clk:zmConUtil.listMails},{htm:d.contactbubble.listattachments,clk:zmConUtil.listAttachment}]));var G={dom:h,items:F,event:b,source:"mail"};zmUtil.isChildWindow()&&(G.source="popmail"),zmConUtil.showContactCard(G);break;case"youtubeurl":var H=[],I={ft:103,fn:"file.mp4",src:n,showInFrame:!0,hideFileName:!0,hideShareOption:!0};H.push(I),zmUtil.initAttSlideShow(H,0,!0),_zm.stopEvents(b);break;case"zm_lbl":if(zmail.mailObj[l]&&zmail.mailObj[l].streams)$(h).addClass("zmst_lbl"),zmStreamsApp.util.bindEntityElements({entityId:l,entityElem:h,entityType:1});else{var J=h.closest(".zm_lbl");y(l,J)}break;case"msi-fav":zmStreamsApp.util.bindEntityElements({entityId:l,entityElem:h,entityType:1,data:zmail.mailObj[l]});break;case"zm_draft":var K=h.closest(".SC_pct").children().eq(1);zmPreviewTemplate.loadInlineCompose(l,K);break;case"SC_plnk":var L=h.attr("data-detail");"downloadall"===L&&a.bindAction({action:L,msgId:l},h);break;case"js-shareicon":if("2"===zmail.collabVersion){var M=$(h).parents(".zmPHdr").parents(".SC_pct").parent()[0];$.publish("/mail/preview/updateshare",{mailID:l,containerDOM:$(M)[0]})}break;case"zm_unsub":zmPreviewTemplate.processUnsubscription(l,e);break;case"zm_exclude":var N,O;if(zmail.mailObj[l]){N=zmail.mailObj[l].F||"",O=zmail.mailObj[l].SFT;var P={5:d.smartfilter.notification,6:d.smartfilter.newsletter,7:d.smartfilter.group};if(N&&O){var Q=zmText.applyArgs(d.smartfilter.confirm_msg,{email_address:N,smart_filter_name:P[O]});zmsDialog.confirm(Q,{onOk:function(){zmPreviewTemplate.classifySmartFilter(l,O,!1,$(h).closest(".SC_pct"))}})}}break;default:var R,S;if(zmUtil.isChildWindow()||(S=zmTab.currentTab.indexOf("zm_srch")!==-1?zmSearchUtil.getSearchViewDetails():zmsuite.getCenterOuter().$el.data("data-detail")),S&&"search"===S.view&&zmSearchUtil.isWorkspaceAvailable()&&(R="zm_srch1"),h.attr("id")&&h.attr("id").indexOf("vfc")!==-1){i(h,e);var T={msgId:l,type:"lt",opentype:void 0!==f?f:zmPreviewTemplate.currentWorkSpace,vfc:!0};zmUtil.isChildWindow()?zmWindow.getMail(T):(T.tabId=R,zmList.getMailData(T)),h.parent().hide()}else{var U=h.closest(".zmPHdr");if(!U.length)return;if(!U.hasClass("zm_tm")&&U.hasClass("zms")){var V=U.children(".zmPT:first").children(".zmpr:first")[0];if(h[0]!==V&&!$.contains(V,h[0]||"zmmre"===g))return}var W=zmail.mailObj[l].FD===zmail.folId.dId;if(U.length&&(!W&&e.find(".SC_pct").length>1&&(i(h,e),U.toggleClass("zm_tm"),U.removeClass("zmsnt"),zmail.mailObj[l].FD===zmail.folId.sId&&U.hasClass("zm_tm")&&U.addClass("zmsnt")),a.toggleMailContentViewMode(U,f,R),!U.hasClass("zm_tm")))if(zmUtil.isChildWindow())zmUtil.setPreviewScroll(U.closest(".SC_pct"),e);else{var X=U.closest(".SC_pct");zmUtil.setPreviewScroll(X,X.parent())}}}},A=function(a,b){var c,e=a.target||a.srcElement,f="",g=zmUtil.getCmpViewType();c=$(e).attr("data-type"),f=$(e).closest(".SC_pct").find(".zmPHdr").attr("data-mid"),i(e,b),g.mode=c,g.msgId=f;var h=zmail.mailObj[f];switch(h&&h.streams&&(g.groupId=h.groupId,g.streamsView=!0),c){case"outbox":zmUtil.invokeComposer(g);break;case"eanew":zmUtil.invokeComposer(g);break;case"reply":case"replyall":case"fwdi":"2"===zmail.collabVersion&&"fwdi"===c&&$.publish("/mail/forwardmail",{mailID:f,workspaceID:zmTab.currentTab,containerDOM:$(e).closest(".SC_pct").parent(),mode:"forward"}),zmUtil.isInlineCompose()&&zmail.mailObj[f]&&zmail.mailObj[f].DMID&&zmComp.getCmpObjId(f).cmpId?(e=b.find("#zmCon"+g.viewType+zmail.mailObj[f].DMID),i(e,b)):zmUtil.getMailContent(f).done(function(a){g.prevElem=$(e).closest(".SC_Twpr"),zmail.prevMails[f]&&(g.draftCont=a),zmUtil.invokeComposer(g)}).fail(function(){_zm.succErrMsg(d.inlinecompose.error)})}},B=function(a){a=$(a);var b=a.hasClass("SCS_postMail")||a.parent(".SCS_postMail").length>0,c="zmStreamsApp"===zmTab.currentTab,d=zmsuite.getCenter()[0].$el.hasClass("zms_streams"),e=0!==a.find(".SCS_cmnt").length;return b||c||d||e},C=function(a,b){var c=a;if("1"===zmail.collabVersion&&(zmUtil.isZohoAccount(zmail.accId)||zmail.isOrg)){b=$(b),b.attr("data-comment",c);var d=zmail.mailObj[a],e=zmail.prevMails[a]||{};if(!(a&&e&&d&&b))return void(b?_zm.succErrMsg("e","Could not load comments. Reason : Mail data was not available !"):_zm.succErrMsg("e","Could not load comments."));a=d.T||a;var f=Boolean(d.T),g=[zmail.folId.oId,zmail.folId.dId,zmail.folId.teId].indexOf(d.FD)===-1,h=zmUtil.isChildWindow(),i=d.FD,j=zmUtil.getFolderObject(i),k=Boolean(j&&"-1"!==j.SH),l=Boolean(zmail.shrTree[0]&&zmail.shrTree[0][i]);!g||h||k||l||B(b)||zmmailAct.retrieveComments(a).done(function(d){var g=d||e.data||{};g.comment=g.comment||{},g.comment.comments=g.comment.comments||{},g.comment.order=g.comment.order||[];var h={comments:g.comment,id:a,isShare:!1,fixedComment:!1,mentions:[],groupsMention:!0,groupId:zmail.zuid,etype:"1",owner:zmail.zuid,sharedCall:!0,sharedApiCall:!1,entityExists:g.comment.order.length>0,placeHolder:{button:"Share",textArea:g.comment.order.length?"Write your comment":"@mention a user or group in your comment to share this conversation."},miscData:{mailID:c}};g.comment.order.length||(h.createEntityDeferredCallback=function(b){var d=$.Deferred();b=b||{};var e=b.includeRecipients;return e=!1,zmmailAct.createCommentEntity(f?a:c,b.mentions,f,e).done(function(){d.resolve()}).fail(function(a){d.reject(a||{})}),d.promise()}),zmUtil.requireStreamsApp().done(function(){var a=zmStreamsApp.CommentModule.init(h);a=$(a),a.addClass("js-mailcomments"),a.attr("data-mailid",c),String(b.attr("data-comment"))===String(c)&&(b.append(a),b.removeAttr("data-comment"),b.find(".SC_Popn").length&&a.hide())}).fail(function(){_zm.succErrMsg("e","Could not load comments ! Reason : Resources can't be loaded !")})}).fail(function(){_zm.succErrMsg("e","Could not load comments ! Reason : Load comments request failed !")})}},D=function(a){var b,c,d,e,f,g,h,i,j;for(b=zmail.prevMails[a].data.mdata.CONTENT,c=zmail.prevMails[a].data.mdata.BLCKCON,d=zmail.prevMails[a].data.mdata.EXTIMG,d.externalURL&&d.externalURL.length?(e=d.externalURL,f=d.externalLink):(e=d.exturl.split(","),f=d.extlink.split(",")),g=e.length,h=0;h<g;h++)j="id="+f[h],i=j+" src="+e[h].replace(/&amp;/gi,"&"),b=b.replace(j,i),c&&(c=c.replace(j,i));zmail.prevMails[a].data.mdata.CONTENT=b,c&&(zmail.prevMails[a].data.mdata.BLCKCON=c),zmail.prevMails[a].data.mdata.EXTIMG.link="none"},E=function(a,b){var d,e,f,g,h,i,j=[],k=[];if(b?i=b:(i=zmUtil.getSelectedMails(),i[0][0]?b=i[0][0]:i[1][0]&&(b=i[1][0])),b){if(h=c+b,zmail.prevMails[b]&&zmail.prevMails[b].data.mdata.EXTIMG)for(d=zmail.prevMails[b].data.mdata.EXTIMG,d.externalURL&&d.externalURL.length?(j=d.externalURL,k=d.externalLink):(j=d.exturl.split(","),k=d.extlink.split(",")),e=j.length,g=0;g<e;g++)f=j[g].replace(/&amp;/gi,"&"),$("#"+k[g]).attr("src",f);$("#ImgDis"+h).hide(),a||D(b)}},F=function(){var a,b,d,e,f,g,h,i=zmUtil.getSelectedMails(),j=c+a;if(i[0][0]?a=i[0][0]:i[1][0]&&(a=i[1][0]),a){for(b=$("#zmC"+j+" img"),d=b.length,e=0;e<d;e++)f=b[e].src,g=f.substring(0,7),h=/(http|https):\//i,h.test(g)&&(b[e].src="");$("#ImgDis"+j).hide()}},G=function(a,b){var c=b.msgId;zmail.prevMails[c]&&(zmail.prevMails[c].data.mdata.CONTENT=a.mdata.CONTENT,zmail.prevMails[c].data.mdata.EXTIMG=a.mdata.EXTIMG,zmail.prevMails[c].data.mdata.BLCKCON=a.mdata.BLCKCON)},H=function(){var a,b=zmUtil.getSelectedMails();if(b[0][0]?a=b[0][0]:b[1][0]&&(a=b[1][0]),a){var c={accId:zmail.accId,msgId:a,folId:zmail.mailObj[a].FD,split:!1};zmAjq.XHR({u:zmail.conPath+"/md.do",t:"POST",fn:G,p:c,ep:{msgId:a}})}},I=function(a,b){if("success"===a.result){var c=b.action;"add"===c?(E("add"),H("add")):"del"===c&&(F(),H("del"))}},J=function(a,b){var c={},d={};d={action:a,accId:zmail.accId,value:b},c.action=a,c.value=b,zmAjq.XHR({u:zmail.conPath+"/editShowImages.do",t:"POST",fn:I,p:d,csr:"s",ep:c})},K=function(a,b){var c={t:"POST",u:zmail.conPath+"/readreceipt.do",p:{mode:b,msgId:a,accId:zmail.accId,folType:"p"}};zmAjq.XHR(c),zmail.mailObj[a].NS2=0},L=function(a,b){var c="";return c+=b?'<div class="SC_pct">':'<div class="SC_pct SC_Tfdr">',c+=zmPreviewTemplate.getTemplate("header",a),c+="</div>"},M=function(){$.subscribe("/mail/draftsaved",function(a,b){b=b||{};var c=b.draftId,d=b.msgId;if(c&&d){var e="[id$="+d+"New]",f=$(e);f.each(function(a,b){b=$(b),b.attr("data-mid",c);var e=b.attr("id");b.attr("id",e.replace(d+"New",c))})}})},N=function(a){if(a=a||{},"2"===zmail.collabVersion&&a.containerDOM&&a.mailID&&a.hasOwnProperty("state")){var b=a.containerDOM,c=a.mailID,d=a.state,e=a.tooltip||"",f=$(b).find("[data-mid="+c+"]").find(".js-shareicon");switch(f.attr("title",e),d){case 1:f.addClass("shd").show();break;case 0:f.removeClass("shd").show();break;case-1:f.removeClass("shd").hide();break;default:f.hide()}}},O=function(){"2"===zmail.collabVersion&&$.subscribe("/mail/collab/updateshareicon",function(a,b){b=b||{},N(b)})},P=function(a){var b;return zmail.listObj[a]&&(b=zmail.listObj[a].MO.length),b},Q={currentWorkSpace:"",getTemplate:function(a,b){var c=void 0!==b.opentype?b.opentype:b.prms.opentype;f(c),e();var d="";switch(a){case"content":d=v(b.data,b.prms);
break;case"header":d=u(b)}return d},attPrevInr:function(a,b){var c,d=zmUtil.fileTyp(a.fn);return c=a.thn?"<img src='"+a.thn+"'>":b?"<i class='"+d[1]+"'></i>":"<i class='"+d[1]+" SC_big'></i>"},getSubjectToPreview:function(a){var b=d.common.noSubject;return zmail.showFeature?a:(a&&(b=_zm.unescapeTags(a),b.length>1e3?(b=b.substring(0,1e3)+"...",b=_zm.escapeTags(b)):b=a),b)},bindPreviewEvents:function(b,c){zmUtil.addSelectMenu(b.find(".zmPCon")[0]),$(b).find(".SC_pct .zmPAtt").find(".zmAch").off("click").on("click",function(a){zmAttach.util.bindoptions(a,{from:"preview"}),_zm.stopEvents(a)}),$(b).find(".zmflg").each(function(){$(this).unbind("contextmenu").contextmenu(function(b){a.consFlagContextMenu(b,this)})}),3!==c&&($(b).scroll(function(){zmUtil.hideMenu()}),$(b).keydown(function(a){38!==a.keycode&&40!==a.keycode||zmUtil.hideMenu()})),$(b).undelegate("click").delegate("div.SC_pct","click",function(a){zmAttach.util.removeMAct(),z(a,b,c);var d=a.target||a.srcElement;($(d).hasClass("zm_ry")||$(d).parent().hasClass("zm_ry"))&&A(a,b),!zmUtil.isChildWindow()&&zmList.listingFocused&&0===zmPreviewTemplate.currentWorkSpace&&(zmList.listingFocused=!1,$(d).hasClass("zm_icn")&&$(d).hasClass("zm_sqt")&&(zmList.listingFocused=!0))}),3===c&&$(b).find(".SC_ptit .msi-more").off("click").on("click",function(){var a={msgId:$(b).attr("msgId"),groupId:$(b).attr("groupId"),opentype:2,type:"lt",isMail:!0,invokedFrom:"notification-popout"};if($.publish("zmstreamsapp/closeDialog",{}),!zmsuite.isMaxLimitReached()){var c=$(this).data("shared");if(c){var d;a.isSharedMail=!0,a.groupId!==zmail.zuid&&(d={viewDetails:{view:"zmncenter"}},a.tabId="zmncenter"),zmList.getMailData(a,d)}else zmStreamsApp.events.openPostInTab(a)}zmUtil.hideMenu()})},showImageDisplayElem:function(a,b){var d,e,f=c+a;if(d=zmail.prevMails[a].data.mdata.EXTIMG?zmail.prevMails[a].data.mdata.EXTIMG.link:"",d||"none"!==d){var g={MESSAGE:3,SHOW_NOW:0,WHITELIST:1,BLACKLIST:2};e=$("#ImgDis"+f).children(),"display"===d?(e.eq(g.MESSAGE).show(),e.eq(g.SHOW_NOW).show()):"both"===d?(e.eq(g.MESSAGE).show(),e.eq(g.SHOW_NOW).show(),e.eq(g.WHITELIST).show()):"remove"===d&&e.eq(g.BLACKLIST).show(),e.eq(g.SHOW_NOW).unbind("click").click(function(){i(this,b);var a="";(b.hasClass("SC_Twpr")||b.hasClass("SCS_popUp"))&&(a=b.attr("msgId")),E("",a)}),e.eq(g.BLACKLIST).unbind("click").click(function(){i(this,b),J("del",zmail.mailObj[a].F)}),e.eq(g.WHITELIST).unbind("click").click(function(){i(this,b),J("add",zmail.mailObj[a].F)}),zmUtil.applyLBDots($("#ImgDis"+f))}},saveHTMLFile:function(a){var b,c="",d=zmail.mailObj[a.mId]||"",e={};zmUtil.isSharedFolder(d.FD)&&(b=zmUtil.getShareId(d.FD)),c=zmail.conPath+"/FileDownload/msg"+a.mId+".html",e={entityId:a.mId,mode:"msg",entityType:1},d.streams?(e.groupId=d.groupId,e.streamsView=!0,e.actionType="viewGroupEntity"):e.accId=zmail.accId,b&&c.length&&(e.shId=b),zmAjq.formSubmit(e,c)},showOrgMsg:function(a){var b="",c=a.mId,d=zmail.mailObj[c];b=zmail.conPath+"/showorg.do?m="+c+"&sc=h",d?(d.FD&&zmUtil.isSharedFolder(d.FD)&&(b+="&shId="+zmUtil.getShareId(d.FD)),b+=d.streams?"&accId="+d.accId+"&groupId="+d.groupId+"&streamsView=true&actionType=viewGroupMailEntity&entityType=1&entityId="+c:"&accId="+zmail.accId):b+="&accId="+zmail.accId,zmUtil.openWindow(b,"60","60")},garbMsg:function(a){var b="",c=a.mId,d=zmail.mailObj[c];b=zmail.conPath+"/gmsg.do?m="+c,d&&(d.FD&&zmUtil.isSharedFolder(d.FD)&&(b+="&shId="+zmUtil.getShareId(d.FD)),b+=d.streams?"&accId="+d.accId+"&groupId="+d.groupId+"&streamsView=true&actionType=viewGroupMailEntity&entityType=1&entityId="+c:"&accId="+zmail.accId);var e=window.open(b,"_blank");e.focus()},printMsg:function(a){zmAppLoader.load("mailPrinter").done(function(){mailPrinter.processor(a)})},showProfilePhoto:function(a,b){var c=function(a,b){var c,d=zmail.aInfo[zmUtil.getZohoAccId()];return c=d.mailId===a?d.disName:b},d=zmail.prevMails[a.msgId]&&zmail.prevMails[a.msgId].data.mdata||"";if("lt"===a.type&&!zmail.mailObj[a.msgId].T||"th"===a.type){var e=d.FROM||zmail.mailObj[a.msgId].F,f=d.SENDER||zmail.mailObj[a.msgId].SN,g=$(b).find(".zmPHdr");$(g).length||(g=$(b)),f||(f=e),"Me"===f&&(f=c(e,f)),zmail.avatar.get({email:e,type:"dom",displayName:f}).done(function(a){$(g).find(".SC_pvul li img").remove(),$(g).find(".SC_pvul li").prepend(a),zmail.wmsAPI.showPresence(e,$(b).find(".SC_pvul .SC_avtr"))})}else zmail.mailObj[a.msgId].T&&$(b).find(".zmPHdr").each(function(){var a=$(this).attr("data-mid"),b=$(this).find(".SC_pvul li"),d=$(this).find(".SC_pvul img"),e=zmail.mailObj[a].F,f=zmail.mailObj[a].SN;f||(f=e),"Me"===f&&(f=c(e,f)),d.length&&e&&zmail.avatar.get({email:e,type:"dom",displayName:f}).done(function(a){$(b).find("div img").length||($(b).find("img").remove(),$(b).prepend(a),zmail.wmsAPI.showPresence(e,$(b).find(".SC_pvul .SC_avtr")))})})},processReadReceipt:function(a){var b=d.common.readreceiptmsg,c=zmail.mailObj[a],e=c&&c.NS2||0,f=zmail.mailOpt?zmail.mailOpt.askReceipt:1;3===e&&(1===f?zmsDialog.confirm(b,{onOk:function(){K(a,"yes")},onCancel:function(){K(a,"no")}}):0===f?K(a,"yes"):K(a,"no"))},showFullContent:function(a,b){var e,f,g,h=a.mdata.CONTENT?a.mdata.CONTENT:"",i=!1,k=b.prefix||c,l=b.msgId,m=$("#zmCon"+k+l);zmUtil.prevCache(l,a),f=m.closest(".SC_Twpr"),g=f.scrollTop(),e=m.find(".zm_icn.zm_sqt.SC_ttip"),e.next().is(":visible")&&(i=!0),a.mdata.BLCKCON&&(h+="lt"===b.type&&zmail.mailObj[l].TC>=0||"content"===b.type?["<div class='zm_icn zm_sqt SC_ttip' data-tooltip='",d.contentOptions.showquote,"'></div>","<div style='display:none'>"+a.mdata.BLCKCON+"</div>"].join(""):a.mdata.BLCKCON),h&&m.find(".zmPCnt").html(h),e=m.find(".zm_icn.zm_sqt.SC_ttip"),e.length&&i&&j(e),f.scrollTop(g)},addMailsInView:function(a){var b,c,d,e,f,g,h=a.list||[],i=a.opentype,j=h.length,k=0,l="",m="",n="",o="";if(0!==j){for(a.contElem?(b=a.contElem,o=a.elemPrefix,d=a.viewDetails,i=a.opentype):0===i?(d=zmInit.getListingDetObj(),n="zm_Container",o="P",b=zmsuite.getCenter(n)[1].getNodes()[1].$el):2===i&&(n="zm_tabt"+zmail.mailObj[h[0]].T,d=zmsuite.getCenterOuter(n).$el.data("data-detail"),o="T",b=zmsuite.getCenter(n)[1].getNodes()[1].$el),g=b.find("div.SC_pct").length,k=0;k<j;k++)c=zmail.mailObj[h[k]],f={msgId:c.M,thd:!0,opentype:i,frm:c.F,sender:c.SN,hasAtt:c.AT,sm:c.SM,label:c.TAG,flag:c.NFG,date:c.DT,elemId:o+c.M,hdrId:"zmHdr"},!c.streams&&zmUtil.getMLConversionValue()&&(f.showIndex=!0),zmUtil.isChildWindow()||(e=c.FD===d.fId||!zmail.folCount[d.fId]),m=L(f,e),l=zmail.convSortOrder?m.concat(l):l.concat(m);for(l.length&&(1===zmail.convSortOrder||"showmore"===a.mode?$(l).insertAfter(b.find("div.SC_pct:last")):b.prepend($(l)),b.parent().addClass("tmail"),a.setscroll&&(1===zmail.convSortOrder?zmUtil.setPreviewScroll(b.find("div.SC_pct").eq(g),b):zmUtil.setPreviewScroll(b.find("div.SC_pct:first"),b))),k=0;k<j;k++)zmPreviewTemplate.showProfilePhoto({msgId:h[k],type:"th"},$("#zmHdr"+o+h[k]))}},discardMsgPreview:function(a){a&&(zmUtil.isChildWindow()?$("#zmHdrW"+a).parent().remove():($("#zmHdrP"+a).parent().remove(),$("#zmHdrT"+a).parent().remove(),$("#zmHdrS"+a).parent().remove()))},showNotifBand:function(a){var b=a.targetElem,c=a.thdId,e=[],f=a.opentype;0===f?e=zmPreviewTemplate.getMissingMailList(c,"P"):2===f&&(e=zmPreviewTemplate.getMissingMailList(c,"T")),zmPreviewTemplate.removeNotifBand(b);var g=_zm.getDOM(["DIV",{attrs:{"class":"SC_new_activity",style:"opacity:1;",id:"zms_newmail"},child:[["text"," "+d.common.notificationmsg+" "]]}]);$(b).append(g),$(g).off("click").on("click",function(c){zmPreviewTemplate.removeNotifBand(b),$.publish("/mail/updatemailview",[{list:e,opentype:a.opentype,setscroll:!0}]),_zm.stopEvents(c)})},removeNotifBand:function(a){$(a).find(".SC_new_activity").remove()},refreshLabelsForMail:w,updateMailHeaderView:x,toggleHeaderState:r,applyHeaderState:s,constructAttachment:l,getRecipientCount:function(a){if(zmail.prevMails[a]){var b=zmail.prevMails[a].data.mdata,c=zmConUtil.splitncheck(b.TO||"","object").length;return c+=zmConUtil.splitncheck(b.CC||"","object").length,c+=zmConUtil.splitncheck(b.BCC||"","object").length}throw new Error(d.common.error)},alignMailTopToPreview:function(a){if(zmUtil.isMailOpenInPreview(a,zmTab.currentTab)){var b;"zm_Container"===zmTab.currentTab?b=$("#zmHdrP"+a):0===zmTab.currentTab.indexOf("zm_srch")&&(b=$("#zmHdrS"+a));var c=b.parent()[0],d=$(c).parent(".SC_Twpr")[0];d.scrollTop=c.offsetTop,$(c).removeClass("js-scrolltop")}},setPreviewHeaderHeight:function(a){if(a.prevElem){var b=$(a.prevElem).find(".SC_ptit"),c=$(a.prevElem).find(".SC_Twpr"),d=b[0].clientHeight;c.css({top:d+"px"})}},addDraftsToView:function(a,b,c){var d,e,f,g,h,i,j,k,l,m,n,o=0,p=0;zmail.listObj[a]&&(d=zmail.listObj[a].MO||[],o=d.length);var q=0;d=d||[],d.forEach(function(){e=zmail.mailObj[d[p]]||{},e.DMID&&q++}),e=void 0,zmUtil.requireComposeModule().done(function(){for(p=0;p<o;p++)e=zmail.mailObj[d[p]],k="",e&&e.DMID&&(j=c+e.DMID,g=e.M,f=b.find("#zmHdr"+c+g).closest(".SC_pct"),"undefined"!=typeof zmComp&&(l=zmComp.getCmpObjId(g),k=l.cmpId,m=l.composerType||"inline"),k?(n=b.find("#zmCon"+c+e.DMID),n.length||(h=zmUtil.getCmpContainerTemplate(j,e.DMID),$(h).insertAfter(f),n=b.find("#zmCon"+j)),zmPreviewTemplate.showDraftedBand({draftId:e.DMID,msgId:g,composeId:k,elemPrefix:c,prevDOM:n,composerType:m})):(h=zmUtil.getCmpContainerTemplate(j,e.DMID),$(h).insertAfter(f),i={mode:"draft",msgId:g,draftId:e.DMID,prevElem:b,draftCont:zmail.prevMails[e.DMID].data.mdata,loadType:"drafted",disableScrollIntoView:q>1},zmUtil.invokeComposer(i))),zmUtil.setInlineCmpScope(!0)})},showDraftedBand:function(a){var b,c,e,f,g,h,i,j,k,l,m="inline";b=a.draftId,c=a.msgId,e=a.composeId,f=a.elemPrefix,k=a.prevDOM,g=k.closest(".SC_Twpr"),m=a.composerType;var n;j=g.find("#zmHdr"+f+c).closest(".SC_pct"),"tab"===m?(l=d.inlinecompose.editdraftintab,n=d.inlinecompose.editingmsg):(l=d.inlinecompose.edithere,n=d.inlinecompose.hasdraft),k.length||(k=g.find(".SC_Drft").find("[data-mid='"+c+"']")),!k.length&&j.length&&b&&(h=["DIV",{attrs:{"class":"SC_pct SC_Drft"},child:[["DIV",{attrs:{id:"zmHdr"+f+b,"class":"zmPHdr","data-mid":b}}],["DIV",{attrs:{id:"zmCon"+f+b},child:[["DIV",{attrs:{"class":"SC_simg"},child:[["FONT",{attrs:{"composer-type":m,"data-cmpid":e,"class":"zm_draft"},child:[["text",l]]}],["SPAN",{child:[["text",n]]}]]}]]}]]}],i=_zm.getDOM(h),$(i).insertAfter(j));var o,p=$("[data-mid="+b+"]").parents(".SC_pct.SC_Drft"),q=p.find("[id^=zmCon]"),r=["DIV",{attrs:{"class":"SC_simg"},child:[["FONT",{attrs:{"composer-type":m,"data-cmpid":e,"class":"zm_draft"},child:[["text",l]]}],["SPAN",{child:[["text",n]]}]]}];q.each(function(b,c){c=$(c),o=_zm.getDOM(r),c.find(".zm_cmp").length&&"replace_draft"!==a.actionType||c.html(o)}),k.length&&(o=_zm.getDOM(r),k.find(".zm_cmp").length&&"replace_draft"!==a.actionType||k.html(o)),zmUtil.applyLBDots($(document.body).find(".zm_draft").parent(".SC_simg"))},loadInlineCompose:function(a,b,c){if(a){var d,e,f,g,h={};if(zmail.mailObj[a]&&zmail.mailObj[a].FD===zmail.folId.dId?d=zmail.mailObj[a].PA:(d=a,a=zmail.mailObj[a].DMID),h=zmComp.getCmpObjId(d),e=h.cmpId,g=h.composerType||"inline",f={mode:"draft",msgId:d,draftId:a,prevElem:b.closest(".SC_Twpr"),draftCont:zmail.prevMails[a].data.mdata,loadType:"drafted",reopen:!0,cmpId:e},c&&(f.loadMode=c),"tab"!==g)if(b.find(".zm_draft").length)b.html("");else if(b.find(".zm_cmp").length){var i=b.find(".zm_cmp").offset().top;f.prevElem.scrollTop(i)}zmUtil.invokeComposer(f),zmUtil.setInlineCmpScope(!0)}},setSlideShow:function(a,b){for(var c,d,e=a.length,f=[],g="",h=0;h<e;h++)c=a[h],g=c.e,d=zmail.mailObj[g],c.gId=d&&d.streams?d.groupId:zmail.zuid,f.push(c);zmUtil.cacheImageForPreview(a),$(b).find(".zmPAtt").find(".zmAch").each(function(a){$(this).find(".zmImg").click(function(b){if(b.stopPropagation(),zmUtil.isChildWindow()){var c={},d=[];d.push("msi-send"),d.push("msi-mail"),d.push("msi-search"),c.hideOptions=d,zmUtil.initAttSlideShow(f,a,!1,c)}else zmUtil.initAttSlideShow(f,a)})})},getAddToMenu:function(b){var c=[],e={};e.align="pleft",e.clk=function(c,d){c.msgId=b,a.bindAction(c,d)},e.divId="zm_dropaddto";var f=zmUtil.isSharedFolder(zmail.mailObj[b].FD);return zmail.mailObj[b]&&zmail.mailObj[b].FD!==zmail.folId.sId&&zmail.mailObj[b].FD!==zmail.folId.spId&&(c=[{htm:d.contextmenu.filters,data:{action:"addfilter",msgId:b}}]),!zmUtil.isZohoAccount(zmail.accId)||zmUtil.isChildWindow()||f||c.push({htm:d.contextmenu.tasks,data:{action:"addtotasks"}}),zmUtil.isZohoAccount(zmail.accId)&&zmUtil.isNoteReactUser()&&!zmUtil.isChildWindow()&&!f&&c.push({htm:d.contextmenu.notes,data:{action:"addtonotes"}}),zmUtil.isZohoAccount(zmail.accId)&&zmAdHocSettings.getProjectInteg().enabled&&!f&&c.push({htm:d.contextmenu.projects,data:{action:"addtoprojects"}}),zmUtil.isZohoAccount(zmail.accId)&&zmail.isSmartFilterEnabled&&zmail.mailObj[b]&&zmail.mailObj[b].FD!==zmail.folId.sId&&zmail.mailObj[b].FD!==zmail.folId.spId&&!f&&(c=c.concat({htm:"<i class='msi-larrow'></i>"+d.contentOptions.include,data:{action:"smartfiltermenu",msgId:b},child:function(){return zmPreviewTemplate.getSmartFilterMenu(b)}})),e.list=c,e},getSmartFilterMenu:function(b){var c=[],e={};return e.align="pleft",e.clk=function(c,d){c.msgId=b,a.bindAction(c,d)},e.divId="zm_dropsmartfilter",c=[{htm:d.smartfilter.notification,data:{action:"addsmartfilter",filtervalue:5,msgId:b}},{htm:d.smartfilter.newsletter,data:{action:"addsmartfilter",filtervalue:6,msgId:b}},{htm:d.smartfilter.group,data:{action:"addsmartfilter",filtervalue:7,msgId:b}}],e.list=c,e},createNewFilter:function(a){var b,c=a.msgId,d="",e="",f="",g="",h=[],i={};if(c&&(b=zmail.prevMails[c]?zmail.prevMails[c].data.mdata:zmail.mailObj[c])){e=b.SUBJECT||b.SB||"",g=b.FROM||b.F||"",f=b.TO||b.TOADDR||"",d=g.substring(0,g.indexOf("@")),f?b.CC&&"NOT PROVIDED"!==b.CC.toUpperCase()&&(f=f+","+b.CC):b.CC&&"NOT PROVIDED"!==b.CC.toUpperCase()&&(f=b.CC),f?(f=f.replace(/&lt;/gi,"<"),f=f.replace(/&gt;/gi,">"),f=f.replace(/&quot;/gi,'"'),h=f.split(",")):h="";var j=h.length,k=0,l=[],m="",n={};for(l.push({rhs:e,operator:"contains",lhs:"subject"}),l.push({rhs:g,operator:"contains",lhs:"sender"}),k=0;k<j;k++)m=h[k],m.indexOf("<")!==-1&&(m=m.substring(m.lastIndexOf("<")+1,m.lastIndexOf(">"))),m=m.trim(),h[k]=m,n={rhs:m,operator:"contains",lhs:"to/cc"},l.push(n);i.criterias=l,i.name=d,i.matchingCondition="or",$.publish("FILTER_SUGGESTION",i)}},editFilter:function(){},loadPrevMail:function(){var a,c,d,e,f=zmTab.currentTab,g=zmPrev.prevDetails(),h=[],i=zmUtil.getMLConversionValue(),j=zmUtil.getSelectedMails(),k=j[0][0]||j[1][0];if(g.msgId||k)$.when(zmPrev.cmpClose()).then(function(j){if(j){var l,m,n,o,p,q,r={};if(k=g.msgId,c=g.type,a=0,"zm_Container"===f&&"zmStreamTree"!==zmail.mailLeft.selLayerId)zmList.listingFocused=!0,r=zmInit.getListingDetObj(),r.fId===zmail.folId.spId&&2===i?i=1:r.fId!==zmail.folId.sId&&r.fId!==zmail.folId.tId||(i=0),"lt"===c?(q=0!==i&&zmail.mailObj[k]&&zmail.mailObj[k].TH?"t"+k:k,d=zmUtil.getFolId(),h=zmail.listObj[d].MO||[],l=h.indexOf(k),m=zmCenterListing.mailObjectAPI.getViewObject(k),m&&(n=m.$element,n.length||(m=zmList.getElemObj(f),n=m.find("#"+q))),n.length?(o=n.prev(),o.is(":visible")||(o=o.prev()),o.hasClass("zmTV")?(p=o.find(".zmL:last"),e=p.attr("id"),c="th"):o.hasClass("zmL")&&(e=o.attr("id"),c="lt")):e=h[l-1]):"th"===c&&(d=zmail.mailObj[k]?zmail.mailObj[k].T:"",d&&zmail.listObj[d]&&(h=zmList.getViewBasedMsgList(d,r)),l=h.indexOf(k),0===l?(m=zmCenterListing.mailObjectAPI.getViewParentOf("c"+k),m&&(n=m.$element,n.length||(m=zmList.getElemObj(f),n=m.find("#"+k).closest(".zmTV").prev())),n.length&&(o=n.prev(),o.is(":visible")||(o=o.prev()),o.hasClass("zmTV")?(p=o.find(".zmL:last"),e=p.attr("id"),c="th",q=k):o.hasClass("zmL")&&(e=o.attr("id"),q=e,c="lt"))):(q=k,e=h[l-1])),e&&zmPrev.updateListOnNavigation(k,b);else if("zm_srch1"===f)zmList.listingFocused=!0,b=zmSearchUtil.getSearchViewDetails(),h=zmSearchUtil.getSearchList()||[],l=h.indexOf(k),e=h[l-1],q=k;else if(!f.indexOf("zm_tab")){b=zmsuite.getCenterOuter().$el.data("data-detail"),g=zmsuite.getCenterOuter().$el.data("row-detail");var s=g.msgId;s.indexOf("t")||(s=s.substring(1)),c=g.type,d=zmUtil.getFolId(b),b.fId===zmail.folId.spId&&2===i?i=1:b.fId!==zmail.folId.sId&&b.fId!==zmail.folId.tId&&"search"!==b.view||(i=0),q="lt"===c&&0!==i&&zmail.mailObj[k]&&zmail.mailObj[k].TH?"t"+zmail.mailObj[k].T:k,k.indexOf("t")||(k=k.substring(1)),"lt"===c?"search"===d?h=zmSearchUtil.getSearchList():zmail.listObj[d]&&(h=zmail.listObj[d].MO||[]):"th"===c&&(d=zmail.mailObj[k]?zmail.mailObj[k].T:"",d&&zmail.listObj[d]&&(h=zmList.getViewBasedMsgList(d,b))),l=h.indexOf(s);var t=zmUtil.getFolId();if(l===-1&&d===t){for(var u=zmsuite.getCenterOuter().$el.data("data-maillist"),v=u.indexOf(s),w=u[v-1];w&&h.indexOf(w)===-1;)v-=1,w=u[v-1];l=h.indexOf(w)+1}e=h[l-1],a=2,e&&zmPrev.updateListOnNavigation(s,b)}if(e){zmList.getMailData({msgId:e,type:c,opentype:a,from:q}),"zm_Container"!==f&&"zm_srch1"!==f||!zmsuite.isWorkspaceAvailable(f)||("unread"!==b.view?zmUtil.initScroll(zmsuite.getCenter(f)[0].getNodes()[2].$el,e,q,"prev"):zmList.setScrollUnreadView(zmsuite.getCenter(f)[0].getNodes()[2].$el,e));var x=zmail.mailObj[k]?zmail.mailObj[k].FD:"";x&&zmUtil.isSharedFolder(x)&&zmail.prevMails[k]&&zmail.mailContainer.removeObject(k)}else zmUtil.disableNavigation(f,"prev")}});else{if(a=0,c="lt","zm_Container"===f&&"zmStreamTree"!==zmail.mailLeft.selLayerId){if(d=zmUtil.getFolId(),e=zmail.listObj[d].MO[0],!e)return}else{if("zm_srch1"!==f)return;if(e=zmSearchUtil.getSearchList()[0],!e)return}e&&zmList.getMailData({msgId:e,type:c,opentype:a})}},loadNextMail:function(){var a,b,c,d,e=zmTab.currentTab,f=zmPrev.prevDetails(),g=[],h=zmUtil.getMLConversionValue(),i=zmUtil.getSelectedMails(),j=i[0][0]||i[1][0];if(f.msgId||j)$.when(zmPrev.cmpClose()).then(function(i){if(i){var k,l,m,n,o,p,q={};if(j||(j=f.msgId),b=f.type,a=0,"zm_Container"===e&&"zmStreamTree"!==zmail.mailLeft.selLayerId){if(zmList.listingFocused=!0,q=zmInit.getListingDetObj(),q.fId===zmail.folId.spId&&2===h?h=1:q.fId!==zmail.folId.sId&&q.fId!==zmail.folId.tId||(h=0),"lt"===b)if(p=0!==h&&zmail.mailObj[j]&&zmail.mailObj[j].TH?"t"+j:j,c=zmUtil.getFolId(),g=zmail.listObj[c].MO||[],k=g.indexOf(j),k===-1&&zmail.mailObj[j]&&zmail.mailObj[j].TH&&(j=f.msgId,p=p.indexOf("t")?j:"t"+j),k=g.indexOf(j),m=[],l=zmCenterListing.mailObjectAPI.getViewObject(j),l&&(m=l.$element||[],m.length||(l=zmList.getElemObj(e),m=l.find("#"+p))),m.length){if(n=m.next(),n.is(":visible")||(n=n.next()),n.hasClass("zmTV"))o=n.find(".zmL").eq(1),d=o.attr("id"),b="th",p=j;else if(n.hasClass("zmL")){var r=n.next();r.hasClass("zmTV")&&r.is(":visible")?(d=r.find(".zmL:first").attr("id"),b="th"):(d=n.attr("id"),b="lt")}}else d=g[k+1];else if("th"===b)if(c=zmail.mailObj[j]?zmail.mailObj[j].T:"",c&&zmail.listObj[c]&&(g=zmList.getViewBasedMsgList(c,q)),k=g.indexOf(j),p=j,k===g.length-1){var s;l=zmCenterListing.mailObjectAPI.getViewParentOf("c"+j),l&&(m=l.$element,m.length||(l=zmList.getElemObj(e),m=l.find("#"+j).closest(".zmTV").prev()),s=m.next().next()),s.length&&(d=s.attr("id"),zmail.mailObj[d]&&zmail.mailObj[d].TH?(n=s.next(),n.hasClass("zmTV")&&n.is(":visible")||(n=n.prev()),n.hasClass("zmTV")?(o=n.find(".zmL:first"),d=o.attr("id"),b="th"):n.hasClass("zmL")&&(d=n.attr("id"),b="lt")):b="lt")}else d=g[k+1];d&&zmPrev.updateListOnNavigation(j,q)}else if("zm_srch1"===e)zmList.listingFocused=!0,q=zmSearchUtil.getSearchViewDetails(),g=zmSearchUtil.getSearchList()||[],k=g.indexOf(j),d=g[k+1],p=j;else if(!e.indexOf("zm_tab")){q=zmsuite.getCenterOuter().$el.data("data-detail"),f=zmsuite.getCenterOuter().$el.data("row-detail");var t=f.msgId;t.indexOf("t")||(t=t.substring(1)),b=f.type,c=zmUtil.getFolId(q),q.fId===zmail.folId.spId&&2===h?h=1:q.fId!==zmail.folId.sId&&q.fId!==zmail.folId.tId&&"search"!==q.view||(h=0),p="lt"===b&&0!==h&&zmail.mailObj[j]&&zmail.mailObj[j].TH?"t"+zmail.mailObj[j].T:j,j.indexOf("t")||(j=j.substring(1)),"lt"===b?"search"===c?g=zmSearchUtil.getSearchList():zmail.listObj[c]&&(g=zmail.listObj[c].MO||[]):"th"===b&&(c=zmail.mailObj[j]?zmail.mailObj[j].T:"",c&&zmail.listObj[c]&&(g=zmList.getViewBasedMsgList(c,q))),k=g.indexOf(t);var u=zmUtil.getFolId();if(k===-1&&c===u){for(var v=zmsuite.getCenterOuter().$el.data("data-maillist"),w=v.indexOf(t),x=v[w+1];x&&g.indexOf(x)===-1;)w+=1,x=v[w+1];k=g.indexOf(x)-1}d=g[k+1],a=2,d&&zmPrev.updateListOnNavigation(t,q)}if(d){zmList.getMailData({msgId:d,type:b,opentype:a,from:p}),"zm_Container"!==e&&"zm_srch1"!==e||!zmsuite.isWorkspaceAvailable(e)||("unread"!==q.view?zmUtil.initScroll(zmsuite.getCenter(e)[0].getNodes()[2].$el,d,p,"next"):zmList.setScrollUnreadView(zmsuite.getCenter(e)[0].getNodes()[2].$el,d));var y=zmail.mailObj[j]?zmail.mailObj[j].FD:"";y&&zmUtil.isSharedFolder(y)&&zmail.prevMails[j]&&zmail.mailContainer.removeObject(j)}else zmUtil.disableNavigation(e,"next")}});else{if(a=0,b="lt","zm_Container"===e&&"zmStreamTree"!==zmail.mailLeft.selLayerId){if(c=zmUtil.getFolId(),d=zmail.listObj[c].MO[0],!d)return}else{if("zm_srch1"!==e)return;if(d=zmSearchUtil.getSearchList()[0],!d)return}d&&zmList.getMailData({msgId:d,type:b,opentype:a})}},showUnsubscribe:function(a,b){if(zmail.prevMails[a]){var c=zmail.prevMails[a].data.mdata;c.USOBJ&&!$.isEmptyObject(c.USOBJ)&&($(b).find("[data-mid='"+a+"'] .zm_unsub").show(),c.USOBJ.USA===!0&&$(b).find("[data-mid='"+a+"'] .zm_unsub").text(d.newsletter.unsubscribed).removeClass("SC_lnk"))}},processUnsubscription:function(a,b){var c=function(c,e){"success"===c.status?(b&&$(b).length&&($(b).find("[data-mid='"+a+"'] .zm_unsub").text(d.newsletter.unsubscribed).removeClass("SC_lnk"),zmUtil.isChildWindow()||zmPreviewTemplate.updateUnsubscribeStatus(a)),zmail.prevMails[e.msgId]&&(zmail.prevMails[e.msgId].data.mdata.USOBJ.USA=!0),_zm.succErrMsg("s",d.newsletter.unsub_success)):_zm.succErrMsg("e",d.newsletter.unsub_failure)},e=function(b,d,e){e=e||c,zmail.prevMails[a].data.mdata.USOBJ.USA||zmAjq.XHR({u:zmail.conPath+"/unsubscribe.do",t:"POST",fn:e,p:b,ep:d,csr:"s"})},f=function(){var b,c,f=zmail.prevMails[a].data.mdata.USOBJ;b={accId:zmail.accId,mode:"add",msgId:a},c={msgId:a},f.USL?b.link=f.USL:f.USM&&(b.send=!0,b.mailto=f.USM,b.from=zmail.aInfo[zmail.accId].mailId,f.USS&&(b.subject=f.USS),f.USC&&(b.content=f.USC)),zmsDialog.confirm(d.newsletter.confirm_link,{onOk:function(){zmsDialog.remove(),e(b,c)}})},g=function(){if(!$("#unsubscribepopup").length){var b=["DIV",{attrs:{id:"unsubscribepopup",style:""},child:[["H4",{child:[["text",d.newsletter.confirm_mail],["DIV",{attrs:{"class":"mail_opt"},child:[["I",{attrs:{"class":"msi-option",value:"true"}}],["SPAN",{child:[["text",d.newsletter.confirm_mail_unsubscribe]]}]]}],["DIV",{attrs:{"class":"mail_opt"},child:[["I",{attrs:{"class":"msi-unoption",value:"false"}}],["SPAN",{child:[["text",d.newsletter.confirm_mail_markspam]]}]]}]]}]]}],c=_zm.getDOM(b);$("body").append(c);var f=$("div.mail_opt",c),g=$("i",f);f.on("click",function(){g.removeClass().addClass("msi-unoption"),$(this).closest("div").find("i").removeClass().addClass("msi-option")});var h=function(){var b,c,d,g=zmail.prevMails[a].data.mdata.USOBJ;b={accId:zmail.accId,mode:"add",msgId:a},c={msgId:a},g.USM&&(d=$("i.msi-option",f).attr("value"),b.mailto=g.USM,b.from=zmail.aInfo[zmail.accId].mailId,g.USS&&(b.subject=g.USS),g.USC&&(b.content=g.USC),"true"===d&&(b.send=!0),zmsDialog.remove(),e(b,c))},i={title:d.newsletter.unsubscribe,style:{width:"500px"},buttons:[{txt:"OK",selected:!0,callback:h},{isCancel:!0,txt:"Cancel",callback:function(){zmsDialog.remove(),$("#unsubscribepopup").remove()}}],drag:!0,mask:!0,hideclose:!1,pos:"center"};zmsDialog.create("unsubscribepopup",i)}},h=function(a){"success"===a.status&&(a.valid?f():g())};if(zmail.prevMails[a]){var i,j=zmail.prevMails[a].data.mdata,k={},l={},m={};if(i=j.USOBJ,!i||i.USA===!0)return;i.USL?(m.link=i.USL,l={msgId:a,selector:b},h({status:"success",valid:!0},l)):i.USM&&(k={accId:zmail.accId,mode:"check",msgId:a},l={msgId:a,selector:b},e(k,l,h))}},updateUnsubscribeStatus:function(a){if(a){var b,c,e,f=zmTab.tabArr;for(b=0;b<f.length;b++)e=f[b].appId,zmsuite.isWorkspaceAvailable(e)&&zmsuite.getCenter(e)[1]&&(c=zmsuite.getCenter(e)[1].getNodes()[1].$el,c.find("[data-mid='"+a+"'] .zm_unsub").text(d.newsletter.unsubscribed))}},showInvitation:function(a,b,e){if(a&&zmail.prevMails[a]&&zmail.prevMails[a].data.mdata.CALOBJ){var f,g=zmail.prevMails[a].data.mdata,h=g.CALOBJ,i=h.mtd,j="",k="",l=e&&e.prefix,m=h.attendee?h.attendee.length:0;k=g.TO||"",k=zmConUtil.splitncheck(k,"object"),h.desc&&(h.desc=h.desc.replace(/\\n/g,"\n").replace(/\\t/g,"\t").replace(/\\r/g,"\r").replace(/\\b/g,"\b").replace(/\\v/g,"\x0B").replace(/\\f/g,"\f"));var n=function(a){var b="",c=[];if(b=a[0].eid,a.length>1){for(var d in zmail.aInfo)c.push(zmail.aInfo[d].mailId);for(var e=0;e<a.length;e++)if(c.indexOf(a[e].eid)!==-1){b=a[e].eid;break}}return b};k=k.length?n(k):"";var o=function(){var a,b="";a=g.FROM;var c=zmConUtil.contactInfo({eid:a});return void 0!==c&&c.json&&c.json.photo&&(b=c.json.photo),b},p=function(a){var b={};if(a){var c=a.split(",");if(c.length>0){var d=c[0];if(d){var e=d.split(" ");3===e.length&&(b.day=e[0],b.month=e[1],b.date=e[2])}}}return b},q=p(h.time),r=o(),s={eventAttendees:function(){var a,b=[];for(a=0;a<m;a++)b.push(["B",{child:[["text",h.attendee[a].emailId]]}]),a<m-1&&b.push(["text",", "]);var c=["P",{child:b}];return c},eventStatus:function(a){var b=[],c=[],e=!1;return"yes"===a?(e=!0,b.push(["LI",{attrs:{"class":"sel","data-type":"evntSts1"},child:[["text",d.calendar.yes]]}],["LI",{attrs:{"data-type":"evntSts3"},child:[["text",d.calendar.maybe]]}],["LI",{attrs:{"data-type":"evntSts2"},child:[["text",d.calendar.no]]}])):"no"===a?(e=!0,b.push(["LI",{attrs:{"data-type":"evntSts1"},child:[["text",d.calendar.yes]]}],["LI",{attrs:{"data-type":"evntSts3"},child:[["text",d.calendar.maybe]]}],["LI",{attrs:{"class":"sel","data-type":"evntSts2"},child:[["text",d.calendar.no]]}])):"maybe"===a?(e=!0,b.push(["LI",{attrs:{"data-type":"evntSts1"},child:[["text",d.calendar.yes]]}],["LI",{attrs:{"class":"sel","data-type":"evntSts3"},child:[["text",d.calendar.maybe]]}],["LI",{attrs:{"data-type":"evntSts2"},child:[["text",d.calendar.no]]}])):"nostatus"===a&&(e=!0,b.push(["LI",{attrs:{"data-type":"evntSts1"},child:[["text",d.calendar.yes]]}],["LI",{attrs:{"data-type":"evntSts3"},child:[["text",d.calendar.maybe]]}],["LI",{attrs:{"data-type":"evntSts2"},child:[["text",d.calendar.no]]}])),e&&(c=["UL",{attrs:{"data-type":"event_status","class":"zmEventAction"},child:b}]),c},eventCreatedAndAdded:function(a){var b,c={};return c=["DIV",{attrs:{"class":"zmEventInfo zmEvInv"},child:[["DIV",{attrs:{"class":"zmEventWra"},child:[["DIV",{attrs:{"class":"zmEventDate"},child:[["text",q.month],["SPAN",{child:[["text",q.date]]}],["text",q.day]]}],["DIV",{attrs:{"class":"zmEventIC"},child:[["STRONG",{child:[["text",m]]}],["text"," "+d.calendar.invited]]}],["DIV",{attrs:{"class":"zmEventData"},child:[["DIV",{attrs:{"class":"zmEventOr"},child:[["DIV",{attrs:{"class":"zmImg"},child:[["IMG",{attrs:{src:r}}]]}],["STRONG",{child:[["text",g.SENDER]]}],["B",{child:[["text",g.FROM]]}],["text"," invites you"]]}],["H3",{child:[["text",h.title]]}],["P",{child:[["text",h.time]]}],s.eventAttendees(),["P",{child:[["text",h.desc]]}],s.eventStatus(a),["B",{attrs:{"data-type":"viewEvent"},child:[["text",d.calendar.viewevent]]}]]}]]}]]}],b=_zm.getDOM(c)},inviteAccepted:function(){var a,b={};return b=["DIV",{attrs:{"class":"zmEventInfo zmEvAcc"},child:[["DIV",{attrs:{"class":"zmEventStatus"},child:[["text",zmText.applyArgs(d.calendar.acceptedmsg,{sendername:g.SENDER})]]}],["DIV",{attrs:{"class":"zmEventWra"},child:[["DIV",{attrs:{"class":"zmEventDate"},child:[["text",q.month],["SPAN",{child:[["text",q.date]]}],["text",q.day]]}],["DIV",{attrs:{"class":"zmEventData"},child:[["DIV",{attrs:{"class":"zmEventOr"},child:[["DIV",{attrs:{"class":"zmImg"},child:[["IMG",{attrs:{src:r}}]]}],["STRONG",{child:[["text",g.SENDER]]}],["B",{child:[["text",g.FROM]]}]]}],["H3",{child:[["text",h.title]]}],["P",{child:[["text",h.time]]}]]}]]}]]}],a=_zm.getDOM(b)},inviteDeclined:function(){var a,b={};return b=["DIV",{attrs:{"class":"zmEventInfo zmEvDec"},child:[["DIV",{attrs:{"class":"zmEventStatus"},child:[["text",zmText.applyArgs(d.calendar.declinedmsg,{sendername:g.SENDER})]]}],["DIV",{attrs:{"class":"zmEventWra"},child:[["DIV",{attrs:{"class":"zmEventDate"},child:[["text",q.month],["SPAN",{child:[["text",q.date]]}],["text",q.day]]}],["DIV",{attrs:{"class":"zmEventData"},child:[["DIV",{attrs:{"class":"zmEventOr"},child:[["DIV",{attrs:{"class":"zmImg"},child:[["IMG",{attrs:{src:r}}]]}],["STRONG",{child:[["text",g.SENDER]]}],["B",{child:[["text",g.FROM]]}]]}],["H3",{child:[["text",h.title]]}],["P",{child:[["text",h.time]]}]]}]]}]]}],a=_zm.getDOM(b)},inviteTentativelyAccepted:function(){var a,b={};return b=["DIV",{attrs:{"class":"zmEventInfo zmEvMay"},child:[["DIV",{attrs:{"class":"zmEventStatus"},child:[["text",zmText.applyArgs(d.calendar.tentativemsg,{sendername:g.SENDER})]]}],["DIV",{attrs:{"class":"zmEventWra"},child:[["DIV",{attrs:{"class":"zmEventDate"},child:[["text",q.month],["SPAN",{child:[["text",q.date]]}],["text",q.day]]}],["DIV",{attrs:{"class":"zmEventData"},child:[["DIV",{attrs:{"class":"zmEventOr"},child:[["DIV",{attrs:{"class":"zmImg"},child:[["IMG",{attrs:{src:r}}]]}],["STRONG",{child:[["text",g.SENDER]]}],["B",{child:[["text",g.FROM]]}]]}],["H3",{child:[["text",h.title]]}],["P",{child:[["text",h.time]]}]]}]]}]]}],a=_zm.getDOM(b)},eventCreatedAndNotAdded:function(){var a,b={};return b=["DIV",{attrs:{"class":"zmEventInfo zmEvInv"},child:[["DIV",{attrs:{"class":"zmEventWra"},child:[["DIV",{attrs:{"class":"zmEventDate"},child:[["text",q.month],["SPAN",{child:[["text",q.date]]}],["text",q.day]]}],["DIV",{attrs:{"class":"zmEventIC"},child:[["STRONG",{child:[["text",m]]}],["text"," "+d.calendar.invited]]}],["DIV",{attrs:{"class":"zmEventData"},child:[["DIV",{attrs:{"class":"zmEventOr"},child:[["DIV",{attrs:{"class":"zmImg"},child:[["IMG",{attrs:{src:r}}]]}],["STRONG",{child:[["text",g.SENDER]]}],["B",{child:[["text",g.FROM]]}],["text"," invites you"]]}],["H3",{child:[["text",h.title]]}],["P",{child:[["text",h.time]]}],s.eventAttendees(),["P",{child:[["text",h.desc]]}],["B",{attrs:{"data-type":"viewEvent",style:"display:none"},child:[["text",d.calendar.viewevent]]}],["P",{child:[["B",{attrs:{"data-type":"addToCal"},child:[["text",d.calendar.addtocal]]}]]}]]}]]}]]}],a=_zm.getDOM(b)},eventCancelled:function(){var a,b={};return b=["DIV",{attrs:{"class":"zmEventInfo zmEvCan"},child:[["DIV",{attrs:{"class":"zmEventWra"},child:[["DIV",{attrs:{"class":"zmEventDate"},child:[["text",q.month],["SPAN",{child:[["text",q.date]]}],["text",q.day]]}],["DIV",{attrs:{"class":"zmEventData"},child:[["DIV",{attrs:{"class":"zmEventOr"},child:[["DIV",{attrs:{"class":"zmImg"},child:[["IMG",{attrs:{src:r}}]]}],["STRONG",{child:[["text",g.SENDER]]}],["B",{child:[["text",g.FROM]]}]]}],["H3",{child:[["text",h.title]]}],["P",{child:[["text",h.time]]}]]}]]}],["DIV",{attrs:{"class":"zmEventTag"},child:[["SPAN",{child:[["text",d.calendar.cancelled]]}]]}]]}],a=_zm.getDOM(b)},eventAddedExpired:function(a){var b,c={};return c=["DIV",{attrs:{"class":"zmEventInfo zmEvExp"},child:[["DIV",{attrs:{"class":"zmEventWra"},child:[["DIV",{attrs:{"class":"zmEventDate"},child:[["text",q.month],["SPAN",{child:[["text",q.date]]}],["text",q.day]]}],["DIV",{attrs:{"class":"zmEventIC"},child:[["STRONG",{child:[["text",m]]}],["text"," "+d.calendar.invited]]}],["DIV",{attrs:{"class":"zmEventData"},child:[["DIV",{attrs:{"class":"zmEventOr"},child:[["DIV",{attrs:{"class":"zmImg"},child:[["IMG",{attrs:{src:r}}]]}],["STRONG",{child:[["text",g.SENDER]]}],["B",{child:[["text",g.FROM]]}],["text"," invites you"]]}],["H3",{child:[["text",h.title]]}],["P",{child:[["text",h.time]]}],s.eventAttendees(),["P",{child:[["text",h.desc]]}],s.eventStatus(a),["B",{attrs:{"data-type":"viewEvent"},child:[["text",d.calendar.viewevent]]}],["P",{child:[["B",{attrs:{"data-type":"deleteEvent"},child:[["text",d.calendar.deleteevent]]}]]}]]}]]}],["DIV",{attrs:{"class":"zmEventTag"
},child:[["SPAN",{child:[["text",d.calendar.expired]]}]]}]]}],b=_zm.getDOM(c)},eventNotAddedExpired:function(){var a,b={};return b=["DIV",{attrs:{"class":"zmEventInfo zmEvExp"},child:[["DIV",{attrs:{"class":"zmEventWra"},child:[["DIV",{attrs:{"class":"zmEventDate"},child:[["text",q.month],["SPAN",{child:[["text",q.date]]}],["text",q.day]]}],["DIV",{attrs:{"class":"zmEventIC"},child:[["STRONG",{child:[["text",m]]}],["text"," "+d.calendar.invited]]}],["DIV",{attrs:{"class":"zmEventData"},child:[["DIV",{attrs:{"class":"zmEventOr"},child:[["DIV",{attrs:{"class":"zmImg"},child:[["IMG",{attrs:{src:r}}]]}],["STRONG",{child:[["text",g.SENDER]]}],["B",{child:[["text",g.FROM]]}],["text"," invites you"]]}],["H3",{child:[["text",h.title]]}],["P",{child:[["text",h.time]]}],s.eventAttendees(),["P",{child:[["text",h.desc]]}]]}]]}],["DIV",{attrs:{"class":"zmEventTag"},child:[["SPAN",{child:[["text",d.calendar.expired]]}]]}]]}],a=_zm.getDOM(b)},eventInfo:function(){var a,b={};return b=["DIV",{attrs:{"class":"zmEventInfo zmEvInv"},child:[["DIV",{attrs:{"class":"zmEventWra"},child:[["DIV",{attrs:{"class":"zmEventDate"},child:[["text",q.month],["SPAN",{child:[["text",q.date]]}],["text",q.day]]}],["DIV",{attrs:{"class":"zmEventIC"},child:[["STRONG",{child:[["text",m]]}],["text"," "+d.calendar.invited]]}],["DIV",{attrs:{"class":"zmEventData"},child:[["DIV",{attrs:{"class":"zmEventOr"},child:[["DIV",{attrs:{"class":"zmImg"},child:[["IMG",{attrs:{src:r}}]]}],["STRONG",{child:[["text",g.SENDER]]}],["B",{child:[["text",g.FROM]]}]]}],["H3",{child:[["text",h.title]]}],["P",{child:[["text",h.time]]}],s.eventAttendees(),["P",{child:[["text",h.desc]]}]]}]]}]]}],a=_zm.getDOM(b)},eventsNotImported:function(){var a,b={};return b=["DIV",{attrs:{"class":"zmEventInfo zmEvInv"},child:[["DIV",{attrs:{"class":"zmEventWra"},child:[["DIV",{attrs:{"class":"zmEventDate"},child:[["text",q.month],["SPAN",{child:[["text",q.date]]}],["text",q.day]]}],["DIV",{attrs:{"class":"zmEventIC"},child:[["STRONG",{child:[["text",m]]}],["text"," "+d.calendar.invited]]}],["DIV",{attrs:{"class":"zmEventData"},child:[["DIV",{attrs:{"class":"zmEventOr"},child:[["DIV",{attrs:{"class":"zmImg"},child:[["IMG",{attrs:{src:r}}]]}],["STRONG",{child:[["text",g.SENDER]]}],["B",{child:[["text",g.FROM]]}],["text"," invites you"]]}],["H3",{child:[["text",h.title]]}],["P",{child:[["text",h.time]]}],s.eventAttendees(),["P",{child:[["text",h.desc]]}],["P",{child:[["B",{attrs:{"data-type":"addToCal"},child:[["text",d.calendar.addtocal]]}]]}]]}]]}]]}],a=_zm.getDOM(b)}},t={getAttendeeStatus:function(){var a=$.Deferred(),b=function(b){return a.resolve(),b},c=function(b){return a.resolve(),b},d={toMailId:k,jsoparam:JSON.stringify(h)},e={url:zmail.conPath+"/zcal/api/private/json/getAttendeeStatus",type:"POST",success:b,error:c,data:d};return $.ajax(e)},showEventStatus:function(){switch(j){case"nostatus":case"yes":case"no":case"maybe":f=s.eventCreatedAndAdded(j);break;case"disable":f=s.eventNotAddedExpired();break;case"disable:0":f=s.eventAddedExpired("nostatus");break;case"disable:1":f=s.eventAddedExpired("yes");break;case"disable:2":f=s.eventAddedExpired("no");break;case"disable:3":f=s.eventAddedExpired("maybe");break;case"No Change":"CANCEL"===i?f=s.eventCancelled():"REPLY"===i?"accepted"===h.status?f=s.inviteAccepted():"declined"===h.status?f=s.inviteDeclined():"tentatively accepted"===h.status&&(f=s.inviteTentativelyAccepted()):"ADD"!==i&&"COUNTER"!==i&&"REFRESH"!==i&&"DECLINECOUNTER"!==i||(f=s.eventInfo());break;case"Add Event":f=s.eventsNotImported();break;case"Update Event":f=s.eventInfo();break;default:f=s.eventCreatedAndNotAdded()}l=l||c;var d=e&&"print"===e.from?$(b):$(b).find("#zmCon"+l+a);if(!d.find("div.zmEventInfo").length){var g=d.find("div.zmPCnt td:first div");g.length>0?g.eq(0).prepend(f):d.find("div.zmPCnt td:first").prepend(f)}},parseStatusResponse:function(a){var b="";if("REQUEST"===i){if(a=$.parseJSON(a),a.time&&(h.time=a.time,q=p(h.time)),void 0!==a.isEventAvailable&&a.isEventAvailable)if(void 0!==a.isExpired&&a.isExpired){if(void 0!==a.status)return"disable:"+a.status;if("zcrm"===h.service)return"disable"}else void 0!==a.status&&(a=String(a.status));else if(void 0!==a.isExpired&&a.isExpired)return"disable"}else if("CANCEL"===i||"PUBLISH"===i)return a;if(a.length<=3)switch(a){case"0":b="nostatus";break;case"1":b="yes";break;case"2":b="no";break;case"3":b="maybe";break;case"4":b="disable";break;default:b=""}else b="";return b},updateStatus:function(a,b){if(a){var c={jsoparam:JSON.stringify(h),toMailId:k,status:a},e=function(){b&&($(b).closest(".zmEventAction").children().removeClass("sel"),$(b).addClass("sel"))},f=function(b){b instanceof Object||(b=b.trim(),"Status Updated"===b?(j=a,zmUtil.succErrMsg("s",d.calendar.statusupdated),e()):"Status Update Failed"===b?zmUtil.succErrMsg("e",d.calendar.statusfailed):"Event Expired"===b?zmUtil.succErrMsg("e",d.calendar.expired):"Event Not present in calendar"===b&&zmUtil.succErrMsg("e",d.calendar.noevent))},g=function(a){a&&(a instanceof Object?zmUtil.succErrMsg("e",a.statusText):zmUtil.succErrMsg("e",d.calendar.statusfailed))},i={url:zmail.conPath+"/zcal/api/private/json/StatusUpdate",type:"POST",success:f,error:g,data:c};$.ajax(i)}},acceptInvitation:function(a){"yes"!==j&&t.updateStatus("yes",a)},declineInvitation:function(a){"no"!==j&&t.updateStatus("no",a)},tentativeAcceptance:function(a){"maybe"!==j&&t.updateStatus("maybe",a)},viewEventInCalendar:function(){var a="//"+zmail.urls.calURL+"/mailapiact.do?mode=viewmaileve&jsoparam="+encodeURIComponent(JSON.stringify(h)),b=window.open(a,"_blank");b.focus()},addEventToCalendar:function(b){var c=function(){if(b){var a=$(b).closest(".zmEventData");a.find("[data-type='addToCal']").remove()}},e=function(){if(b){var a=$(b).closest(".zmEventData");a.find("[data-type='viewEvent']").show()}},f=function(a){if(a){try{$.parseJSON(a),a=$.parseJSON(a)}catch(b){}a instanceof Object?(a=a.response?a.response:a,a.error&&a.error.message?zmUtil.succErrMsg("e",a.error.message):zmUtil.succErrMsg("e",d.attachmentmenu.eventerror)):(a=a.trim(),"Added Successfully"===a?(zmUtil.succErrMsg("s",d.attachmentmenu.eventadded),e(),c()):"Event Updated Successfully"===a&&(zmUtil.succErrMsg("s",d.attachmentmenu.eventupdated),e(),c()))}},g=function(a){a&&(a instanceof Object?zmUtil.succErrMsg("e",a.statusText):zmUtil.succErrMsg("e",d.attachmentmenu.eventerror))},i={url:zmail.conPath+"/zcal/mailapiact.do?mode=addmaileve",type:"POST",success:f,error:g,data:{msgId:a,accId:zmail.accId,jsoparam:JSON.stringify(h)}};$.ajax(i)},deleteEventFromCalendar:function(a){var b={jsoparam:JSON.stringify(h)},c=function(){if(a){var b=$(a).closest(".zmEventData");b.find(".zmEventAction").remove(),b.find("[data-type='viewEvent']").remove(),b.find("[data-type='deleteEvent']").remove()}},e=function(a){var b;void 0!==a.response&&a.response.result&&(b=a.response.result.eKey,c(),"0"!==b?zmUtil.succErrMsg("s",d.calendar.eventdeleted):"0"===b&&zmUtil.succErrMsg("s",d.calendar.deletedalready))},f=function(a){a&&(a instanceof Object?zmUtil.succErrMsg("e",a.statusText):zmUtil.succErrMsg("e",d.calendar.deletionfailed))},g={url:zmail.conPath+"/zcal/mailapiact.do?mode=deletemaileve",type:"POST",success:e,error:f,data:b};$.ajax(g)},bindEvents:function(){var a=$(f);a.off("click").on("click",function(a){var b,c=a.srcElement||a.target;switch(b=$(c).attr("data-type")||""){case"evntSts1":$(c).closest(".zmEventAction").children().removeClass("sel"),$(c).addClass("sel"),t.acceptInvitation(c);break;case"evntSts2":$(c).closest(".zmEventAction").children().removeClass("sel"),$(c).addClass("sel"),t.declineInvitation(c);break;case"evntSts3":$(c).closest(".zmEventAction").children().removeClass("sel"),$(c).addClass("sel"),t.tentativeAcceptance(c);break;case"viewEvent":t.viewEventInCalendar(c);break;case"addToCal":t.addEventToCalendar(c);break;case"deleteEvent":t.deleteEventFromCalendar(c)}})}};"PUBLISH"===i||"REQUEST"===i||"CANCEL"===i?$.when(t.getAttendeeStatus()).then(function(a){j=t.parseStatusResponse(a),j=j.trim(),t.showEventStatus(),e&&"print"!==e.from||t.bindEvents()}):"REPLY"!==i&&"COUNTER"!==i&&"ADD"!==i&&"REFRESH"!==i&&"DECLINECOUNTER"!==i||(j="No Change",t.showEventStatus(),e&&"print"!==e.from||t.bindEvents())}},addShowMoreMailsLink:function(a,b){if(a.contElem.length){var c='<div class="SC_simg"><font class="zm_shwconv">'+d.contentOptions.showmore+"</font></div>";$(c).insertAfter(a.contElem.find("div.SC_pct:last")),a.contElem.find(".zm_shwconv").off("click").on("click",function(){$(this).parent().remove(),zmPreviewTemplate.fetchMoreMails(a.contElem.parent(),b)})}},fetchMoreMails:function(a,b){var d,e=$(a).find("div.SC_pct:first").parent(),f=e.data("msg_params"),g={accId:zmail.accId,summary:!0},h=f.msgId;if(h.indexOf("t")!==-1&&(h=h.substring(1)),d=zmail.mailObj[h]?zmail.mailObj[h].T:""){var i=!1;zmUtil.isChildWindow()&&(i=!0),g.thId=d,f.shId&&zmUtil.getFolderIdwithShId(f.shId)&&(g.shId=f.shId),f.streamsShowMail&&(g.streamsView=!0),f.entityType&&(g.entityType=f.entityType),f.actionType&&(g.actionType=f.actionType),f.groupId&&(g.groupId=f.groupId),f.entityId&&(g.entityId=d);var j=function(a,b){var d,g=b.thId,h=zmail.listObj[g].MO;d=i?zmWindow.addinList(g,a.tdata):zmCache.dolistObj(g,a.tdata),zmail.listObj[g].showNextPage=0;var j=0,k=d.MO.length;for(j=0;j<k;j++)h.indexOf(d.MO[j])===-1&&h.push(d.MO[j]);void 0!==d.showNextPage&&(zmail.listObj[g].showNextPage=d.showNextPage),zmUtil.isInlineCompose()&&zmUtil.mapDraftId(g);var l=zmPreviewTemplate.getMissingMailList(g,c);zmPreviewTemplate.addMailsInView({list:l,contElem:e,elemPrefix:c,viewDetails:f.elemObj.viewDetails,opentype:f.opentype,mode:"showmore"}),1===zmail.listObj[g].showNextPage&&zmPreviewTemplate.addShowMoreMailsLink({contElem:e})},k=P(d);k&&(g.thdindex=k);var l=$.extend({},g);l.from="tIcon",l.opentype=b,l.contElem=e,i?(l.fetchMoreMails=!0,zmWindow.sendMailDataReq(g,l,j)):zmList.sendMailDataReq(g,l,j)}},getMissingMailList:function(a,b){var c,d,e=[],f=zmail.listObj[a].MO.slice(),g=f.length;for(c="zmHdr"+b,1===zmail.convSortOrder&&f.reverse(),d=0;d<g;d++)zmUtil.isInlineCompose()&&zmail.mailObj[f[d]]&&(zmail.mailObj[f[d]].FD===zmail.folId.dId||zmail.mailObj[f[d]].FD===zmail.folId.tId)||$("#"+c+f[d]).length||e.push(f[d]);return e},_rPath:function(a,b){var c,d={},e="",f="",g="",h="",i="",j="",k=a.delegate,l=[],m=[],n="",o="",p="";if(a.frm&&(n=a.frm),a.rPath){var q=a.rPath;for(q=q.replace(/</gi,""),q=q.replace(/>/gi,""),m=q.split(","),m=_.uniq(m),c=0;c<=m.length;c++)f=m[c],f&&(g=f.indexOf("@"),g!==-1&&(o+="<b>"+f.substr(g+1)+"</b>"),f.indexOf("zmgrbounces")===-1&&f.toLowerCase()!==n.toLowerCase()||(m.splice(c,1),c--))}if(m.length){for(c=0;c<=m.length;c++)f=m[c],f&&(g=f.indexOf("@"),g!==-1&&l.push(f.substr(g+1)));var r=n;if(r){r=r.replace(/</gi,""),r=r.replace(/>/gi,"");var s=r.indexOf("@");s!==-1&&(r=r.substr(s+1))}o=l.join(","),p=m.join(","),p=p.replace(/</gi,""),p=p.replace(/>/gi,""),i="redtxt",h="Sent by",j="via",1===l.length&&r===l[0]&&(i="ylwtxt"),k&&(i="bluetxt",h="Sent by",j="delegate")}if("less"===b){var t=$("<div/>");t.attr("data-zmvia","less"),t.attr("title",n),t.attr("class","SC_cs"),t.attr("data-eid",n);var u=$("<span/>");if(u.text(zmUtil.replaceHTMLEntities(n)),t.append(u),m.length){var v=$("<span/>");v.attr("class",i),v.text("via"),t.append(v);var w=$("<span/>");w.text(o),t.append(w)}if(e=t[0].outerHTML,"delegate"===j){var x=$("<div/>");x.attr("class","SC_cs");var y=$("<span/>");if(y.text(n),x.append(y),m.length){var z=$("<span/>");z.attr("class",i),z.text("delegated via"),x.append(z);var A=$("<span/>");A.text(o),x.append(A)}e=x[0].outerHTML}}else"via"===b?e='<span class="'+i+'">via</span><span>'+o+"</span>":m.length&&(e='<div id="zmRPATH'+a.elemId+'" class="zmpdtl zmvia">',e+='<div><div class="zmpr">',e+="delegate"===j?'<span><em class="'+i+'" title="'+h+'">'+h+"</em><span>"+p+"</span></span>":'<span><em class="'+i+'" title="'+h+'">'+h+"</em><span>"+p+"</span></span>",e+="</div></div></div>");return d._viaType=j,d._str=e,d},classifySmartFilter:function(a,b,c,e){if(a&&b&&void 0!==c){var f;f=zmUtil.isChildWindow()?opener.zmailSettings:zmailSettings,f.FilterApp.categoriseMail({msgId:a,filType:b,include:c}).done(function(){c?(zmail.mailObj[a].SFT=b,_zm.succErrMsg("s",d.smartfilter.include)):(zmail.mailObj[a].SFT=0,e.find(".zm_exclude").remove(),_zm.succErrMsg("s",d.smartfilter.exclude))})}},showNotes:function(a){var b,c=a.msgId,d=a.mailContElem;if(c&&(zmail.mailObj[c]&&zmail.mailObj[c].MA?b=zmail.mailObj[c].MA:zmail.prevMails[c]&&(b=zmail.prevMails[c].data.mdata.MA)),b&&zmUtil.isZohoAccount(zmail.accId)&&zmUtil.isNoteReactUser()){var e={};if((64|b)!==b)return;var f;d.length&&(f=d.find(".zm_mail_note"),f.length||(f=$(_zm.getDOM(["DIV",{attrs:{"class":"zm_mail_note"}}])),f.insertAfter(d.find(".zmPCon")),a.vfc||a.streamsShowMail||(e={mailId:c,mountingElem:f,preCallback:function(){},postCallback:function(){},listParam:{showHeader:!0}},zmList.notesAssociates(c,e))))}},showTasks:function(a){var b,c=a.msgId,d=a.mailContElem;if(c&&(zmail.mailObj[c]&&zmail.mailObj[c].MA?b=zmail.mailObj[c].MA:zmail.prevMails[c]&&(b=zmail.prevMails[c].data.mdata.MA)),b&&zmUtil.isZohoAccount(zmail.accId)){var e={};if((32|b)!==b)return;var f;d.length&&(f=d.find(".zm_mail_task"),f.length||(f=$(_zm.getDOM(["DIV",{attrs:{"class":"zm_mail_task"}}])),f.insertAfter(d.find(".zmPCon")))),a.vfc||a.streamsShowMail||(e={mailId:c,mountingElem:f,preCallBk:function(){},postCallBk:function(){zmUtil.requireTaskModule().done(function(){zmtCom.unsubscribeTaskListeners(),zmtCom.subscribeDeleteListener(c,f)})},listParam:{showHeader:!0}},zmList.taskAssociates(c,e))}},showProjectsEntities:function(a){var b,c=a.msgId,d=a.mailContElem||$("#zmConP"+c);if(c&&(zmail.mailObj[c]&&zmail.mailObj[c].MA?b=zmail.mailObj[c].MA:zmail.prevMails[c]&&(b=zmail.prevMails[c].data.mdata.MA)),b){if((4|b)!==b)return;var e;if(d.length){e=d.find(".zm_mail_projects"),e.length?e.find(".multiAppInfo").empty():(e=$(_zm.getDOM(["DIV",{attrs:{"class":"zm_mail_projects multiAppData"},child:[["DIV",{attrs:{"class":"multiAppInfo"}}]]}])),e.insertAfter(d.find(".zmPCon")));var f=e.find(".multiAppInfo"),g=$(_zm.getDOM(["DIV",{attrs:{"class":"multiAppHead"},child:[["SPAN",{child:[["text","Zoho Projects"]]}]]}]));f.append(g),zmUtil.loadProjects(function(){zmail.projectsInteg.util.listProjectsEntities(c,f)})}}},unsubscribeNotesTasks:function(a){if($(a).length){var b=$(a).find(".zm_mail_note");b.each(function(a,b){ReactDOM.unmountComponentAtNode(b)})}},updateNoteComponent:function(a){if(a&&zmail.mailObj[a]){var b=["zmConP","zmConT","zmConW","zmConS"];for(var c in b){var d;d=$("[id="+b[c]+a+"]");for(var e=0;e<d.length;e++){var f=d.eq(e);zmPreviewTemplate.showNotes({msgId:a,mailContElem:f})}}}},updateTaskComponent:function(a){if(a&&zmail.mailObj[a]){var b=["zmConP","zmConT","zmConW","zmConS"];for(var c in b){var d;d=$("[id="+b[c]+a+"]");for(var e=0;e<d.length;e++){var f=d.eq(e);zmPreviewTemplate.showTasks({msgId:a,mailContElem:f})}}}},postSaveDraftAction:function(a,b,c){$.isEmptyObject(c)||$.publish("/mail/draftsaved",c),zmail.mailObj[b.M]&&(b.TC=zmail.mailObj[b.M].TC,b.PA=zmail.mailObj[b.M].PA),zmail.mailObj[b.M]=b,zmail.mailObj[b.M].PA||(zmail.mailObj[b.M].PA=a),$.publish("/maction/newm",[[b]])},isMailOpenedViaStreams:B,initComments:C,addFocusOnclick:i,getAttachmentDom:m,constructContent:v};return M(),O(),Q}();