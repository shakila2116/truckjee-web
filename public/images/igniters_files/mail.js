!function(a){"use strict";var b,c,d,e={},f={},g="c",h="previouslySelected",i="expanded";e.init=function(a){b=a.doAfterMailSelection,c=a.updateMailSelectionView,d=a.isThreadExpanded},e.isChildId=function(a){return a.indexOf(g)!==-1},e.getRawId=function(a){return a.replace(g,"")},e.getViewObjectStore=function(a){return a=a||zmTab.currentTab,f[a]||{}},e.getViewObject=function(a,b){return e.getViewObjectStore(b)[a]},e.setViewObject=function(a,b,c){c=c||zmTab.currentTab;var d=f[c]||{};d[a]=b,f[c]=d},e.dropViewObjectStore=function(a){a=a||zmTab.currentTab,delete f[a]};var j=function(a,b){if(a&&a.isSelected!==b)return void 0===b&&(b=!a.isSelected),a.isSelected=b,c(a.$element,b),!0};e.selectMail=function(a,c,d){var f=j(e.getViewObjectStore(d)[a],c);f&&b(c)},e.selectMails=function(a,c,d){var f,g=e.getViewObjectStore(d),h=a.length;if(g){for(f=0;f<h;f++)j(g[a[f]],c);b(c)}},e.getChildrenIdsOf=function(a,b){if(!zmail.mailObj[a])return b;var c,d=zmList.getViewBasedMsgList(zmail.mailObj[a].T,zmInit.getListingDetObj()),e=d.length;for(b=b||[],c=0;c<e;c++)b.push(g+d[c]);return b};var k=function(a,b){a=a||[];var c,d,f=a.length;for(d=0;d<f&&!(c=e.getViewObject(a[d],b));d++);return c};e.getViewParentOf=function(a,b){a=e.getRawId(a);var c=zmail.mailObj[a].T,d=k(zmList.getViewBasedMsgList(c,zmInit.getListingDetObj(),!0),b);if(zmail.listObj[c]&&(d=d||k(zmail.listObj[c].MO,b)),!d&&1===zmail.convSortOrder){var f=zmList.getDupThdRowId(a,zmUtil.getFolId());f&&(d=e.getViewObject(f,b))}return d},e.isChildrenAreSelected=function(a){a=e.getRawId(a);var b,c,d=zmList.getViewBasedMsgList(zmail.mailObj[a].T,zmInit.getListingDetObj()),f=d.length;for(c=0;c<f;c++)if(b=e.getViewObject(g+d[c]),!b.isSelected)return!1;return!0},e.getAllViewObjectIds=function(a){var b,c,d,f=[],g=e.getMailOrders(),h=g.length;for(d=0;d<h;d++)b=g[d],f.push(b),c=e.getViewObject(b),a?e.getChildrenIdsOf(b,f):c&&c.$element.next(".zmTV").is(":visible")&&e.getChildrenIdsOf(b,f);return f},e.setPerviouslySelected=function(a,b){var c=e.getViewObjectStore(b);c[h]=a},e.getPerviouslySelected=function(a){var b=e.getViewObjectStore(a);return b[h]},e.setExpanded=function(a,b){var c=e.getViewObjectStore(b);c[i]=a},e.getExpanded=function(a){var b=e.getViewObjectStore(a);return b[i]},e.handleForChildSelection=function(a,b){if(e.isChildId(a)){var c=e.getViewParentOf(a),d=b&&e.isChildrenAreSelected(a);e.selectMail(c.id,d)}},e.filter=function(a){var b,c,f,g,h,i,j,k,l,m=[];for(b=e.getMailOrders(),j=b.length,k=0;k<j;k++)if(c=b[k],g=d(c)&&e.getChildrenIdsOf(c)||[],h=g.length){for(i=[],l=0;l<h;l++)f=g[l],a(e.getRawId(f))&&i.push(f);h===i.length&&m.push(c),m=m.concat(i)}else{var n=a(c);n&&m.push(c)}return m},e.readfilter=function(a){var b=zmail.mailObj[a];return 0===b.TH||0===zmUtil.getMLConversionValue()?1===b.S:1===b.TS},e.unreadfilter=function(a){var b=zmail.mailObj[a];return 0===b.TH||0===zmUtil.getMLConversionValue()?0===b.S:0===b.TS},e.flaggedfilter=function(a){var b=zmail.mailObj[a];return 0===b.TH||0===zmUtil.getMLConversionValue()?void 0!==b.NFG&&"0"!==b.NFG:b.TI||b.TF||b.TM},e.taggedfilter=function(a){var b,c=zmail.mailObj[a];return 0===c.TH||0===zmUtil.getMLConversionValue()?(b=c.TAG,b&&b.length>0):(b=c.TTAGS,b&&b.length>0)},e.attachmentfilter=function(a){var b=zmail.mailObj[a];return 0===b.TH||0===zmUtil.getMLConversionValue()?1===b.AT:1===b.TA},e.hasElement=function(a,b){var c=e.getViewObjectStore(b),d=c[a];if(d){if(document.contains(d.$element[0]))return d;delete c[a]}return!1},e.getMailOrders=function(a){a=a||zmTab.currentTab;var b;return a.indexOf("zm_srch")>=0?b=zmSearchUtil.getSearchList():(b=zmail.listObj[zmUtil.getFolId()],b&&b.MO||[])},e.init({doAfterMailSelection:function(a){var b=zmList.getElemObj();b.mainElem.hasClass("SC_sw")&&(a?zmPrev.setCountinPreview(b):zmPrev.removeCountinPreview(b)),zmList.updateSelectionCount(zmTab.currentTab);var c=zmsuite.getCenter()[0].getNodes()[0].$el.find(".msi-uncheck");zmList.isAllListingChecked(b.listElem)?c.removeClass().addClass("msi-uncheck msi-check"):zmList.isListingChecked(b.listElem)?c.removeClass().addClass("msi-uncheck msi-partcheck"):c.removeClass().addClass("msi-uncheck"),zmUtil.removeDocSelection(),zmUtil.sTopMenu({type:"l"})},updateMailSelectionView:function(a,b){b?a.addClass("SC_check"):a.removeClass("SC_check")},isThreadExpanded:function(a,b){if(!e.isChildId(a)){var c=e.getViewObjectStore(b),d=c[a];if(d.$element.next(".zmTV").is(":visible"))return!0}return!1}}),a=a||{},a.mailObjectAPI=e}(zmCenterListing),function(){"use strict";var a=zmText.get("mail"),b={INTENTIONAL_SPACE:"&nbsp;"},c=zmCenterListing.getMappedClass,d=function(d){d=d||{};var e,f,g,h;e=d.returnType,f=d.propertyMap,g=d.classMap,h=d.data;var i="",j="",k="",l="",m="",n="",o="",p="",q="",r="",s="",t="",u="",v="",w=a.listing.common,x=h[f.sub]||h.sub||w.noSubject,y=h[f.sum]||h.sum||"",z=h[f.count]||h.count||"",A=h[f.size]||h.size||"",B=h[f.id]||h.id||"",C=h[f.from]||h.from||b.INTENTIONAL_SPACE,D=h[f.data]||h.data||"",E=h[f.date]||h.date||"",F=h[f.tagLst]||h.tagLst||"",G=h[f.fName]||h.fName||"",H=h[f.iconArr]||h.iconArr||"",I=H.length,J=h[f.draftCount]||h.draftCount||0,K=h.CT,L=h.CMT,M=h.SCTX||"",N=h[f.schemaText]||h.schemaText||"",O=h[f.schemaTip]||h.schemaTip||"",P=h[f.sender]||"",Q=h[f.deliverySts]||0,R=h.mailDeliveryTip,S=h.showNewCompactView||"";i=c(f,g,h,"bold"),j=c(f,g,h,"att"),k=c(f,g,h,"flag"),l=c(f,g,h,"pri"),m=c(f,g,h,"subIcon"),n=c(f,g,h,"arch"),o=c(f,g,h,"hasTask"),p=c(f,g,h,"outType"),u=c(f,g,h,"schemaIcon"),q=c(f,g,h,"calEvent"),r=c(f,g,h,"schemaDisable"),v=c(f,g,h,"schemaIconColor"),s=c(f,g,h,"deliverySts"),t=c(f,g,h,"mdsParentClass"),G=h[f.fName]||"";var T="";z>1&&(T=w.tooltip.showHideConversation);var U={count:['<div class="zmtCt" title="'+T+'">',z,"</div>"].join(""),icon:['<i class="msi-thread" title="'+w.tooltip.loadFullConversation+'"></i>'].join("")},V="";z===-1?V=U.icon:z>0&&(V=U.count);for(var W=!1,X=['<div class="zmSze">',"<span>"+A+"</span>","</div>"].join(""),Y=['<span class="SC_mdet">','<i class="'+p+'" title="'+M+'"></i>',"</span>"].join(""),Z=J&&!h.hideDraftCount,_=[J,J>1?w.draftPlural:w.draft].join(" "),aa=[],ba=0;ba<I;ba++)aa.push('<i class="'+H[ba]+'"></i>');aa.join("");var ca=0!==F.length,da=['<div class="zm_lbl">',zmsTemplates.constructTagListHTML(F,!1,4),"</div>"].join(""),ea=['<div id="'+B+'" class="zmL SC_mlst '+(i+" "+n)+'" data-'+f.dataAttr+'="'+D+'" >','<div class="zmLst">','<div class="zmFlt">','<i class="msi-uncheck"></i>','<i class="'+(q?q:j)+'"></i>','<div class="zm_td">','<div class="zm_tlb"></div>',"</div>",V,'<div class="'+k+'"></div>',"</div>",'<div class="zmDtl">',o?'<div class="'+o+'"></div>':"",'<div class="zmDate">',"<span>"+E+"</span>","</div>",W?X:"",'<div class="zmFdr">',"<span>"+G+"</span>","</div>",Q?'<div class="zmSndSts" title="'+R+'"><div class="zmSndStsCon '+t+'" ><span class="zmSndStsIco"><i class="'+s+'"></i></span></div></div>':"",'<div class="zmFrm">',S?"<div "+(P?' title="'+P+'"':"")+' class="zmCmp_proPic zm_prof_img"></div>':"",l?'<i class="msi-priority '+l+'"></i>':"",p?Y:"","<span"+(P?' title="'+P+'"':"")+">"+C+"</span>",'<div class="SC_dft">',"<span>",Z?"&nbsp;"+_+"&nbsp;":"","</span>",!zmail.showFeature&&K?'<i class="msi-lcmnt" title="'+w.tooltip.commentsAvailable+'"></i>':"","</div>",zmail.showFeature&&L?'<div class="SC_cmt"><i class="msi-lcmnt" title="'+w.tooltip.commentsAvailable+'"></i><span>'+L+"</span></div>":"","</div>",'<div class="zmSub">',m?'<i class="'+m+'"></i>':"","<span>",x,'<span class="sum">',y.trim()?" - "+y:y,"</span>",N?'<span class="SC_zmlbtn '+v+' zmLLmask zm_highlight"'+(O?' title="'+O+'"':"")+" >"+(r?'<font class="'+r+'">'+N+"</font>":N)+'<i class="'+u+' zm_highlight"></i></span>':"","</span>","</div>",'<div class="SC_icn">',aa,"</div>",ca?da:"","</div>",'<div class="zmFrt"></div>',"</div>","</div>"].join("");return"dom"===e&&(ea=$(ea)[0]),ea},e=function(){zmCenterListing.registerListItemTemplate({type:"mail",generator:d})};e()}(),function(){"use strict";var a={INTENTIONAL_SPACE:"&nbsp;"},b=zmCenterListing.getMappedClass,c=function(c){c=c||{};var d,e,f,g;d=c.returnType,e=c.propertyMap,f=c.classMap,g=c.data;var h,i,j="",k="",l="",m="",n="",o="",p="",q="",r="",s="",t="",u=g[e.id]||g.id||"",v=g[e.data]||g.data||"",w=g[e.date]||g.date||"",x=g[e.size]||g.size||"",y=g[e.sub]||g.sub||"",z=g[e.sum]||g.sum||"",A=g[e.from]||g.from||a.INTENTIONAL_SPACE,B=g[e.fName]||g.fName||"",C=g[e.tagLst]||g.tagLst||"",D=g[e.iconArr]||g.iconArr||[],E=g[e.sender]||"",F=g[e.schemaText]||g.schemaText||"",G=g[e.schemaTip]||g.schemaTip||"",H=g.showNewCompactView||"";j=b(e,f,g,"bold"),l=b(e,f,g,"flag"),k=b(e,f,g,"att"),m=b(e,f,g,"pri"),n=b(e,f,g,"subIcon"),o=b(e,f,g,"hasTask"),p=b(e,f,g,"arch"),t=b(e,f,g,"calEvent"),r=b(e,f,g,"schemaIcon"),q=b(e,f,g,"schemaDisable"),s=b(e,f,g,"schemaIconColor"),j&&(j=" "+j);var I=!1,J=[];for(i=D.length,h=0;h<i;h++)J.push('<i class="'+D[h]+'"></i>');J.join("");var K=Boolean(C.length),L=['<div class="zm_lbl">',zmsTemplates.constructTagListHTML(C,!1,4),"</div>"].join(""),M=['<div class="zmL SC_mlst '+j+" "+p+'" id="'+u+'" data-'+e.dataAttr+'="'+v+'">','<div class="zmLst">','<div class="zmFlt">','<i class="msi-uncheck"></i>','<div class="zm_td">','<div class="zm_tlt"></div>','<div class="zm_tlb"></div>','<div class="zm_tls"></div>',"</div>",'<div class="'+l+'"></div>',"</div>",'<div class="zmDtl">',o?'<div class="'+o+'"></div>':"",'<div class="zmDate">',"<span>"+w+"</span>","</div>",I?'<div class="zmSze"><span>'+x+"</span></div>":"",'<div class="zmFdr">',"<span>"+B+"</span>","</div>",'<div class="zmFrm">',H?"<div "+(E?' title="'+E+'"':"")+' class="zmCmp_proPic zm_prof_img"></div>':"",m?'<i class="msi-priority '+m+'"></i>':"",n?'<i class="'+n+'"></i>':"",'<i class="'+(t?t:k)+'"></i>','<span class="zm_mailFrom"'+(E?' title="'+E+'"':"")+">",A,"</span>",'<span class="zm_mailCont">'+z+"</span>","</div>",'<div class="zmSub">',"<span>",y,'<span class="sum">',z.trim()?" - "+z:z,"</span>","</span>","</div>",'<div class="SC_icn">',J,"</div>",F?'<span class="SC_zmlbtn '+s+' zmLLmask zm_highlight"'+(G?' title="'+G+'"':"")+" >"+(q?'<font class="'+q+'">'+F+"</font>":F)+'<i class="'+r+' zm_highlight"></i></span>':"",K?L:"","</div>",'<div class="zmFrt"></div>',"</div>","</div>"].join("");return"dom"===d&&(M=$(M)[0]),M},d=function(){zmCenterListing.registerListItemTemplate({type:"submail",generator:c})};d()}(),zmail.folderCache=function(){"use strict";var a=function(){this.MO=[],this.showNextPage=0},b=function(b,c,d){var e,f,g,h=c.length,i=[];for(f=new a,e=0;e<h;e++){var j=c[e],k="";if(j.M){k=j.M;var l,m,n=0;zmail.mailObj[k]?(j.opened=zmail.mailObj[k].opened,g=zmail.mailObj[k].PA,j.TH?(d||(n=zmail.mailObj[k].TC,j.DC=zmail.mailObj[k].DC||j.DC,j.DMID=zmail.mailObj[k].DMID,l=void 0===zmail.mailObj[k].TS?void 0!==j.TS?j.TS:j.S:zmail.mailObj[k].TS,j.TS=l,j.TI=zmail.mailObj[k].TI||j.TI||!1,j.TM=zmail.mailObj[k].TM||j.TM||!1,j.TF=zmail.mailObj[k].TF||j.TF||!1,m=j.TSN!==zmail.mailObj[k].TSN?zmail.mailObj[k].SN:j.SN,j.SN=m,j.TSM=zmail.mailObj[k].TSM||j.TSM||"",j.TSN=zmail.mailObj[k].TSN||j.TSN||"",j.TTAGS=j.TTAGS||zmail.mailObj[k].TTAGS||[],j.TSB=zmail.mailObj[k].TSB||j.TSB||"",j.TA=zmail.mailObj[k].TA||j.TA,j.TOADDR=zmail.mailObj[k].TOADDR||j.TOADDR,j.TSNADDR=zmail.mailObj[k].TSNADDR||"",j.TC>0&&(n=j.TC),j.TC=n),j.SM=zmail.mailObj[k].SM||j.SM,j.TO=zmail.mailObj[k].TO||j.TO,zmail.mailObj[k]=j):zmail.mailObj[k]=j,g&&(zmail.mailObj[k].PA=g),zmail.mailObj[k].opened+=1):(zmail.mailObj[k]=j,zmail.mailObj[k].opened=1),0===zmail.mailObj[k].TC&&(zmail.mailObj[k].TC=1),void 0===zmail.mailObj[k].FD&&zmail.mailObj[k].TAG[0]&&(zmail.mailObj[k].FD=zmail.mailObj[k].TAG[0]),i.push(k)}else void 0!==j.showNextPage?f.showNextPage=j.showNextPage:j.stateinfo?f.showNextPage=j.stateinfo.showNextPage:void 0!==j.showMore&&(f.showNextPage=j.showMore)}return f.MO=i,f},c=function(a,b,c,d){var e,f,g,h=zmail.listObj[c].MO,i=h.length,j=!1,k=!0,l=0;if(h.indexOf(a)!==-1)return void(k=!1);if(zmail.mailObj[a]&&zmail.mailObj[a].T&&(e=zmail.mailObj[a].T,"msg"===d&&(f=zmList.getViewBasedMsgList(e,{fId:c},!0),1===f.length&&(zmail.mailObj[a].TC=1))),d&&"newm"!==d)for(g=0;g<i;g++){if(h[g]===a){k=!1;break}if(void 0!==e&&zmail.mailObj[h[g]].T===e){if(k=!1,1===zmUtil.getMLConversionValue())if(l=zmail.mailObj[h[g]].TC,zmail.listObj[e]){for(var m=0;m<f.length;m++)if(b>zmail.mailObj[f[m]].R){zmail.listObj[c].MO.splice(g,1),j=!0,k=!0,i=h.length,"thd"===d?zmail.mailObj[a].TC+=l:zmail.mailObj[a].TC=l+1;break}j||("thd"===d?zmail.mailObj[h[g]].TC=l+zmail.mailObj[a].TC:zmail.mailObj[h[g]].TC=l+1)}else{var n=zmail.mailObj[h[g]].R;b>n?(zmail.listObj[c].MO.splice(g,1),"thd"===d?zmail.mailObj[a].TC+=l:zmail.mailObj[a].TC=l+1,i=h.length,k=!0):"thd"===d?zmail.mailObj[h[g]].TC=l+zmail.mailObj[a].TC:zmail.mailObj[h[g]].TC=l+1}j=!1;break}}if(k){if(1===zmail.convSortOrder&&"newm"===d){for(g=i-1;g>=0;g--)if(b>zmail.mailObj[h[g]].R){zmail.listObj[c].MO.splice(g+1,0,a),j=!0;break}}else if(0===zmUtil.getMLConversionValue()&&zmail.listObj[c].sortOrder&&c===zmUtil.getFolId())0===zmail.listObj[c].showNextPage&&zmail.listObj[c].MO.push(a),j=!0;else for(g=0;g<i;g++)if(b>zmail.mailObj[h[g]].R){zmail.listObj[c].MO.splice(g,0,a),j=!0;break}j||zmail.listObj[c].MO.push(a),zmail.mailObj[a].T&&0===zmail.mailObj[a].TC&&(zmail.mailObj[a].TC=1)}},d=function(a,b,c){for(var d=zmail.listObj[b].MO,e=d.length,f=0;f<e;f++)if(zmail.mailObj[a].T&&1===zmUtil.getMLConversionValue()&&"msg"===c){var g=zmail.mailObj[a].T;if(g===zmail.mailObj[d[f]].T&&zmail.listObj[g])for(var h=zmList.getMailSummaryList({fId:b},g,!0),i=0;i<h.length;i++){if(0!==i&&a===h[i])return void(zmail.mailObj[h[0]].TC-=1);if(0===i&&a===h[i]&&h.length>1){zmail.listObj[b].MO.splice(f,1);var j=zmail.mailObj[h[1]].R,k=!1;d=zmail.listObj[b].MO,e=d.length;for(var l=0;l<e;l++)if(j>zmail.mailObj[d[l]].R){zmail.listObj[b].MO.splice(l,0,h[1]),zmail.mailObj[h[1]].TC=zmail.mailObj[a].TC-1,zmail.mailObj[h[0]].TC=1,k=!0;break}return void(k||(zmail.listObj[b].MO.push(h[1]),zmail.mailObj[h[1]].TC=zmail.mailObj[a].TC-1,zmail.mailObj[h[0]].TC=1))}}}else if(a===d[f]){var m=zmail.listObj[b].MO.splice(f,1);return m}},e=function(a){if(zmail.mailObj[a].T){var b,c,d=zmail.mailObj[a].T;if(b="zm_Container"===zmTab.currentTab?zmInit.getListingDetObj():zmsuite.getCenterOuter().$el.data("data-detail"),1===zmUtil.getMLConversionValue()){if(c=zmList.getMailSummaryList(b,d,!0),c.length>1){var e=a===c[0]?c[1]:c[0];2===c.length&&($("#"+e).parent().prev().find(".zm_td").remove(),$("#"+e).parent().prev().removeClass("zmTLst"),$("#"+e).parent().prev().find("i.msi-tarrow").addClass("msi-barrow"),$("#"+e).parent().remove())}}else if(c=zmList.getViewBasedMsgList(zmail.mailObj[a].T,b),0===c.length){var f;$("#"+a).length?(f=$("#"+a).parent().prev().attr("id"),f&&(f=f.substring(1))):""!==zmPrev.prevDetails().msgId&&zmail.mailObj[a].T===zmail.mailObj[zmPrev.prevDetails().msgId].T&&(f=zmPrev.prevDetails().msgId),$("#thd"+f).remove(),$("#t"+f).remove()}}},f={dolistObj:function(a,c,d){return b(a,c,d)},updateObj:function(a){switch(a.mode){case"upd":zmail.mailObj[a.msgId][a.key]=a.val;break;case"insert":zmail.listObj[a.folId]&&c(a.msgId,a.rt,a.folId,a.type);break;case"delete":zmail.listObj[a.folId]&&d(a.msgId,a.folId,a.type),e(a.msgId,a.folId),zmail.mailObj[a.msgId].FD=zmail.folId.tId;break;case"move":zmail.listObj[a.rFrom]&&d(a.msgId,a.rFrom,a.type),e(a.msgId,a.rFrom),zmail.mailObj[a.msgId].FD=a.addTo,zmail.listObj[a.addTo]&&c(a.msgId,zmail.mailObj[a.msgId].R,a.addTo,a.type)}},clearListObj:function(a){var b;if(delete zmail.listObj.unread,delete zmail.listObj.all,delete zmail.listObj.flag,zmail.useCache)b=zmInit.getListingDetObj(),(b.view||b.label||b.flag||b.attach)&&delete zmail.listObj[b];else for(var c in zmail.listObj)(zmUtil.isFolderId(c)||zmUtil.isSharedFolder(c))&&(a&&zmCache.clearMailObj({listId:c,reinit:!0}),delete zmail.listObj[c])},updateCacheForViews:function(a){var b=0,c=zmUtil.getFolId();b=$.inArray(a,zmail.listObj[c].MO),b!==-1&&zmail.listObj[c].MO.splice(b,1)},clearSearchList:function(){var a,b,c=zmSearchUtil.getSearchList(),d=c.length;for(a=0;a<d;a++)b=c[a],!b||zmList.isMailListedInApp(b)||zmUtil.isMailContentInUse(b)||zmUtil.isDraftMail(b)||delete zmail.mailObj[b]},clearSearchMsg:function(a){!a||zmList.isMailListedInApp(a)||zmUtil.isMailContentInUse(a)||zmUtil.isDraftMail(a)||delete zmail.mailObj[a]},clearMailObj:function(a){var b,c,d=0,e=a.msgId,f=[];if(!e||zmUtil.isMailContentInUse(e)||zmList.isMailListedInSearch(e)||zmUtil.isDraftMail(e)){if(zmail.listObj[a.listId])for(f=zmail.listObj[a.listId].MO,b=f.length,d=0;d<b;d++)if(e=f[d],c=zmail.mailObj[e]){var g;if(zmUtil.isMailContentInUse(e)||zmList.isMailListedInSearch(e)||zmUtil.isDraftMail(e))a.reinit&&c.TH&&(g=c.T,$.publish("/mail/threadUpdated",g));else{if(c.TH&&(g=c.T,zmail.listObj[g])){var h,i=zmail.listObj[g],j=i.MO.length;for(h=0;h<j;h++)zmail.mailObj[i[h]]&&delete zmail.mailObj[i[h]];delete zmail.listObj[g]}delete zmail.mailObj[e]}}}else delete zmail.mailObj[e]},mailOpened:function(a){zmail.mailObj[a].opened+=1},mailClosed:function(a){zmail.mailObj[a].opened-=1}};return f}(),window.zmfolAction=function(a){"use strict";return a=a||{},a.getChildrenOf=function(){var a,b,c=function(d){var e=b[d];if(e){var f=e.CH;for(var g in f)a.push(g),b[g]&&c(g)}};return function(d){return a=[],b=zmail.folTree[1],c(d),a}}(),a}(window.zmfolAction),function(){"use strict";var a=window.zmInit||{};window.zmInit=a;var b=!1,c=!1,d=0,e=zmText.get("mail"),f=e.leftTree,g=e.listing,h=e.preview,i=e.actions,j={list:{left:[{groupId:"view",actionArr:[{iconList:["msi-uncheck","msi-barrow"],dropAction:!0}]},{groupId:"SortCustom",actionArr:[{iconList:["msi-filter"],dropAction:!0,tooltip:f.iconTooltip.views},{iconList:["msi-sortdatedn"],tooltip:f.iconTooltip.sortDescend},{iconList:["msi-sortdateup"],tooltip:f.iconTooltip.sortAscend}]},{groupId:"MoveLabel",actionArr:[{iconList:["msi-folder"],dropAction:!0,tooltip:i.iconTooltip.move},{iconList:["msi-label"],dropAction:!0,tooltip:i.iconTooltip.addtag}]},{groupId:"sendOutbox",actionArr:[{iconList:["msi-send",{txt:f.foldercontextmenu.sendnow+"&nbsp;"}],tooltip:f.foldercontextmenu.sendnow}]},{groupId:"spamTrash",actionArr:[{iconList:["msi-trash"],tooltip:i.iconTooltip["delete"],separator:!0},{iconList:["msi-spam"],tooltip:i.iconTooltip.markspam},{iconList:["msi-notspam"],tooltip:i.iconTooltip.marknotspam}]},{groupId:"Archive",actionArr:[{iconList:["msi-archive"],tooltip:g.maillistopt.archive,separator:!0}]},{groupId:"action",actionArr:[{iconList:["msi-action"],dropAction:!0,tooltip:f.iconTooltip.moreact,separator:!0}]}],right:[{groupId:"folSpecConv",actionArr:[{iconList:["msi-thread"],tooltip:f.iconTooltip.swithOffConv,hideIcon:!0,customClass:"SC_prm"},{iconList:["msi-conversation"],tooltip:f.iconTooltip.switchOnConv,hideIcon:!0,customClass:"SC_prm"}]},{groupId:"LViewType",actionArr:[{iconList:["msi-classic"],dropAction:!0,tooltip:f.iconTooltip.chgview}]}]}},k={list:{left:{leftHTML:""},right:[]}},l=function(a){var b,c,d="",e="",h=!1,j=!1;b={selectFolder:i.bulkaction.common.selectall,clearSelection:i.bulkaction.common.clearselection,clearAndSelect:i.bulkaction.common.clearandselectall};var k=function(){var a=['<div id="bulkActBand" class="SC_simg">','<span x-id="message"></span>','<font x-id="action" id="selectOpt"></font>',"</div>"].join(""),b=$(a),c=b.find("[x-id=message]").removeAttr("x-id"),f=b.find("[x-id=action]").removeAttr("x-id");return c.text(e),f.text(d),b[0]},m=function(){var a=['<div x-id="wrapper">','<span x-id="message"></span>','<font x-id="action" id="clearSelect"></font>',"</div>"].join(""),b=$(a),c=b,f=b.find("[x-id=message]").removeAttr("x-id"),g=b.find("[x-id=action]").removeAttr("x-id");return f.text(e),g.text(d),$(c.children())};return a.isBulkActionSet=!1,a.toggleListingBand=function(b){b?a.SpamTrashBand.setBand():a.SpamTrashBand.removeBand()},a.createBulkActionBand=function(f,g){if(g&&f){var i,l;l="zm_srch1"===zmTab.currentTab?zmsuite.getCenter()[0].getNodes()[2].$el:$(zmail.mailCenter.listElem),a.toggleListingBand(!1),a.removeBulkActionBand(),d=b[g],e=f,i=k(),c=$(i),c.find("#selectOpt").off("click").on("click",function(){a.isBulkActionSet=!0,a.showClearSelectionBand();var b=_zm.getDOM(["DIV",{attrs:{"class":"SC_Pop noanim wht",style:"top: 90px;z-index:0;"}}]);zmsuite.getCenter()[0].$el.append(b)}),l.before(i),zmsuite.getCenter()[0].$el.addClass("SC_trsh"),h=!0,j=!0,zmUtil.applyLBDots(c)}},a.showClearSelectionBand=function(){var h;d=b.clearSelection,e=g.selmenuopt.all+" "+f.common.emailsel,h=m(),c.html(h),c.find("#clearSelect").off("click").on("click",function(){a.isBulkActionSet=!1,zmList.unchkAll()}),zmUtil.applyLBDots(c)},a.toggleBulkActionBand=function(a){a?!j&&h&&(c.show(),j=!0):j&&(c.hide(),j=!1)},a.removeBulkActionBand=function(){h&&(c.remove(),h=!1,l.isBulkActionSet=!1,zmsuite.getCenter()[0].$el.find(".noanim.wht").remove(),zmsuite.getCenter()[0].$el.removeClass("SC_trsh"),l.toggleListingBand(!0))},a}({});l=function(b){b=b||{};var c=['<div id="listingBand" class="SC_simg js-spam-trash-band">','<font id="emptyTSP" x-id="empty"></font>','<font id="helpET" x-id="more"></font>','<span x-id="message"></span>',"</div>"].join(""),d=function(a){a=a||{};var b=$(c);b.children().addClass("SC_ldot");var d={};return b.find("[x-id]").each(function(a,b){b=$(b),d[b.attr("x-id")]=b,b.removeAttr("x-id")}),"spam"===a.mode?($(d.empty).text(f.foldercontextmenu.emptyspam),$(d.message).text(f.foldercontextmenu.spamdelete),$(d.more).remove()):"trash"===a.mode&&($(d.empty).text(f.foldercontextmenu.emptytrash),$(d.message).text(f.foldercontextmenu.trashdelete),$(d.more).text(f.foldercontextmenu.lrnmore)),"undefined"!=typeof a.emptyAction&&$(d.empty).on("click",a.emptyAction),"undefined"!=typeof a.moreAction&&$(d.more).on("click",a.moreAction),a.hideEmpty&&$(d.empty).remove(),b},e=function(){return $(zmail.mailCenter.listElem)},g=function(){var b,c="",f=function(){var b=a.getListingDetObj()||{};b.fId!==zmail.folId.tId&&b.fId!==zmail.folId.spId||zmList.emptyFolContextMenu(b.fId)},g=function(){var a="//www.zoho.com/mail/help/deleting-mail.html#alink3";zmail.isFuji&&(a="ja"===zmail.user.lang?"//www.skydesk.jp/ja/apps/mail/help/deleting-mail.html#alink3":"//www.skydesk.jp/en/apps/mail/help/deleting-mail.html#alink3"),window.open(a,"_blank").focus()},h=function(){if(c){b&&b.remove();var a=e(),h=0===a.find(".zmL.SC_mlst").length;b=d({mode:c,hideEmpty:h,emptyAction:f,moreAction:g}),$("#listingBand.js-spam-trash-band").remove(),a.before(b),zmsuite.getCenter("zm_Container")[0].$el.addClass("SC_trsh")}},i=function(){zmsuite.getCenter("zm_Container")[0].$el.find("#bulkActBand").length||zmsuite.getCenter("zm_Container")[0].$el.removeClass("SC_trsh"),b&&(b.remove(),b=void 0)};return{setBand:function(){var b={};"zmlTreeH"===zmail.mailLeft.selLayerId&&(b=a.getListingDetObj()||{});var d=e().hasClass("zms_streams SC_streams"),f=zmail.listDetails&&"2"===zmail.listDetails.attach;d||b.fId!==zmail.folId.spId||f?d||b.fId!==zmail.folId.tId||f?i():(c="trash",h()):(c="spam",h())},removeBand:function(){i()}}},h=function(){$.subscribe("mail/listing/viewchanged",g.setBand)};return h(),b.SpamTrashBand=g(),b}(l);var m=function(){var b=a.getListingDetObj(),c={};if(b.fId===zmail.folId.dId)c.children=[["text",g.emptylist.drafts]];else if(b.fId===zmail.folId.teId)c.children=[["text",g.emptylist.templates+" "],["font",{child:[["text",g.emptylist.composer]]}]],c.action=!0,c.id=b.fId;else if(b.fId===zmail.folId.sId)c.children=[["text",g.emptylist.folder]];else if(b.fId===zmail.folId.spId&&"unread"!==b.view)c.children=[["text",g.emptylist.spam]];else if(b.fId===zmail.folId.tId)c.children=[["text",g.emptylist.trash]];else if(b.fId===zmail.folId.oId)c.children=[["text",g.emptylist.outbox]];else if(b.fId&&"unread"===b.view)c.children=[["text",g.emptylist.unreadfolder]];else if(b.label)if("-1"===b.label)c.children=[["text",g.emptylist.tagview]];else{var d=g.emptylist.filteredtagview,e=zmText.applyArgs(d,{tagname:zmUtil.findTagName(b.label)});c.children=[["text",e]]}else if(b.flag)if("-1"===b.flag)c.children=[["text",g.emptylist.flagview]];else{var f=g.emptylist.filteredflagview,h=zmText.applyArgs(f,{flagname:zmUtil.findFlagName(b.flag)});c.children=[["text",h]]}else b.fId?c.children=[["text",g.emptylist.nomailfolder]]:c.children=[["text",g.emptylist.nomailview]];return c},n=function(a,b){b.id===zmail.folId.teId&&$(a).find("font").on("click",function(){zmUtil.hideMenu(),zmUtil.compose()})},o=function(a){var b,c={};a?b=[["text",a]]:(c=m(),b=c.children);var d=_zm.getDOM(["DIV",{attrs:{"class":"SC_nmsg",id:"nomails"},child:b}]);return c.action&&n(d,c),d},p=function(){c||(c=!0,$.subscribe("/folder/rename",function(){zmList.updateFolderName()})),$.subscribe("/maction/newm",function(a,b,c){for(var d,e,f=b.length-1;f>=0;f--)d=b[f],e=d.M,zmail.mailObj[e]=d,zmList.reviewMailNotification(d,c),zmList.updateAttachmentCache(e)}),$.subscribe("folder/read",function(a,b,c){zmList.markFolderAsReadHandler(b,c)}),$.subscribe("folder/archived",function(a,b,c){zmList.markFolderAsArchived(b,c)}),$.subscribe("/mail/threadUpdated",function(a,b){zmList.updateThreadList(b)}),$.subscribe("/mail/listMails",function(a,b){"undefined"!=typeof zmList&&zmList.showMailListing(b,{toSelFol:!0})}),$.subscribe("/mail/updatemailview",function(a,b){zmPreviewTemplate.addMailsInView(b)}),$.subscribe("/mail/previewclosed",function(){zmList&&zmList.clearcpvReq()}),$.subscribe("/mail/msgDiscarded",function(a,b){zmUtil.discardMsg(b)}),$.subscribe("/mail/discardFromThread",function(a,b){zmUtil.discardFromThread(b)}),$.subscribe("wmsevents/mail",function(a,b){zmfolAction.handleWMSEvents(b.event,b.notification,b.content)}),$.subscribe("wmsevents/mail",function(a,b){zmmailAct.handleWMSEvents(b.event,b.notification,b.content)}),$.subscribe("m/mail_tab",function(a,b){var c=$.extend({},b.data);c.src="restore",zmList.getMailData(c)}),$.subscribe("m/mail_attachment",function(a,b){b=b.data,b.attObj.src="restore",zmAttach.util.viewAttachment(b.attObj,b.mode,b.fileExtn)}),$.subscribe("stream/stream_app",function(a,b){var c=b.appId;b=b.data,b.src="restore",zmsuite.getAppObj(c).centerObj.paint(),zmsuite.addLoadingBand(c,"list"),$.when(zmUtil.requireStreamsApp()).done(function(){zmCont.isGroupLoaded(zmStreamsApp.init,[b.groupId,b.fromLeft,b.src])})}),$.subscribe("stream/stream_post",function(a,b){b=b.data,b.src="restore",zmUtil.loadStreamsInTab(b)}),$.subscribe("stream/stream_mail",function(a,b){b=b.data,zmUtil.loadStreamsInTab(b)}),$.subscribe("/zm/task/addTask",function(a,b,c){b.TASKID&&zmList.addTaskIndicator(b,c)}),$.subscribe("/note/add",function(a,b,c){b.id&&zmList.addNoteIndicator(b,c)}),$.subscribe("/mail/preview/draftClosed",zmUtil.removeComposer),$.subscribe("SETTINGS_MAIL_VIEW",function(a,b){var c={key:"_settMail",info:{type:b,action:"mailOpenType"}};zmCrosstab.renew("zm_mail",c)}),$.subscribe("SETTINGS_ASK_RECEIPT_ON_READ",function(a,b){var c={key:"_settCompose",info:{type:b,action:"askReceipt"}};zmCrosstab.renew("zm_mail",c)}),$.subscribe("CS_EDITOR_TYPE_CHANGED",function(a,b){var c={key:"_settCompose",info:{type:b,action:"composeOpenType"}};zmCrosstab.renew("zm_mail",c)}),$.subscribe("CS_ADD_RECIPIENTS_CHANGED",function(a,b){var c={key:"_settCompose",info:{type:b,action:"addRecipients"}};zmCrosstab.renew("zm_mail",c)}),$.subscribe("CS_ENCODING_CHANGED",function(a,b){var c={key:"_settCompose",info:{type:b,action:"encode"}};zmCrosstab.renew("zm_mail",c)}),$.subscribe("CS_FONT_FAMILY_CHANGED",function(a,b){var c={key:"_settCompose",info:{type:b,action:"font"}};zmCrosstab.renew("zm_mail",c)}),$.subscribe("CS_FONT_SIZE_CHANGED",function(a,b){var c={key:"_settCompose",info:{type:b,action:"fontSize"}};zmCrosstab.renew("zm_mail",c)}),$.subscribe("CS_SENDING_DELAY_CHANGED",function(a,b){var c={key:"_settCompose",info:{type:b,action:"mailSendingDelay"}};zmCrosstab.renew("zm_mail",c)}),$.subscribe("SIGNATURE_ADDED",function(a,b){var c={key:"_settSignature",info:{data:b,action:"newSign"}};zmCrosstab.renew("zm_mail",c)}),$.subscribe("SIGNATURE_UPDATED",function(a,b){var c={key:"_settSignature",info:{data:b,action:"updSign"}};zmCrosstab.renew("zm_mail",c)}),$.subscribe("SIGNATURE_DELETED",function(a,b){var c={key:"_settSignature",info:{data:b,action:"delSign"}};zmCrosstab.renew("zm_mail",c)}),$.subscribe("SIGNATURE_ASSOCIATED",function(a,b){var c={key:"_settSignature",info:{data:b,action:"assSign"}};zmCrosstab.renew("zm_mail",c)}),zmAdHocSettings.subscribeFontChange(function(a,b){var c={key:"_settMail",info:{action:"fontChange",value:b.value}};zmCrosstab.renew("zm_mail",c)}),zmAdHocSettings.subscribeThemeChange(function(a,b){var c={key:"_settMail",info:{action:"themeChange",value:b.value}};zmCrosstab.renew("zm_mail",c)}),zmAdHocSettings.subscribeAppOrderChange(function(a,b){var c={key:"_settMail",info:{action:"appOrderChange",value:b.value}};zmCrosstab.renew("zm_mail",c)}),zmAdHocSettings.subscribeLeftOrderChange(function(a,b){var c={key:"_settMail",info:{action:"leftOrderChange",value:b.value}};zmCrosstab.renew("zm_mail",c)}),zmAdHocSettings.subscribeHelperBlockVisibilityChange(function(a,b){var c={key:"_settIntegration",info:{action:"smartMenu",value:b.value}};zmCrosstab.renew("zm_mail",c)})},q=function(){$(zmail.mailCenter.listElem).html(""),zmail.mailCenter.listElem.scrollTop=0,zmCache.clearListObj(),zmUtil.sTopMenu({type:"l",tabId:"zm_Container",iconsDiv:zmsuite.getCenter("zm_Container")[0].getNodes()[0]}),l.SpamTrashBand.setBand(),l.removeBulkActionBand(),zmCenterListing.mailObjectAPI.dropViewObjectStore("zm_Container")},r=function(){if("1"===zmail.collabVersion){var a=function(a,b){b=b||{};var c=zmAdHocSettings.getSuppressedMessagesState();if("off"!==c.mailShareTip){var d=zmail.mailObj[b.mailID]||{};if((b.mailID||"forward"!==b.mode)&&!(d&&[zmail.folId.teId,zmail.folId.oId,zmail.folId.dId].indexOf(d.FD)!==-1||d&&zmail.shrTree[0]&&zmail.shrTree[0][d.FD])){var e=zmUtil.getFolderObject(d.FD);e&&"-1"!==e.SH||zmmailAct.mailShareTip.show()}}};$.subscribe("/mail/forwardmail",a),$.subscribe("/compose/bccpresent",a)}},s=function(b){var c,d,e,f,h,i,j,l,m="sum unreadCount";if("zmStreamTree"!==zmail.mailLeft.selLayerId){if(i=a.getListingDetObj(),d=zmail.mailLeft.selId,e=zmail.mailLeft.getSelectedRowObj()[d],f=e.FN||e.dispName||e.name,c=zmsuite.getCenter("zm_Container")[0].getNodes()[1],"notification"===b&&c.$el.find(".selCount").is(":visible"))return void c.$el.find(".unreadCount").hide();if("zm_unread"===d)if(h=a.getUnreadViewCount(),h>1){var n=g.headertitle.multiplemail;j=zmText.applyArgs(n,{count:h}),f+='<span class="'+m+'"> '+j+"</span>"}else 1===h&&(f+='<span class="'+m+'"> '+g.headertitle.singlemail+"</span>");else if(zmail.folCount[d])if(i.flag)switch(i.flag){case"-1":f+='<span class="'+m+'">'+g.headertitle.flagmsg+"</span>";break;case"1":f+='<span class="'+m+'">'+g.headertitle.infoflagmsg+"</span>";break;case"2":f+='<span class="'+m+'">'+g.headertitle.impflagmsg+"</span>";break;case"3":f+='<span class="'+m+'">'+g.headertitle.followupmsg+"</span>"}else if(i.label)"-1"===i.label?f+='<span class="'+m+'">'+g.headertitle.alltagged+"</span>":(j=g.headertitle.filteredtag,l=zmText.applyArgs(j,{tagname:zmUtil.findTagName(i.label)}),f+='<span class="'+m+'">'+l+"</span>");else if("1"===i.attach)f+='<span class="'+m+'">'+g.headertitle.attachview+"</span>";else if("2"===i.attach)f+='<span class="'+m+'">'+g.headertitle.attachonly+"</span>";else if("archive"===i.view)f+='<span class="'+m+'">'+g.headertitle.archiveview+"</span>";else if(zmail.folCount[d].c>0){var o=g.headertitle.singleunread,p=g.headertitle.multipleunread;d===zmail.folId.oId&&(o=g.headertitle.singleunreadOutbox,p=g.headertitle.multipleunreadOutbox),1===zmail.folCount[d].c?f+='<span class="'+m+'"> '+o+" </span>":(l=zmText.applyArgs(p,{n:zmail.folCount[d].c}),f+='<span class="'+m+'"> '+l+" </span>")}k.list.left.leftHTML=f,c.push(k.list),c.paint(),"notification"===b&&c.$el.find(".selCount").is(":visible")&&c.$el.find(".unreadCount").hide()}},t=function(a){var b=a/1024;b=Math.ceil(b);var c=b.toString().length;return c>3?b=Math.ceil(b/1024)+" MB":b+=" KB",b},u=function(b){if(zmsuite.isWorkspaceAvailable("zm_Container")){
var c,d=a.getListingDetObj();c=d.fId?parseInt(zmail.folCount[d.fId].c):parseInt(zmail.folCount[zmail.folId.iId].c),(d.fId&&d.fId!==zmail.folId.sId&&d.fId!==zmail.folId.teId&&d.fId!==zmail.folId.dId&&c!==b||!d.fId&&"unread"===d.view&&c!==b)&&a.getFolderTreeCount()}},v=function(a){var b,c={};c.parentDOM=$(a),c.displayAs="dropdown",c.hltPar=!0,c.offsets={left:0,top:-1},c.excludeList=[zmail.folId.dId,zmail.folId.teId,zmail.folId.oId],c.excludeChild=!0,c.viewDOM=$(zmsuite.getCenterOuter().$el).find(".SCmc"),c.onSelect=function(a){zmmailAct.doActions("move","drop",{action:"move",folId:a})},c.onCreate=function(a){zmfolAction.isValidName(a,void 0,{opType:"new"})&&(zmfolAction.sendNewFolderReq(a,{reqDoneClbk:function(a,b){a&&c.onSelect(b)}}),b.hide())},b=zmUtil.createFLComp("folder",c),b.show()},w=function(a){var b,c={};c.parentDOM=$(a),c.hltPar=!0,c.displayAs="dropdown",c.labelState={selectedMails:!0},c.offsets={left:0,top:-1},c.viewDOM=$(zmsuite.getCenterOuter().$el).find(".SCmc"),c.onStateChange=function(a,b){zmmailAct.applyActions("label","click",{lA:b?"add":"delete",lId:a,disp:zmail.labInfo[a].dispName})},c.onCreate=function(a){zmlab.isValidName(a)&&zmlab.labelCreate(a,"",{reqDoneClbk:function(a,d){a&&(c.onStateChange(d,!0,function(){}),b.hide())}})},b=zmUtil.createFLComp("label",c),b.show()},x=function(){var b,c,d=a.getListingDetObj(),e=[],f="",h="",i="",j=0;if(b={unread:g.common.unreadmsg,archive:g.common.archivemsg,all:g.common.allmsg},c={"-1":g.selmenuopt.all,1:g.flagmenu.infoflag,2:g.flagmenu.important,3:g.flagmenu.followup},d){if(d.fId)f=a.findFolName(d.fId),d.view?i=b[d.view]:d.flag?("-1"!==d.flag&&(h=c[d.flag]),i="Flagged"):d.label?("-1"!==d.label&&(h=zmail.labInfo[d.label].dispName),i="Tagged"):d.attach&&(i="Attachments"),h&&(f+=" ["+h+"]",h=""),i&&(f+=" ["+i+"]",i=""),j=zmail.folCount[d.fId]&&zmail.folCount[d.fId].c,e.push(f);else if(d.label){var k=g.windowtitle.tagview,l=zmText.applyArgs(k,{tagname:zmail.labInfo[d.label].dispName});e.push(l)}else d.view?(e.push(b[d.view]),"unread"===d.view&&(j=a.getUnreadViewCount())):d.flag&&("-1"!==d.flag?f=c[d.flag]+" ["+g.common.flagged+"]":f+=g.windowtitle.flagview,e.push(f));if(j>0){if("undefined"!=typeof zmUtil){var m=!0;j=zmUtil.commaSeparateNum(j,m)}e.unshift("("+j+")")}return e}},y=function(){var a=function(a){a=a||{};var b={};if(a.cs&&(b=$.parseJSON(a.cs)[0]||{}),a.error)zmUtil.updOutbox(a);else if(b.event){var c=["moveMail","markFlagged","emptyFolder","folderRead","renameFolder","deleteFolder","moveFolder","addFolder"];c.indexOf(b.event)!==-1&&$.publish("wmsevents/mail",{event:b.event,notification:a,content:b})}else a.MDS?zmInit.updateMailDeliveryStatus(a):zmmailAct.doActions("newm","chat",a)};zmComponent.notifier.addHandler("mail",a)},z=function(){var b=_zm("#","nmenc");b||(b=_zm.getDOM(["DIV",{attrs:{id:"nmenc","class":"SC_mnoti"}}]),document.body.appendChild(b)),a.mNotifier=zmComponent.mailNotifier({parent:b,openMail:function(a){var b=a&&a.M;b&&zmList.getMailData({msgId:b,opentype:2,type:"lt",src:"external",eprm:{accId:zmail.accId}})}}),y()},A=function(a,b){var c=zmsuite.getCenter(a)[0].getNodes()[0].$el.find(".msi-classic");c.length||(c=zmsuite.getCenter(a)[0].getNodes()[0].$el.find(".msi-compact")),"0"===b?c.removeClass().addClass("msi-classic"):"1"===b&&c.removeClass().addClass("msi-compact")},B=zmsuite.createAppRouter();$.extend(a,{rclkId:0,startFill:!1,leftMain:null,mapObj:{bold:"S",id:"M",data:"data",subIcon:"AT",count:"TC",flag:"NFG",date:"DT",from:"F",sub:"SB",sum:"SM",pri:"PR",tagLst:"TAG",dataAttr:"ty",fName:"FN",iconArr:"ICN",outboxSts:"OBT",att:"S",arch:"AR",hasTask:"HT",draftCount:"DC",outType:"OT",outText:"SCTX",calEvent:"HC",schemaIcon:"actionIcon",schemaIconColor:"actionIconColor",schemaDisable:"expired",sender:"fromaddr",deliverySts:"MDS",mdsParentClass:"MDS"},classObj:{bold:{0:"zm_urd",2:"zm_urd",3:"zm_urd"},att:{0:"msi-mail",1:"msi-mail","":"",2:"msi-rpd",3:"msi-fwd",4:"msi-rpd",5:"msi-fwd",6:"msi-edit"},calEvent:{2:"msi-calendar",3:"msi-calendar zmEvAcc",4:"msi-calendar zmEvDec",5:"msi-calendar zmEvMay",6:"msi-calendar zmEvCan",8:"msi-calendar",9:"msi-calendar",10:"msi-calendar",11:"msi-calendar",12:"msi-calendar"},subIcon:{1:"msi-attachicon"},flag:{0:"zm_icn zmflg",1:"zm_icn zmflg zm_fgB",2:"zm_icn zmflg zm_fgR",3:"zm_icn zmflg zm_fgG",4:"msi-priority zm_icn SC_lred",5:"msi-priority zm_icn SC_lgreen",6:"zm_icn zmflg zm_fgM"},pri:{1:"SC_red",2:"SC_red",4:"SC_blue",5:"SC_blue"},outboxSts:{0:"SC_lred",1:"SC_lgreen"},arch:{1:"zmarch"},hasTask:{1:"SC_mdata"},outType:{1:"msi-clock",2:"msi-reccur"},schemaIcon:{one_click:"msi-tick","goto":"msi-pout",review:"msi-rate",review_comment:"msi-review",rsvp:"msi-rsvp"},schemaIconColor:{one_click:"zmlbtn_green","goto":"zmlbtn_red",review:"zmlbtn_orange",review_comment:"zmlbtn_blue",rsvp:"zmlbtn_blue"},schemaDisable:{1:"SC_op3"},deliverySts:{0:"",1:"msi-mailQue",2:"msi-mailInpro",3:"msi-mailInpro",4:"msi-mailInpro",5:"msi-mailSuc",6:"msi-mailFail",7:"msi-mailFail",8:"msi-mailUndo",9:"msi-mailRetry",10:"msi-mailRetry"},mdsParentClass:{0:"",1:"",2:"zmSndSts-pro",3:"zmSndSts-pro",4:"zmSndSts-pro",5:"zmSndSts-suc",6:"zmSndSts-fail",7:"zmSndSts-fail",8:"",9:"zmSndSts-failB",10:"zmSndSts-fail"}},prevHeader:{id:"zmPrevHeader",text:"Preview Text",rIcons:[[{tooltip:i.iconTooltip.prev,iconClass:"msi-prev",data:{action:"msi-prev"}},{tooltip:i.iconTooltip.next,iconClass:"msi-next",data:{action:"msi-next"}}],[{tooltip:i.iconTooltip.popout,iconClass:"msi-popout",data:{action:"openwindow",from:"header"}}],[{tooltip:i.iconTooltip.close,tooltipDir:"right",iconClass:"msi-close",data:{action:"clsPrev"}}]]},init:function(){var a={appname:"Mail",appId:"zm_Container",appIcon:"msi-mail",faqKey:"mail listing",searchPlaceHolder:zmText.get("mailsuite").searchMail,data:{LNodes:"2",CNodes:"3"},stateData:{type:"app",data:{accId:zmail.accId,listing:{view:{fId:zmail.folId.iId,view:"",viewId:""},expand:{mId:""}},preview:{p:""}}},handler:{create:function(){zmUtil.compose()}},shortcuts:zmshCut.mail,titleProvider:x,sortLeftLayers:!0,appBodyClassName:"SC_mailApp",router:B};zmsuite.setAppInfo(a),zmWinTitle.registerDefaultProvider(x),zmail.postJsDeffered.done(function(){B.initialize({hashKey:"mail",handler:zmUrlAct.manualHandler}),B.activate();var a=zmHash.decode();!a.key||"mail"===a.key&&"tab"===a.params[0]||"mail"===a.key&&!a.params.length?zmail.mailOpt.isFol?(B.setParams(["folder","inbox"]),B.update()):(B.setParams(["views","unread"]),B.update()):"mail"!==a.key&&(zmail.mailOpt.isFol?B.setParams(["folder","inbox"]):B.setParams(["views","unread"]))}),$.subscribe("/mail/accountSwitch",function(a,b){b=b||{},"success"===b.status&&(zmail.mailOpt.isFol?B.update(["folder","inbox"]):B.update(["views","unread"]))}),zmCrosstab.subscribe("zm_mail",{},zmMsgProcessor._handler,!1)},initials:function(){if(zmail.prevMails={},zmail.outboxFail){var a=zmsuite.getAppObj("zm_Container").centerObj.$el,b=e.global.notifoutbox,c=["DIV",{attrs:{id:"zm_outboxfail","class":"SC_msg SC_emsg"},child:[["SPAN",{}]]}],d=_zm.getDOM(c);a.append(d),b+=" <i class='msi-close' onclick='zmInit.outboxClose();'></i>",$("#zm_outboxfail").children("span").html(b),zmUtil.updSendErrorStatus(!0,zmail.folId.oId)}$("#MS_action span").unbind("click").click(function(){zmUtil.compose()}),$("#zmsignout").unbind("click").click(function(){location.href=zmail.logoutURL})},outboxClose:function(){$("#zm_outboxfail").remove()},sendLoadOutbox:function(a){if("hide"===a)$("#zm_outbox_send_load").remove();else{var b="Loading",c=["DIV",{attrs:{id:"zm_outbox_send_load","class":"SC_msg SC_imsg"},child:[["SPAN",{}]]}],d=_zm.getDOM(c);$("body").append(d),$("#zm_outbox_send_load").children("span").html(b)}},initMailList:function(){var b,c="",d={},e={},f={};1===zmail.mailOpt.isFol?(c=zmail.folId.iId,b=c,e={fId:c,view:"",label:"",flag:"",attach:""},f={fId:c,view:"",lId:"",flag:"",attach:""}):(c="zm_unread",b="unread",e={fId:"",view:"unread",label:"",flag:"",attach:""},f={fId:"",view:"unread",lId:"",flag:"",attach:""}),d=a.cacheDataObj(zmail.mailList,b,1),a.setListingDetObj(e),f.showNxt=d.showNextPage,a.mailList(d.MO,f);var g=zmsuite.getCenter()[0].getNodes()[0];g.hideGroup("spamTrash"),g.hideGroup("MoveLabel"),g.hideGroup("sendOutbox"),g.hideGroup("Archive"),"unread"===b?(0!==zmUtil.getMLConversionValue()?g.hideGroup("SortCustom"):(g.$el.find(".msi-sortdatedn").closest("li").hide(),g.$el.find(".msi-filter").closest("li").hide()),g.hideGroup("action")):(g.$el.find(".msi-sortdatedn").closest("li").hide(),0!==zmUtil.getMLConversionValue(c)&&g.$el.find(".msi-sortdateup").closest("li").hide(),zmList.showHideConvIcon(c))},constructView:function(b){if(b&&(zmail.folId=b.folId,zmail.folTree=b.folTree,zmail.folCount=b.folCount,zmail.labInfo=b.labInfo,zmail.viewInfo=b.viewInfo,zmail.mailOpt=b.mailOpt),zmail.shrTree=zmail.shrTree||[],zmail.shrLabelTree=zmail.shrLabelTree||[],zmail.showFeature&&zmail.shrLabelTree.length){var c=$.extend({},zmail.shrTree[0],zmail.shrLabelTree[0]);zmail.shrTree[0]=c}zmail.zohoAccLabInfo||(zmail.zohoAccLabInfo=zmail.labInfo),zmail.mailObj={},zmail.listObj={},zmail.sortOrder=!zmail.mailOpt.isDesc,zmail.mailLeft=zmsuite.getLeft(),a.setListingDetObj({}),zmail.folCount[zmail.folId.sId].c="0",zmail.folCount[zmail.folId.dId].c="0",a.translateSystemFolders(),a.constructLeft(),a.constructCenter(),a.constructRight(),zmsuite.showExistingApp("zm_Container"),zmail.mailCenter=zmsuite.getCenter(),zmail.mailCenter.listElem=zmail.mailCenter[0].getNodes()[2].$el[0],zmail.mailCenter.listObj=zmail.mailCenter[0].getNodes()[2],zmail.mailCenter.prevElem=zmail.mailCenter[1].$el[0],zmail.mailCenter.prevObj=zmail.mailCenter[1],zmail.mailCenter.prevObj.getNodes()[0].setListener("click",function(a,b){zmList.bindAction(a,b)})},zmfnPrecall:function(){zmail.win.zmCache=zmail.folderCache},initMailSuite:function(){a.zmfnPrecall(),a.init(),a.constructView(),a.initMailList(),a.updateCountTitle(),z(),p(),r();var b=function(){zmail.allowInline=1!==zmail.mailOpt.compTab};zmAdHocSettings.subscribe("settingsloaded",b),zmAdHocSettings.subscribeComposeTypeChange(function(){b(),$.publish("/mail/listMails",{})}),a.initials(),zmail.loadCompleted=!0},hashFolPath:function(a){var b="",c="";return a===zmail.folId.iId||"inbox"===a?(b+="inbox",c=zmail.folId.iId):a===zmail.folId.dId||"drafts"===a?(b+="drafts",c=zmail.folId.dId):a===zmail.folId.spId||"spam"===a?(b+="spam",c=zmail.folId.spId):a===zmail.folId.teId||"templates"===a?(b+="templates",c=zmail.folId.teId):a===zmail.folId.sId||"sent"===a?(b+="sent",c=zmail.folId.sId):a===zmail.folId.tId||"trash"===a?(b+="trash",c=zmail.folId.tId):a===zmail.folId.oId||"outbox"===a?(b+="outbox",c=zmail.folId.oId):"unread"===a||"zm_unread"===a?(b+="unread",c="zm_unread"):"all"===a||"zm_all"===a?(b+="all",c="zm_all"):"flag"===a||"zm_flag"===a?(b+="flagged",c="zm_flag"):/^\+?(0|[1-9]\d*)$/.test(a)&&(b+=a,c=a),{hashTxt:b,folId:c}},constructLeft:function(){var b,c,d=[];b=zmail.mailLeft.getNodes();var e={id:"id",name:"name",count:"scount",sequence:"order"},h={id:"id",name:"FN",count:"c",parentId:"p",hasChild:"HC",expChild:"E",sequence:"SE",shared:"SH"},i={name:"dispName",color:"color",id:"id",count:"c",sequence:"se"};zmail.showFeature&&(i.shared="shId");var j={id:"id",name:"FN",count:"c",parentId:"p"},k={id:"id",name:"FN",OZUID:"OZUID",accessText:"ROLE",entityClass:"RT"},l={accessText:{11:"R",12:"W",13:"W"}},m={entityClass:{91:"msi-folder",92:"msi-label"}},n={id:"id",name:"FN",sequence:"SE"},o=new ZMLayer,p={type:"1",listId:"zmsTree",hasChild:!1,mapObject:e,id:"zmStreamTree",dataObject:{headerObject:{licon:"msi-folder",id:"zmStreamTree",name:"STREAMS",showList:!0},listObject:zmCont.getEmailEnabledGroup()}};zmail.trialUsers&&(p.disableSelection=!0,p.dataObject.headerObject.scount="<i class='msi-plus'></i>",p.dataObject.headerObject.onAdd=function(){zmUtil.loadStreams().done(function(){zmGroupSubscription.showPage({onPreviewClose:zmStreamsApp.util.closePreview})})}),o.push(p),d.push(o);var q=new ZMLayer,r={type:"1",listId:"zmlTree",hasChild:!0,hasCountObject:!0,mapObject:h,id:"zmlTreeH",dataObject:{headerObject:{licon:"msi-folder",id:"zmlTreeH",name:f.header.folders,c:"<i class='msi-plus'></i>",showList:!0,onAdd:function(){zmfolAction.showCreateFolderPopUp({mode:"new"})}},listObject:zmail.folTree[0],childObject:zmail.folTree[1],countObject:zmail.folCount}};q.push(r),q.setDragDrop({allowedParents:"#zmlTreeH",getDescendant:0===zmail.mailOpt.folSort,onDrop:function(a,b,c,d){zmfolAction.onDrop(a,b,c,d)},allowDrag:function(a){return zmfolAction.allowDrag(a)},allowDrop:function(a,b,c){return zmfolAction.allowDrop(a,b,c)},dragStart:function(a,b){var d,e={};for(d in b)c=d;return e.text=b[c].FN,e}});var s=new ZMLayer,t={type:"2",mapObject:i,listId:"zmllabel",id:"zmllabelH",dataObject:{headerObject:{licon:"msi-label",id:"zmllabelH",name:f.header.tag,showList:!0,c:"<i class='msi-plus'></i>",onAdd:function(){zmlab.showCreateTagPopUp({mode:"new"})}},listObject:zmail.labInfo}};s.push(t),s.setDragDrop({allowedParents:"#zmllabelH,.zmL",onDrop:function(b,c,d,e){var f,g,h,i,j={},k=[],l=[];for(f in c)h=f;if("center"===e){if(i=a.getListingDetObj().fId,g=d.length,i===zmail.folId.dId||i===zmail.folId.teId||i===zmail.folId.oId||i===zmail.folId.spId)return!1;for(f=0;f<g;f++)d[f].id.indexOf("t")!==-1?k.push(a.zmsubStr(d[f].id,"t")):l.push(d[f].id);j={action:"label",msgId:l,thd:k,lA:"add",lId:h},zmmailAct.applyActions("label","click",j)}else zmlab.labelmov("m",c,d)},allowDrag:function(){return!0},allowDrop:function(a,b,c){return"inside"!==c&&(0===zmail.mailOpt.labSort||"next"!==c&&"prev"!==c)},dragStart:function(a,b){var c,d,e={};for(c in b)d=c;return e.text=b[d].dispName,e}});var u=new ZMLayer,v={type:"1",mapObject:j,listId:"zmlview",id:"zmlviewH",hasCountObject:!0,dataObject:{headerObject:{licon:"msi-views",id:"zmlviewH",name:f.iconTooltip.views,showList:!0},listObject:{zm_unread:{FN:g.common.unread},zm_all:{FN:g.common.allmsg},zm_flag:{FN:g.common.flagged}},countObject:{zm_unread:{c:a.getUnreadViewCount(),p:"-1"},zm_all:{c:0,p:"-1"},zm_flag:{c:0,p:"-1"}}}};if(u.push(v),d.push(q),zmail.shrTree.length&&zmail.accId===zmail.defAccId){var w=new ZMLayer,x={type:"3",mapObject:k,listId:"zmlSTree",id:"zmlSTreeH",classObject:l,dataObject:{headerObject:{licon:"msi-sharefolder",id:"zmlSTreeH",name:f.header.sharedwithme,showList:!0},listObject:zmail.shrTree[0]}};zmail.showFeature&&(x.entityClass=m),w.push(x),d.push(w)}if(d.push(s),d.push(u),zmail.savedSearchList&&Object.keys(zmail.savedSearchList).length>0){var y=new ZMLayer,z={type:"1",mapObject:n,disableSelection:!0,listId:"zmlSSrchTree",id:"zmlSSrchTreeH",dataObject:{headerObject:{licon:"msi-save",id:"zmlSSrchTreeH",name:f.header.savedsearch,showList:!0},listObject:zmail.savedSearchList}};y.push(z),d.push(y)}b[0].push({layerArr:d}),zmail.mailLeft.render(),1===zmail.mailOpt.isFol?(c=zmail.folId.iId,zmsuite.getLeft().selRow(c,"zmlTreeH")):(c="zm_unread",zmsuite.getLeft().selRow(c,"zmlviewH")),zmail.mailLeft.setListener("click",function(b){a.bindLeftActions(b)}),zmail.mailLeft.setListener("contextmenu",function(b){a.bindLeftActions(b)}),_zm.is_typesafari&&(zmail.mailLeft.setListener("mouseover",function(){$(this).addClass("SC_oya")}),zmail.mailLeft.setListener("mouseout",function(){$(this).removeClass("SC_oya")})),zmail.mailLeft.getNodes()[0].getLayer("zmlTreeH").setChildToggle(a.viewChild)},constructCenter:function(){var b=zmsuite.getCenter(),c=b[0].getNodes();c[0].push(j.list,{rightElemCustomClass:"SC_prm"}),c[0].setListener("click",function(b,c){a.bindActionHeaderIcons(b,c)}),c[1].push(k.list),c[2].setListener("click",function(a){("zm_Container"!==zmTab.currentTab||"2"!==zmail.listDetails.attach&&"zmStreamTree"!==zmail.mailLeft.selLayerId)&&zmList.bindEventsMailRow(a)}),c[2].setListener("contextmenu",function(a){("zm_Container"!==zmTab.currentTab||"2"!==zmail.listDetails.attach&&"zmStreamTree"!==zmail.mailLeft.selLayerId)&&zmList.mailUtility(a)}),c[2].setDragDrop({onDrop:function(b,c,d){var e,f,g,h,i=[],j=[];for(g in d)e=g;for(h=c.length,g=0;g<h;g++)c[g].id.indexOf("t")!==-1?j.push(a.zmsubStr(c[g].id,"t")):i.push(c[g].id);d[e].FN?(f={action:"move",folId:e,msgId:i,thd:j},zmmailAct.doActions("move","drop",f)):(f={action:"label",msgId:i,thd:j,lA:"add",lId:e},zmmailAct.applyActions("label","drop",f))},allowDrag:function(){var b;return b=a.getListingDetObj().fId,b!==zmail.folId.dId&&b!==zmail.folId.teId&&b!==zmail.folId.spId&&b!==zmail.folId.oId&&"2"!==zmail.listDetails.attach},allowDrop:function(a,b,c){var d,e;for(d in b)e=d;return b[e].FN?"inside"===c&&(e!==zmail.folId.dId&&e!==zmail.folId.teId&&e!==zmail.folId.oId&&"2"!==zmail.listDetails.attach):"inside"===c},dragStart:function(b,c){var d,e={};return c.length>1?(e.count=zmUtil.getCheckedMailCount(),e.text=f.common.emailsel):(d=a.zmsubStr(c[0].id,"t"),e.text=zmail.mailObj[d].SB),e},allowedParents:"#zmlTreeH,#zmllabelH"}),zmsuite.renderCenter(),s(),a.setDisplayDensity()},constructRight:function(){zmsuite.renderRight()},getListingDetObj:function(){return zmail.listDetails},setListingDetObj:function(a){"string"==typeof a?zmail.listDetails=$.parseJSON(a):zmail.listDetails=a},viewChild:function(a,b){var c,d,e,f;if(a.zmsData)for(var g in a.zmsData.rowObject)c=a.zmsData.rowObject[g],d=g;else c=a,d=b[0].id;e=b.find(".msi-arrow45"),f={accId:zmail.accId,mode:"expand",folId:d},e.length?(f.isExpand=1,c.E=1):(f.isExpand=0,c.E=0),zmAjq.XHR({u:zmail.conPath+"/folAction.do",t:"POST",fn:"",p:f,csr:"s"})},flgClass:function(a,b){var c="";return a=parseInt(a),c=1===a?"zm_icn zmflg zm_fgB":2===a?"zm_icn zmflg zm_fgR":3===a?"zm_icn zmflg zm_fgG":6===a?"zm_icn zmflg zm_fgM":"s"===b?"":"zm_icn zmflg"},getThdFlagvalue:function(a){var b=0;if(a){var c=zmail.mailObj[a];b=c.TI&&c.TF||c.TF&&c.TM||c.TM&&c.TI?6:zmail.mailObj[a].TF?3:zmail.mailObj[a].TM?2:zmail.mailObj[a].TI?1:0}return b},findFolName:function(a){if(zmail.folTree[0][a])return zmail.folTree[0][a].FN;var b,c=zmail.folTree[1];for(var d in c)if(b=c[d].CH,b[a])return b[a].FN;var e=zmail.shrTree||[];for(var f in e)if(e[f][a])return e[f][a].FN;return""},getMails:function(b,c,e,f,g){var h,i,j=zmail.mailOpt.isshowSummary,k=b.f,l=b.t,m=b.fId,n=b.label,o=b.flag,p=b.attach,q=b.view;k||(k=1),f=void 0!==f?f:zmail.sortOrder;var r,s={from:k,to:l,ty:c,fId:m,lId:n,view:q,flag:o,attach:p,cache:!1,scenario:b.scenario,retainPreview:b.retainPreview,sortOrder:f,mlDefObj:g},t={mode:"listing",accId:zmail.accId,from:k,to:l,summary:j,sortBy:"date",sortOrder:f,folderSpec:zmUtil.getMLConversionValue()};if(b.shId&&(t.shId=b.shId,2===zmail.folviewThread&&(t.folderSpec=1),zmail.opType.list?t.opType=zmail.opType.list:t.opType=0,m&&zmUtil.isSharedFolder(m)&&92===zmail.shrTree[0][m].RT&&(n=m,m="")),""!==m&&(t.folId=m,s.from=k,m===zmail.folId.sId&&(t.folderSpec=0)),""!==o&&(t.flag=o,b.sendReq=!0),""!==n&&(t.label=n,b.sendReq=!0),""!==p&&(t.attach=p,b.sendReq=!0),""!==q&&(m&&"all"===q||(t.view=q),b.sendReq=!0),r=m||n||q,zmail.listObj[r]&&(h=zmail.listObj[r].MO,s.showNxt=zmail.listObj[r].showNextPage),i=b.callbk?b.callbk:a.mailList,!zmail.listObj[r]||b.sendReq){s.req="server",s.reqId=++d;var u,v={u:zmail.conPath+"/ml.do",t:"POST",p:t,ep:s},w=zmail.mailCenter.listElem;if(!e){var x=1===b.f?"listing":"pagination";u=zmComponent.loadingBand({container:w,type:x,addAtFirst:1===b.f})}v.fn=function(a,b){u&&u(),i(a,b)},zmAjq.XHR(v),zmUtil&&(zmUtil.isSharedFolder(m)||zmUtil.isFolderId(m)&&"-1"!==zmList.getRowInfo(m,"zmlTreeH","info").SH)&&"undefined"==typeof zmStream&&zmUtil.requireStreamsApp().done(function(){})}else i(h,s)},foldView:function(b){var c,d,e,f="",g="",h="",i="",j="",k="",l="",m=b.folId||"",n=b.view||"",o=b.viewId||"",p=b.reInitialize,r=b.isLoadingNotNeeded,s=b.retainPreview,t=b.sortOrder;if(d=a.getListingDetObj(),d.view?(l=d.view,g=d.view):d.label?(l="label",g=d.label):d.attach?(l="attach",g=d.attach):d.flag&&(l="flag",g=d.flag),d.fId?f=d.fId:d.label&&(f=d.label),m.indexOf("zm_")!==-1&&(n=m.substring(3,m.length),m="","unread"===n||"all"===n?o=n:""===o&&(o="-1")),f!==m||l!==n||g!==o){a.startFill=!1,c=m,"flag"===n?(n="",j=o||-1):"attach"===n?(n="",k=1):"label"===n&&(n="",i=o||-1),e=$("#zm_Main .SC_frt .SC_mtb").eq(1),m||"unread"!==n&&"all"!==n&&"flag"!==n?e.show():(m="","flag"===n?e.show():e.hide()),zmail.labInfo[m]&&(n="",i=m,m="",c=""),zmail.loadCompleted&&!s&&zmPrev.clsPreview("list"),("stream"===n||c&&"all"===n)&&(n=""),zmCache.clearMailObj({listId:zmUtil.getFolId()}),h='{"fId":"'+c+'","view":"'+n+'","flag":"'+j+'","label":"'+i+'","attach":"'+k+'"}',a.setListingDetObj(h),$.isEmptyObject(d)||q();var u={f:1,t:zmail.mailOpt.range,fId:m,view:n,flag:j,label:i,attach:k,callbk:a.mailList,retainPreview:s};p?(zmsuite.getCenter("zm_Container")[0].getNodes()[0].$el.find(".msi-uncheck").removeClass().addClass("msi-uncheck"),u.callbk=function(b,c){a.reInitListing(),a.mailList(b,c)}):zmList.unchkAll(),"zmlSTree"===$("#"+m).parent().attr("id")&&(u.shId=zmList.getRowInfo(m,"zmlSTreeH","info").SHID),$.publish("mail/listing/viewchanged",[]);var v={fId:b.folId||zmail.mailLeft.selId,view:b.view,viewId:b.viewId};zmRestore.saveState("listing",v,{}),zmUrlAct.update(b),a.getMails(u,"n",r,t,b.hashDeffObj)}},checkThreadRead:function(b){var c,d,e=[];if(zmail.listObj[b]){var f=a.getListingDetObj();for(e=zmList.getViewBasedMsgList(b,f),d=e.length,c=0;c<d;c++)if(0===zmail.mailObj[e[c]].S)return!1}return!0},mailList:function(c,e){if(!zmail.loadCompleted||e.reqId===d){var f,g,h,i;if(i=a.getListingDetObj(),h=i.fId||i.view||i.label||i.flag,"-1"!==h&&"1"!==h&&"2"!==h&&"3"!==h||(h="flag"),"server"===e.req?(f=a.cacheDataObj(c,h,e.from),g=f.showNextPage,f=f.MO):(f=c,g=e.showNxt,e.to=f.length),void 0===e.sortOrder||0!==zmUtil.getMLConversionValue()&&h!==zmail.folId.sId||h===zmail.folId.teId||(zmail.listObj[h].sortOrder=e.sortOrder,1===e.from&&zmInit.toggleSortingIcons(e.sortOrder)),b=!1,a.startFill=!0,h===zmail.folId.oId?$(zmail.mailCenter.listElem).addClass("SC_obox"):$(zmail.mailCenter.listElem).removeClass("SC_obox"),f.length>0){var j=$(a.constructMailRow(h,f));if("h"===zmail.viewInfo[0].DT&&j.find(".zmDate").hide(),"h"===zmail.viewInfo[0].SZ&&j.find(".zmSze").hide(),$(zmail.mailCenter.listElem).find(".zmL").length){var k=$(zmail.mailCenter.listElem)[0].scrollTop;$(zmail.mailCenter.listElem).append(j),$(zmail.mailCenter.listElem)[0].scrollTop=k;var l=zmsuite.getCenter()[0].getNodes()[0].$el.find(".msi-uncheck");l.hasClass("msi-check")&&l.removeClass().addClass("msi-uncheck msi-partcheck")}else $(zmail.mailCenter.listElem).html(j)}else $(zmail.mailCenter.listElem).html(o());if($("#ms_load").remove(),g>=0&&$(zmail.mailCenter.listElem).data("data-ty",g),zmail.loadCompleted&&1===e.from&&(zmail.mailCenter.listElem.scrollTop=0,e.fId&&!zmUtil.isSharedFolder(e.fId)||!e.fId&&"unread"===e.view)){var m=parseInt(c[c.length-1].unCnt);u(m)}if($(zmail.mailCenter.listElem).unbind("scroll").bind("scroll",function(){a.fillMails()}),a.listingBand.SpamTrashBand.setBand(),zmail.loadCompleted&&e.retainPreview){var n=zmPrev.prevDetails();n.msgId&&zmail.mailObj[n.msgId]&&zmList.setMailSelection(n.msgId,n.type,$(zmail.mailCenter.listElem))}e.mlDefObj&&e.mlDefObj.resolve()}},cacheDataObj:function(b,c,d){var e,f;return c&&c.length||(f=a.getListingDetObj(),c=f.fId||f.view||f.label||f.flag,"-1"!==c&&"1"!==c&&"2"!==c&&"3"!==c||(c="flag")),e=zmail.folderCache.dolistObj(c,b,!0),c&&(zmail.listObj[c]&&1!==d?(zmail.listObj[c].MO=zmail.listObj[c].MO.concat(e.MO),zmail.listObj[c].showNextPage=e.showNextPage):zmail.listObj[c]=e),e},constructMailRow:function(b,c){var d,e,f,i,j,k=document.createDocumentFragment(),l=[],m=[],n=a.getListingDetObj(),o=zmCenterListing.create({type:"mail",mapObj:a.mapObj,classObj:a.classObj}),p={},q=" ("+h.contentOptions.archived+")",r="zm_Container",s=zmUtil.getMLConversionValue(b);for(b===zmail.folId.sId&&(p={0:"",1:g.mailDeliveryStatus.tooltips.queued,2:g.mailDeliveryStatus.tooltips.inprogress,3:g.mailDeliveryStatus.tooltips.inprogress,4:g.mailDeliveryStatus.tooltips.inprogress,5:g.mailDeliveryStatus.tooltips.success,6:g.mailDeliveryStatus.tooltips.failure,7:g.mailDeliveryStatus.tooltips.failure,8:g.mailDeliveryStatus.tooltips.undo,9:g.mailDeliveryStatus.tooltips.retry,10:g.mailDeliveryStatus.tooltips.retry}),b||zmTab.currentTab.indexOf("zm_srch")===-1||(b=zmSearchUtil.getSearchedFolders()[0]||"",r=zmTab.currentTab),l=a.getMailRowIcons(b),m=c?c:zmail.listObj[b].MO,j=m.length,i=0;i<j;i++){e=m[i],d=$.extend({},zmail.mailObj[e]),zmail.folCount[b]&&"zm_srch1"!==r||(d.FN=a.findFolName(zmail.mailObj[e].FD),zmail.mailObj[e].AR&&n.label&&!n.fId&&(d.FN+=q)),b===zmail.folId.sId||b===zmail.folId.oId||b===zmail.folId.dId||b===zmail.folId.teId?d.fromaddr=d.TOADDR||d.TO||(d.CC&&"Not Provided"!==d.CC?d.CC:"")||d.BCC||"":d.fromaddr=d.F||d.SN||"",0!==r.indexOf("zm_srch")&&0!==s&&zmail.mailObj[e].TH&&b!==zmail.folId.tId&&b!==zmail.folId.dId&&b!==zmail.folId.sId&&zmail.mailObj[e].TC>0&&(d.M="t"+d.M,d.S=zmail.mailObj[e].TS,d.NFG=a.getThdFlagvalue(e),zmail.mailOpt.isshowSummary&&(d.SM=zmail.mailObj[e].TSM),d.SB=a.getThreadSubject(e),d.TAG=zmail.mailObj[e].TTAGS,d.AT=zmail.mailObj[e].TA),b===zmail.folId.sId||b===zmail.folId.oId?(b===zmail.folId.oId&&(d.S="6"),d.F=zmail.mailObj[e].TOADDR||d.TO||(d.CC&&"Not Provided"!==d.CC?d.CC:"")||d.BCC||g.common.undisclosed):(b===zmail.folId.spId&&(d.NFG="-1",d.TAG=[]),0===s?d.F=zmail.mailObj[e].SN||zmail.mailObj[e].F:d.F=zmail.mailObj[e].TSN||zmail.mailObj[e].SN||zmail.mailObj[e].F);try{0===d.TH&&d.F===zmail.aInfo[zmail.accId].mailId&&(d.F="Me")}catch(t){}if(b===zmail.folId.oId?"queue"===d.S3?d.NFG="5":(d.NFG="4",d.OBT="0"):b===zmail.folId.teId?(d.TC=0,d.NFG="-1",d.S="",d.F=zmail.mailObj[e].TOADDR||g.common.undisclosed):b===zmail.folId.dId?(d.TC=0,d.NFG="-1",d.S="",d.TAG=[],d.F=zmail.mailObj[e].TOADDR||g.common.undisclosed):b===zmail.folId.tId?d.TC=0:!d.TH||0!==s&&0!==r.indexOf("zm_srch")&&b!==zmail.folId.sId||(d.TC=-1,1===d.NS2?d.S=0===d.S?2:4:2===d.NS2&&(d.S=0===d.S?3:5)),d.UW=zmList.isRMOBJ(e),d.AWMID=e,d.data="lt",d.ICN=$.extend([],l),(zmail.mailObj[e].MA&&!zmUtil.isSharedFolder(b)||d.UW)&&(d.HT="1"),zmail.mailObj[e].FD===zmail.folId.sId&&b!==zmail.folId.sId&&(d.MDS=0),zmail.mailObj[e].SCO&&(d.OT=zmail.mailObj[e].SCO.OT,d.SCTX=zmail.mailObj[e].SCO.SCTX),d.hideDraftCount=zmail.mailObj[e].FD===zmail.folId.dId,d.CT=Boolean(zmail.mailObj[e].CT),d.mailDeliveryTip=p[d.MDS]||"",zmail.mailObj[e].SCOBJ&&zmail.mailObj[e].FD!==zmail.folId.spId&&b!==zmail.folId.sId){var u=zmail.mailObj[e].SCOBJ[0]||{};if("REVIEWACTION"===u.SCATYPE)d.schemaTip=_zm.escapeTags(u.DESC||""),d.schemaText=g.quickactions.review,u.SHOWRB?d.actionIcon=d.actionIconColor="review_comment":d.actionIcon=d.actionIconColor="review";else if("RSVPACTION"===u.SCATYPE){if(u.EXPIRED)d.schemaTip=g.quickactions.eventexpired,d.schemaText=g.quickactions.rsvp,d.expired=1;else{d.schemaTip=_zm.escapeTags(u.DESC||"");var v={yes:g.quickactions.yes,no:g.quickactions.no,maybe:g.quickactions.maybe};u.RSVPSTUS?d.schemaText=g.quickactions.attending+" : "+v[u.RSVPSTUS]:d.schemaText=g.quickactions.rsvp}d.actionIcon=d.actionIconColor="rsvp"}else"CONFIRMACTION"===u.SCATYPE||"SAVEACTION"===u.SCATYPE?(d.schemaText=_zm.escapeTags(u.DN||""),d.schemaTip=_zm.escapeTags(u.DESC||""),d.actionIcon=d.actionIconColor="one_click",u.ASTATUS&&(d.expired=1)):"VIEWACTION"!==u.SCATYPE&&"TRACKACTION"!==u.SCATYPE||(d.schemaText=_zm.escapeTags(u.DN||""),d.schemaTip=_zm.escapeTags(u.DESC||""),d.actionIcon=d.actionIconColor="goto")}d.showNewCompactView=zmail.isWatchUser,o.setDataObj(d),f=$(o.getHTML()),zmCenterListing.mailObjectAPI.setViewObject(e,{id:e,$element:f,isSelected:!1,isExpanded:!1},r),k.appendChild(f[0])}return zmail.isWatchUser&&"1"===zmAdHocSettings.getListingDisplayDensity()&&zmInit.showProfileImages(r,m),k},getFirstRecipientEmailId:function(a){if(!zmail.mailObj[a])return"";var b,c,d,e=zmail.mailObj[a].TOADDR;for(e=zmUtil.replaceHTMLEntities(e),e=e.split(","),d=e.length,b=0;b<d;b++)if(c=e[b],c.indexOf("@")!==-1&&c.indexOf(".")!==-1)return c.indexOf("<")!==-1?c.substring(c.indexOf("<")+1,c.indexOf(">")):c;return""},showProfileImages:function(a,b){var c;c="threadChild"===a?zmCenterListing.mailObjectAPI.getViewObjectStore("zm_Container"):zmCenterListing.mailObjectAPI.getViewObjectStore(a);var d=function(a,b,c){a=a||"",b=b||"",zmail.avatar.get({request:!1,email:a.trim(),type:"dom",displayName:b.trim()}).done(function(a){c.prepend(a)})},e=[zmail.folId.sId,zmail.folId.dId,zmail.folId.teId,zmail.folId.oId];b.forEach(function(b){var f,g=b;if("threadChild"===a&&(g="c"+b),zmail.mailObj[b]&&c[g]){var h=[],i=[],j=0,k="";for(zmail.mailObj[b].TSNADDR&&"threadChild"!==a&&a!==zmSearchUtil.getSearchTabId()?e.indexOf(zmUtil.getFolId())!==-1?(k=zmInit.getFirstRecipientEmailId(b)||zmail.mailObj[b].F,h.push(k),i=h):(h=zmail.mailObj[b].TSNADDR.split("... "),i=zmUtil.replaceHTMLEntities(zmail.mailObj[b].TSN).split("... "),h[0]===h[1]&&(h.pop(),i.pop())):"zm_Container"===a&&e.indexOf(zmUtil.getFolId())!==-1||a===zmSearchUtil.getSearchTabId()&&e.indexOf(zmSearchUtil.getSearchedFolders()[0])!==-1?(k=zmInit.getFirstRecipientEmailId(b)||zmail.mailObj[b].F,h.push(k),i=h):(h.push(zmail.mailObj[b].F),i.push(zmUtil.replaceHTMLEntities(zmail.mailObj[b].SN))),f=c[g].$element.find(".zm_prof_img"),j=0;j<h.length;j++)0===j&&f.empty(),d(h[j],i[j],f)}})},updateMailDeliveryStatus:function(a){var b=a.M;a.MDS=parseInt(a.MDS);var c=zmail.mailObj[b],d=a.ignorePopupUpdate||!1,e="",f=a.MDS;if(6===f||7===f){var h=zmail.mailLeft.getNodes()[0].getLayer("zmlTreeH");h.updateCount(zmail.folId.sId,"inc"),zmUtil.updSendErrorStatus(!0,zmail.folId.sId)}if(c&&f!==c.MDS){if(e=c.MDS,f>1&&f<5&&e>1&&e<5||f<5&&e>4)return;if(zmCache.updateObj({mode:"upd",msgId:b,key:"MDS",val:f}),zmUtil.getFolId()===zmail.folId.sId){var i,j=zmCenterListing.mailObjectAPI.getViewObject(b,"zm_Container"),k={0:"",1:g.mailDeliveryStatus.statusTitle.queued,2:g.mailDeliveryStatus.statusTitle.inprogress,3:g.mailDeliveryStatus.statusTitle.inprogress,4:g.mailDeliveryStatus.statusTitle.inprogress,5:g.mailDeliveryStatus.statusTitle.success,6:g.mailDeliveryStatus.statusTitle.failure,7:g.mailDeliveryStatus.statusTitle.failure,8:g.mailDeliveryStatus.statusTitle.undo,9:g.mailDeliveryStatus.statusTitle.retry,10:g.mailDeliveryStatus.statusTitle.retry},l=function(a,b){var c="",d=a.find(".zmSndSts-anipro"),f=a.find(".zmSndStsCon");!d.length&&b>1&&b<5&&(c='<span class="zmSndSts-anipro"><span class="zmSndSts-Inpro zm_delspinner"></span><span class="zmSndSts-Inpro zm_delfiller"></span><span class="zm_delmask"></span></span>'),a.length?(!d.length||b>1&&b<5?f.prepend($(c)):d.remove(),f.attr("class","zmSndStsCon "+zmInit.classObj.mdsParentClass[b]),10===e&&2===b&&f.addClass("zmSndSts-fpro"),a.find("i").removeClass().addClass(zmInit.classObj.deliverySts[b]),a.attr("title",k[b])):(a='<div class="zmSndSts" title="'+k[b]+'"><div class="zmSndStsCon '+zmInit.classObj.mdsParentClass[b]+'" >'+c+'<span class="zmSndStsIco"><i class="'+zmInit.classObj.deliverySts[b]+'"></i></span></div></div>',$(a).insertBefore(j.find(".zmFrm")))};j&&(j=$(j.$element),j.length&&(i=j.find(".zmSndSts"),1!==f?l(i,2):l(i,f),f>4&&(i.length||(i=j.find(".zmSndSts")),setTimeout(function(){l(i,f)},1500))))}!d&&$("#mail_delivery_status").length&&$("#mail_delivery_status").attr("data-msg")===b&&zmList.getMailDeliveryStatus(b)}},constructListHolder:function(){$(".SCl").last().after("<div id='zm_centerHolder' class='SCm_parent'></div>")},getCurrentLeftId:function(){return zmail.mailLeft.selId},checkLoadMoreMails:function(){var a=0;return function(){var b=$(zmail.mailCenter.listElem),c=b[0].scrollTop,d=b[0].scrollHeight-b[0].offsetHeight,e=!1;return a>c?e=!1:c>=.8*Math.floor(d)&&(e=!0),a=c,e}}(),fillMails:_.debounce(function(c){var d,e,f,g,h,i,j="all",k="",l="",m="",n=!1,o="";if(a.checkLoadMoreMails()){if("2"===zmail.listDetails.attach)return void zmail.listObj.attachVw.attachUtil.getAttachemntOnScroll();n=!0,zmUtil.debugLog("Mail Listing","Scroll bottom reached. Have to fill new content")}if(c?(h=c<zmail.mailOpt.range?c:zmail.mailOpt.range,n=!0,a.startFill=!0):h=zmail.mailOpt.range,b&&(n=!1),n&&a.startFill===!0)if(g=$(zmail.mailCenter.listElem).data("data-ty"),
g>0){i=a.getCurrentLeftId(),i.indexOf("zm_")!==-1&&(i=i.substring(3,i.length)),f=a.getListingDetObj(),o=f.fId,k=f.label,j=f.view,l=f.flag,m=f.attach,"unread"!==o&&"all"!==o&&"flag"!==o||(j=o,"flag"===o&&(j=""),o="");var p=zmPrev.prevDetails("zm_Container");if("unread"===j&&p.msgId){var q=p.msgId;e=zmail.mailObj[q]&&(0===zmail.mailObj[q].TH||zmail.mailObj[q].TH&&zmInit.checkThreadRead(zmail.mailObj[q].T))?zmail.listObj[i].MO.length:zmail.listObj[i].MO.length+1}else e=zmail.listObj[i].MO.length+1;d={f:e,t:h,fId:o,view:j,flag:l,label:k,attach:m,sendReq:!0},zmUtil.isSharedFolder(o)&&(d.shId=zmUtil.getShareId(o)),$(zmail.mailCenter.listElem).unbind("scroll").bind("scroll",function(){a.fillMails()}),b=!0,a.getMails(d,"n","",zmail.listObj[i].sortOrder)}else zmList.setEmptyListing()},500),constructListOuter:function(a){var b,c;b=["DIV",{attrs:{"class":"SCm SC_show",id:a.tId||""},child:[["DIV",{attrs:{"class":"SCmb SCmenu",id:a.actId||""}}],["DIV",{attrs:{"class":"SCmc",id:a.mId||""}}]]}],c=_zm.getDOM(b),$("#zm_centerHolder").append(c)},getUnreadViewCount:function(){var a=[zmail.folId.sId,zmail.folId.spId,zmail.folId.oId,zmail.folId.tId];a=a.concat(zmfolAction.getChildrenOf(zmail.folId.tId));var b=$.extend({},zmail.folCount),c=a.length;if(a)for(var d=0;d<c;d++)delete b[a[d]];var e=0;for(var f in b)e+=parseInt(b[f].c);return e},getCountTitle:function(a){var b=e.global.zmail;return a>0&&(b+=" ( "+a+" - "+g.common.unread+" )"),b},updateCountTitle:function(){zmWinTitle.updateTitle()},zmsubStr:function(a,b){return a.indexOf(b)!==-1&&(a=a.substring(b.length,a.length)),a},bindLeftActions:function(b){var c,d,e,f,g,h,i,j="",k="",m="";b=b.zmsData,e=b.type,f=b.eventInfo,d=f.srcElement||f.target,g=b.rowInfo.layerId,c=b.rowInfo.type,i=b.prevSelectLayer;for(var n in b.rowObject){j=b.rowObject.id||n;break}if("contextmenu"===e)zmList.FLUtility(f,d,g,c);else if("click"===e){if("zmlSSrchTreeH"===g)return void("header"===c&&"zmlSSrchTreeH"===j||zmSearch.processSavedSearch({id:j,mode:"get"}));if("header"!==c&&zmail.trialUsers!==!0){var o=zmsuite.getAppRouter("zm_Container"),p=null,r=function(){p&&(zmsuite.setAppRouter("zm_Container",p,{replace:!0}),o.deactivate(),p.activate(),p.update())};"zmStreamTree"===g?zmAppLoader.load("streamsApp").done(function(){p=zmStreamsApp.RouteHelper,r()}):(p=B,r())}if("zmStreamTree"===g&&g!==j){var t,u=zmail.mailLeft.getNodes()[0].getLayer("zmStreamTree");if("more"===j||"less"===j){var v=j,w="less"===j?"more":"less",x=u.listObject,y="more"===j?"showNode":"hideNode",z=u.el.children("#zmsTree").children();_.each(z,function(a,b){t=a.id,(x[t].hideNode&&"more"===j||"less"===j&&b>5&&"more"!==t&&"less"!==t)&&u[y](t)}),u.hideNode(v),u.showNode(w),"more"===w&&$("#"+zmail.zuid)[0].scrollIntoView()}else{if(zmail.trialUsers){if($(d).find(".SC_ct.SC_new").removeClass("SC_new"),zmStreamsApp&&zmStreamsApp.GroupApp&&zmStreamsApp.GroupApp.GroupId&&zmStreamsApp.GroupApp.GroupId===j&&zmsuite.isWorkspaceAvailable("zmStreamsApp"))return void zmsuite.showWorkSpace("zmStreamsApp")}else{var A=zmsuite.getCenter("zm_Container")[0].getNodes()[2].$el;A.removeClass("SC_cmpct");var C=zmTab.getTabObject("zm_Container");C.appIcon="msi-streams",C.searchPlaceHolder=zmText.get("search","searchInApp",{appname:"Streams"}),zmTab.updateTabLst(C),zmshCut.currentLeftId=j,zmsuite.showExistingApp("zm_Container")}zmSearch.updateSearchValues("zmStreamsApp"),zmUtil.requireStreamsApp().done(function(){zmCont.isGroupLoaded(zmStreamsApp.init,[j,!0])}),h=zmail.mailLeft.getNodes()[0].getLayer(g),h.removeClassAtStart(j,"msi-lcmnt"),zmail.trialUsers||(l.SpamTrashBand.removeBand(),$(zmail.mailCenter.listElem).unbind("scroll"),l.removeBulkActionBand())}}else{if(zmshCut.currentLeftId=j,"header"!==c&&zmsuite.showExistingApp("zm_Container"),"zmStreamTree"===i&&g!==i&&!b.rowObject.id){zmStreamsApp.PostApp.unsubscribeEvents(),zmail.mailCenter=zmsuite.getCenter("zm_Container"),a.constructCenter(),zmail.mailCenter.listElem=zmail.mailCenter[0].getNodes()[2].$el[0],zmail.mailCenter.listObj=zmail.mailCenter[0].getNodes()[2],zmail.mailCenter.prevElem=zmail.mailCenter[1].$el[0],zmail.mailCenter.prevObj=zmail.mailCenter[1],zmail.mailCenter.prevObj.getNodes()[0].setListener("click",function(a,b){zmList.bindAction(a,b)}),zmail.mailCenter[0].$el.removeClass("zms_streams SC_streams"),q(),a.setListingDetObj({}),zmSearch.updateSearchValues("m");var D=zmTab.getTabObject("zm_Container");D.searchPlaceHolder=zmText.get("search","searchInApp",{appname:"Mail"}),D.appIcon="msi-mail",zmTab.updateTabLst(D)}"zmlTreeH"===g&&"zmlTreeH"!==j&&(h=zmsuite.getLeft().getNodes()[0].getLayer(g),h.removeHighlightFromParent(j,!0)),j!==g&&("zmllabelH"===g?(k="label",m=j):"zmlviewH"===g&&(k=j.substring(3)),j===zmail.folId.sId&&zmUtil.updSendErrorStatus(!1,zmail.folId.sId),a.foldView({folId:j,view:k,viewId:m})),s(),(zmUtil.isSharedFolder(j)||zmUtil.isFolderId(j)&&"-1"!==zmList.getRowInfo(j,"zmlTreeH","info").SH)&&"undefined"==typeof zmStream&&zmUtil.requireStreamsApp(1).done(function(){})}}a.isLeftFocused=!0},bindActionHeaderIcons:function(b,c,d){var e,f,g,h=d||b.srcElement||b.target;switch(c&&c.indexOf("msi-")===-1&&$(h).prev().hasClass("msi-send")&&(c="msi-send"),c){case"msi-uncheck msi-check":case"msi-uncheck msi-partcheck":zmList.unchkAll();break;case"msi-uncheck":$(h).hasClass("msi-uncheck")||(h=$(h).find(".msi-uncheck")),zmList.chkAll(h);break;case"msi-action":case"msi-customize":case"msi-filter":case"msi-barrow":e=$(h).closest("li"),f="pleft",e.find(".msi-action").length?(g=zmDrop.getActionDrop(),zmTab.currentTab.indexOf("zm_tab")!==-1&&(f="pright")):e.find(".msi-uncheck").length?g=zmDrop.getSelectDrop():e.find(".msi-filter").length&&(g=zmDrop.getViewDrop()),g&&(zmUtil.hideMenu(),e.find("b").addClass("SC_ddn"),zmsuite.showMenu({par:e,list:g,align:f,clk:function(a,b){zmList.bindAction(a,b)}}));break;case"msi-sortdatedn":zmList.changeLisingSortOrder(!1);break;case"msi-sortdateup":zmList.changeLisingSortOrder(!0);break;case"msi-folder":zmUtil.hideMenu(),e=$(h).closest("li"),v(e);break;case"msi-label":zmUtil.hideMenu(),e=$(h).closest("li"),w(e);break;case"msi-spam":zmList.bindAction({action:"spam"});break;case"msi-notspam":zmList.bindAction({action:"notspam"});break;case"msi-trash":zmList.bindAction({action:"delete"});break;case"msi-reply":zmList.bindAction({action:"reply"});break;case"msi-replyall":zmList.bindAction({action:"replyall"});break;case"forward":zmList.bindAction({action:"forward"}),zmUtil.hideMenu();break;case"msi-send":zmList.sendOutbox();break;case"msi-archive":zmList.bindAction({action:"archive"}),zmUtil.hideMenu();break;case"msi-classic":case"msi-compact":e=$(h).closest("li"),f="pright",g=zmDrop.getCustomizeViewDrop(),g&&(zmUtil.hideMenu(),e.find("b").addClass("SC_ddn"),zmsuite.showMenu({par:e,list:g,align:f,clk:function(a,b){zmList.bindAction(a,b)}}));break;case"msi-thread":zmList.changeListingView(0);break;case"msi-conversation":zmList.changeListingView(2)}a.isLeftFocused=!1},getFolderTreeCount:function(){var b={accId:zmail.accId,mode:"foldertree"};zmAjq.XHR({u:zmail.conPath+"/folAction.do",t:"POST",fn:a.updFolTreeCount,p:b})},updFolTreeCount:function(b){var c,d,e,f="zmlTreeH",g={},h="0",i=!1;zmail.folCount&&(h=zmail.folCount[zmail.folId.sId].c||"0",$("#"+zmail.folId.sId).hasClass("SC_redtxt")&&(i=!0));var j=b&&b.foltree;if(j){g=zmail.mailLeft.getNodes()[0].getLayer(f),j[zmail.folId.sId].c=h,j[zmail.folId.dId].c="0";for(var k in j)c=k,e=zmail.folCount[c].c,j[c]!==e&&g.updateCount(c,"upd",j[c].c,!1);zmail.outboxFail&&zmUtil.updSendErrorStatus(!0,zmail.folId.oId),"0"!==h&&i&&zmUtil.updSendErrorStatus(!0,zmail.folId.sId),d=a.getUnreadViewCount(),f="zmlviewH",g=zmail.mailLeft.getNodes()[0].getLayer(f),g.updateCount("zm_unread","upd",d),zmUtil.updateCountForAcc(zmail.accId,"upd",d),zmWinTitle.updateTitle(),"zmStreamTree"!==zmail.mailLeft.selLayerId?zmail.trialUsers&&"zmStreamsApp"===zmTab.currentTab||zmail.mailLeft.selRow(zmail.mailLeft.selId,zmail.mailLeft.selLayerId):"zm_unread"===zmail.mailLeft.selId&&zmail.mailLeft.selRow(zmail.mailLeft.selId,"zmlviewH"),s()}},getAccountInfo:function(){var b={mode:"getAccInfo"};zmAjq.XHR({u:zmail.conPath+"/mailUtilAction.do",t:"POST",fn:a.updateAccountUnreadCount,p:b})},updateAccountUnreadCount:function(a){if(a instanceof Object){var b=a.aInfo;for(var c in b)zmUtil.updateCountForAcc(b[c].accId,"upd",b[c].c)}},getMailRowIcons:function(){var a=[];return a.push("msi-trash"),a},emptyRow:o,reInitListing:q,cSize:t,updateHeaderBand:s,listingBand:l,getThreadSubject:function(a){var b=zmail.mailObj[a].SB||"",c=b.trim();return 0!==c.indexOf("Re:")&&0!==c.indexOf("Fwd:")||(b=zmail.mailObj[a].TSB||b),b},isLeftFocused:!1,setDisplayDensity:function(b){var c=b||zmAdHocSettings.getListingDisplayDensity();a.customizeDisplayDensity(c)},customizeDisplayDensity:function(a){var b,c,d,e,f=["zm_Container","zm_srch1"],g=f.length;for(b=0;b<g;b++)zmsuite.isWorkspaceAvailable(f[b])&&(A(f[b],a),d="","zm_Container"===f[b]&&"zmStreamTree"!==zmail.mailLeft.selLayerId&&(d="m",e=zmail.listObj[zmUtil.getFolId()]&&zmail.listObj[zmUtil.getFolId()].MO||[]),"zm_srch1"===f[b]&&(d=zmSearch.forceSearch?zmSearch.forceSearch:zmSearchUtil.getSearchAppType(),e=zmSearchUtil.getSearchList()),"m"===d&&(c=zmsuite.getCenter(f[b])[0].getNodes()[2].$el||[],"1"===a?(zmail.isWatchUser?(c.addClass("SC_cmpct SC_proCmpct"),"0"===zmAdHocSettings.getListingDisplayDensity()&&zmInit.showProfileImages(f[b],e)):c.addClass("SC_cmpct"),zmAdHocSettings.setListingDisplayDensity(a)):"0"===a&&(zmail.isWatchUser?c.removeClass("SC_cmpct SC_proCmpct"):c.removeClass("SC_cmpct"),zmAdHocSettings.setListingDisplayDensity(a))))},translateSystemFolders:function(){var a,b=zmail.folId,c=zmail.folTree[0];for(var d in b)a=b[d],c[a].FN=f.systemFolder[c[a].FN]},toggleSortingIcons:function(a){var b=zmsuite.getCenter("zm_Container")[0].getNodes()[0].$el;a?(b.find(".msi-sortdatedn").closest("li").show(),b.find(".msi-sortdateup").closest("li").hide()):(b.find(".msi-sortdateup").closest("li").show(),b.find(".msi-sortdatedn").closest("li").hide())}})}(),window.zmList=function(){"use strict";var a,b=zmCenterListing.mailObjectAPI,c=zmText.get("mail"),d=c.leftTree,e=c.listing,f=c.preview,g=c.actions,h=["zmLTMenu_Nf","zmLTMenu_lne1","zmLTMenu_Fr","zmLTMenu_lne2","zmLTMenu_Sf","zmLTMenu_lne3","zmLTMenu_Rf","zmLTMenu_Df","zmLTMenu_lne4","zmLTMenu_Af","zmLTMenu_Ef"],i=0,j=function(b){return a="pvreq_"+Date.now(),b.cpvreq=a,a},k=function(a,b){var c,d=$(b.listElem).scrollTop(),e=a.height();c=d-e,$(b.listElem).scrollTop(c)},l=function(a){var b;b=a.mainElem.find(".zmTV:visible"),k(b,a),b.prev().removeClass("zmTLst"),b.prev().find("i.msi-tarrow").addClass("msi-barrow"),b.hide()},m=function(a){var b,c="";b=a.mainElem.find(".zmTV:visible"),b.children("div.zmSLst").length?(c=b.prev().attr("id"),c.indexOf("t")||(c=c.substring(1)),zmList.setMailSelection(c,"lt",$(a.listElem))):b.prev().hasClass("zmSLst")&&(c=zmUtil.getSelectedMails()[0][0],c&&zmList.setMailSelection(c,"th",$(a.listElem)))},n=function(a){a.rowElem.addClass("zmTLst"),a.rowElem.hasClass("SC_check")&&a.rowElem.next().children("div").addClass("SC_check")},o=function(a,c,d){var e,f=document.createDocumentFragment(),g=c.mId,h=a.MO,i=!0;if(e=d.rowElem.next(),e.hasClass("zmTV"))d.rowElem.hasClass("zmTLst")?(e.slideUp(400,function(){return function(){d.rowElem.removeClass("zmTLst")}}(d)),i=!1):(l(d),e.slideDown(400),n(d));else{l(d);for(var j=$('<div class="zmTV" id="thd'+g+'">'),k=b.getViewObject(g)||b.getViewParentOf(h[0]),o=k&&k.isSelected,p=0;p<h.length;p++)f.appendChild(zmList.constructThreadChildRow(h[p],o)[0]);j.append(f),$(j).insertAfter(d.rowElem).hide().slideDown(400),n(d)}var q;q=i?{mId:c.mId}:{mId:""},zmRestore.saveState("expandThd",q,{mId:c.mId}),m(d),c.eTDefObj&&c.eTDefObj.resolve()},p=function(a,b,c){var d,e,f="",g=b.mId,h=a.MO,i=h.length,j="",k={},l=!1;"zm_Container"===zmTab.currentTab?k=zmInit.getListingDetObj():zmTab.currentTab.indexOf("zm_tab")!==-1?k=zmsuite.getCenterOuter().$el.data("data-detail"):zmTab.currentTab.indexOf("zm_srch")!==-1&&(k=zmSearchUtil.getSearchViewDetails()),"search"===k.view?j="S":0===b.opentype?j="P":2===b.opentype?j="T":3===b.opentype&&(j="N"),b.streamsMail||0===zmUtil.getMLConversionValue()&&(0!==zmUtil.getMLConversionValue()||"conversation"!==b.src)||(l=!0);for(var m=0;m<i;m++){var n=zmail.mailObj[h[m]];if(e=j+n.M,n.SM=n.SM||"",n.M&&n.M!==g){if(n.FD===zmail.folId.spId&&k.fId!==zmail.folId.spId||n.FD===zmail.folId.tId&&k.fId!==zmail.folId.tId)continue;f+=n.FD!==k.fId&&zmail.folCount[k.fId]&&3!==b.opentype?'<div class="SC_pct SC_Tfdr">':'<div class="SC_pct">',f+=zmPrev.getHeader({msgId:n.M,thd:!0,opentype:b.opentype,frm:n.F,sender:n.SN,hasAtt:n.AT,sm:n.SM,label:n.TAG,flag:n.NFG,date:n.DT,elemId:e,hdrId:c.hdrId,elemObj:c,showIndex:l}),f+="</div>"}}0===b.opentype?(d=c.contElem,d.append(f),$(c.prevElem).addClass("tmail"),$(c.listElem).parent().addClass("SC_sw")):2===b.opentype?(d=c.contElem,d.append(f),zmsuite.getCenter()[1].$el.addClass("tmail")):3===b.opentype&&(d=c.contElem,_zm.addClass(d.parentElement,"tmail"),$(d).append(f))},q=function(a,b){var c,d=b.mId,e=[],f=[],g=0,h=zmail.mailObj[d].T;a.tdata&&(a=a.tdata),c=b.elemObj;var i=c.viewDetails||zmInit.getListingDetObj();if(!h||zmail.listObj[h]&&!zmUtil.isInlineCompose()||!a.length&&!a.tdata||(zmail.listObj[h]=zmCache.dolistObj(h,a),zmUtil.isInlineCompose()&&zmUtil.mapDraftId(h)),"search"===i.view?f=e=zmail.listObj[h].MO||[]:(f=zmList.getViewBasedMsgList(h,i,!1),e=zmail.listObj[h].MO),"tIcon"===b.from){if(f.length>1)o({MO:f},b,c);else if("unread"===i.view){var j=$.extend({},i);j.view="all",f=zmList.getViewBasedMsgList(h,j,!1),o({MO:f},b,c)}}else if("showMail"===b.from){p({MO:e},b,c),"0"===b.opentype&&zmsuite.getCenter()[1].$el.find(".SC_pct").removeClass("SC_Tfcs");for(var k=0;k<e.length;k++)if(b.mId===e[k]){g=k;break}g>0&&($(c.prevElem).find("#zmHdrP"+d).parent().insertAfter($(c.prevElem).find("#zmHdrP"+e[g-1]).parent()),$(c.prevElem).find("#zmHdrT"+d).parent().insertAfter($(c.prevElem).find("#zmHdrT"+e[g-1]).parent()),$(c.prevElem).find("#zmHdrS"+d).parent().insertAfter($(c.prevElem).find("#zmHdrS"+e[g-1]).parent()),$("#zmHdrN"+d).parent().insertAfter($("#zmHdrN"+e[g-1]).parent()))}},r=function(a,b,c){var d;if(d=b.attr("id")||b.attr("data-detail"),"add"===a){var e=zmail.mailObj[d]?zmail.mailObj[d].PA:"";c.find(".zmL").each(function(){var a=$(this),b=this.id||$(this).attr("data-detail");a.removeClass("zm_tst zm_ted zm_trd zm_tsel"),b===d&&a.addClass("zm_trd"),b===e&&(a.addClass("zm_trd"),e=void 0===zmail.mailObj[e].PA?"":zmail.mailObj[e].PA)})}else"remove"===a&&c.find(".zmL").removeClass("zm_tst zm_ted zm_trd zm_tsel")},s=function(a){var b,c,d,f,g,h,i=[],j=zmSearchUtil.isNewSearch();if(b=zmInit.rclkId,b=zmInit.zmsubStr(b,"t"),"zm_srch1"===zmTab.currentTab)i=zmSearchUtil.getSearchedFolders().slice();else{var k=zmInit.getListingDetObj();h=k.fId,h&&i.push(h)}if("sender"===a)c=zmail.mailObj[b].F||zmail.mailObj[b].SN,c&&(j?(g=g||[],g.push({className:"sender",value:c}),i.length&&g.push({className:"FolderFilter",value:zmfolAction.getFolderPath(i[0])})):g={searchQueryArr:[{lhs:"Sender",contains:!0,value:c}],folderArr:i});else if("recipient"===a)try{var l=zmail.mailObj[b].TO||zmail.mailObj[b].TOADDR||(zmail.mailObj[b].CC&&"Not Provided"!==zmail.mailObj[b].CC?zmail.mailObj[b].CC:"")||zmail.mailObj[b].CCADDR||void 0;d=l?zmConUtil.splitncheck(l,"object"):[],d=d.length?d[0].eid:void 0,d&&(j?(g=g||[],g.push({className:"toorcc",value:d}),i.length&&g.push({className:"FolderFilter",value:zmfolAction.getFolderPath(i[0])})):g={searchQueryArr:[{lhs:"To/Cc",contains:!0,value:d}],folderArr:i})}catch(m){}else"subject"===a&&(f=zmInit.rclkId.indexOf("t")!==-1?zmInit.getThreadSubject(b):zmail.mailObj[b].SB,f&&(f=zmUtil.replaceHtmlInSubject(f),f='"'+f+'"',j?(g=g||[],g.push({className:"subject",value:f}),i.length&&g.push({className:"FolderFilter",value:zmfolAction.getFolderPath(i[0])})):g={searchQueryArr:[{lhs:"Subject",contains:!0,value:f}],folderArr:i}));g?j?(zmail.Search.Environment.remove(),zmail.Search.setContext(zmail.Search.Models.Contexts.mailSearchContext),zmail.Search.addFilters(g)):(zmSearch.setPrevAppSearch("m"),zmSearch.addSearch(g)):_zm.succErrMsg("e",e.common.errorsearch),zmUtil.hideMenu()},t=function(a,b,c){zmail.mailObj[a]||(zmail.mailObj[a]={M:a,FD:c||"",T:"",TAG:"",NFG:"",SM:"",SB:"",TH:0}),b&&(zmail.mailObj[a].TH=1,zmail.mailObj[a].T=b)},u=function(a,b,c){t(a,c);var d=zmail.mailObj[a];d.F=d.F||b.FROM,d.TO=d.TO||b.TO,d.SN=d.SN||b.SENDER,d.R=d.R||b.RDT,d.SB=d.SB||b.SUBJECT,d.AT=d.AT||(b.NEWATT?1:0)},v=function(a,b,c){var d,e=b.msgId,g=b.type,h=b.prevId||e,i=zmail.mailObj[e],j=b.tabId||zmTab.currentTab,k="",l=zmPreviewTemplate.getSubjectToPreview(i.SB);$(c.prevElem).removeClass("tmail smail"),c.rowElem&&zmList.doThreadPath(c.rowElem,"remove"),d=zmsuite.getCenter(j)[1].getNodes(),k=!i.TH||(0!==zmUtil.getMLConversionValue()&&zmail.mailLeft.selId!==zmail.folId.sId||"zm_Container"!==zmTab.currentTab)&&"zm_srch1"!==zmTab.currentTab?["DIV",{attrs:{"class":"SC_phd"},child:[["text",l]]}]:["DIV",{attrs:{"class":"SC_phd"},child:[["text",l],["I",{attrs:{"class":"msi-thread","data-event":"viewfullthd","data-from":"header",title:f.contextmenu.viewthd}}]]}];var m=_zm.copyOf(zmInit.prevHeader);i.streams&&(m.rIcons=_zm.copyOf(zmInit.prevHeader.rIcons),b.showIcons?m.rIcons.splice(1,m.rIcons.length-2):m.rIcons.splice(0,m.rIcons.length-1),b.titleTxt&&(k=["DIV",{child:[["SPAN",{attrs:{"class":"SC_StrmMT"},child:[["text",b.titleTxt]]}],["DIV",{attrs:{"class":"SC_phd"},child:[["text",l]]}]]}])),zmInit.prevHeader.text=k,m.text=k,d[0].push(m),zmPrev.setMailDOMContent(a.mdata,b),"lt"===g&&zmsuite.getCenter(j)[1].contentObj.$el.find(".SC_pct").removeClass("SC_Tfcs"),c.contElem=zmsuite.getCenter(j)[1].contentObj.$el,c.hdrElem=zmsuite.getCenter(j)[1].getNodes()[0].$el,$(c.prevElem).attr({"data-mid":h,"data-ty":b.type}),zmsuite.getCenter(j)[1].show(),i.TH&&c.viewDetails.fId!==zmail.folId.tId&&(0!==zmUtil.getMLConversionValue()&&"search"!==c.viewDetails.view&&c.viewDetails.fId!==zmail.folId.sId||i.streams||"conversation"===b.src)?(q("",{mId:e,from:"showMail",opentype:b.opentype,elemObj:c}),$(c.prevElem).addClass("tmail"),"th"===g&&c.viewDetails.fId!==zmail.folId.spId&&c.viewDetails.fId!==zmail.folId.tId&&zmList.doThreadPath(c.rowElem,"add")):($(c.prevElem).addClass("smail"),c.mainElem.addClass("SC_sw")),zmPreviewTemplate.setPreviewHeaderHeight(c),$(c.prevElem).hasClass("tmail")?c.contElem.css({bottom:"0px"}):c.contElem.css({bottom:$(c.prevElem).find(".zmQRB").height()+"px"}),zmUtil.setScrollShadow(c.contElem),"conversation"===b.src?($(c.mainElem).find("i.msi-prev,i.msi-next").closest("b").addClass("SC_opy3"),zmUtil.sTopMenu({type:"p"})):b.streamsShowMail||(zmUtil.sTopMenu({type:"p"}),zmList.unchkAll(c),zmPrev.PvNt(b.rowId,b.type,b.opentype,zmTab.currentTab,c))},w=function(a,b,c){zmPrev.setMailDOMContent(a.mdata,b);var d=zmail.mailObj[b.msgId],e=a.tdata&&a.tdata.length?"t"+d.T:d.M,f=c.contElem[0].parentElement;_zm.setAttr(f,{msgId:e,groupId:b.shOwner}),a.tdata&&a.tdata.length&&q(a.tdata,{mId:b.msgId,from:"showMail",opentype:3,elemObj:c})},x=function(a,b,c){var e,h,i,j=b.msgId,k=j,l=zmPreviewTemplate.getSubjectToPreview(zmail.mailObj[j].SB),m="",n=zmail.mailObj[j],o={},p=b.msgId;"lt"===b.type&&n.TH&&(0!==zmUtil.getMLConversionValue()&&c.viewDetails&&"search"!==c.viewDetails.view&&c.viewDetails.fId!==zmail.folId.sId||n.streams||"conversation"===b.src||"restore"===b.src&&"conversation"===b.toOpen)&&(h=n.T,k=h,j="t"+h,i=zmail.listObj[h],p=h),e="zm_tab"+j;var r=function(a,b){var c=b.id.split("#")[1];c===p&&zmsuite.isWorkspaceAvailable(e)&&zmsuite.closeWorkspace(e)};if($.subscribe("zmstreamsapp/deletePost",r),zmsuite.isWorkspaceAvailable(e)&&"restore"!==b.src&&!b.streamsMail)return void zmsuite.showWorkSpace(e);b.tabId=e,b.from&&zmsuite.isWorkspaceAvailable("zm_tab"+b.from)&&"restore"!==b.src&&zmsuite.closeWorkspace("zm_tab"+b.from);var s=b.actionType;b.streamsMail&&(s=zmCont.isGroup(b.groupId)?"viewGroupEntity":"viewSelfData");var t=function(){var a=zmsuite.createAppRouter();return b.streamsMail?(a._hashKey="stream",a.initialize({hashKey:"stream",handler:function(){return{updateParams:!1,handled:!1,daultAction:!1}}}),a.setParams(["tab",b.groupId,k,b.entityType,s])):(a._hashKey="mail",a.initialize({hashKey:"mail",handler:function(){return{updateParams:!1,handled:!1,daultAction:!1}}}),a.setParams(["tab",j])),a},u=t(),v=function(){var b={appname:l,title:a.mdata.SENDER,appId:e,faqKey:"Conversations",data:{CNodes:"2"},router:u,appIcon:"msi-mailopen",shortcuts:zmshCut.mail,titleProvider:function(){return zmUtil.decodeHTMLEntities(l)}};return b},w=v(),x={appId:e,msgId:b.msgId,opentype:2,type:b.type};w.onDelete=function(){var a=zmsuite.getCenter(e)[1].$el;return zmPreviewTemplate.unsubscribeNotesTasks(a),!0},("restore"===b.src||b.streamsMail)&&zmsuite.isWorkspaceAvailable(e)?zmsuite.resetWorkspace(e,w):zmsuite.setWorkSpace(w),c=c||zmList.getListingElemObj(b);var y=zmsuite.getCenter(),z=y[0].getNodes(),A=y[1].getNodes();if(z[1].$el.remove(),zmsuite.renderCenter(),m=n.TH&&(0===zmUtil.getMLConversionValue()||c.viewDetails&&c.viewDetails.folId===zmail.folId.sId||c.viewDetails&&"search"===c.viewDetails.view)?["DIV",{attrs:{"class":"SC_phd"},child:[["text",l],["I",{attrs:{"class":"msi-thread","data-event":"msi-thread","data-action":"viewfullthd","data-from":"header",title:f.contextmenu.viewthd}}]]}]:b.titleTxt?["DIV",{child:[["SPAN",{attrs:{"class":"SC_StrmMT"},child:[["text",b.titleTxt]]}],["DIV",{attrs:{"class":"SC_phd"},child:[["text",l]]}]]}]:["DIV",{attrs:{"class":"SC_phd"},child:[["text",l]]}],o={id:"zmPrevHeader",rIcons:[{groupId:"MoveLabel",actionArr:[{iconClass:"msi-folder",data:"msi-folder",dropAction:!0,tooltip:g.iconTooltip.move},{iconClass:"msi-label",data:"msi-label",dropAction:!0,tooltip:g.iconTooltip.addtag}]},{groupId:"spamTrash",actionArr:[{iconClass:"msi-trash",data:"msi-trash",tooltip:g.iconTooltip["delete"]},{iconClass:"msi-spam",data:"msi-spam",tooltip:g.iconTooltip.markspam},{iconClass:"msi-notspam",data:"msi-notspam",tooltip:g.iconTooltip.marknotspam}]},{groupId:"Archive",actionArr:[{iconClass:"msi-archive",data:"msi-archive",tooltip:g.iconTooltip.archive}]},{groupId:"action",actionArr:[{iconClass:"msi-action",data:"msi-action",dropAction:!0,tooltip:d.iconTooltip.moreact}]},{groupId:"prevIcons",actionArr:[{iconClass:"msi-prev",data:"msi-prev",tooltip:g.iconTooltip.prev},{iconClass:"msi-next",data:"msi-next",tooltip:g.iconTooltip.next},{iconClass:"msi-delete",data:"msi-delete",tooltip:g.iconTooltip.close}]}]},o.text=m,A[0].push(o),b.streamsMail&&(o.rIcons=[{groupId:"prevIcons",actionArr:[{iconClass:"msi-delete",data:"msi-delete",tooltip:g.iconTooltip.close}]}]),A[0].setListener("click",function(a,b){switch(a){case"msi-prev":zmPreviewTemplate.loadPrevMail();break;case"msi-next":zmPreviewTemplate.loadNextMail();break;case"msi-delete":zmList.bindAction({action:"clsPrev"}),$.unsubscribe("zmstreamsapp/deletePost",r);break;case"msi-thread":zmList.bindAction($(b).data(),b);break;default:zmInit.bindActionHeaderIcons(null,a,b)}}),zmsuite.getCenterOuter().$el.data("row-detail",b),c.viewDetails&&"search"===c.viewDetails.view)zmsuite.isWorkspaceAvailable("zm_srch1")&&zmsuite.getCenterOuter().$el.data("data-maillist",zmSearchUtil.getSearchList().slice()),zmsuite.getCenterOuter().$el.data("data-detail",c.viewDetails);else if(c.viewDetails&&"stream"===c.viewDetails.view)zmsuite.getCenterOuter().$el.data("data-maillist",[b.msgId]),zmsuite.getCenterOuter().$el.data("data-detail",c.viewDetails);else{var B=zmInit.getListingDetObj(),C=zmUtil.getFolId(B);zmsuite.getCenterOuter().$el.data("data-detail",B),zmsuite.getCenterOuter().$el.data("data-maillist",zmail.listObj[C]&&zmail.listObj[C].MO.slice()||[])}zmPrev.setMailDOMContent(a.mdata,b),c.mainElem=y[0].$el,c.contElem=y[1].contentObj.$el,c.hdrElem=A[0].$el,c.prevElem=y[1].$el,y[1].show(),"lt"===b.type&&n.TH&&n.FD!==zmail.folId.tId&&(0!==zmUtil.getMLConversionValue()&&c.viewDetails&&"search"!==c.viewDetails.view&&c.viewDetails.fId!==zmail.folId.sId||n.streams||"conversation"===b.src||"restore"===b.src&&"conversation"===b.toOpen)&&(x.tId=n.T,q(i,{mId:b.msgId,from:"showMail",opentype:b.opentype,elemObj:c})),zmsuite.showWorkSpace(e),y[0].$el.addClass("SC_sw"),y[1].$el.addClass("SC_w100"),zmUtil.sTopMenu({type:"l",iconsDiv:A[0]});var D=zmsuite.getCenter()[1].getNodes()[0].$el[0].clientHeight;c.contElem.css({top:D+"px"}),$(c.prevElem).hasClass("tmail")?c.contElem.css({bottom:"0px"}):(y[1].contentObj.$el.find(".SC_pct").removeClass("SC_Tfcs"),c.contElem.css({bottom:$(c.prevElem).find(".zmQRB").height()+"px"})),$(c.prevElem).attr({"data-mid":j,"data-ty":b.type}),zmUtil.setScrollShadow(c.contElem),b.src&&("external"===b.src||"restore"===b.src)||n.streams?$(c.mainElem).find("i.msi-prev,i.msi-next").closest("b").addClass("SC_opy3"):b.streamsShowMail||zmPrev.PvNt(b.rowId,b.type,b.opentype,e,c),x.fId=n.FD,x.viewDetails=c.viewDetails,x.toOpen=b.toOpen||"conversation"===b.src?"conversation":void 0;var E={actionType:"viewGroupEntity",etype:b.entityType,gid:b.groupId};if(E.pid=x.tId?x.tId:b.msgId,b.streamsMail){var F={appId:e,appname:l,data:{},appIcon:"msi-mailopen"};$.publish("zmail/SaveTabState",[{appId:e,app:"stream",appObj:F,category:"stream_mail",data:E}])}else $.publish("zmail/SaveTabState",[{appId:e,app:"m",appObj:{appId:e,appname:l,data:{},appIcon:"msi-mailopen"},category:"mail_tab",data:x}]),zmRestore.saveState("tab",{key:"tab",data:{app:"m",category:"mail_tab",data:x}},{action:"open"})},y=function(a,b,c,d){if(b=b||{},"tIcon"!==b.from&&"bulk"!==a.mode){var e=zmail.mailObj[a.msgId]||{};a.entityId=a.entityId||e.T||a.msgId,a.groupId=a.groupId||zmail.zuid,a.entityType=1}var f={u:zmail.conPath+"/md.do",t:"POST",fn:c,p:a,ep:b};"function"==typeof d&&(f.efn=d),zmAjq.XHR(f)},z=function(a){var b,c={};return a=a||zmTab.currentTab,b=zmsuite.getCenter(a),b[1]&&(c.prevElem=b[1].$el[0]),b[0].getNodes()[2]&&(c.listElem=b[0].getNodes()[2].$el[0]),c.mainElem=b[0].$el,c.hdrId="zmHdr",c.viewDetails=$.extend({},zmsuite.getCenterOuter(a).$el.data("data-detail")),a.indexOf("zm_srch")?a.indexOf("zmStreamsApp")?a.indexOf("zm_tab")?c.viewDetails=$.extend({},zmInit.getListingDetObj()):c.viewDetails=$.extend({},zmsuite.getCenterOuter(a).$el.data("data-detail")):c.viewDetails={view:"stream"}:(c.id=1,c.viewDetails=$.extend({},zmSearchUtil.getSearchViewDetails())),c},A=function(a){var b,c,d,e,f,g,h,i,j={},k=!1,l=!1;return i=a.tabId||zmTab.currentTab,(g=a.msgId)?(g.indexOf("t")||(g=g.substring(1)),b=zmail.listObj,i.indexOf("zm_srch")||(k=!0),zmUtil.getFolId()===zmail.folId.sId&&(l=!0),k?(h=i.substring(7),e=zmSearchUtil.getSearchViewDetails(),c="lt"===a.type?zmSearchUtil.getSearchList():zmList.getViewBasedMsgList(zmail.mailObj[g].T,e,!1)):(e=zmInit.getListingDetObj(),f=a.opentype,d=zmUtil.getFolId(),"lt"===a.type?b[d]&&(c=b[d].MO):b[zmail.mailObj[g].T]&&(c=zmList.getViewBasedMsgList(zmail.mailObj[g].T,e,!1))),0===f?j=z("zmStreamsApp"===i?"zmStreamsApp":"zm_Container"):(j=z(i),j.listElem||(k?j.listElem=zmsuite.getCenter("zm_srch1")[0].getNodes()[2].$el:j.listElem=zmail.mailCenter.listElem)),j.listArr=c,j.id=h,j.msgId=g,j.isParent=zmail.mailObj[g].TH&&"lt"===a.type&&0!==zmUtil.getMLConversionValue(),"lt"===a.type&&zmail.mailObj[g].TH&&0!==zmUtil.getMLConversionValue()?k||l?j.rowElem=$(j.listElem).find("#"+g):j.rowElem=$(zmail.mailCenter.listElem).find("#t"+g):k||l?j.rowElem=$(j.listElem).find("#"+g):j.rowElem=$(zmail.mailCenter.listElem).find("#"+g),k&&(zmSearchUtil.isNewSearch()?j.collection={}:j.collection=zmail.searchObj[1].collection),2===a.opentype?(j.contElem=zmsuite.getCenter("zm_Container")[1].getNodes()[1].$el.children().eq(0),j.hdrElem=zmsuite.getCenter("zm_Container")[1].getNodes()[0].$el):(j.contElem=zmsuite.getCenter()[1].getNodes()[1].$el.children().eq(0),j.hdrElem=zmsuite.getCenter()[1].getNodes()[0].$el),j.type=a.type,j):j},B=function(a,b,c,d,e){var f,g,h,i={attData:{},addInfo:{}},j=zmail.attachmentContainer;for(f in c)g=c[f].e,i.attData[g]||(i.attData[g]={},i.attData[g].attData=[],i.attData[g].addInfo={}),i.attData[g].attData[parseInt(c[f].Id)-1]=c[f];i.addInfo.shownext=d,i.addInfo.isFull=!0,"tc"===e&&(i.addInfo.isFull=!1),h=j.getObject(b),h?"tc"===e?h.data.attData[a]=i.attData[a]:"t"===e&&(h.data=i):j.addObject({id:b,data:i})},C=function(a,b,c){var d=!1,e=zmail.attachmentContainer;switch(c){case"sm":(e.getObject(b)||zmail.mailAttachments[a])&&(d=!0);break;case"tc":(e.getObject(b)||zmail.mailAttachments[b])&&zmail.mailAttachments[b].data.attData[a]&&(d=!0);break;case"t":(e.getObject(b)||zmail.mailAttachments[b])&&zmail.mailAttachments[b].data.addInfo.isFull&&(d=!0)}return d},D=function(a,b,c){var d=[];switch(c){case"sm":zmail.mailAttachments[a]&&(d=zmail.mailAttachments[a].data.attData[a].attData);break;case"tc":zmail.mailAttachments[b]&&zmail.mailAttachments[b].data.attData[a]&&(d=zmail.mailAttachments[b].data.attData[a].attData);break;case"t":if(zmail.mailAttachments[b]){var e,f,g,h=zmail.mailAttachments[b].data.attData,i=Object.getOwnPropertyNames(h);for(e=0;e<i.length;e++){g=h[i[e]].attData;for(f in g)d.push(g[f])}}break;default:d=[]}return d},E=function(b,c){if(b.mdata.MSGID&&1===Object.keys(b.mdata).length&&2===c.opentype&&c.prevDefObj)return void c.prevDefObj.resolve();zmUtil.debugLog("zmList.openMail()",b,c);var d,e,f,g,h,i,j,k,l;if(d=c.msgId,b.mdata&&b.mdata.MSGID&&d!==b.mdata.MSGID&&(d=b.mdata.MSGID,zmail.mailObj[c.msgId].TH?u(d,b.mdata,zmail.mailObj[c.msgId].T):u(d,b.mdata),c.msgId=d),"external"!==c.src&&"restore"!==c.src&&"zmncenter"!==c.src||!b.mdata||(u(d,b.mdata),zmail.mailObj[d].AT&&(c.att=zmail.mailObj[d].AT),b.tdata&&b.tdata.length&&!zmail.mailObj[d].T&&(zmail.mailObj[d].TH=1,zmail.mailObj[d].T=b.tdata[0].T)),c.streamsShowMail=c.streamsShowMail||!1,c.isDraftMail=c.isDraftMail||!1,c.isDraftEditable=c.isDraftEditable||!1,e=zmail.mailObj[d].T,g=c.opentype,f=c.elemObj,k=c.isSh||!1,k&&3!==g&&delete c.streams,e&&!c.streamsMail&&("zm_srch1"===zmTab.currentTab&&("conversation"===c.src||"conversation"===c.toOpen||"content"===c.type)||0!==zmUtil.getMLConversionValue()&&"zm_srch1"!==zmTab.currentTab||0===zmUtil.getMLConversionValue()&&("conversation"===c.src||"conversation"===c.toOpen))&&(c.showIndex=!0),f&&"search"===f.viewDetails.view?(j="S"+d,l="S"):0===g?(j="P"+d,l="P"):2===g?(j="T"+d,l="T"):3===g&&(j="N"+d,l="N"),c.prefix=l,f&&"search"===f.viewDetails.view&&!f.listArr){var m=f.id;zmSearchUtil.isNewSearch()?(f.searchStr=zmSearchUtil.getSearchString(),f.listArr=zmSearchUtil.getSearchList()):("srch"===zmail.searchObj[m].collection.type?(f.searchStr=zmail.searchObj[m].collection.searchContArr[0],f.searchType=2):(f.searchStr=zmail.searchObj[m].collection.advSearchStr,f.searchType=3),f.listArr=zmail.searchObj[m].collection.searchList),"lt"===c.type&&zmail.mailObj[d].TH?f.rowElem=$(f.listElem).find("#t"+d):f.rowElem=$(f.listElem).find("#"+d)}if(b.tdata&&(e&&(!zmail.listObj[e]||zmUtil.isInlineCompose()||c.streamsMail)&&(zmail.listObj[e]=zmCache.dolistObj(e,b.tdata),zmUtil.isInlineCompose()&&zmUtil.mapDraftId(e),c.sm=zmail.mailObj[d].SM||""),c.streamsMail)){var n,o,p=b.tdata,q=p.length;for(n=0;n<q;n++)o=p[n].M,o&&(zmail.mailObj[o].accId=c.accId,zmail.mailObj[o].actionType=c.actionType,zmail.mailObj[o].entityType=c.entityType,zmail.mailObj[o].groupId=c.groupId,zmail.mailObj[o].entityType=c.entityType,zmail.mailObj[o].S=1,zmail.mailObj[o].streams=!0,zmail.mailObj[o].isFav=c.isFav,zmail.mailObj[o].TAG=c.TAG,c.newStreams&&(zmail.mailObj[o].newStreams=!0))}if(c.vfc)zmail.mailContainer.removeObject(d),zmPreviewTemplate.showFullContent(b,c);else if("content"===c.type)"bulk_mail"!==c.load_action&&$(f.prevElem).find(".SC_pct").removeClass("SC_Tfcs"),zmPrev.setMailDOMContent(b.mdata,c),2===g&&f&&"search"===f.viewDetails.view&&(f=zmList.getElemObj()),3!==g&&zmPreviewTemplate.setPreviewHeaderHeight(f);else{if(0===g){if(c.cpvreq&&c.cpvreq!==a)return c.markread&&zmmailAct.applyActions("unread","click",{msgId:[d],thd:[]}),void zmUtil.prevCache(d,b);v(b,c,f),c.streamsShowMail||"zm_srch1"===c.tabId||(zmUrlAct.update({from:"zmCenter",
msgId:c.msgId,type:c.type,opentype:0}),zmRestore.saveState("preview",{p:c.msgId},{}))}else 2===g?x(b,c,f):3===g&&("zmncenter"===c.src&&(zmList.getNotifyPopupContainer(b.mdata,f.prevElem,k,f),c.parentElm=f.contElem,f.prevElem.className.indexOf("SC_Twpr")===-1&&(f.contElem[0].style.maxHeight=document.body.getBoundingClientRect().height-zmUtil.wmsBarHeight()-320+"px",f.contElem[0].style.overflow="auto"),b.mdata.shareId=c.shId||c.shareId),zmail.mailContainer.removeObject(d),w(b,c,f));if(c.streamsMail&&3!==g&&!b.mdata.newStreams&&!k){var r=e||d;r=zmail.mailObj[r].groupId+"#"+r,zmUtil.requireStreamsApp().done(function(){zmStreamsApp.PostActions.getSharedMail(r,$(f.contElem)[0])}).fail(function(){zmUtil.debugLog("Could not load comments !","zmList.openMail()",arguments)})}if(f.contElem){var s=$.extend({},c);$(f.contElem).data("msg_params",s)}}if(zmUtil.prevCache(d,b),b.ddata){var t,y,z=b.ddata,A=z.length,D=0;for(D=0;D<A;D++)t=z[D].draftId,y=z[D].content,zmUtil.prevCache(t,{mdata:y});zmPreviewTemplate.addDraftsToView(zmail.mailObj[d].T,$(f.prevElem),l)}if(b.mdata&&b.mdata.READSTATUS&&c.reqSent)"success"===b.mdata.READSTATUS&&zmmailAct.rapplyAction({result:"success"},{mailId:[d],thd:[],action:"read"});else if(0===zmail.mailObj[d].S&&zmail.mailObj[d].FD!==zmail.folId.oId&&"stream"!==f.viewDetails.view||c.markread){var E={};E.msgId=[d],E.thd=[],zmmailAct.applyActions("read","click",E)}if(f?(h=$(f.prevElem),3===g&&(h.closest(".SCS_popUp").length?h=h.closest(".SCS_popUp"):h.closest("#postpopUp").length&&(h=h.closest("#postpopUp"))),i="th"===c.type||"content"===c.type?$("#zmCon"+j):$(f.prevElem)):h=i=$(c.parentElm),zmail.mailObj[d].FD===zmail.folId.oId&&$(f.prevElem).find("i.msi-popout").closest("b").addClass("SC_opy3"),zmPreviewTemplate.showInvitation(d,h),zmPreviewTemplate.showImageDisplayElem(d,h),zmail.mailObj[d].FD!==zmail.folId.spId&&zmPreviewTemplate.showUnsubscribe(d,h),"content"!==c.type&&(c.vfc||zmPreviewTemplate.showProfilePhoto({msgId:c.msgId,type:"lt"},h),e&&zmail.listObj[e]&&1===zmail.listObj[e].showNextPage&&(0!==zmUtil.getMLConversionValue()&&"search"!==f.viewDetails.view||"conversation"===c.src||"conversation"===c.toOpen)&&zmPreviewTemplate.addShowMoreMailsLink(f,g)),zmPreviewTemplate.bindPreviewEvents(h,g),zmPreviewTemplate.applyHeaderState($("#zmHdr"+j)),"bulk_mail"===c.load_action||c.noScroll||c.vfc||zmUtil.setPreviewScroll($("#zmHdr"+j).closest(".SC_pct"),f.contElem),zmail.mailObj[d].TH&&"lt"===c.type&&!c.streamsShowMail&&"1"===zmAdHocSettings.getMarkConversationRead()&&(zmInit.checkThreadRead(e)||zmList.loadUnreadMails(e,g,f.viewDetails)),c.showIndex&&$('[id="zmHdr'+j+'"]').each(function(a,b){setTimeout(function(){$(b).find("#zm_readtitle").fadeOut()},5e3)}),b.mdata.NEWATT){var F,G,H,I,J,K,L=b.mdata.NEWATT,M=L.length,N=0,O=zmail.mailObj[d],P=zmail.mailObj[d].TH;for(P?(J=O.T,K="tc"):(J=d,K="sm"),C(d,J,K)||B(d,J,L,void 0,K),I=O.FD,I&&zmUtil.isSharedFolder(I)&&(F=zmUtil.getShareId(I)),O.streams&&(H=O.groupId,G="viewGroupEntity"),N=0;N<M;N++)F&&(L[N].shId=F),H&&(L[N].gId=H,L[N].type=G);zmPreviewTemplate.setSlideShow(L,i[0])}if(!c.vfc){if(b.comment&&k){b.comment.comments||(b.comment={comments:{},order:[]}),b.comment.shOwner=c.shOwner;var Q=e||d;zmUtil.requireStreamsApp().done(function(){var a=b.sharedUsers||[];zmStreamsApp.PostActions.getSharedMail(Q,f.contElem[0],{comment:b.comment,shId:c.shId,sharedUsers:a,commentuuid:c.commentuuid},!0)}).fail(function(){zmUtil.debugLog("Could not load comments for shared folder mail !","zmList.openMail()",arguments)})}else if(!c.streamsMail&&!k&&"content"!==c.type&&c.vfc!==!0){var R=zmail.mailObj[d]||{};$(f.contElem).siblings(".zms_fixed").remove(),zmUtil.requireMailCollab().done(function(){$.publish("/mail/openedincontainer",{mailID:String(d),containerDOM:$(f.contElem)[0],useConversation:Boolean(R.T),conversationID:R.T?String(R.T):"",openedBy:c.invokedFrom,commentLoadDelay:R.T?500:void 0,folderID:R.FD,commentValue:R.CT})})}zmPreviewTemplate.processReadReceipt(d)}c.prevDefObj&&c.prevDefObj.resolve()},F=function(a,b){var c,d=b.msgId||[],e=d.length,f=!1;for(c=0;c<e;c++){var g=d[c];if(a[g]&&(f=!0,zmUtil.prevCache(g,{mdata:a[g]})),zmail.prevMails[g]){var h=zmail.prevMails[g].data,i={msgId:g,type:"content",reqSent:f,load_action:"bulk_mail"};i.elemObj=z(),i.opentype=b.opentype,i.markread=b.markread;var j=$(i.elemObj.prevElem).find(".zmPHdr[data-mid='"+g+"']"),k=j.attr("id");if(k){k=k.substring(5),i.from=$(i.elemObj.prevElem).find(".zmPHdr[data-mid='"+g+"']");var l=$("<div />");l.attr("id","zmCon"+k),j.after(l),E(h,i)}}}zmInit.checkThreadRead(b.thdId)||zmList.loadUnreadMails(b.thdId,b.opentype,b.viewDet)},G=function(a,b,c){var d=zmPrev.prevDetails().msgId;if(d&&(d.indexOf("t")||(d=d.substring(1)),zmail.mailObj[d]&&zmail.mailObj[d].T===a)){var e,f,g,h=[],i=[],j=[],k=[],l=5;for(c=c||z().viewDetails,h=zmList.getViewBasedMsgList(a,c,!0),e=h.length,f=0,g=0;f<e&&g<l;f++)zmail.mailObj[h[f]]&&0===zmail.mailObj[h[f]].S&&(j.push(h[f]),zmail.prevMails[h[f]]||(i.push(h[f]),zmail.mailObj[h[f]].AR?k.push(!0):k.push(!1)),g++);if(j.length){var m={accId:zmail.accId,summary:!0,mode:"bulk",markread:!0},n={markread:m.markread,msgId:j,thdId:a,opentype:b,viewDet:c};m.msgId=i.join(),m.archiveStatus=k.join(),m.folId=zmail.mailObj[j[0]].FD,zmUtil.isSharedFolder(zmail.mailObj[j[0]].FD)&&(m.shId=n.shId=zmUtil.getShareId(zmail.mailObj[j[0]].FD)),i.length?y(m,n,F):F({},n)}}},H=function(a,b){var c,d,e;if("header"===a.from){var f=$(b).closest(".SC_pv");zmInit.rclkId=f.attr("data-mid"),"zm_Container"===zmTab.currentTab&&"lt"===f.attr("data-ty")&&zmail.mailObj[zmInit.rclkId].TH&&(zmInit.rclkId="t"+zmInit.rclkId)}else"list"===a.from&&(zmInit.rclkId=$(b).closest(".zmL").attr("id"));if(zmInit.rclkId.indexOf("t")){if(c=zmInit.rclkId,zmail.mailObj[c].FD===zmail.folId.oId)return;e=zmail.conPath+"/popMail.do?accId="+zmail.accId+"&msgId="+c+"&folId="+zmail.mailObj[c].FD+"&att="+zmail.mailObj[c].AT,zmUtil.isInlineCompose()&&(e+="&inlineCompose=true"),zmail.mailObj[c].TH&&(e+="&thId="+zmail.mailObj[c].T+"&showConv=false")}else c=zmInit.rclkId.substring(1),d=zmail.mailObj[c].T,e=zmail.conPath+"/popMail.do?accId="+zmail.accId+"&msgId="+c+"&thId="+d+"&folId="+zmail.mailObj[c].FD+"&att="+zmail.mailObj[c].AT+"&showConv=true",zmUtil.isInlineCompose()&&(e+="&inlineCompose=true");var g,h=zmail.mailObj[c].FD,i=!1;zmUtil.isSharedFolder(h)?(i=!0,e+="&rShareId="+zmUtil.getShareId(h)+"&isSh=true&groupId="+zmail.shrTree[0][h].OZUID):zmUtil.isFolderId(h)&&(i=!0,g=zmList.getRowInfo(h,"zmlTreeH","info").SH,"-1"!==g&&(e+="&isSh=true&groupId="+zmail.zuid+"&rShareId="+g)),i&&(e+="&entityId="+c+"&entityType=1"),zmTab.currentTab.indexOf("zm_srch")||(e+="&isSrch=true"),e+="&feature="+zmail.showFeature,zmUtil.openWindow(e,60,80)},I=function(a){var b=$(a).children(".zmL");if(b.length>0){var c=b.filter(":not(.SC_check)");if(0===c.length)return!0}return!1},J=function(a){return!!$(a).find(".SC_check").length},K=function(a,b){var c=b.cName,d=zmList.getElemObj();"success"===a.result?"show"===b.opt?("SZ"===c?$(d.listElem).find(".zmSze").show():"DT"===c&&$(d.listElem).find(".zmDate").show(),zmail.viewInfo[0][c]="s"):("SZ"===c?$(d.listElem).find(".zmSze").hide():"DT"===c&&$(d.listElem).find(".zmDate").hide(),zmail.viewInfo[0][c]="h"):zmsDialog.alert("Error in updating mail view")},L=function(a){var b,c=a.parents(".zmL").attr("id");b=c.indexOf("t")?{msgId:[c],thd:[]}:{thd:[c.substring(1,c.length)],msgId:[]},zmmailAct.doActions("delete","mail",b)},M=function(a){var b;a&&""!==a&&(b=a.indexOf("t")?{msgId:[a],thd:[]}:{thd:[a.substring(1,a.length)],msgId:[]},zmmailAct.doActions("delete","mail",b))},N=function(a){var b;a&&""!==a&&(b=a.indexOf("t")?{msgId:[a],thd:[]}:{thd:[a.substring(1,a.length)],msgId:[]},zmmailAct.doActions("spam","mail",b))},O=function(a){var b;a&&""!==a&&(b=a.indexOf("t")?{msgId:[a],thd:[]}:{thd:[a.substring(1,a.length)],msgId:[]},zmmailAct.doActions("notspam","mail",b))},P=function(a){var b,c={};a=a.parents(".zmL"),b=$(a)[0].id,b.indexOf("t")!==-1?(c.thd=[zmInit.zmsubStr(b,"t")],c.msgId=[]):(c.msgId=[b],c.thd=[]),a.hasClass("zm_urd")?zmmailAct.applyActions("read","dropdown",c):zmmailAct.applyActions("unread","dropdown",c)},Q=function(a){if(zmail.mailObj[a]&&!zmail.mailObj[a].TH)return!1;var b,c,d,e=zmail.mailObj,f=zmail.listObj[zmUtil.getFolId()].MO,g=[];for(b in f)c=f[b],d=e[c],d.TH&&d.T===a&&g.push(c);return g},R=function(a){var c,d,e,f=Q(a.entityId)||[a.entityId],g=a.total;if(!isNaN(g)){var h={};h.update=function(a,b){var c=$(a).find(".SC_cmt");c.length&&c.find("span").text(b)},h.remove=function(a){var b=$(a).find(".SC_cmt");b.length&&b.remove()};for(c in f)e=f[c],d=b.getViewObject(e,"zm_Container"),d=d&&d.$element,d.length&&(zmail.mailObj[e].CMT=g,0===g?h.remove(d):h.update(d,g))}};$.subscribe("/streams/comment",function(a,b){_zm._isPrivilegedUser()&&R(b)});var S=function(a,b){var c,d="",e=[];if(!a||!zmail.mailObj[a])return"";if(zmail.listObj[b]?e=zmail.listObj[b].MO:"search"===b&&(e=zmSearchUtil.getSearchList()),c=e.length,c>0){var f,g=zmail.mailObj[a].T;for(f=0;f<c;f++)if(e[f]===zmail.mailObj[a].T||zmail.mailObj[e[f]].TH&&zmail.mailObj[e[f]].T===g){d=e[f];break}}return d},T=function(a){var b=0,c=zmail.listObj[a]?zmail.listObj[a].MO:[],d=c.length,e=0;if(zmUtil.isInlineCompose())for(e=0;e<d;e++)zmail.mailObj[c[e]].DMID&&b++;else for(e=0;e<d;e++)zmail.mailObj[c[e]].FD===zmail.folId.dId&&b++;return b},U=function(a,b){var c,d=$(zmail.mailCenter.listElem).find("#"+a),e="",f=zmInit.getThreadSubject(b.M);if(b.FD!==zmail.folId.dId&&(zmail.mailOpt.isshowSummary&&b.TSM&&b.TSM.trim()&&(e=" - "+b.TSM),d.find(".zmFrm span:first").html(b.TSN),c=_zm.getDOM(["SPAN",{child:[["text",f],["SPAN",{attrs:{"class":"sum"},child:[["text",e]]}]]}]),d.find(".zmSub span:first").html($(c))),b.TC>0){var g=d.find(".zmtCt");g.length&&b.FD!==zmail.folId.dId?g.text(b.TC):g.length||(g=$(_zm.getDOM(["DIV",{attrs:{"class":"zmtCt"},child:[["text",b.TC]]}])),g.insertAfter(d.find(".zm_td")))}var h=a;if(0===a.indexOf("t")&&(h=a.substring(1)),b.FD===zmail.folId.dId){var i=T(b.T)||1;zmail.mailObj[h]&&(zmail.mailObj[h].DC=i)}},V=function(a,b,c,d){var e,f,g,h;a.TC=a.TC||1,e=zmUtil.getFolId(),f=S(a.M,e),h=zmail.mailObj[f]||{},f&&(g=$(zmail.mailCenter.listElem).find("#t"+f),h.T||(h.TC=1,h.TH=1,h.T=f),a.FD===zmail.folId.sId&&(2===c||1===c&&d)?(a.TC=h.TC+1,h.TC+=1):a.TC=h.TC||a.TC,a.DT=h.DT||a.DT,g.length?(U("t"+f,a),$(zmail.mailCenter.listElem).find("#thd"+f).remove()):(g=$(zmail.mailCenter.listElem).find("#"+f),g.length&&(U(f,a),a.TC&&g.find(".zmFlt").append(_zm.getDOM(["DIV",{attrs:{"class":"zmtCt"},child:[["text",a.TC]]}])))))},W=function(a,b){var c,d,e,f=a.T,g=[],h=!1,i=!1,j=$.Deferred();if(a.TC=a.TC||1,g=zmList.getViewBasedMsgList(f,b,!0),c=zmUtil.getFolId(),g.length>0&&(i=!0,e=$(zmail.mailCenter.listElem).find("#t"+g[1])),i&&a.FD!==zmail.folId.dId&&e.length?(a.TC=g.length,e.remove(),$(zmail.mailCenter.listElem).find("#thd"+g[1]).remove(),h=!0,d=g[1]):(d=S(a.M,c),d&&(zmail.mailObj[d].T?($(zmail.mailCenter.listElem).find("#"+d).remove(),$(zmail.mailCenter.listElem).find("#t"+d).remove(),$(zmail.mailCenter.listElem).find("#thd"+d).remove()):(zmail.mailObj[d].TC=1,zmail.mailObj[d].TH=1,zmail.mailObj[d].T=d,$(zmail.mailCenter.listElem).find("#"+d).remove()),a.FD!==zmail.folId.dId?a.TC=zmail.mailObj[d].TC+1:a.TC=zmail.mailObj[d].TC,h=!0)),h){var k=zmail.listObj[c].MO.indexOf(d);k!==-1&&zmail.listObj[c].MO.splice(k,1),j.resolve()}else zmList.getThreadCount({msgId:a.M,viewObj:b,deferredObj:j});return j},X=function(a,b){var c,d,e,f=!1;if(d=b.msgId,e=b.type,d.indexOf("t")||(d=d.substring(1,d.length)),0===a){var g=b.tabId;c=zmPrev.prevDetails(g),f=d===c.msgId&&e===c.type&&"content"!==e}else 2===a&&("lt"===e&&zmail.mailObj[d].T&&(d="t"+zmail.mailObj[d].T),zmsuite.isWorkspaceAvailable("zm_tab"+d)&&"restore"!==b.src&&(zmsuite.showWorkSpace("zm_tab"+d),f=!0));return f},Y=function(a){var b,c="",d="";return"string"==typeof a?(d=a,c=$("#"+a).attr("data-ty")):(b=$(a).closest(".zmL"),b.length&&(c=b.attr("data-ty"),d=b[0].id||b.attr("data-detail"))),{msgId:d,type:c,opentype:zmail.mailOpt.isPopup}},Z=function(){var a=zmsuite.getCenter()[0].getNodes()[2].$el[0];a.scrollTop=0;var b=$(a).children(".SC_check:first");b.length&&(a.scrollTop=b.offset().top-$(a).offset().top)},_=function(a){var c=a.action,d=!0,e={};switch(e="zm_Container"===zmTab.currentTab?zmInit.getListingDetObj():zmTab.currentTab.indexOf("zm_srch")!==-1?zmSearchUtil.getSearchViewDetails():zmsuite.getCenterOuter().$el.data("data-detail"),c){case"select_all":zmList.chkAll();break;case"select_none":d=!1;break;case"select_read":b.selectMails(b.filter(b.readfilter));break;case"select_unread":"unread"===e.view?zmList.chkAll():b.selectMails(b.filter(b.unreadfilter));break;case"select_flag":e.flag?zmList.chkAll():b.selectMails(b.filter(b.flaggedfilter));break;case"select_label":e.label?zmList.chkAll():b.selectMails(b.filter(b.taggedfilter));break;case"select_attach":e.attach?zmList.chkAll():b.selectMails(b.filter(b.attachmentfilter));break;default:d=!1}d&&"select_all"!==c&&Z(),zmUtil.hideMenu()},aa=function(){var a={headerElem:$(zmail.mailCenter.listElem),appName:"mail",onScroll:!0,viewType:"thumb",requireParams:{accId:zmail.accId,mode:"lstEntity",thb:!0,fldId:zmUtil.getFolId()}},b=function(){var a=["view","MoveLabel","sendOutbox","spamTrash","Archive","folSpecConv","action","folSpecConv","LViewType"],b=zmUtil.getFolId();zmInit.setListingDetObj({fId:b,view:"",flag:"",lable:"",attach:"2"}),zmail.mailCenter.listElem.scrollTop=0,zmCache.clearMailObj({listId:zmUtil.getFolId()}),zmCache.clearListObj(),zmCenterListing.mailObjectAPI.dropViewObjectStore("zm_Container"),zmUrlAct.update({folId:b,view:"attach",viewId:"2"}),zmInit.listingBand.SpamTrashBand.setBand(),zmRestore.saveState("listing",{fId:b,view:"attach",viewId:"2"}),zmList.unchkAll(),zmPrev.clsPreview("list");var c,d=zmsuite.getCenter("zm_Container")[0].getNodes()[0];d.showGroup("SortCustom");for(c in a)d.hideGroup(a[c]);$(zmail.mailCenter.listElem).html(""),zmail.mailCenter.listElem.scrollTop=0};b(),zmUtil.initAttachListing(a,function(a){zmail.listObj.attachVw=a})},ba=function(a){var b="",c="",d="",e=a.action,f=zmInit.getListingDetObj(),g=!0;switch(b=f.fId,e){case"view_all":c="all";break;case"view_unread":c="unread";break;case"view_flag":c="flag",d="-1";break;case"view_label":c="label",d="-1";break;case"view_attach":var h=a.isAttachOnly;h&&(g=!1,aa()),c="attach",d="1";break;case"view_archive":c="archive";break;case"listview":c=a.view,d=a.viewId;break;default:g=!1}g&&(zmList.unchkAll(),zmInit.foldView({folId:b,view:c,viewId:d}),zmInit.updateHeaderBand()),zmUtil.hideMenu()},ca=function(a,b){var c,d,e=a,f=[],g=0;for(c=zmail.mailObj[a].T,f=zmList.getViewBasedMsgList(c,b,!0),g=f.length,d=g-1;d>=0;d--)if(0===zmail.mailObj[f[d]].S&&0===zmail.mailObj[f[d]].AR){e=f[d];break}return e},da=function(a,b){var c,d,e=a,f=[],g=0;for(c=zmail.mailObj[a].T,f=zmList.getViewBasedMsgList(c,b,!0),g=f.length,d=0;d<g;d++)if(0===zmail.mailObj[f[d]].S&&0===zmail.mailObj[f[d]].AR){e=f[d];break}return e},ea=function(a,b){var c=[],d=[];"t"===a.charAt(0)?(a=a.substring(1),d.push(a)):c.push(a);var e="";zmail.mailObj[a]&&zmail.mailObj[a].streams&&(e="default");var f={};f.parentDOM=$(b),f.displayAs="popup",f.accType=e,f.labelState={mailList:[{id:a,ttag:Boolean(d.length)}]},f.onStateChange=function(a,b){zmmailAct.applyActions("label","click",{msgId:c,thd:d,lA:b?"add":"delete",lId:a,accType:e,disp:zmail.labInfo[a].dispName})};var g=zmUtil.createFLComp("label",f);g.show()},fa=function(a,b){var c=zmail.mailObj[a],d=zmail.mailObj[b];if(c&&d){0===d.S?d.TS=0:d.TS=void 0!==c.TS?c.TS:c.S,d.TC=c.TC||1,d.TTAGS=c.TTAGS||c.TAG,d.TSB=d.TSB||c.TSB||c.SB,d.FD===zmail.folId.sId?d.TSM=c.TSM||c.SM:d.TSM=d.TSM||c.TSM||c.SM,d.TSN=d.TSN||c.TSN||c.SN,d.TI=c.TI||!1,d.TF=c.TF||!1,d.TM=c.TM||!1,1===d.AT?d.TA=1:d.TA=void 0!==c.TA?c.TA:c.AT;var e=c.NFG?parseInt(c.NFG):0;if(!d.TI&&!d.TF&&!d.TM&&0!==e)switch(e){case 1:d.TI=!0;break;case 2:d.TM=!0;break;case 3:d.TF=!0}d.NFG&&(1===parseInt(d.NFG)?d.TI=!0:2===parseInt(d.NFG)?d.TM=!0:3===parseInt(d.NFG)&&(d.TF=!0)),d.FD===zmail.folId.dId&&(d.DC=T(d.T))}},ga=function(a,b){var c=S(a,b);return!!c&&(fa(c,a),!0)},ha=function(a){var b=a.length,c=1,d=a[c];for(c=1;c<b;c++)if(zmail.mailObj[a[c]].FD!==zmail.folId.sId){d=a[c];break}return d},ia=function(a,b){a.src="conversation",a.opentype=zmail.mailOpt.isPopup,zmList.getMailData(a,b)},ja=function(a,b,c,d){var e,f,g;e=f=a.msgId,g=zmTab.currentTab.indexOf("zm_srch")?zmInit.getListingDetObj():zmSearchUtil.getSearchViewDetails(),e.indexOf("t")||(f=e.substring(1)),"unread"!==g.view||!c||f===c||zmail.mailObj[f].TH&&zmail.mailObj[f].T===zmail.mailObj[c].T||zmList.remReadMail(),zmList.getMailData(a,b,d)},ka=function(a,b,c,d,e,f){zmAjq.XHR({u:zmail.conPath+a,t:b,fn:c,onerror:d,p:e,ep:f})},la=function(a,b,c,d,e,f){var g,h,i=b.length,j="t"===d?1:0;g=j?"":'<span class="SC_plnk" data-msg="downloadall">Download as zip</span>';var k='<div class="SC_PUtt"><div class="SCmb"><ul><li><b><div class="SC_hd"></div><span class="SC_ttip ttr" data-tooltip="Close"><i class="msi-close" data-msg="close"></i></span></b></li></ul></div></div>',l='<div class="SC_tp10"> '+zmText.applyArgs("{{count}} Attachments",{count:i})+g+"</div>";l+=zmAttach.build(b,{from:"attpop",isThread:j}),h=j?"zm_threadAtt":"";var m=k+'<div class="zmPAtt '+h+'" data-tId ='+f+">"+l+"</div>";setTimeout(function(){var a=$("#zm_dropDown");a.find(".zmPAtt").length||($("#zm_dropDown ul").removeClass(),$("#zm_dropDown ul").append($(m)),e(),c.position(),zmPreviewTemplate.setSlideShow(b,a))},200)},ma=function(a){var b=zmsuite.showMenu(a),c=document.getElementById("zm_dropDown"),d=zmComponent.loadingBand({container:c,type:"pagination"});return b.position(),[b,d]},na=function(a,b,c,d,e,f){var g=function(g,h){if(h.reqId===i){var j;j="tc"===d?g[a]:g[b],j.length?(la(c,j,f,d,e,b),B(a,b,j,g.shownext,d)):$("#zm_dropDown").remove()}},h=function(a,b){if(b.reqId===i){var c=a.msg;c&&_zm.succErrMsg("e",c),$("#zm_dropDown").remove()}},j={accId:zmail.accId,mode:"lstEntity",thb:!0};"t"===d?j.tId=b:j.mId=a,i++,ka("/attach.do","POST",g,h,j,{loadingBand:e,reqId:i})},oa=function(a){var b=zmail.mailObj[a]||{},c=function(){return b.AT};if(c(a)&&b.TH){var d=b.T;C(a,d,"t")&&(zmail.mailAttachments[d].data.addInfo.isFull=!1)}};$.subscribe("mail/spam",function(a,b){oa(b)}),$.subscribe("mail/notspam",function(a,b){oa(b)}),$.subscribe("mail/delete",function(a,b,c,d){5===d&&oa(b)}),$.subscribe("mail/archive",function(a,b){oa(b)});var pa=function(a,b){var c,d,e,f=a.msgId,g=a.type,h="zm_Container"===zmTab.currentTab&&zmUtil.getFolId();if(!h||!zmUtil.isSharedFolder(h)){if("t"===f.charAt(0)){if("zm_Container"===zmTab.currentTab&&(h===zmail.folId.spId||"archive"===zmail.listDetails.view))return;f=f.substring(1),c="t"}var i={par:b,showArrow:!0,liDom:"",spanClass:"zm_attPop minwid zmAtt_mulMail",clk:function(a,b){zmAttach.util.bindoptions(b,{mId:f,eId:d,from:"attpop",mailType:c})}};if(e=ma(i),"t"===c?d=zmail.mailObj[f].T:"lt"!==g||zmail.mailObj[f].TH?(c="tc",d=zmail.mailObj[f].T):(c="sm",d=f),C(f,d,c)){var j=D(f,d,c);la(b,j,e[0],c,e[1],d),e[1]()}else na(f,d,b,c,e[1],e[0])}},qa=function(a,b){if(a&&zmail.mailObj[a]&&zmail.mailObj[a].SCOBJ[0]){var c,d=zmail.mailObj[a].SCOBJ[0];d.ASTATUS=!0,_zm.succErrMsg("s","Action completed successfully"),"CONFIRMACTION"===b.actName||"SAVEACTION"===b.actName?(c=$("#"+a+" span.zm_highlight"),!c.length&&zmail.mailObj[a].TH&&(c=$("#t"+a+" span.zm_highlight")),c.length&&c.each(function(a,b){$(b).html("<font class='SC_op3'>"+_zm.escapeTags(d.DN)+"</font>"),$(b).append("<i class='msi-tick zm_highlight'></i>")})):"REVIEWACTION"===b.actName?(d.RB=b.reviewBody||"",d.RR=b.reviewRating):"RSVPACTION"===b.actName&&(d.RSVPSTUS=b.rsvpStatus.toLowerCase(),c=$("#"+a+" span.zm_highlight"),!c.length&&zmail.mailObj[a].TH&&(c=$("#t"+a+" span.zm_highlight")),c.length&&c.each(function(a,c){$(c).text(e.quickactions.attending+" : "+b.rsvpStatus),$(c).append("<i class='msi-rsvp zm_highlight'></i>")}))}},ra=function(a,b,c){if(a&&b){c=c||{};var d={msgId:b,accountId:zmail.accId,actName:a.SCATYPE},e=$.extend({},d);c.evtstatus?(d.rsvpStatus=c.evtstatus.toLowerCase(),e.rsvpStatus=c.evtstatus):c.reviewRating&&(d.reviewRating=e.reviewRating=c.reviewRating,c.reviewBody&&(d.reviewBody=e.reviewBody=c.reviewBody));var f=function(a,c){"SUCCESS"===a.ASTATUS&&qa(b,c)},g=function(a){_zm.succErrMsg("e",a.msg)};if(!a.ASTATUS||"RSVPACTION"===a.SCATYPE){var h={u:zmail.conPath+"/executeActSchema.do",t:"POST",fn:f,onerror:g,p:d,ep:e};zmAjq.XHR(h)}}},sa=function(a,b,c){var d=$(a).data().value||"";d&&c&&(ra(c,b,{evtstatus:d}),zmUtil.hideMenu())},ta=function(a){if(a){var b=a.GURL||a.AURL;if(a.ZMAIL_INTERNAL_SERVICE&&"task"===a.ZMAIL_INTERNAL_SERVICE){var c=zmHash.decode(decodeURIComponent(b));if("stream"===c.key){var d=c.params;zmUtil.loadStreamsInTab({pid:d[1],gid:d[0],etype:d[2],actionType:d[3],commentId:d[4]})}else{var e=window.open(decodeURIComponent(b),"_blank");e.focus()}}else{var f=window.open(decodeURIComponent(b),"_blank");f.focus()}}},ua=function(a,b){a&&ra(a,b)},va=function(a,b,c){var d=$(a).data().value||"";if("publish"===d){var f,g,h;if(h=$(a).closest("ul"),f=h.find("#zm_reviewbody").val(),g=h.find(".sel").length,0===g)_zm.succErrMsg("e",e.quickactions.alertrating);else if(c.REVPARAM){var i={};i=f?{reviewRating:g,reviewBody:f}:{reviewRating:g},ra(c,b,i),zmUtil.hideMenu()}}else if(0===d.indexOf("rate")){var j=d.substring(4)||0,k=$(a).closest("li").find(".msi-fav"),l=k.length,m=0;for(j=parseInt(j),k.removeClass("sel"),m=1;m<=j;m++)k.eq(l-m).addClass("sel")}},wa=function(a,b,c){if(a&&c.length){var d,f={},g="",h="",i="",j="SC_Rating yetToRate",k=e.quickactions.reviewcomment,l="";for(a.ASTATUS&&(k=_zm.escapeTags(a.RB||""),l="readonly",h="sel",j="SC_Rating"),d=a.RWR;d<=a.RBR;d++)i=d<=a.RR?"msi-fav "+h:"msi-fav",g='<i class="'+i+'" data-value="rate'+d+'" title="'+d+'"></i>'+g;var m=["<li><b>"+a.DN+"</b></li>",'<li style="width:200px">'+_zm.escapeTags(a.DESC||"")+"</li>",a.SHOWRB?'<li><textarea tabindex="0" placeholder="'+k+'" maxlength="1500" id="zm_reviewbody" '+l+"></textarea></li>":"",'<li><div class="'+j+'"><div>'+g+"</div></div></li>"];a.ASTATUS||(m=m.concat(['<li><div class="SC_PUbtm"><span data-value="publish">'+e.quickactions.submit+"</span></div></li>"])),m=m.join(""),f={par:c,showArrow:!0,liDom:$(m),spanClass:"minwid",ulClass:"noclass",clk:function(c,d){va(d,b,a)}},zmsuite.showMenu(f)}},xa=function(a,b,c){if(a&&c.length&&!a.EXPIRED){var d={},f={yes:"",no:"",maybe:""};a.ASTATUS&&(f[a.RSVPSTUS]="sel");var g=['<li class="'+f.yes+'" data-value="Yes">'+e.quickactions.yes+"</li>","true"===a.SHOWMB&&a.MBURL?'<li  class="'+f.maybe+'" data-value="Maybe">'+e.quickactions.maybe+"</li>":"",'<li class="'+f.no+'" data-value="No">'+e.quickactions.no+"</li>"].join(""),h=[a.PADDR.ADDRNAME?a.PADDR.ADDRNAME+",":"",a.PADDR.ADDRBOXNO?a.PADDR.ADDRBOXNO+",":"",a.PADDR.STREET?a.PADDR.STREET+",":"",a.PADDR.ADDRLOCALITY?a.PADDR.ADDRLOCALITY+",":"",a.PADDR.ADDRREGION?a.PADDR.ADDRREGION+",":"",a.PADDR.ADDRCOUNTRY?a.PADDR.ADDRCOUNTRY+",":"",a.PADDR.ADDRPCODE?a.PADDR.ADDRPCODE:""].join(" ");h=_zm.escapeTags(h);var i=["<li><b>"+a.DN+"</b></li>",'<li style="width:200px"><span class="SC_iconList"><i class="msi-clock"></i>'+a.SD+(a.ED?" - "+a.ED:"")+"</span>",(h.trim().length?'<span class="SC_iconList"><i class="msi-location"></i>'+h+"</span>":"")+"</li>",'<li class="zmsEventAction"><ul>'+g+"</ul></li>"].join("");d={par:c,showArrow:!0,liDom:$(i),spanClass:"minwid",ulClass:"noclass",clk:function(c,d){sa(d,b,a)}},zmsuite.showMenu(d)}},ya=function(a,b){var c,d=a.msgId;if(d&&0===d.indexOf("t")&&(d=d.substring(1)),c=zmail.mailObj[d],c&&c.SCOBJ){var e,f;switch(f=c.SCOBJ[0],e=f.SCATYPE){case"VIEWACTION":case"TRACKACTION":ta(f);break;case"SAVEACTION":case"CONFIRMACTION":ua(f,d);break;case"REVIEWACTION":wa(f,d,b);break;case"RSVPACTION":xa(f,d,b)}}},za=function(){zmsDialog.remove(),$("#sweeppopup").remove()},Aa=function(a,b,c){if((c||a.length)&&b.length){var d=[],f=[];if(c=c||a.find(".msi-option").data("value"),b.find(".msi-check").each(function(){d.push($(this).data("value")),f.push($(this).data("msg"))}),0===d.length)return void zmUtil.succErrMsg("i",e.sweep.selonesender);if(d.length>5)return void zmUtil.succErrMsg("i",e.sweep.sellimit);if(!c)return void zmUtil.succErrMsg("i","Please select the action");var g={mode:"sweep",senderList:d,actionType:c,msgId:f,thd:[]};zmmailAct.doActions("sweep","dropdown",g),za()}},Ba=function(a){var b,c="",d=0,f="msi-check";for(a.length>5&&(f="msi-uncheck"),d=0;d<a.length;d++)c+='<li class="senderid"><i class="'+f+'" data-msg="'+a[d].msgId+'" data-value="'+a[d].emailId+'"></i><label>'+a[d].emailId+"</label></li>";b=['<div id="sweeppopup" style="display:none">','<ul class="zm_formArea">',"<li>"+zmText.applyArgs(e.sweep.sweepmsg,{foldername:zmInit.findFolName(zmUtil.getFolId())})+"</li>"+c,"</ul>","</div>"].join(""),b=$(b);var h=b.find(".action_type"),i=b.find(".senderid");i.off("click").on("click",function(a){var b=a.srcElement||a.target;b=$(b),b.length&&(b=b.closest("i").length?b.closest("i"):b.closest("li").find("i"),b.hasClass("msi-check")?b.removeClass().addClass("msi-uncheck"):b.hasClass("msi-uncheck")&&b.removeClass().addClass("msi-check"))}),h.off("click").on("click",function(a){var b=a.srcElement||a.target;b=$(b),b.length&&(b=b.closest("i").length?b.closest("i"):b.prev(),(b.hasClass("msi-option")||b.hasClass("msi-unoption"))&&(h.find("i").removeClass().addClass("msi-unoption"),b.removeClass().addClass("msi-option")))}),$("body").append(b);var j={title:e.sweep.title+" - "+zmInit.findFolName(zmUtil.getFolId()),style:{width:"500px"},buttons:[{txt:g.common.archive,selected:!1,callback:function(){Aa(h,i,"archive")}},{txt:g.common["delete"],selected:!1,callback:function(){Aa(h,i,"delete")}},{isCancel:!0,txt:g.common.cancel,callback:function(){za()}}],drag:!0,mask:!0,hideclose:!1,pos:"center",closeaction:function(){za()}};zmsDialog.create("sweeppopup",j)},Ca=function(a){var b,c=[],d=[],f=0,g=0;a||(a=zmUtil.getSelectedMails(),a=a[0].concat(a[1])),g=a.length;var h=function(a){return a=a.replace(/&lt;/gi,"<").replace(/&gt;/gi,">").replace(/&quot;/gi,'"'),a.indexOf("<")!==-1&&(a=a.substring(a.lastIndexOf("<")+1,a.lastIndexOf(">"))),a=a.trim()};for(f=0;f<g;f++)b=zmail.mailObj[a[f]].F,b&&(b=h(b),c.indexOf(b)===-1&&(c.push(b),d.push({msgId:a[f],emailId:b})));0===c.length?zmUtil.succErrMsg("i",e.sweep.selone):Ba(d)},Da=function(a,b){if(zmail.isWatchUser){var c,d=a.msgId,e=[zmail.folId.sId,zmail.folId.dId,zmail.folId.teId,zmail.folId.oId],f=[],g=[],h="",i=zmTab.currentTab;if(d.indexOf("t")!==-1)d=d.substring(1),zmail.mailObj[d]&&zmail.mailObj[d].TSNADDR?(f=zmail.mailObj[d].TSNADDR.split("... "),g=zmail.mailObj[d].TSN.split("... ")):(f.push(zmail.mailObj[d].F),g.push(zmail.mailObj[d].SN));else if(zmail.mailObj[d])if("zm_Container"===i&&e.indexOf(zmUtil.getFolId())!==-1||i===zmSearchUtil.getSearchTabId()&&e.indexOf(zmSearchUtil.getSearchedFolders()[0])!==-1){f.push(zmInit.getFirstRecipientEmailId(d)||zmail.mailObj[d].F);var j=zmCont.getContactInfo({email:f[0]});j?g.push(j.displayName):g.push(zmConUtil.parseContacts(f[0])[0].fn||f[0])}else f.push(zmail.mailObj[d].F),g.push(zmail.mailObj[d].SN);for(c=0;c<f.length;c++)h+="<li><div>"+g[c]+"<span>"+f[c]+"</span></div><img></li>";h=$(h).each(function(a,b){f[a]&&zmail.avatar.get({email:f[a],type:"dom",displayName:zmUtil.replaceHTMLEntities(g[a])}).done(function(a){$(b).find("img").remove(),$(b).append(a)})});var k={par:b,showArrow:!0,liDom:h,ulClass:"SC_P2r"};zmsuite.showMenu(k)}},Ea={excludeSent:!1,listingFocused:!0,showNotificationPopup:function(a){var b={},c={};b={msgId:a.pid,opentype:3,type:"lt",tabId:"zmncenter",src:"zmncenter",commentuuid:a.commentuuid},b.eprm={accId:zmUtil.getZohoAccId(),isSh:!0,groupId:a.gid,shareId:a.shId,thId:a.pid},a.gid!==zmail.zuid&&(b.eprm.shId=a.shId),c.prevElem=a.elm,c.viewDetails={view:"notification"},zmList.getMailData(b,c)},getNotifyPopupContainer:function(a,b,c,d){var e=a.SUBJECT,f=["DIV",{attrs:{"class":"SC_ptit"},child:[["DIV",{attrs:{"class":"SCmb SC_frt"},child:[["UL",{child:[["LI",{child:[["B",{child:[["SPAN",{attrs:{"class":"SC_ttip ttr"},child:[["I",{attrs:{"class":"msi-more","data-shared":c}}]]}]]}]]}]]}]]}],["DIV",{child:[["DIV",{attrs:{"class":"SC_phd"},child:[["text",e]]}]]}]]}],g=["DIV",{attrs:{"class":"SCS_postMail",type:"fixedComment"}}];b.appendChild(_zm.getDOM(f)),b.appendChild(_zm.getDOM(g)),d.contElem=$(d.prevElem.childNodes[1])},getMailData:function(a,b,c){var d,e,f,g,h,i,k,l="",m={},n={},o=a.type,p=a.opentype,q={},r=a.tabId||zmTab.currentTab,s=!1;l=a.msgId,d=a.from;var u=a.invokedFrom||"";if(n.invokedFrom=u,("external"===a.src||"restore"===a.src||"zmncenter"===a.src&&!zmail.mailObj[l])&&("restore"===a.src&&(e=a.fId,q=a.viewDetails,k=a.toOpen),t(l,a.tId,e),zmail.mailObj[l]=$.extend(zmail.mailObj[l],a.eprm)),Object.keys(q).length||("zm_Container"===r?q=zmInit.getListingDetObj():r.indexOf("zm_tab")!==-1?q=zmsuite.getCenterOuter(r).$el.data("data-detail"):r.indexOf("zm_srch")!==-1?q=zmSearchUtil.getSearchViewDetails():r.indexOf("zmncenter")!==-1&&(q=b?b.viewDetails:{viewDetails:{view:"zmncenter"}})),"search"===q.view&&zmSearchUtil.isWorkspaceAvailable()&&(a.tabId="zm_srch1"),b=b||A(a),"restore"===a.src&&(b.viewDetails=q),l&&!l.indexOf("t")&&(l=l.substring(1,l.length)),"search"===q.view&&"th"===o&&(b.listArr=zmList.getViewBasedMsgList(zmail.mailObj[l].T,b.viewDetails,!1)),g=l,l&&zmail.mailObj[l]&&(a.vfc||!X(a.opentype,a,b)||("lt"!==o||zmail.mailObj[l].TH)&&"th"!==o))if(1===zmail.mailObj[l].TH&&"external"===a.src&&(a.msgId="t"+a.msgId),e||(e=zmail.mailObj[l].FD),zmUtil.isInlineCompose()||e!==zmail.folId.dId||"lt"!==o||b.viewDetails.fId===zmail.folId.dId||"search"===b.viewDetails.view||(l=zmail.mailObj[l].T,e="",zmail.mailObj[l]||(zmail.mailObj[l]={M:l,FD:"",S:1,TH:1,T:l,SB:zmail.mailObj[g].SB})),0===p&&(!zmUtil.isMailOpenInPreview(l,r)||"zm_Container"===r&&zmList.isListingChecked(b.listElem))&&$(b.prevElem).attr({"data-mid":"","data-ty":""}),e!==zmail.folId.dId||q.fId!==zmail.folId.dId&&zmUtil.isInlineCompose()&&"search"!==q.view)if(e===zmail.folId.teId)zmUtil.invokeComposer({msgId:l,mode:"template"});else{if(b.rowElem&&b.rowElem.length&&b.rowElem.is(":visible")&&0===a.opentype&&($(b.listElem).find("div.zmL").removeClass("zmSLst"),$(b.listElem).find(b.rowElem).addClass("zmSLst")),m={accId:zmail.accId,split:!0,summary:!0},"external"!==a.src&&"zmncenter"!==a.src||(a.eprm?m=$.extend(m,a.eprm):m.accId=zmUtil.getZohoAccId()),f=zmail.mailObj[l],0!==zmUtil.getMLConversionValue()&&"search"!==q.view&&"archive"!==q.view&&1!==f.TS&&f.TH&&"lt"===o&&("1"===zmAdHocSettings.getMarkConversationRead()?zmail.listObj[f.T]?l=da(l,q):m.getUnread="latest":zmail.listObj[f.T]?l=ca(l,q):m.getUnread="oldest"),zmUtil.isInlineCompose()&&("lt"===o?zmail.mailObj[l].DC&&zmail.mailObj[l].DC>0&&(m.hasdraft=!0,zmail.mailObj[l].T&&(m.thId=zmail.mailObj[l].T),zmail.mailObj[l].FD===zmail.folId.dId&&(l=zmail.mailObj[l].PA?zmail.mailObj[l].PA:zmail.mailObj[l].T,zmail.mailObj[l]||t(l),zmail.mailObj[l].TH=1,zmail.mailObj[l].T=m.thId)):"th"===o&&zmail.mailObj[l].DMID&&(m.hasdraft=!0,zmail.mailObj[l].T&&(m.thId=zmail.mailObj[l].T))),f=zmail.mailObj[l],m.msgId=l,"zmncenter"===a.src){var v=m.groupId!==zmail.zuid;e=e||zmUtil.getFolderForShID(m.shId,v)}e&&(q.fId&&zmUtil.isSharedFolder(q.fId)&&92===zmail.shrTree[0][q.fId].RT?(m.label=q.fId,e=q.fId):m.folId=e),n={msgId:l,att:f.AT,tg:f.TAG,flg:f.NFG,type:o,sm:f.SM,opentype:a.opentype,from:d,noanim:a.noanim,rowId:a.msgId,prevId:g,src:a.src,reqSent:!0,invokedFrom:u,tabId:r,prevDefObj:c,toOpen:k,commentuuid:a.commentuuid},f.TH&&"content"!==o&&q.fId!==zmail.folId.tId&&("conversation"===a.src||"restore"===a.src&&"conversation"===k||0!==zmUtil.getMLConversionValue()&&"search"!==q.view&&q.fId!==zmail.folId.sId)&&(!zmail.listObj[f.T]||zmail.mailObj[f.T]&&zmail.mailObj[f.T].streams)&&(m.thId=f.T),"zmncenter"!==a.src&&(zmail.prevMails[l]&&zmail.prevMails[l].data&&zmail.prevMails[l].data.mdata.shareId&&(m.isSh=!0,m.shareId=i,m.groupId=zmail.mailObj[l].groupId),zmUtil.isSharedFolder(e)?(m.shId=n.shId=zmUtil.getShareId(e),
m.isSh=!0,m.shareId=m.shId,m.groupId=zmail.shrTree[0][e].OZUID):q.fId&&zmUtil.isFolderId(q.fId)?(h=zmList.getRowInfo(q.fId,"zmlTreeH","info"),i=h?h.SH:"",i&&"-1"!==i&&(m.isSh=!0,m.shareId=i,m.groupId=zmail.zuid)):q.label&&zmUtil.isLabelId(q.label)?(h=zmList.getRowInfo(q.label,"zmllabelH","info"),i=h?h.shId:"",i&&"-1"!==i&&(m.isSh=!0,m.shareId=i,m.groupId=zmail.zuid)):"search"===q.view&&zmUtil.isFolderId(zmail.mailObj[l].FD)&&(h=zmList.getRowInfo(zmail.mailObj[l].FD,"zmlTreeH","info"),i=h?h.SH:"",i&&"-1"!==i&&(m.isSh=!0,m.shareId=i,m.groupId=zmail.zuid))),m.isSh&&(m.entityId=f.T?f.T:l,m.entityType=1,n.shOwner=m.groupId,n.shId=m.shId||i||"",n.shareId=m.shareId||"",zmail.prevMails[l]&&"notification-popout"!==u&&zmail.mailContainer.removeObject(l),m.isSh="content"!==o&&m.isSh),n.isSh=m.isSh||!1,zmail.mailObj[l].FD===zmail.folId.oId?n.opentype=0:0===zmail.mailObj[l].S&&(m.markread=!0,zmail.mailObj[l].AR&&(m.archiveStatus=!0)),a.vfc&&(m.vfc=n.vfc=a.vfc),n.elemObj=b;var w=b.viewDetails.view;if("stream"!==w&&3!==p&&"zmStreamsApp"!==r&&!f.streams||!zmail.mailObj[l].actionType||a.src||(m.accId=zmail.mailObj[l].accId,delete m.folId,m.actionType=zmail.mailObj[l].actionType,m.streamsView="true",m.groupId=zmail.mailObj[l].groupId,m.entityId=l,m.entityType=zmail.mailObj[l].entityType),zmail.mailObj[l].TH||0!==zmail.mailObj[l].S||zmail.mailObj[l].FD===zmail.folId.oId||0!==a.opentype||(zmmailAct.rapplyAction({result:"success"},{mailId:[l],thd:[],action:"read",from:"mail_preview"}),n.markread=!0),0===a.opentype&&j(n),"zmncenter"===a.src||!zmail.prevMails[l]||m.hasdraft||m.vfc||(m.thId?zmail.listObj[m.thId]&&(s=!0):s=!0),1===a.opentype)H({from:"list"},$("#"+a.msgId));else if(0===a.opentype&&!a.vfc&&"content"!==o&&zmail.mailObj[l].TH&&0!==zmUtil.getMLConversionValue()&&"search"!==b.viewDetails.view&&b.viewDetails.fId!==zmail.folId.sId&&b.viewDetails.fId!==zmail.folId.tId&&zmUtil.isMailOpenInPreview(l,r)){var x="#zmHdr"+("search"===b.viewDetails.view?"S":"P")+l,z=$(x),B=a.type;if(zmPrev.removeCountinPreview(b),"lt"!==B){if(!z.length){var C=zmPreviewTemplate.getMissingMailList(zmail.mailObj[l].T,"P");zmPreviewTemplate.removeNotifBand(b.prevElem),zmPreviewTemplate.addMailsInView({list:C,opentype:0}),z=$(x)}z.length&&(z.find(".zmpr:first").trigger("click"),z.removeClass("zm_tm"),zmPreviewTemplate.alignMailTopToPreview(String(l))),zmRestore.saveState("preview",{p:l},{})}z.parent().addClass("js-scrolltop"),zmList.setMailSelection(l,B,$(b.listElem)),zmPreviewTemplate.setPreviewHeaderHeight(b),zmList.listingFocused=!0}else if(!s||a.vfc||m.thId){if(0===a.opentype&&"content"!==o){var D=zmsuite.getCenter(r)[1].getNodes(),F=zmail.mailObj[l].SB||"(No subject)",G=["DIV",{attrs:{"class":"SC_phd"},child:[["text",F]]}];zmInit.prevHeader.text=G,D[0].push(zmInit.prevHeader),m.vfc||(D[1].getDOMNode().html(""),zmComponent.loadingBand({container:D[1].getDOMNode()[0],type:"pagination"}),zmsuite.getCenter(r)[1].show())}y(m,n,E)}else{n.reqSent=!1;var I={mdata:zmail.prevMails[l].data.mdata};zmail.prevMails[l].data.comment&&(I.comment=zmail.prevMails[l].data.comment),zmail.prevMails[l].data.sharedUsers&&(I.sharedUsers=zmail.prevMails[l].data.sharedUsers),E(I,n)}}else zmUtil.invokeComposer({msgId:l,mode:"draft"})},constructThreadChildRow:function(a,c){var d,f={},g={},h=[],i=zmInit.getListingDetObj(),j="";f=zmCenterListing.create({type:"submail",mapObj:zmInit.mapObj,classObj:zmInit.classObj}),g=$.extend({},zmail.mailObj[a]),g.data="th",j=g.FD,""!==i.fId&&2!==zmUtil.getMLConversionValue()||(g.FN=zmInit.findFolName(zmail.mailObj[a].FD)),h=zmInit.getMailRowIcons(i.fId),1===g.NS2?g.S=0===g.S?2:4:2===g.NS2&&(g.S=0===g.S?3:5),j===zmail.folId.oId||j===zmail.folId.dId||j===zmail.folId.teId?g.fromaddr=g.TO||g.TOADDR||"":g.fromaddr=g.F||g.SN||"",j===zmail.folId.oId?g.F=zmail.mailObj[a].TOADDR||zmail.mailObj[a].TO||"Undisclosed":(i.fId===zmail.folId.spId?(g.NFG="-1",g.TAG=[]):i.fId!==zmail.folId.teId&&i.fId!==zmail.folId.dId||(g.NFG="-1",g.S=""),g.F=zmail.mailObj[a].SN||zmail.mailObj[a].F),g.UW=zmList.isRMOBJ(a),(zmail.mailObj[a].MA||g.UW)&&(g.HT="1");try{g.F===zmail.aInfo[zmail.accId].mailId&&(g.F="Me")}catch(k){}if(zmail.mailObj[a].SCOBJ&&zmail.mailObj[a].FD!==zmail.folId.spId&&j!==zmail.folId.sId){var l=zmail.mailObj[a].SCOBJ[0]||{};if("REVIEWACTION"===l.SCATYPE)g.schemaTip=_zm.escapeTags(l.DESC||""),g.schemaText=e.quickactions.review,l.SHOWRB?g.actionIcon=g.actionIconColor="review_comment":g.actionIcon=g.actionIconColor="review";else if("RSVPACTION"===l.SCATYPE){if(l.EXPIRED)g.schemaTip=e.quickactions.eventexpired,g.schemaText=e.quickactions.rsvp,g.expired=1;else{g.schemaTip=_zm.escapeTags(l.DESC||"");var m={yes:e.quickactions.yes,no:e.quickactions.no,maybe:e.quickactions.maybe};l.RSVPSTUS?g.schemaText=m[l.RSVPSTUS]:g.schemaText=e.quickactions.rsvp}g.actionIcon=g.actionIconColor="rsvp"}else"CONFIRMACTION"===l.SCATYPE||"SAVEACTION"===l.SCATYPE?(g.schemaText=_zm.escapeTags(l.DN||""),g.schemaTip=_zm.escapeTags(l.DESC||""),g.actionIcon=g.actionIconColor="one_click"):"VIEWACTION"!==l.SCATYPE&&"TRACKACTION"!==l.SCATYPE||(g.schemaText=_zm.escapeTags(l.DN||""),g.schemaTip=_zm.escapeTags(l.DESC||""),g.actionIcon=g.actionIconColor="goto")}if(g.showNewCompactView=zmail.isWatchUser,g.iconArr=h,f.setDataObj(g),d=$(f.getHTML()),"h"===zmail.viewInfo[0].DT&&d.find(".zmDate").hide(),"h"===zmail.viewInfo[0].SZ&&d.find(".zmSze").hide(),zmail.mailObj[a]&&j===zmail.folId.sId&&d.addClass("zmsnt"),void 0===c){var n=b.getViewParentOf(a);c=n&&n.isSelected||!1}return zmCenterListing.mailObjectAPI.setViewObject("c"+a,{id:"c"+a,$element:d,isSelected:c,isExpanded:!0}),zmail.isWatchUser&&"1"===zmAdHocSettings.getListingDisplayDensity()&&zmInit.showProfileImages("threadChild",[a]),d},bindEventsMailRow:function(a,b){var c,d,e,f,g,h=a.target||a.srcElement;if(c=$(h),d=c.attr("class")||"",e=Y(h),zmList.listingFocused=!0,e.msgId){if((e.msgId||b)&&(b=b||zmList.getListingElemObj(e),b.rowElem=c.closest(".zmL")),c.closest(".zm_lbl").length&&(d="zm_lbl"),d.indexOf("msi-rpd")===-1&&d.indexOf("msi-fwd")===-1||(d="msi-mail"),d.indexOf("zmtCt")!==-1)"1"===c.text()?(f=zmPrev.prevDetails().msgId,f&&f!==e.msgId.substring(1)?$.when(zmPrev.cmpClose()).then(function(a){a&&zmList.getMailData(e,b)}):zmList.getMailData(e,b)):zmList.showHideThread(c,b);else if(d.indexOf("msi-uncheck")!==-1)e=Y(c),b=zmList.getListingElemObj(e),zmList.chkBox(c,b,a);else if(d.indexOf("zmFlt")!==-1)e=Y(c),b=zmList.getListingElemObj(e),zmList.chkBox(c,b,a);else if(d.indexOf("zmflg")!==-1)c.is(".zm_fgG,.zm_fgB,.zm_fgR,.zm_fgM")?zmList.flagMail(c,"0"):zmList.flagMail(c,"2");else if(d.indexOf("msi-trash")!==-1)L(c);else if(d.indexOf("msi-edit")!==-1)zmUtil.invokeComposer({msgId:e.msgId,mode:"outbox"});else if(c.parent().attr("class")&&c.parent().attr("class").indexOf("zmSndSts")===-1&&d.indexOf("msi-mail")!==-1||d.indexOf("msi-calendar")!==-1)P(c);else if(d.indexOf("zm_lbl")!==-1){var i=c.closest(".zm_lbl"),j=String(e.msgId);ea(j,i)}else d.indexOf("SC_mdata")!==-1?(g=e.msgId,g&&!g.indexOf("t")&&(g=g.substring(1,g.length)),zmList.associateDialog({msgId:g,elemObj:b,rowDet:e,elem:c,loadType:"list",openWatch:"header_all"})):d.indexOf("msi-thread")!==-1?(f=zmPrev.prevDetails().msgId,f?$.when(zmPrev.cmpClose()).then(function(a){a&&ia(e,b)}):ia(e,b)):d.indexOf("msi-mailReminder")!==-1?(g=e.msgId,g&&!g.indexOf("t")&&(g=g.substring(1,g.length)),zmWatch.showWatch({msgId:g,elemObj:b,rowDet:e,elem:c,loadType:"popup",openWatch:"header_list"})):d.indexOf("zm_highlight")!==-1?ya(e,c):0===d.indexOf("zmSndSts")||0===d.indexOf("msi-mail")&&c.parent().attr("class")&&c.parent().attr("class").indexOf("zmSndSts")!==-1?zmList.getMailDeliveryStatus(e.msgId):"msi-attachicon"===d?pa(e,c):d.indexOf("zm_prof_img")!==-1||d.indexOf("SC_avtr")!==-1?Da(e,c):(f=zmPrev.prevDetails().msgId,f?$.when(zmPrev.cmpClose()).then(function(a){a&&ja(e,b,f)}):ja(e,b));zmInit.isLeftFocused=!1}},isRMOBJ:function(a){var b=!1;if(zmail.mailObj&&zmail.mailObj[a]&&zmail.mailObj[a].RMOBJ&&!$.isEmptyObject(zmail.mailObj[a].RMOBJ)){var c=zmail.mailObj[a].RMOBJ.WT;1!==c&&2!==c&&3!==c||(b=!0)}return zmail.folId.oId!==zmail.mailObj[a].FD&&zmail.folId.dId!==zmail.mailObj[a].FD&&zmail.folId.spId!==zmail.mailObj[a].FD&&zmail.folId.tId!==zmail.mailObj[a].FD&&zmail.folId.teId!==zmail.mailObj[a].FD||(b=!1),b},associateDialog:function(a){var b,c,d,e,f=a.msgId,g=zmList.isRMOBJ(f),h={text:"Reminder",selected:!0,tabName:"watch",onClk:function(b){zmWatch.listDialog(a,b)},buttons:[{text:"Update Reminder",onClk:function(b){var c=a.msgId,d=b.getButtonContainer().find("span").eq(0);d.attr("id","zmWatch_save_"+c),zmWatch.addWatch(c,d)}}]},i=function(){$.unsubscribe("zm/closeAllOpenDialog",e)};if((32|zmail.mailObj[a.msgId].MA)===zmail.mailObj[a.msgId].MA&&(b={text:"Task",hideCloseButton:!0,tabName:"task",onClk:function(b){b.showLoadingBand("task");var c=function(){b.removeLoadingBand("task"),b.hideButtons("task")},d=b.getCenterElem("task"),e={mailId:a.msgId,mountingElem:d,listParam:{showHeader:!1,dialog:b},preCallBk:c};zmList.taskAssociates(a.msgId,e)},icons:[{iconClass:"msi-add",selected:!0,text:"Add Task",onClk:function(b){zmUtil.loadTask({action:"addAsTask",addparams:{msgid:a.msgId,accid:zmail.accId,senderid:zmail.mailObj[a.msgId].F},groupId:zmail.zuid,tasks:{SUMMARY:zmail.mailObj[a.msgId].SM,TITLE:zmail.mailObj[a.msgId].SB}},function(c){b.getCenterElem("task").html(c.$el),c.setHeightforEle(),b.replaceButtons([{text:"Add",onClk:function(){var d=b.getCenterElem("task"),e={mailId:a.msgId,mountingElem:d,listParam:{showHeader:!1,dialog:b}};c.addTask(zmList.taskAssociates.bind(zmList,a.msgId,e))}},{text:"Cancel",onClk:function(){var c=b.getCenterElem("task"),d={mailId:a.msgId,mountingElem:c,listParam:{showHeader:!1,dialog:b}};zmList.taskAssociates(a.msgId,d)},attr:{"data-val":"Cancel"}}],"task")}),b.showButtons("task")}}]}),(64|zmail.mailObj[a.msgId].MA)===zmail.mailObj[a.msgId].MA){var j,k;c={text:"Notes",hideCloseButton:!0,tabName:"notes",onClk:function(b){b.showLoadingBand("notes"),j=function(){b.removeLoadingBand("notes"),b.hideButtons("notes")},k=function(a){b.configOption.onClose=function(){i(),ReactDOM.unmountComponentAtNode(b.getCenterElem("notes")[0])}},zmList.notesAssociates(a.msgId,{mountingElem:b.getCenterElem("notes"),preCallback:j,postCallback:k})},icons:[{iconClass:"msi-add",selected:!0,text:"Add Notes",onClk:function(b){zNote.loadAddNote({addparams:{msgid:a.msgId,accid:zmail.accId,senderid:zmail.mailObj[a.msgId].F}}),b.showButtons("notes")}}]}}(4|zmail.mailObj[a.msgId].MA)===zmail.mailObj[a.msgId].MA&&(d={text:"Zoho Projects",tabName:"projectsEntity",hideCloseButton:!0,onClk:function(b){b.showLoadingBand("projectsEntity"),zmUtil.loadProjects(function(){b.removeLoadingBand("projectsEntity"),zmail.projectsInteg.util.listProjectsEntities(a.msgId,b.getCenterElem("projectsEntity"))})}});var l={};l.tabs=[],g&&l.tabs.push(h),b&&l.tabs.push(b),l.onClose=function(){i(),b&&zmtCom.unsubscribeTaskListeners()},zmUtil.isNoteReactUser()&&(64|zmail.mailObj[a.msgId].MA)===zmail.mailObj[a.msgId].MA&&l.tabs.push(c),(4|zmail.mailObj[a.msgId].MA)===zmail.mailObj[a.msgId].MA&&l.tabs.push(d),g||(l.tabs[0].selected=!0);var m=zmsDialog.createTabPopupDialog(l);e=function(){m.close()},$.subscribe("zm/closeAllOpenDialog",e)},taskAssociates:function(a,b){var c={taction:"getTasksAssociatedMail",msgid:a,accid:zmail.accId,streamsView:!0},d=$.extend(!0,{},b);zmAjq.XHR({u:zmail.conPath+"/getTasks.do",t:"POST",fn:zmList.showTaskAssociates,p:c,ep:d})},notesAssociates:function(a,b){var c={mode:"getMailNotes",messageId:a,accid:zmail.accId,streamsView:"Notes"},d=$.extend(!0,{},b);d.mailId=a,d.accId=zmail.defAccId,zmAjq.XHR({u:zmail.conPath+"/NotesAction.do",t:"POST",fn:zmList.showNotesAssociates,p:c,ep:d})},showNotesAssociates:function(a,b){b.preCallback();var c={id:"mailassociated",msgid:b.mailId,accid:b.accId,senderid:zmail.mailObj[b.mailId].F},d=b.listParam;zNote.getNoteList(a,{options:d,listInfo:c},b.mountingElem,b.postCallback)},showTaskAssociates:function(a,b){var c="";b.preCallBk&&b.preCallBk(),b.listParam&&b.listParam.dialog&&(b.listParam.dialog.removeLoadingBand("task"),b.listParam.dialog.hideButtons("task")),zmUtil.requireTaskModule().done(function(){c=zmTask.generateTaskList(a,b),b.mountingElem&&(b.mountingElem.empty(),b.mountingElem.append(c))}),b.postCallBk&&b.postCallBk(c)},getMailDeliveryStatus:function(a,b,c){if(a){0===a.indexOf("t")&&(a=a.subtring(1));var d={accId:zmail.accId,mode:"getMailDeliveryStatus",msgId:a};zmAjq.XHR({u:zmail.conPath+"/mailUtilAction.do",t:"POST",fn:zmList.showDeliveryStatusDialog,p:d,ep:{msgId:a,refresh:b,dInst:c},csr:"s"})}},showDeliveryStatusDialog:function(a,b){if(!a.error&&a.MDS){var c,d,f,g={},h=a.MDS,i=b.msgId,j="",k=b.dInst||{},l=e.mailDeliveryStatus.common.learnmore,m="",n={0:"",1:e.mailDeliveryStatus.statusTitle.queued,2:e.mailDeliveryStatus.statusTitle.inprogress,3:e.mailDeliveryStatus.statusTitle.inprogress,4:e.mailDeliveryStatus.statusTitle.inprogress,5:e.mailDeliveryStatus.statusTitle.success,6:e.mailDeliveryStatus.statusTitle.failure,7:e.mailDeliveryStatus.statusTitle.failure,8:e.mailDeliveryStatus.statusTitle.undo,9:e.mailDeliveryStatus.statusTitle.retry,10:e.mailDeliveryStatus.statusTitle.retry},o={0:"",1:e.mailDeliveryStatus.statusContent.queued,2:e.mailDeliveryStatus.statusContent.inprogress,3:e.mailDeliveryStatus.statusContent.inprogress,4:e.mailDeliveryStatus.statusContent.inprogress,5:e.mailDeliveryStatus.statusContent.success,6:e.mailDeliveryStatus.statusContent.failure,7:e.mailDeliveryStatus.statusContent.failure,8:e.mailDeliveryStatus.statusContent.undo,9:e.mailDeliveryStatus.statusContent.retry,10:e.mailDeliveryStatus.statusContent.retry};6!==h&&7!==h||(m='<font id="helpDF" class="SC_ldot">'+l+"</font>"),d=b.refresh||!1,a.userstatus.toLogs?(f=a.userstatus.toLogs||[],j=a.userstatus.nrcpts||""):(f=a.userstatus||[],j=f.length);var p=function(a){var b="",c=zmCont.getContactInfo({email:a});return b=c?c.displayName:zmConUtil.parseContacts(a)[0].fn||a},q=function(a){var b="";return b="<div>"+p(a)+"<font><b> - </b>"+a+"</font><span>"+a+"</span></div>",b+='<img src="">'},r=function(a,b){if(!a&&!b)return"";var c="",d={TEMP_FAILURE:"msi-mailRetry",SUCCESS:"msi-mailSuc",PERM_FAILURE:"msi-mailFail"},f={TEMP_FAILURE:"zmSndSts-fail",SUCCESS:"zmSndSts-suc",PERM_FAILURE:"zmSndSts-fail"};return c='<div class="zmDel_status">',b&&(c+='<span class="zmSndSts_PopupIcon"><div class="zmSndStsCon '+f[b]+'"><span class="zmSndStsIco"><i class="'+d[b]+'"></i></span></div></span>'),a&&(c+='<span class="zmDel_time">'+a+"</span>"),"TEMP_FAILURE"!==b&&"PERM_FAILURE"!==b||(c+='<span class="zmDel_failLnk">'+e.mailDeliveryStatus.common.knowwhy+"</span>"),c+="</div>"},s=function(a){var b="";return a&&(b='<div class="zmDel_failMsg"><p>'+a+"</p></div>"),b},t=function(a){var b="";return b+='<li eid="'+a.rcpt+'">',h>1&&h<10&&8!==h&&(b+=r(a.deliveryTime,a.status)),b+=q(a.rcpt)+"</li>",6!==h&&7!==h&&10!==h&&9!==h||(b+=s(a.reason)),b},u=function(a){var b,c=f.length,d=0,e=!1;for(d=0;d<c;d++)if(b=f[d],b.rcpt===a){e=!0;break}return e},v=function(){var b,c,d=f.length,e="";for(b=0;b<d;b++)c=f[b],e+=t(c);if(h>0&&h<5||9===h||10===h)for(d=a.undelivered.length,b=0;b<d;b++)c=a.undelivered[b],u(c)||(e+=t({rcpt:c,status:"",reason:"",deliveryTime:""}));return e},w=function(){var a=$("#mail_delivery_status");return a.length||(a=$('<div id="mail_delivery_status" class="delStatus_content" data-msg="'+b.msgId+'">')),a},x=function(){var a,b,c="",d="",g=e.mailDeliveryStatus.common.member,i=e.mailDeliveryStatus.common.members,k="",l=0,m=0;if(7===h){for(a=0;a<j;a++)b=f[a]||{},"PERM_FAILURE"===b.status?(k+=t(b),m++):"SUCCESS"===b.status&&(d+=t(b),l++);c=['<div id=mds_right class="delStatus_rht">','<div class="partialMail_contact zmTV">',"<h4>"+e.mailDeliveryStatus.common.delivered+" "+l+" "+(l>1?i:g)+"</h4>",'<div class="SC_PUcen">','<ul class="SC_P2r">'+d+"</ul>","</div>","</div>",'<div class="partialMail_contact">',"<h4>"+e.mailDeliveryStatus.common.failure+" "+m+" "+(m>1?i:g)+"</h4>",'<div class="SC_PUcen">','<ul class="SC_P2r">'+k+"</ul>","</div>","</div>","</div>"].join("")}else c=['<div id=mds_right class="delStatus_rht">','<div class="singleMail_contact">','<ul class="SC_P2r">'+v()+"</ul>","</div>","</div>"].join("");return c},y=function(){var a=[];return a=['<div class="delStatus_row">','<div id=mds_left class="delStatus_lft">',"<h3>"+n[h]+"</h3>","<p>"+o[h]+" "+m+"</p>",h>1&&h<5?'<p><a id="mds_update" class="SC_lnk">'+e.mailDeliveryStatus.common.refresh+"</a>  "+e.mailDeliveryStatus.common.inprogresstext+"</p>":"",6===h||7===h?'<div id="mds_resend" class="SC_PUbtm"><span>'+e.mailDeliveryStatus.common.resend+"</span></div>":"","</div>",x(),"</div>"].join("")},z=function(){var a=c.find("li");a.each(function(a,b){var c=$(b).attr("eId");c&&zmail.avatar.get({email:c,type:"dom",displayName:c}).done(function(a){$(b).find("img").remove(),$(b).append(a)})})},A=function(){var a,b,d,e;c.length&&(a=c.find("#mds_update"),b=c.find(".zmDel_failLnk"),d=c.find("#mds_resend"),e=c.find("#helpDF"),a.length&&a.off("click").on("click",function(){zmList.getMailDeliveryStatus(i,!0,k)}),b.length&&b.off("click").on("click",function(){var a=$(this).closest("li");a.next().slideToggle(),a.toggleClass("zm_failMsg")}),d.length&&d.off("click").on("click",function(){k.remove(),zmUtil.invokeComposer({mode:"eanew",msgId:i})}),e.length&&e.off("click").on("click",function(){6===h?window.open("//www.zoho.com/mail/help/how-email-works.html#alink1","_blank").focus():7===h&&window.open("//www.zoho.com/mail/help/how-email-works.html#alink2","_blank").focus()}))};if(a.undelivered.length){var B,C=a.undelivered.length,D=0;for(D=0;D<C;D++)B=a.undelivered[D],0===B.indexOf(i)&&(a.undelivered[D]=a.undelivered[D].substring(i.length+1,B.length)),u(a.undelivered[D])||j++}!d&&w().parent().length&&(d=!0),d?(c=w(),c.html(y()),z(),A()):(c=w(),c.html(y()),g.$content=c,g.ignoreMouseDown=!1,g.contentWrapperClass="SC_PU singleMail_DelStatus zmSnd_stsPopup",g.dialogDidMount=function(){},g.dialogWillMount=function(){z(),A()},k=Dialog["new"](g)),h!==zmail.mailObj[i].MDS&&zmInit.updateMailDeliveryStatus({module:"mail",MDS:h,M:i,ignorePopupUpdate:!0})}},unchkAll:function(){var a=zmsuite.getCenter()[0].getNodes()[0].$el.find(".msi-uncheck");a.length&&(a.hasClass("msi-check")||a.hasClass("msi-partcheck"))&&(b.selectMails(b.getAllViewObjectIds(!0),!1),zmList.resetThreadPath(),zmInit.listingBand.removeBulkActionBand())},chkAll:function(){b.selectMails(b.getAllViewObjectIds(!0),!0),zmList.showBulkActionBand()},chkBox:function(a,c,d){d=d||{};var e,f,g,h=c.isParent,i=c.msgId,j=i,k=b.getPerviouslySelected(),l=c.type;j="th"===l?"c"+i:i,e=b.getViewObject(j),f=!(e&&e.isSelected),b.selectMail(j,f),d.shiftKey&&k&&k!==j&&b.hasElement(k)&&(g=zmUtil.arrayExtractor(b.getAllViewObjectIds(),k,j),b.selectMails(g,f),b.handleForChildSelection(k,f)),h?b.selectMails(b.getChildrenIdsOf(i),f):b.handleForChildSelection(j,f),b.setPerviouslySelected(j),f||zmList.resetThreadPath(),zmList.showBulkActionBand()},chkSingleMsg:function(){var a={},c=zmPrev.prevDetails(),d=c.msgId,e="";d||(d=b.getMailOrders()[0]);var f=b.getViewObject(d);e=f&&f.$element.data("ty"),a.isParent=zmail.mailObj[d].TH&&"lt"===e&&0!==zmUtil.getMLConversionValue(),a.msgId=d,a.type=e,a.msgId&&zmList.chkBox(null,a)},updateSelectionCount:function(a,b){a=a||"zm_Container";var c,d=zmsuite.getCenter(a)[0].getNodes()[1].$el,f=d.find(".unreadCount"),g=d.find(".zm_refine"),h=d.find(".zm_savesearch");if(d.length)if(c=d.find(".selCount"),void 0===b||b){var i=zmUtil.getCheckedMailCount();0===i?(c.remove(),"zm_Container"===a&&zmInit.updateHeaderBand(),g.show(),h.show()):(c.length||(c=$(_zm.getDOM(["SPAN",{attrs:{"class":"sum selCount"}}])),d.find(".SC_flt .SC_mtb").append(c)),1===i?c.text(e.common.singlemail):c.text(zmText.applyArgs(e.common.multiplemail,{count:i})),f.hide(),g.hide(),h.hide())}else c.remove(),"zm_Container"===a&&zmInit.updateHeaderBand(),g.show(),h.show()},doThreadPath:function(a,b){var c="";c=a.parents(".SC_mclst"),r(b,a,c)},resetThreadPath:function(){if("zm_Container"===zmTab.currentTab||"zm_srch1"===zmTab.currentTab){var a,b,c=zmPrev.prevDetails(zmTab.currentTab),d=c.msgId,e=c.type;a=zmsuite.getCenter(zmTab.currentTab)[0].getNodes()[2].$el,b="th"===e?a.find("#"+d):a.find("#t"+d),zmList.doThreadPath(b,"add")}},allowFLOperation:function(a){var b=!0;if(!a)return!1;for(var c in zmail.folId)if(zmail.folId[c]===a){b=!1;break}return b},remReadMail:function(){var a,b=zmList.getElemObj().listElem||zmail.mailCenter.listElem,c=$(b);a="zm_Container"===zmTab.currentTab?c.children(".zmL:not(.zm_urd)"):c.children(".zmL:not(.zm_urd,.zmSLst)"),a.each(function(){var a,b,c=this.id;a=$(this),b=a.parent(),b.hasClass("zmTV")?b.children(".zmL").hasClass("zm_urd")||(b.remove(),b.prev().remove()):(a.remove(),c.indexOf("t")||(c=c.substring(1,c.length)),$("#thd"+c).length&&$("#thd"+c).remove()),zmCache.updateCacheForViews(c)})},mailUtility:function(a){var b,c,d,f,g,h={};if(g=a.target||a.srcElement,b=$(g).closest(".zmL").attr("id")){zmInit.rclkId=b,c=a.target||a.srcElement,d=$(c);var i=d.closest(".zmL");if(i.length&&i.addClass("SC_rgtClk"),d.hasClass("zmflg"))d.css("visibility","visible"),f={clk:function(a,b){zmList.setFlag(d,b)},removeSelection:!0,conArr:[{htm:"<i class='zm_icn zmflg zm_fgB'></i>"+e.flagmenu.infoflag,data:{flag:"1"}},{htm:"<i class='zm_icn zmflg zm_fgR'></i>"+e.flagmenu.important,data:{flag:"2"}},{htm:"<i class='zm_icn zmflg zm_fgG'></i>"+e.flagmenu.followup,data:{flag:"3"}},{sep:!0},{htm:"<i class='zm_icn zmflg'></i>"+e.flagmenu.clearflag,data:{flag:"0"}}]},zmsuite.showContextMenu(a,f),zmUtil.stopEvents(a);else if(h=zmInit.getListingDetObj(),h.fId!==zmail.folId.oId&&h.fId!==zmail.folId.teId&&h.fId!==zmail.folId.dId){var j;j=h.fId===zmail.folId.sId?{htm:e.contextmenu.listrecipient,data:{action:"listrecipient",from:"ctxtMenu"}}:{htm:e.contextmenu.listfromsender,data:{action:"listsender",from:"ctxtMenu"}};var k=[j,{htm:e.contextmenu.listbysubject,data:{action:"listsubject",from:"ctxtMenu"}},{sep:!0},{htm:e.contextmenu.openpreview,data:{action:"openpreview",opentype:0}},{htm:e.contextmenu.opentab,data:{action:"opentab",opentype:2}},{htm:e.contextmenu.popout,data:{action:"openwindow",from:"ctxtMenu"}},{sep:!0},{htm:e.contextmenu.reply,data:{action:"reply",from:"ctxtMenu"}},{htm:e.contextmenu.replyall,data:{action:"replyall",from:"ctxtMenu"}},{htm:e.contextmenu.forward,data:{action:"forward",from:"ctxtMenu"}},{sep:!0},{htm:e.contextmenu.markspam,data:{action:"spam",from:"ctxtMenu"}},{htm:e.contextmenu.marknotspam,data:{action:"notspam",from:"ctxtMenu"}},{htm:e.contextmenu["delete"],data:{action:"delete",from:"ctxtMenu"}}];0===zmail.mailOpt.isPopup?k.splice(3,1):1===zmail.mailOpt.isPopup?k.splice(5,1):k.splice(4,1),h.fId===zmail.folId.spId?k.splice(10,1):k.splice(11,1),k.push({sep:!0},{htm:e.contextmenu.addfilter,data:{action:"addFilter"}}),zmUtil.isZohoAccount(zmail.accId)&&!zmUtil.isSharedFolder(h.fId)&&(k.push({htm:e.contextmenu.addtask,data:{action:"addTask"}}),zmUtil.isZohoAccount(zmail.accId)&&zmUtil.isNoteReactUser()&&!zmUtil.isSharedFolder(h.fId)&&k.push({htm:e.contextmenu.addnote,data:{action:"addNote"}})),f={clk:function(a,b){zmList.bindAction(b,a)},conArr:k,removeSelection:!0},zmsuite.showContextMenu(a,f),zmUtil.stopEvents(a)}}},leftUtility:function(a,b,c){var e,f=b.id||$(b).parents(".SC_tre").attr("id");if(zmInit.rclkId=f,"zmlTreeH"===c)e={clk:function(a,b){zmList.bindAction(b,a)},conArr:[{htm:d.foldercontextmenu.createsub,id:"zmLTMenu_Nf",cEdit:!0,data:{action:"zmLTMenu_Nf"}},{sep:!0,id:"zmLTMenu_lne1"},{htm:d.foldercontextmenu.markfolread,id:"zmLTMenu_Fr",cEdit:!1,data:{action:"zmLTMenu_Fr"}},{sep:!0,id:"zmLTMenu_lne2"},{htm:d.foldercontextmenu.sharefol,id:"zmLTMenu_Sf",cEdit:!1,data:{action:"zmLTMenu_Sf"}},{sep:!0,id:"zmLTMenu_lne3"},{htm:d.foldercontextmenu.renamefol,id:"zmLTMenu_Rf",cEdit:!0,data:{action:"zmLTMenu_Rf"}},{htm:d.foldercontextmenu.delfol,id:"zmLTMenu_Df",cEdit:!1,data:{action:"zmLTMenu_Df"}},{sep:!0,id:"zmLTMenu_lne4"},{htm:d.foldercontextmenu.archfol,id:"zmLTMenu_Af",cEdit:!1,data:{action:"zmLTMenu_Af"}},{htm:d.foldercontextmenu.emptyfol,id:"zmLTMenu_Ef",cEdit:!1,data:{action:"zmLTMenu_Ef"}}]},zmsuite.showContextMenu(a,e),zmUtil.stopEvents(a);else if("zmllabelH"===c){if(!zmUtil.isSystemLabel(f)){var g=[{htm:d.tagCreateEdit.edittag,id:"zmLTMenu_El",cEdit:!0,data:{action:"zmLTMenu_El"}},{htm:d.tagCreateEdit.deltag,id:"zmLTMenu_Dl",cEdit:!1,data:{action:"zmLTMenu_Dl"}}];if(zmail.showFeature){var h={},i=d.tagCreateEdit.sharetag,j=zmList.getRowInfo(f,"zmllabelH","info");j&&j.shId&&"-1"!==j.shId&&(i=d.foldercontextmenu.shareinfo),h.htm=i,h.id="zmLTMenu_Sl",h.data={action:"zmLTMenu_Sl"},h.cEdit=!0,g.push(h)}e={clk:function(a,b){zmList.bindAction(b,a)},conArr:g},zmsuite.showContextMenu(a,e)}zmUtil.stopEvents(a)}else if("zmlSSrchTreeH"===c)e={clk:function(a,b){zmList.bindAction(b,a)},conArr:[{htm:d.common.rename,id:"zmLTMenu_Rss",cEdit:!1,data:{action:"zmLTMenu_Rss"}},{htm:d.common["delete"],id:"zmLTMenu_Dss",cEdit:!1,data:{action:"zmLTMenu_Dss"}}]},zmsuite.showContextMenu(a,e),zmUtil.stopEvents(a);else if("zmlSTreeH"===c)e={clk:function(a,b){zmList.bindAction(b,a)},conArr:[{htm:d.foldercontextmenu.unsubscribe,id:"zmLTMenu_Unshare",cEdit:!1,data:{action:"zmLTMenu_Unshare",cur:b,zm_unshareId:f}}]},zmsuite.showContextMenu(a,e),zmUtil.stopEvents(a);else if("zmStreamTree"===c){if(e={clk:function(a,b){zmStreamsApp.events.groupAction(b)},conArr:[{htm:"Chat with this group",id:"zmLTMenu_CChat",cEdit:!1,data:{action:"createChat",gid:f}},{htm:"View Members",id:"zmLTMenu_VMem",cEdit:!1,data:{action:"viewMembers",gid:f}}]},zmail.trialUsers&&f!==zmail.zuid&&$.isNumeric(f)){var k=zmCont.getGroup(f);k.eid&&e.conArr.push({htm:"Email this group",id:"zmLTMenu_Email",cEdit:!1,data:{action:"email",gid:f}}),k.scount>0&&e.conArr.push({htm:"Mark posts as read",id:"zmLTMenu_Email",cEdit:!1,data:{action:"markRead",gid:f}}),zmsuite.showContextMenu(a,e)}zmUtil.stopEvents(a)}},setFlag:function(a,b){var c=b.flag;a.css("visibility",""),zmList.flagMail(a,c),zmUtil.hideMenu()},getMailSummaryList:function(a,b,c){var d,e=[],f=!1,g="archive"===a.view;if(a.fId!==zmail.folId.sId&&zmList.excludeSent||(f=!0),zmail.listObj[b]){var h=zmail.listObj[b].MO,i=zmail.folId.dId,j=zmail.folId.sId,k={};if(zmail.folCount[a.fId]||$("#"+a.fId).length)if(a.flag)if(parseInt(a.flag)===-1)for(d=0;d<h.length;d++)k=zmail.mailObj[h[d]],k.FD===a.fId&&0!==parseInt(k.NFG)&&1!==k.AR&&k.FD!==i&&(k.FD!==j||k.FD===j&&f)&&e.push(h[d]);else for(d=0;d<h.length;d++)k=zmail.mailObj[h[d]],k.FD===a.fId&&parseInt(k.NFG)===parseInt(a.flag)&&1!==k.AR&&k.FD!==i&&(k.FD!==j||k.FD===j&&f)&&e.push(h[d]);else if(a.label)if("-1"===a.label)for(d=0;d<h.length;d++)k=zmail.mailObj[h[d]],k.FD===a.fId&&k.TAG&&k.TAG.length>0&&1!==k.AR&&k.FD!==i&&(k.FD!==j||k.FD===j&&f)&&e.push(h[d]);else for(d=0;d<h.length;d++){k=zmail.mailObj[h[d]];var l=$.inArray(a.label,k.TAG);k.FD===a.fId&&l!==-1&&1!==k.AR&&k.FD!==i&&(k.FD!==j||k.FD===j&&f)&&e.push(h[d])}else if("unread"===a.view)for(d=0;d<h.length;d++)k=zmail.mailObj[h[d]],k.FD===a.fId&&0===k.S&&1!==k.AR&&k.FD!==i&&(k.FD!==j||k.FD===j&&f)&&e.push(h[d]);else if(a.attach)for(d=0;d<h.length;d++)k=zmail.mailObj[h[d]],k.FD===a.fId&&1===k.AT&&1!==k.AR&&k.FD!==i&&(k.FD!==j||k.FD===j&&f)&&e.push(h[d]);else if(g)for(d=0;d<h.length;d++)k=zmail.mailObj[h[d]],k.FD===a.fId&&1===k.AR&&k.FD!==i&&(k.FD!==j||k.FD===j&&f)&&e.push(h[d]);else for(d=0;d<h.length;d++)k=zmail.mailObj[h[d]],k.FD===a.fId&&1!==k.AR&&k.FD!==i&&(k.FD!==j||k.FD===j&&f)&&e.push(h[d]);else if(zmail.labInfo[a.label]){for(d=0;d<h.length;d++)if(k=zmail.mailObj[h[d]],k.TAG&&k.FD!==zmail.folId.spId&&k.FD!==zmail.folId.tId&&k.FD!==i&&(k.FD!==j||k.FD===j&&f))for(var m=k.TAG,n=0;n<m.length;n++)m[n]===a.label&&e.push(h[d])}else if("unread"===a.view)for(d=0;d<h.length;d++)k=zmail.mailObj[h[d]],k.FD!==zmail.folId.spId&&k.FD!==zmail.folId.tId&&0===k.S&&k.FD!==i&&(k.FD!==j||k.FD===j&&f)&&e.push(h[d]);else if(a.flag)if(parseInt(a.flag)===-1)for(d=0;d<h.length;d++)k=zmail.mailObj[h[d]],k.FD!==zmail.folId.spId&&k.FD!==zmail.folId.tId&&0!==parseInt(k.NFG)&&k.FD!==i&&(k.FD!==j||k.FD===j&&f)&&e.push(h[d]);else for(d=0;d<h.length;d++)k=zmail.mailObj[h[d]],k.FD!==zmail.folId.spId&&k.FD!==zmail.folId.tId&&parseInt(k.NFG)===parseInt(a.flag)&&k.FD!==i&&(k.FD!==j||k.FD===j&&f)&&e.push(h[d]);else if("all"===a.view)for(d=0;d<h.length;d++)k=zmail.mailObj[h[d]],k.FD!==zmail.folId.spId&&k.FD!==zmail.folId.tId&&k.FD!==i&&(k.FD!==j||k.FD===j&&f)&&e.push(h[d])}return zmail.convSortOrder&&c?e.reverse():e},getListForAllMailsView:function(a,b,c){a=a||{};var d=[],e=0,f=!1,g="archive"===a.view;if(a=a||{},a.fId!==zmail.folId.sId&&zmList.excludeSent||(f=!0),zmail.listObj[b]){var h,i=zmail.listObj[b].MO,j=zmail.folId.dId;for(e=0;e<i.length;e++)h=zmail.mailObj[i[e]],h.FD!==zmail.folId.spId&&h.FD!==zmail.folId.tId&&(g&&1===h.AR||!g&&1!==h.AR||c)&&h.FD!==j&&(h.FD!==zmail.folId.sId||h.FD===zmail.folId.sId&&f)&&d.push(i[e])}return d},flagMail:function(a,b){var c,d,e={};d=a.parents(".zmL"),c=d[0].id,c.indexOf("t")!==-1?(e.thd=[zmInit.zmsubStr(c,"t")],e.msgId=[]):(e.msgId=[c],e.thd=[]),e.fVal=b,zmmailAct.applyActions("flag","click",e)},showHideThread:function(a,b,c,d){var e,f,g,h,i,j={},k={};h=$(a).closest(".zmL"),f=e=h[0].id,f.indexOf("t")||(e=f.substring(1)),j={from:"tIcon",mId:e,elemObj:b},d&&(j.eTDefObj=d),"search"!==b.viewDetails.view&&zmail.listObj[zmail.mailObj[e].T]?q({},{mId:e,from:j.from,elemObj:b,opentype:c}):(g=zmail.mailObj[e].T,i=zmail.mailObj[e].FD,k={accId:zmail.accId,thId:g,from:0,to:10,summary:!0},b.viewDetails.fId&&zmUtil.isSharedFolder(b.viewDetails.fId)?(i=b.viewDetails.fId,k.shId=zmUtil.getShareId(i),zmail.opType.read_mail?k.opType=zmail.opType.read_mail:k.opType=0):"zm_Container"===zmTab.currentTab&&(k.folId=i),y(k,j,q))},getThreadCount:function(a){var b,c=zmail.mailObj[a.msgId].T,d={accId:zmail.accId,tId:c},e=a.viewDetails||zmInit.getListingDetObj();1===zmUtil.getMLConversionValue()||2===zmUtil.getMLConversionValue()&&(e.fId===zmail.folId.spId||e.fId===zmail.folId.sId)?(e.fId&&(d.folId=e.fId),e.flag&&(d.flag=e.flag),e.attach&&(d.attach=e.attach),e.view&&(d.view=e.view),e.label&&(d.label=e.label),d.folderSpec=1,d.mode="count",b=zmList.updThdCount):(d.folderSpec=2,d.mode="metadata",d.tId=a.msgId,b=zmList.updThdDetails),zmAjq.XHR({u:zmail.conPath+"/getThdCount.do",t:"POST",fn:b,p:d,ep:{msgId:a.msgId,deferredObj:a.deferredObj}})},updThdCount:function(a,b){var c=b.msgId,d=1;a.cntdata[0].count&&(d=parseInt(a.cntdata[0].count)),zmail.mailObj[c].TC=d,b.deferredObj&&b.deferredObj.resolve()},updThdDetails:function(a,b){var c=b.msgId,d=zmail.mailObj[c];a&&(d.TC=a.TC,d.TA=a.TA,d.TS=a.TS,d.TI=a.TI,d.TM=a.TM,d.TF=a.TF,d.TTAGS=a.TTAGS,d.TSN=a.TSN,d.TSB=a.TSB,d.TSM=a.TSM),b.deferredObj&&b.deferredObj.resolve()},setEmptyListing:function(){var a,b;a=$(zmail.mailCenter.listElem),0!==a.find(".zmL").length||a.data("ty")||(b=zmInit.emptyRow(),a.html(b)),zmInit.listingBand.SpamTrashBand.setBand()},FLUtility:function(a,b,c,e){var f=b.id||$(b).parents(".SC_tre").attr("id"),g=zmail.folId;if(zmUtil.stopEvents(a),"zm_unread"===f||"zm_all"===f||"zm_flag"===f||f===g.dId||f===g.teId)return void zmUtil.hideMenu();if("header"!==e)if(zmList.leftUtility(a,b,c),f&&"zmlTreeH"===c?zmfolAction.rgtFolId=f:"zmllabelH"===c?zmlab.labelId=f:"zmlSSrchTreeH"===c?zmSearch.savedSearchId=f:"zmStreamTree"===c&&zmail.trialUsers&&zmUtil.loadStreams().done(function(){zmStreamsApp.constants.rightClickId=f}),f===g.iId)zmList.dimUtility(h,[4,6,7]);else if(f===g.tId||zmfolAction.isDeletedFolder(f))zmList.dimUtility(h,[0,4,6,7,9]),zmfolAction.rgtFolId=zmail.folId.tId,$("#zmLTMenu_Ef").html(d.emptyfolder.emptytrash);else if(f===g.sId)$("#zmLTMenu_Ef").html(d.emptyfolder.emptysent),zmList.dimUtility(h,[0,2,4,6,7]);else if(f===g.spId)$("#zmLTMenu_Ef").html(d.emptyfolder.emptyspam),zmList.dimUtility(h,[0,4,6,7,9]);else if(f===g.oId){$("#zmLTMenu_Ef").html(d.foldercontextmenu.sendnow);var i=[0,2,4,6,7,9];0===Number(zmail.folCount[zmail.folId.oId].c)&&i.push(10),zmList.dimUtility(h,i)}else $("#zmLTMenu_Ef").html(d.foldercontextmenu.emptyfol);
zmail.isOrg||"1"!==zmail.aInfo[zmail.accId].accountType?"0"===zmail.aInfo[zmail.accId].accountType?($("#zmLTMenu_lne2").remove(),$("#zmLTMenu_Sf").remove()):zmUtil.isFolderId(f)&&"-1"!==zmList.getRowInfo(f,"zmlTreeH","info").SH&&$("#zmLTMenu_Sf").html(d.foldercontextmenu.shareinfo):$("#zmLTMenu_Sf").addClass("SC_op3")},getParent:function(a,b){for(;$(a).attr("tagName")!==zmInit.topelement&&!$(a).hasClass(b);)if(a=zmInit.nn6?a.parentNode:a.parentElement,$(a).hasClass(b)&&"DIV"===a.tagName)return a;return a},dimUtility:function(a,b){b=b.sort(function(a,b){return a===b?0:a>b?1:-1});for(var c=0,d=0;d<a.length;d++)d===b[c]?("zmLTMenu_Rf"===a[d]||"zmLTMenu_Nf"===a[d]?$("#"+a[d]).parent().addClass("SC_op3"):$("#"+a[d]).addClass("SC_op3"),c++):$("#"+a[d]).removeClass("SC_op3")},changeViewColumns:function(a){var b,c={},d={};b="s"===zmail.viewInfo[0][a]?"hide":"show",d={opt:b,accId:zmail.accId,cName:a},c.opt=b,c.cName=a,zmAjq.XHR({u:zmail.conPath+"/editHeader.do",t:"POST",fn:K,p:d,csr:"s",ep:c})},getRowInfo:function(a,b,c){var d,e,f={};return a&&(d=zmail.mailLeft.getNodes()[0].getLayer(b),f=d.getRowObj(a),c)?e=f[a]:f},editLeftRow:function(a,b){var c;c=zmail.mailLeft.getNodes()[0].getLayer(b),c.editNode(a,c.mapObject)},nwFolContextMenu:function(){var a=$("#zmLTMenu_Nf"),b=zmfolAction.rgtFolId;zmUtil.setEditable({ele:a,target:$("#"+b),callback:zmUtil.hideMenu,allowCondition:function(){return zmail.folId.iId===b||"zmlTreeH"===b,!0},parentdiv:$("#zmCntxtMenu"),hideMenu:zmUtil.hideMenu}),$.publish("/mail/activeMenu",[{activeMenuElement:a,activeMenuHandler:zmfolAction.newFolderMenuHandler}])},rnSSrchContextMenu:function(){zmUtil.hideMenu(),zmSearch.getSavedSearchName({mode:"rename"}).then(function(a){zmSearch.processSavedSearch({id:zmSearch.savedSearchId,searchName:a.savedsearchname,mode:"rename"})}).fail(function(){})},rnFolContextMenu:function(){var a=zmfolAction.rgtFolId,b=zmList.allowFLOperation(a),c=$("#zmLTMenu_Rf");zmUtil.setEditable({ele:c,target:$("#"+a),callback:zmUtil.hideMenu,initialize:!0,allowCondition:function(){return!(!a||zmfolAction.getParentFolderId(a)===zmail.folId.tId)&&b},parentdiv:$("#zmCntxtMenu"),hideMenu:zmUtil.hideMenu}),$.publish("/mail/activeMenu",[{activeMenuElement:c,activeMenuHandler:zmfolAction.renameFolderMenuHandler}])},delFolContextMenu:function(){var a=zmfolAction.rgtFolId,b=zmList.allowFLOperation(a);return b&&a?void(zmfolAction.getParentFolderId(a)!==zmail.folId.tId&&(zmsDialog.confirm(zmText.applyArgs(d.emptyfolconfmsg.delfolmsg,{foldername:'"'+zmInit.findFolName(a)+'"'}),{onOk:function(){var b={accId:zmail.accId,mode:"delete",folId:a};zmAjq.XHR({u:zmail.conPath+"/folAction.do",t:"POST",fn:zmfolAction.deleteFolder,p:b,ep:{toTrash:!0},csr:"s"})}}),$("#zmCntxtMenu").hide())):void zmUtil.hideMenu(!0)},rnLabContextMenu:function(){var a="zmllabelH"!==zmlab.labelId,b=a?"e":"a",c=$("#zmLTMenu_El");zmUtil.setEditable({ele:$("#zmLTMenu_El"),target:$("#"+zmlab.labelId),callback:zmUtil.hideMenu,initialize:a,parentdiv:$("#zmCntxtMenu"),hideMenu:zmUtil.hideMenu}),$.publish("/mail/activeMenu",[{activeMenuElement:c,activeMenuHandler:zmlab.labelMenuHadler,activeMenuArgsArray:[b]}])},delLabContextMenu:function(){var a=zmlab.labelId,b=zmList.allowFLOperation(a);return b&&a?(zmsDialog.confirm(d.tagCreateEdit.deltagdialogmsg,{onOk:function(){zmlab.labelreq("d")}}),void zmUtil.hideMenu(!0)):void zmUtil.hideMenu(!0)},delSavedSrchContextMenu:function(){var a=zmSearch.savedSearchId;zmsDialog.confirm(zmText.get("search","savedsearch.confirmDelete",{name:"test"}),{onOk:function(){zmSearch.processSavedSearch({id:a,mode:"delete"})}}),zmUtil.hideMenu()},mrkReadContextMenu:function(){var a=zmfolAction.rgtFolId;return a?void zmfolAction.markAsReadFolder(a):void zmUtil.hideMenu(!0)},unshareContextMenu:function(a){zmshare.unshare(a)},emptyFolContextMenu:function(a){var b,c=a||zmfolAction.rgtFolId;return c!==zmail.folId.dId&&c!==zmail.folId.teId&&c!==zmail.folId.oId&&(c===zmail.folId.spId?zmsDialog.confirm(d.emptyfolconfmsg.spammsg,{onOk:function(){b={accId:zmail.accId,mode:"emptyspam",folId:c},zmAjq.XHR({u:zmail.conPath+"/folAction.do",t:"POST",fn:zmfolAction.emptyFolder,p:b,csr:"s"})}}):c===zmail.folId.tId?zmsDialog.confirm(d.emptyfolconfmsg.trashmsg,{onOk:function(){b={accId:zmail.accId,mode:"emptytrash",folId:c},zmAjq.XHR({u:zmail.conPath+"/folAction.do",t:"POST",fn:zmfolAction.emptyFolder,p:b,csr:"s"})}}):c===zmail.folId.sId?zmsDialog.confirm(d.emptyfolconfmsg.sentmsg,{onOk:function(){b={accId:zmail.accId,mode:"emptysent",folId:c},zmAjq.XHR({u:zmail.conPath+"/folAction.do",t:"POST",fn:zmfolAction.emptyFolder,p:b,csr:"s"})}}):zmfolAction.sendEmptyFolderReq(c),void zmUtil.hideMenu(!0))},shareFolContextMenu:function(a){var b,c,d="",e=[];if("fol"===a){if(b=zmfolAction.rgtFolId,c=zmList.allowFLOperation(b),!c||!b)return void zmUtil.hideMenu(!0)}else if("tag"===a&&(b=zmlab.labelId,!b))return void zmUtil.hideMenu(!0);var f=zmText.get("sharefolder","share_folder"),g="",h="";e&&("tag"===a?(e=zmList.getRowInfo(b,"zmllabelH","info"),h=e.dispName?e.dispName:"",h=e.label?e.label:h,e&&"-1"!==e.shId&&(g=e.shId),f="Share tag"):"fol"===a&&(e=zmList.getRowInfo(b,"zmlTreeH","info"),h=e.FN?e.FN:"",h=e.SN?e.SN:h,e&&"-1"!==e.SH&&(g=e.SH))),""!==h&&(d=" - "+h);var i=$('<div class="shrFol" id="sharepopup"/>'),j=[];j=["<div>",'<div class="SC_input">','<input id="zmshr_usrinp" type="text" placeholder="'+zmText.get("sharefolder","org_member")+'">',"</div>",'<div id="zmshr_role" data-readval="read" data-read="'+zmText.get("sharefolder","read")+'" data-write="'+zmText.get("sharefolder","write")+'" class="SC_rwToggle"></div>','<div id="zmshr_delegate" class="SC_tp10 SC_dyn"><span id="zmshr_frmchk"  class="cursorPointer"><i class="msi-uncheck"></i>'+zmText.get("sharefolder","allow_delegation")+"</span>",'<div class="SC_cs SC_np SC_dyn" id="zmshr_frmlst"><span>'+zmail.cmpdata.DEFFRM_ADDR+'</span><i class="msi-barrow"></i></div>',"</div>",'<div class="SC_PUbtm"><span id="zmshr_share">'+zmText.get("sharefolder","share")+"</span></div>","</div>"],i.append($(j.join(""))),i.append('<div id="zmshr_usrlst" class="SC_dyn"/>');var k={};k.$content=i,k.title=f+" "+d,k.ignoreMouseDown=!1,k.dialogDidMount=function(c){$("#sharepopup")[0].zm_share_dialog_ele=c,c.$els.$contentWrapper.css({"min-width":"500px"}),zmail.showFeature||$("#zmshr_unshare_opt").remove(),$("#zmshr_role").off("click").on("click",function(){$(this).toggleClass("SC_rwWrite");var a=$("#zmshr_role").attr("class");a.indexOf("SC_rwWrite")===-1?($("#zmshr_delegate").addClass("SC_dyn"),$("#zmshr_frmchk").find("i").eq(0).removeClass("msi-check").addClass("msi-uncheck"),$("#zmshr_frmlst").addClass("SC_dyn")):$("#zmshr_delegate").removeClass("SC_dyn")}),$("#zmshr_unshare").off("click").on("click",function(){zmshare.unshared(g)}),$("#zmshr_share").off("click").on("click",function(){zmshare.saveShare(b,a,g)}),$("#zmshr_cancel").off("click").on("click",function(){zmshare.closeDialog()}),$("#sharepopup").attr("data-resId",b).attr("data-shId",g),$("#sharepopup").attr("data-resType",a);var d=Object.keys(zmList.frmListObj(zmail.cmpdata.FROM_LIST)),e=d.length;if(1===e?$("#zmshr_frmlst").removeClass().addClass("SC_cs SC_np SC_ni"):e>1&&$("#zmshr_frmlst").off("click").on("click",function(){zmList.getFrmLst($(this))}),$("#zmshr_frmchk").off("click").on("click",function(){$("#zmshr_frmchk").find("i").eq(0).hasClass("msi-check")?($("#zmshr_frmchk").find("i").eq(0).removeClass("msi-check").addClass("msi-uncheck"),$("#zmshr_frmlst").addClass("SC_dyn")):($("#zmshr_frmchk").find("i").eq(0).removeClass("msi-uncheck").addClass("msi-check"),$("#zmshr_frmlst").removeClass("SC_dyn"))}),g&&""!==g)$("#zmshr_usrlst").removeClass("SC_dyn"),$("#zmshr_usrlst > ul").html('<li id="zmshr_load">'+zmText.get("sharefolder","loading")+" <blink>...</blink></li>"),zmshare.getUserLst(g);else{$("#zmshr_unshare_opt").remove();var f={contentArray:"org",compare:["fn","ln","nn","eid"],LType:"3",OType:"2",display:"fn"};zmAutoFill.setAutofill(f,$("#sharepopup #zmshr_usrinp"))}},k.dialogWillMount=function(a){var b=['<div id="zmshare_folder_error_band" class="SC_msg SC_emsg SC_dyn"><span><font  id="zmshare_folder_error_msg"></font><i id="zmshare_folder_error_close" class="msi-close"></i></span></div>'];a.$els.$contentWrapper.before(b.join(""))},k.defaultNavigator=!1,k.navigator=new zmail.Navigator({onEscape:function(){var a=$("#sharepopup")[0].zm_share_dialog_ele;a.remove()}}),Dialog["new"](k)},archiveFolderContextMenu:function(a){var b=a||zmfolAction.rgtFolId;b===zmail.folId.dId||b===zmail.folId.teId||b===zmail.folId.spId||b===zmail.folId.oId||b===zmail.folId.tId||zmfolAction.isDeletedFolder(b)||zmfolAction.sendArchiveFolderReq(b)},frmListObj:function(a){var b={};for(var c in a)a[c]&&"undefined"!=typeof a[c].FRM_SIGMODE&&6!==a[c].FRM_SIGMODE&&(b[c]=a[c]);return b},getFrmLst:function(a){var b,c=zmList.frmListObj(zmail.cmpdata.FROM_LIST),d={},e=[];for(var f in c)b={htm:f,data:{frm:f}},a.find("span").eq(0).text()!==f&&e.push(b);d.list=e,d.par=$("#zmshr_frmlst"),d.align="pleft",d.clk=function(a){$("#zmshr_frmlst").find("span").eq(0).text(a.frm),$("#zm_dropDown").remove()},zmsuite.showMenu(d)},updateThreadList:function(a){var b={},c={thId:a};a&&zmail.listObj[a]&&(b={accId:zmail.accId,thId:a,from:0,to:50,summary:!0},c={thId:a,from:"tIcon"},y(b,c,zmUtil.cacheThreadList))},updateFolderName:function(){var a,b=zmList.getElemObj();a=b.viewDetails,$(b.listElem).length&&(""!==a.fId||"unread"!==a.view&&"all"!==a.view&&"flag"!==a.view?a.fId&&zmInit.updateHeaderBand():$(b.listElem).find("div.zmL").each(function(){var a;a=this.id,a.indexOf("t")!==-1&&(a=a.substring(1,a.length)),a&&$(this).find(".zmFdr span").text(zmInit.findFolName(zmail.mailObj[a].FD))}))},reviewMailNotification:function(a,b){var c,d,e=zmUtil.getFolId(),f=zmInit.getListingDetObj(),g=!1,h=!1,i=!1,j=!1,k=zmUtil.getMLConversionValue(e);if(e===zmail.folId.sId||e===zmail.folId.tId?k=0:2===k&&e===zmail.folId.spId&&(k=1),a.T&&(a.FD===zmail.folId.dId&&zmUtil.isInlineCompose()||zmCache.updateObj({mode:"insert",msgId:a.M,rt:a.R,folId:a.T,type:"newm"}),a.FD===zmail.folId.dId&&zmUtil.isInlineCompose()&&zmail.mailObj[a.PA]&&(zmail.mailObj[a.PA].DMID=a.M,0===k&&(zmail.mailObj[a.PA].DC=zmail.mailObj[a.PA].DC+1||1)),zmail.mailObj[a.T]&&0===zmail.mailObj[a.T].TH&&(zmail.mailObj[a.T].TH=1,zmail.mailObj[a.T].T=a.T,zmail.mailObj[a.T].TC=1,zmail.listObj[a.T]?zmail.listObj[a.T].MO?1===zmail.convSortOrder?zmail.listObj[a.T].MO.unshift(a.M):zmail.listObj[a.T].MO.push(a.M):a.FD===zmail.folId.dId&&zmUtil.isInlineCompose()?zmail.listObj[a.T].MO=[a.T]:1===zmail.convSortOrder?zmail.listObj[a.T].MO=[a.T,a.M]:zmail.listObj[a.T].MO=[a.M,a.T]:a.FD===zmail.folId.dId&&zmUtil.isInlineCompose()?(zmail.mailObj[a.T].DC=1,zmail.listObj[a.T]={MO:[a.T]}):(a.FD===zmail.folId.dId&&(zmail.mailObj[a.T].DC=1),1===zmail.convSortOrder?zmail.listObj[a.T]={MO:[a.T,a.M]}:zmail.listObj[a.T]={MO:[a.M,a.T]}),$.publish("mail/threadCreated",{conversationID:a.T}))),!(a.FD===zmail.folId.spId&&e!==zmail.folId.spId||a.FD===zmail.folId.tId&&e!==zmail.folId.tId)&&((f.fId&&e===a.FD||!f.fId)&&(i=!0),("unread"===f.view&&0===a.S||"1"===f.attach&&1===a.AT||a.NFG&&f.flag&&("-1"===f.flag&&0!==parseInt(a.NFG)||parseInt(f.flag)===parseInt(a.NFG))||f.label&&a.TAG&&("-1"===f.label||a.TAG.indexOf(f.label)!==-1)||(f.fId&&e===a.FD||!f.fId&&"all"===e)&&!f.flag&&!f.label&&!f.attach&&"unread"!==f.view)&&(h=!0),(zmail.listObj[a.FD]&&zmail.listObj[a.FD].MO.indexOf(a.M)===-1||zmail.listObj[e]&&zmail.listObj[e].MO.indexOf(a.M)===-1)&&(j=!0),i&&h&&j&&(g=!0,a.TH&&0!==k))){var l=S(a.M,e);l?fa(l,a.M):zmail.listObj[a.T]&&(d=zmList.getViewBasedMsgList(a.T,f,!0),d.length>0&&(a.FD===zmail.folId.dId?fa(a.M,a.M):zmail.mailObj[d[1]].FD===zmail.folId.sId?(c=ha(d),fa(c,a.M)):fa(d[1],a.M)))}!g&&0!==k&&a.TH&&e!==zmail.folId.spId&&e!==zmail.folId.tId&&(zmail.listObj[a.T]?(d=zmList.getMailSummaryList(f,a.T),d.length>0&&(d=zmList.getViewBasedMsgList(a.T,f,!0),a.FD===zmail.folId.dId?fa(a.M,a.M):zmail.mailObj[d[1]].FD===zmail.folId.sId?(c=ha(d),fa(c,a.M)):fa(d[1],a.M),g=!0)):g=ga(a.M,e)),g&&zmList.updateForNewMail(a,b,h);var m=[zmail.folId.spId,zmail.folId.tId,zmail.folId.dId];if("zmailReconnect"!==b&&m.indexOf(a.FD)===-1&&0===a.S&&"1"!==a.SNS){zmInit.mNotifier.push(a);var n={};n.title=a.SN||a.F||"",n.msg=zmUtil.decodeHTMLEntities(a.SB)||"",n.tag="Mail";var o=zmConUtil.contactInfo({eid:a.F});void 0!==o&&o.json&&o.json.photo?n.imgUrl=o.json.photo:n.imgUrl="",n.callback=function(){zmList.getMailData({msgId:a.M,opentype:2,type:"lt",src:"external",eprm:{accId:zmail.accId}})},_zm.pushDesktopNotification(n)}},updateForNewMail:function(a,b,c){var d,e,f,g,h=!1,i=!1,j=!1,k=[],l="",m=!0,n="",o=zmUtil.getMLConversionValue();if(e=a.FD,d=zmInit.getListingDetObj(),f=zmUtil.getFolId(),a.AR||(a.AR=0),a.NFG||(a.NFG="0"),"zmailReconnect"!==b&&a.FD!==zmail.folId.sId&&a.FD!==zmail.folId.dId||(m=!1),f===zmail.folId.sId||f===zmail.folId.tId?o=0:2===o&&f===zmail.folId.spId&&(o=1),a.T&&0!==o){if(n="zm_tabt"+a.T,0!==a.S||a.TS||(a.TS=0),zmsuite.isWorkspaceAvailable(n)&&(j=!0),$(zmail.mailCenter.prevElem).hasClass("shw")&&(g=$(zmail.mailCenter.prevElem).attr("data-mid"),zmail.mailObj[g].T===a.T||g===a.T)){i=!0,h=!0,l=g;var p=$(zmail.mailCenter.listElem).find("#"+l);p.length?(l="t"+l,p.attr("id",l)):(l="t"+l,p=$(zmail.mailCenter.listElem).find("#"+l))}}else 0===o&&a.TH&&(a.TC=-1);i||"archive"===d.view||(0===o||(2===o||1===o&&c)&&f===zmail.folId.sId==(a.FD===zmail.folId.sId)&&f===zmail.folId.dId==(a.FD===zmail.folId.dId)?0!==o&&a.TH&&!h?$.when(W(a,d)).then(function(){var b=!0;"unread"===d.view&&1===a.TS&&(b=!1),b&&zmList.addMailsToListing(a,f),zmCache.updateObj({mode:"insert",msgId:a.M,rt:a.R,folId:f}),zmPrev.updatePvNtforNewMails()}):(zmList.addMailsToListing(a,f),h||(zmCache.updateObj({mode:"insert",msgId:a.M,rt:a.R,folId:e}),""===d.fId&&zmCache.updateObj({mode:"insert",msgId:a.M,rt:a.R,folId:f})),zmPrev.updatePvNtforNewMails()):V(a,d,o,c)),m||(i?k=zmPreviewTemplate.getMissingMailList(a.T,"P"):j&&(k=zmPreviewTemplate.getMissingMailList(a.T,"T"))),i&&(m?zmPreviewTemplate.showNotifBand({targetElem:zmsuite.getCenter("zm_Container")[1].getNodes()[1].$el,thdId:a.T,opentype:0}):$.publish("/mail/updatemailview",[{list:k,opentype:0}]),"archive"===d.view||a.FD===zmail.folId.sId&&(a.FD!==zmail.folId.sId||zmList.excludeSent)||2!==o&&(1!==o||!c&&a.FD!==zmail.folId.dId)||(a.FD!==zmail.folId.dId&&($(zmail.mailCenter.listElem).find("#thd"+g).is(":visible")||$(zmail.mailCenter.listElem).find("#thd"+g).remove(),zmail.mailObj[g]?(zmail.mailObj[g].TC+=1,a.TC=zmail.mailObj[g].TC):a.TC+=1,0===a.TS&&l&&a.FD!==zmail.folId.dId&&$("#"+l).addClass("zm_urd")),U(l,a))),j&&(m?zmPreviewTemplate.showNotifBand({targetElem:zmsuite.getCenter(n)[1].getNodes()[1].$el,thdId:a.T,opentype:2}):$.publish("/mail/updatemailview",[{list:k,opentype:2}]))},addMailsToListing:function(a,b){var c;if(c=$(zmail.mailCenter.listElem),zmail.mailOpt.isshowSummary||(a.SM=""),!c.closest(".SC_streams").length){I(c)&&zmsuite.getCenter("zm_Container")[0].getNodes()[0].$el.find(".msi-uncheck").removeClass().addClass("msi-uncheck msi-partcheck");var d=$(zmInit.constructMailRow(b,[a.M]));"h"===zmail.viewInfo[0].DT&&d.find(".zmDate").hide(),"h"===zmail.viewInfo[0].SZ&&d.find(".zmSze").hide(),c.find("#nomails").length?c.html(d):zmail.listObj[b]&&zmail.listObj[b].sortOrder?0===zmail.listObj[b].showNextPage&&c.append(d):c.prepend(d),zmInit.listingBand.SpamTrashBand.setBand()}},bindAction:function(a,b){if(a){var c,d,e,f,g,h,i,j,k,l=a.action||a;switch(l){case"actionmenu":break;case"folread":zmfolAction.markAsReadFolder(),zmUtil.hideMenu(!0);break;case"unread":zmmailAct.applyActions(l,"dropdown"),zmUtil.hideMenu(!0);break;case"read":zmmailAct.applyActions(l,"dropdown"),zmUtil.hideMenu(!0);break;case"flag":case"label":zmmailAct.applyActions(l,"click",a),zmUtil.hideMenu(!0);break;case"move":zmmailAct.doActions(l,"drop",a);break;case"spam":a.from&&"ctxtMenu"===a.from?(h=zmInit.rclkId,i=N):(h="spam",i=zmmailAct.doActions),i(h);break;case"delete":a.from&&"ctxtMenu"===a.from?(h=zmInit.rclkId,i=M):(h="delete",i=zmmailAct.doActions),i(h);break;case"notspam":a.from&&"ctxtMenu"===a.from?(h=zmInit.rclkId,i=O):(h="notspam",i=zmmailAct.doActions),i(h);break;case"archive":zmmailAct.doActions("archive"),zmUtil.hideMenu();break;case"unarchive":zmmailAct.doActions("unarchive"),zmUtil.hideMenu();break;case"views":zmList.show("zm_viewLst",b);break;case"editrow":zmList.show("zm_shdLst",b);break;case"listview":zmUtil.hideMenu(),ba(a);break;case"clsPrev":if("zm_Container"!==zmTab.currentTab&&zmTab.currentTab.indexOf("zm_srch")){var m=zmsuite.getCenterOuter().$el.data("data-detail");"unread"===m.view&&zmList.remReadMail(),$.when(zmPrev.cmpClose()).then(function(a){a&&zmsuite.closeWorkspace(zmTab.currentTab)})}else zmPrev.clsPreview();break;case"editHeader":zmList.changeViewColumns(a.column),zmUtil.hideMenu();break;case"zmLTMenu_Nf":zmUtil.hideMenu(),zmfolAction.showCreateFolderPopUp({mode:"new",type:"subfolder"});break;case"zmLTMenu_Rf":zmUtil.hideMenu(),zmfolAction.showCreateFolderPopUp({mode:"rename"});break;case"zmLTMenu_Fr":zmList.mrkReadContextMenu(),zmUtil.hideMenu(!0);break;case"zmLTMenu_Unshare":zmList.unshareContextMenu(a),zmUtil.hideMenu(!0);break;case"zmLTMenu_Ef":zmfolAction.rgtFolId===zmail.folId.oId?zmList.sendOutbox("sendI"):zmList.emptyFolContextMenu();break;case"zmLTMenu_Df":zmList.delFolContextMenu();break;case"zmLTMenu_El":zmUtil.hideMenu(),zmlab.showCreateTagPopUp({mode:"rename"});break;case"zmLTMenu_Dl":zmList.delLabContextMenu();break;case"zmLTMenu_Sf":zmList.shareFolContextMenu("fol"),zmUtil.hideMenu(!0);break;case"zmLTMenu_Sl":zmList.shareFolContextMenu("tag"),zmUtil.hideMenu(!0);break;case"zmLTMenu_Af":zmList.archiveFolderContextMenu(),zmUtil.hideMenu(!0);break;case"zmLTMenu_Dss":zmList.delSavedSrchContextMenu(),zmUtil.hideMenu();break;case"zmLTMenu_Rss":zmList.rnSSrchContextMenu();break;case"listsender":s("sender");break;case"listrecipient":s("recipient");break;case"listsubject":s("subject");break;case"openpreview":c=Y(zmInit.rclkId),c.opentype=a.opentype;var n=zmPrev.prevDetails().msgId;n?$.when(zmPrev.cmpClose()).then(function(a){a&&zmList.getMailData(c)}):zmList.getMailData(c),zmUtil.hideMenu();break;case"opentab":c=Y(zmInit.rclkId),c.opentype=a.opentype,zmsuite.isMaxLimitReached()||zmList.getMailData(c),zmUtil.hideMenu();break;case"openwindow":H(a,b),zmUtil.hideMenu();break;case"viewfullthd":var o=a.from||$(b).attr("data-from");"header"===o&&(d=$(b).closest(".SC_pv"),j=d.attr("data-mid"),j&&zmList.getMailData({msgId:j,type:"lt",opentype:2,src:"conversation"}));break;case"reply":a.from&&"ctxtMenu"===a.from&&(d=zmsuite.getCenter()[1].$el,j=zmInit.rclkId.indexOf("t")?zmInit.rclkId:zmInit.rclkId.substring(1),k={mode:"reply",msgId:j,prevElem:d},zmUtil.invokeComposer(k)),zmUtil.hideMenu();break;case"replyall":a.from&&"ctxtMenu"===a.from&&(d=zmsuite.getCenter()[1].$el,j=zmInit.rclkId.indexOf("t")?zmInit.rclkId:zmInit.rclkId.substring(1),k={mode:"replyall",msgId:j,prevElem:d},zmUtil.invokeComposer(k)),zmUtil.hideMenu();break;case"forward":a.from&&"ctxtMenu"===a.from?(d=zmsuite.getCenter()[1].$el,j=zmInit.rclkId.indexOf("t")?zmInit.rclkId:zmInit.rclkId.substring(1),k={mode:"fwdi",msgId:j,prevElem:d}):k={mode:"fwdi"},"2"===zmail.collabVersion&&$.publish("/mail/forwardmail",{mailID:j,mode:"forward"}),zmUtil.invokeComposer(k),zmUtil.hideMenu();break;case"FwdAttach":var p=zmUtil.getSelectedMails();if(zmUtil.hideMenu(),p[1].length){var q=p[0].length+zmUtil.getTotalMailCountInThreads(p[1]);zmmailAct.confThreadAction("multipleforward",q,function(){zmUtil.invokeComposer({mode:"fwdme"})},zmInit.getListingDetObj())}else zmUtil.invokeComposer({mode:"fwdme"});break;case"select_all":case"select_none":case"select_unread":case"select_read":case"select_flag":case"select_label":case"select_attach":zmList.unchkAll(),_(a);break;case"view_all":case"view_unread":case"view_flag":case"view_label":case"view_attach":case"view_archive":ba(a);break;case"customize":var r,t=a.value;"date"===t?r="DT":"size"===t&&(r="SZ"),zmList.changeViewColumns(r),zmUtil.hideMenu();break;case"addTask":j=zmInit.rclkId.indexOf("t")?zmInit.rclkId:zmInit.rclkId.substring(1),e=zmail.mailObj[j],f=e.SB?_zm.unescapeTags(e.SB):"",g=e.SM?_zm.unescapeTags(e.SM):"",zmUtil.hideMenu(),zmUtil.loadTask({action:"addPopupTask",groupId:zmail.zuid,tasks:{SUMMARY:g,TITLE:f},addparams:{msgid:j,accid:zmail.accId,senderid:e.F}});break;case"addFilter":j=zmInit.rclkId.indexOf("t")?zmInit.rclkId:zmInit.rclkId.substring(1),zmUtil.hideMenu(),zmPreviewTemplate.createNewFilter({action:l,msgId:j});break;case"addNote":j=zmInit.rclkId.indexOf("t")?zmInit.rclkId:zmInit.rclkId.substring(1),e=zmail.mailObj[j],f=e.SB?_zm.unescapeTags(e.SB):"",g=e.SM,zmUtil.hideMenu(),zmUtil.loadNotes("popup",{desc:g,title:f,addparams:{msgid:j,accid:zmail.accId,senderid:e.F}});break;case"msi-prev":zmPreviewTemplate.loadPrevMail();break;case"msi-next":zmPreviewTemplate.loadNextMail();break;case"customize_view":zmInit.customizeDisplayDensity(a.value);var u={key:"_settMail",info:{type:a.value,action:"customize_view"}};zmCrosstab.renew("zm_mail",u),zmUtil.hideMenu();break;case"sweep":Ca();break;default:zmUtil.hideMenu()}}},updOutbox:function(a){zmInit.sendLoadOutbox("hide"),zmList.unchkAll(),zmUtil.sTopMenu({type:"l"});var b=a.res.split(",")[0];if(b>0)for(var c=0;c<b;c++)zmmailAct.updateCount({fId:zmail.folId.oId,mode:"dec"});var d=zmInit.getListingDetObj();"zm_Container"===zmTab.currentTab&&zmail.folId.oId===d.fId&&($(zmail.mailCenter.listElem).html(""),zmCache.clearListObj(),zmInit.setListingDetObj({}),zmInit.foldView({folId:zmail.folId.oId}))},sendOutbox:function(a){zmUtil.hideMenu(),zmInit.sendLoadOutbox("show"),a||(a="sendM");var b={aId:zmail.accId};if(b.mode=a,"sendM"===a){var c=zmUtil.getSelectedMails()[0];b.mId=c.join(",")}var d={mode:a};zmAjq.XHR({u:zmail.conPath+"/cOpt.do",t:"POST",fn:zmList.updOutbox,p:b,csr:"s",ep:d})},getElemObj:z,consPreview:E,getListingElemObj:A,markFolderAsReadHandler:function(a,b){b=b||[];var c,d,e,f,g,h,i,j=0!==b.length,k=zmInit.getListingDetObj(),l="unread"===k.view,m=!1,n=zmail.mailObj,o=[],p=[],q={action:"read"};if(j||(g=k.flag&&"flag"||k.view||k.label,c=zmail.listObj[g],b=c&&c.MO||[]),h=b.length){for(i=0;i<h;i++){if(d=n[b[i]],!j&&(d.TH||l&&d.FD===a)){m=!0;break}a===d.FD&&(d.TH?p.push(d.M):o.push(d.M))}m?(e="unread"===k.view?"zm_unread":"",g=k.label&&"label"||g,f=k.label||k.flag,zmCache.clearListObj(),zmInit.setListingDetObj({}),zmInit.foldView({folId:e,view:g,viewId:f,reInitialize:!0})):(0===zmUtil.getMLConversionValue()?(o=o.concat(p),q.mailId=o):(q.mailId=o,q.tmailId=p),zmmailAct.rapplyAction({result:"success"},q))}},markFolderAsArchived:function(a,b){if(a){var c;zmUtil.isFolderId(a)&&(c=zmList.getRowInfo(a,"zmlTreeH","info")),c&&(b?c.IA=parseInt(b):c.IA=1)}},showMailListing:function(a,b){b=b||{};var c,d,e,f="",g=!1,h={unread:"zm_unread",all:"zm_all",flag:"zm_flag"},i=b&&!(b.toSelFol===!1);a&&!$.isEmptyObject(a)?(c=a,f=c.fId||c.folId||"",d=c.view||"",e=c.viewId||""):(c=zmInit.getListingDetObj(),d=c.flag&&"flag"||c.label&&"label"||c.view||c.attach&&"attach",f=c.fId||c.folId||h[d]||"",e=c.label||c.flag),i?f?zmUtil.isViewId(f)?(g=!0,zmail.mailLeft.selRow(f,"zmlviewH",!0)):zmUtil.isSharedFolder(f)?(g=!0,zmail.mailLeft.selRow(f,"zmlSTreeH",!0)):zmUtil.isFolderId(f)?(g=!0,zmail.mailLeft.selRow(f,"zmlTreeH",!0)):zmUtil.isLabelId(f)&&(g=!0,zmail.mailLeft.selRow(f,"zmllabelH",!0)):e&&zmUtil.isLabelId(e)&&(g=!0,zmail.mailLeft.selRow(e,"zmllabelH",!0)):g=!0,g?($(zmail.mailCenter.listElem).html(""),zmCache.clearListObj(!0),zmInit.setListingDetObj({}),b.retainPreview?zmInit.foldView({folId:f,view:d,viewId:e,reInitialize:!0,isLoadingNotNeeded:!0,retainPreview:!0,sortOrder:b.sortAscending}):zmInit.foldView({folId:f,view:d,viewId:e,reInitialize:!0,sortOrder:b.sortAscending,hashDeffObj:b.mlDefObj}),zmInit.updateHeaderBand()):b.mlDefObj&&b.mlDefObj.resolve()},getViewBasedMsgList:function(a,b,c){var d=[],e=zmUtil.getMLConversionValue();return a&&(b||(b=zmInit.getListingDetObj()),b.fId===zmail.folId.spId&&2===e?e=1:b.fId!==zmail.folId.sId&&b.fId!==zmail.folId.tId||(e=0),1===e?d=zmList.getMailSummaryList(b,a):0!==e&&(d=zmList.getListForAllMailsView(b,a))),zmail.convSortOrder&&c?d.reverse():d},setScrollUnreadView:function(a,b){var c=a.find("#"+b);$(c).length&&$(a).length&&a.scrollTop($(a).scrollTop()+$(c).offset().top-$(a).offset().top)},isMailListedInApp:function(a){var b,c=zmUtil.getFolId(),d=zmail.listObj[c]&&zmail.listObj[c].MO||[];return b=d.indexOf(a),b!==-1},isMailListedInSearch:function(a){if(zmSearchUtil.isWorkspaceAvailable()){var b,c=zmSearchUtil.getSearchList();if(b=c.indexOf(a),b!==-1)return!0}return!1},setMailSelection:function(a,b,c){var d,e,f,g,h,i=!1;if(f=Boolean(zmail.mailObj[a].TH),zmsuite.getWorkSpace(zmTab.currentTab)[1]&&(e=zmsuite.getWorkSpace(zmTab.currentTab)[1].$el),d=f&&"lt"===b?c.find("#t"+a):c.find("#"+a),g=Boolean(d&&d.length&&d.is(":visible")),!g&&e&&e.attr("data-mid")&&(d=c.find("#"+e.attr("data-mid"))),d&&d.length&&(g&&d.is(":visible")?(c.find("div.zmL").removeClass("zmSLst"),d.addClass("zmSLst")):d.parent().hasClass("zmTV")&&(c.find("div.zmL").removeClass("zmSLst"),d.parent().prev().addClass("zmSLst"))),g&&e)e.attr("data-mid",a),"content"===b&&f&&e.hasClass("tmail")&&e.attr("data-ty","th"),"lt"===b&&e.attr("data-ty","lt"),zmList.doThreadPath(d,"add"),i=!0;else if(d&&d.length&&d.parent().hasClass("zmTV")&&e){var j=d.parent().prev().attr("id");j="t"===j.charAt(0)?j.substr(1):j,e.attr("data-mid",j),e.attr("data-ty","lt"),zmList.doThreadPath(d,"remove"),i=!0}i&&"zmStreamsApp"!==zmTab.currentTab&&"zm_srch1"!==zmTab.currentTab&&(b="content"===b?"th":b,h=zmList.getListingElemObj({msgId:a,type:b,opentype:0}),"lt"===b&&zmail.mailObj[a].TH&&a.indexOf("t")===-1&&(a="t"+a),zmPrev.PvNt(a,b,0,zmTab.currentTab,h))},clearcpvReq:function(){a=void 0},changeListingView:function(a,b,c){if(b||(b=zmUtil.getFolId()),zmUtil.hasFolSpecConversation(b)){var d=function(c){"success"===c.status&&(zmfolAction.updateCV(b,a),zmList.showMailListing())},e=function(a){var b=a.msg;b&&_zm.succErrMsg("e",b)},f=function(){var c={accId:zmail.accId,mode:"updateConversationView",folId:b,convView:a};zmAjq.XHR({u:zmail.conPath+"/folAction.do",t:"POST",fn:d,onerror:e,p:c})};c?d({status:"success"}):f()}},setListingType:function(a,b){var c={accId:zmail.accId,folderSpec:a,mode:"setlisttype"},d=function(b){"success"===b.result&&(zmail.listObj={},zmail.mailObj={},zmail.folviewThread=a,zmUtil.closeMailTabs(),zmfolAction.updateFoldersCV(a),zmList.showMailListing())};return b?void d({result:"success"}):zmAjq.XHR({u:zmail.conPath+"/listOpt.do",t:"POST",fn:d,p:c})},setConversationOrder:function(a){a=Number(a);var b={accId:zmail.accId,isAscending:a,mode:"setsortorder"},d=function(a){"success"!==a.result&&_zm.succErrMsg("e",c.global.errmsg)};return zmAjq.XHR({u:zmail.conPath+"/listOpt.do",t:"POST",fn:d,p:b}).then(function(){zmUtil.succErrMsg("s","Conversation order changed successfully. Kindly refresh the browser.",{hideAfter:3e3}),zmail.convSortOrder=a})},showHideConvIcon:function(a){if("zm_srch1"!==zmTab.currentTab){a||(a=zmUtil.getFolId());var b,c=zmsuite.getCenter("zm_Container")[0].getNodes()[0];c.showGroup("folSpecConv"),zmUtil.hasFolSpecConversation(a)?(b=zmfolAction.getFolCV(a),void 0!==b&&(b?(c.$el.find(".msi-thread").closest("li").show(),c.$el.find(".msi-conversation").closest("li").hide()):(c.$el.find(".msi-thread").closest("li").hide(),c.$el.find(".msi-conversation").closest("li").show()))):c.hideGroup("folSpecConv")}},changeLisingSortOrder:function(a){var b=zmUtil.getFolId();zmail.listObj[b]&&zmList.showMailListing({},{retainPreview:!1,sortAscending:a})},showBulkActionBand:function(){var a=!1,b=200,c=!0,d=parseInt(zmail.mailOpt.range);if("zm_Container"===zmTab.currentTab){var f=zmUtil.getFolId();a=zmail.listObj[f].showNextPage;var h=zmUtil.getSelectedMails();h[0].length<=b&&h[1].length<=b&&(c=!1)}else"zm_srch1"===zmTab.currentTab&&(a=zmSearchUtil.hasNextPage(),d=zmSearchUtil.getPageSize());var i,j,k=zmUtil.getCheckedMailCount();k>b&&c?(i=zmText.applyArgs(g.bulkaction.common.selexceed,{n:b}),j="clearAndSelect",zmInit.listingBand.createBulkActionBand(i,j)):a&&k<=b&&k>=d?(i=zmText.applyArgs(e.common.multiplemail,{count:k}),j="selectFolder",zmInit.listingBand.createBulkActionBand(i,j)):k<d&&zmInit.listingBand.removeBulkActionBand()},showThreadTree:function(){var a,b,c=zmTab.currentTab;if("zm_Container"===c||"zm_srch1"===c){var d=zmUtil.getSelectedMails();if(b=d[1][0],!b){var e=d[0][0];e&&zmail.mailObj[e]&&zmail.mailObj[e].TH&&(b=e)}if(b){a=zmList.getListingElemObj({msgId:b,type:"lt",tabId:c,opentype:0});var f=a.rowElem||[];f.length&&f.hasClass("zmTLst")||(zmList.hideThreadTree(),zmList.showHideThread(f,a))}}},hideThreadTree:function(){var a,b=zmTab.currentTab;"zm_Container"!==b&&"zm_srch1"!==b||(a=z(b),m(a),l(a))},addTaskIndicator:function(a){var b,c,d,e,f,g,h=["zm_Container","zm_srch1"],i=h.length;if(a.data.tasks.email&&a.data.tasks.email.msgid){for(b=a.data.tasks.email.msgid,zmail.mailObj[b]&&zmCache.updateObj({mode:"upd",msgId:b,key:"MA",val:32|zmail.mailObj[b].MA}),f=0;f<i;f++)g=h[f],zmsuite.isWorkspaceAvailable(g)&&(d=zmCenterListing.mailObjectAPI.getViewObject(b,g),d?e=d.$element:(c=zmsuite.getCenter(g)[0].getNodes()[2].$el,e=c.find("#"+b)),e.length&&!e.find(".SC_mdata").length&&e.find(".zmDtl").prepend('<div class="SC_mdata"></div>'));zmPreviewTemplate.updateTaskComponent(b)}},addNoteIndicator:function(a){var b,c,d,e,f,g,h=["zm_Container","zm_srch1"],i=h.length;if(a.email&&a.email.accid&&a.email.msgid){for(b=a.email.msgid,zmail.mailObj[b]&&zmCache.updateObj({mode:"upd",msgId:b,key:"MA",val:64|zmail.mailObj[b].MA}),f=0;f<i;f++)g=h[f],zmsuite.isWorkspaceAvailable(g)&&(d=zmCenterListing.mailObjectAPI.getViewObject(b,g),d?e=d.$element:(c=zmsuite.getCenter(g)[0].getNodes()[2].$el,e=c.find("#"+b)),e.length&&!e.find(".SC_mdata").length&&e.find(".zmDtl").prepend('<div class="SC_mdata"></div>'));zmPreviewTemplate.updateNoteComponent(b)}},updateAttachmentCache:oa,isListingChecked:J,isAllListingChecked:I,getDupThdRowId:S,sendMailDataReq:y,showMailPreview:ja,loadUnreadMails:G,loadAttachviewer:aa,getCachedAttachmentData:D};return function(){$.subscribe("zmailReconnect",function(){if(window.console.log("Updating Listing View, in respond to zmailReconnect - "+new Date),zmInit.getFolderTreeCount(),zmInit.getAccountInfo(),"zmStreamTree"!==zmail.mailLeft.selLayerId){var a;if(zmail.trialUsers&&"zmStreamsApp"===zmTab.currentTab&&(a=!0),zmail.listDetails&&"2"===zmail.listDetails.attach)zmList.loadAttachviewer();else{var b=zmail.listObj[zmUtil.getFolId()]?zmail.listObj[zmUtil.getFolId()].sortOrder:"";zmList.showMailListing({},{retainPreview:!1,sortAscending:b,mlDefObj:void 0,toSelFol:a})}}})}(),zmail.postJsDeffered.done(function(){zmail.mailAttachments={},zmail.attachmentContainer=new zmail.Container({store:zmail.mailAttachments,containerSize:200,evictCount:20,idName:"id",considerAsHitOnRetrieval:!0})}),Ea}(),window.zmPrev=function(){"use strict";var a=zmText.get("mail"),b=a.listing,c=a.preview,d=function(a,b){var c,d=!0;b=b||zmInit.getListingDetObj(),a.indexOf("t")!==-1?(c=a.substring(1,a.length),0===zmList.getMailSummaryList(b,zmail.mailObj[c].T).length&&(d=!1)):(c=a,d=!1),("unread"===b.view&&1===zmail.mailObj[c].S||b.flag&&("-1"===b.flag&&0===zmail.mailObj[c].NFG||"-1"!==b.flag&&zmail.mailObj[c].NFG!==b.flag))&&(d||zmList.remReadMail(),zmList.setEmptyListing())},e={prevDetails:function(a){a=a||zmTab.currentTab;var b="",c="";return zmsuite.isWorkspaceAvailable(a)&&zmsuite.getCenter(a)[1]&&(b=zmsuite.getCenter(a)[1].$el.attr("data-mid")||"",c=zmsuite.getCenter(a)[1].$el.attr("data-ty")||""),{msgId:b,type:c}},isPrevOpen:function(a){return a=a||zmTab.currentTab,zmsuite.getCenter(a)[1].$el.hasClass("shw")},posAView:function(a){var b=$("#zmC"+a+" div.zmPAtt");b.is(":visible")&&b[0].scrollIntoView()},PvNt:function(a,b,c,d,e){var f,g,h,i,j,k,l;if(f=e.listArr||[],j=zmUtil.getFolId(),a.indexOf("t")||(a=a.substring(1)),f.length&&(i=$.inArray(a,f),g=f[i-1],h=f[i+1]),g||"th"===b&&(k=zmail.mailObj[a]||{},
k.TH&&zmail.listObj[j]&&(l=zmList.getDupThdRowId(a,j),l&&(f=zmail.listObj[j].MO,f.length&&(i=f.indexOf(l),g=f[i-1])))),h||"th"===b&&(k=zmail.mailObj[a]||{},k.TH&&zmail.listObj[j]&&(l=zmList.getDupThdRowId(a,j),l&&(i=f.indexOf(l),h=f[i+1]))),g||h?g?h?zmUtil.enableNavigation(d,"both"):zmUtil.disableNavigation(d,"next"):zmUtil.disableNavigation(d,"prev"):zmUtil.disableNavigation(d,"both"),2===c){var m=function(a){return function(){a&&zmUtil.disableNavigation(a,"both"),$.unsubscribe("mail/listing/viewchanged",m)}}(d);$.subscribe("mail/listing/viewchanged",m)}},cmpClose:function(a){a=a||zmTab.currentTab;var b=$.Deferred();if(zmsuite.getCenter(a)[1]){var c=zmsuite.getCenter(a)[1].getNodes()[1].$el;zmPreviewTemplate.unsubscribeNotesTasks(c);var d=zmPrev.prevDetails(a).msgId,e="";if(d&&zmail.mailObj[d]&&(e=zmail.mailObj[d].T||"",$.publish("mail/preview/unload",{prevElem:c,msgId:d,thdId:e})),"undefined"!=typeof zmComp){var f=zmsuite.getCenter(a)[1].getNodes()[1].$el,g=[],h=f.find(".zm_cmp");h.each(function(){var a=$(this).attr("id"),b={};a&&(b=a.split("_"),g.push({cmpId:b[0],msgId:b[1]}))}),g.length?zmComp.saveReply({deferObj:b,cmpList:g}):b.resolve(!0)}else b.resolve(!0)}else b.resolve(!0);return b},composeReply:function(a,b){var d=zmsuite.getCenter()[1].$el,e=b.M;a=$.extend(a,zmUtil.getCmpViewType()),zmUtil.isInlineCompose()?b&&b.DMID?(a.prevDOM=d.find("#zmCon"+a.viewType+b.DMID),zmPreviewTemplate.loadInlineCompose(e,a.prevDOM,a.mode)):zmUtil.getMailContent(e).done(function(b){a.prevElem=d,a.msgId=e,zmail.prevMails[e]&&(a.draftCont=b),zmUtil.invokeComposer(a)}).fail(function(){_zm.succErrMsg(c.inlinecompose.error)}):(a.prevElem=d,a.msgId=e,zmUtil.invokeComposer(a))},clsPreview:function(a){$.when(zmPrev.cmpClose()).then(function(b){if(b){var c,d,e,f;if(a=a||zmTab.currentTab,zmPrev.prevDetails(a).msgId&&(a.indexOf("zm_tab")===-1&&(zmUtil.sTopMenu({type:"l",isClsPrev:!0}),zmUtil.hideMenu()),zmUrlAct.update({from:"zmCenter",remove:!0}),zmRestore.saveState("preview",{p:""},{})),"list"===a?(c=zmPrev.prevDetails("zm_Container").msgId,e=!0,f=zmList.getElemObj("zm_Container")):c=zmPrev.prevDetails().msgId,zmUtil.setInlineCmpScope(!1),f=f||zmList.getElemObj(a),f.rowElem=$(f.listElem).find(".zmSLst"),$(f.prevElem).attr("data-mid",""),$(f.prevElem).attr("data-ty",""),$(f.prevElem).removeClass("SC_notr"),f.mainElem.removeClass("SC_sw"),zmList.listingFocused=!0,f.rowElem.length&&f.rowElem.removeClass("zmSLst"),d="zm_Container"===a||"list"===a?zmInit.getListingDetObj():zmsuite.getCenterOuter().$el.data("data-detail"),c&&zmail.mailObj[c]&&!zmail.mailObj[c].streams){var g;g=d&&d.fId&&zmUtil.isSharedFolder(d.fId)?d.fId:zmail.mailObj[c].FD,(zmUtil.isSharedFolder(g)||"-1"!==zmList.getRowInfo(g,"zmlTreeH","info").SH)&&zmail.prevMails[c]&&zmail.mailContainer.removeObject(c)}d&&"unread"===d.view&&c&&(e||zmList.remReadMail(),(""===d.fId&&0===zmInit.getUnreadViewCount()||""!==d.fId&&!zmUtil.isSharedFolder(d.fId)&&0===zmail.folCount[d.fId].c)&&zmList.setEmptyListing()),f.rowElem.length&&zmList.doThreadPath(f.rowElem,"remove"),a.indexOf("zm_srch")?zmsuite.getCenter("zm_Container")[1].close():zmsuite.getCenter(a)[1].close(),$.publish("/mail/previewclosed",{})}})},updatePrevOnDeletion:function(a,b){var c,d,e,f,g,h;b=b||"zm_Container",a.indexOf("t")||(a=a.substring(1)),"zm_Container"===b?(e=zmInit.getListingDetObj(),c=zmUtil.getFolId(),h=$(zmail.mailCenter.listElem),"th"===h.find("#"+a).data("ty")?g=zmList.getViewBasedMsgList(zmail.mailObj[a].T,e):zmail.listObj[c]&&(g=zmail.listObj[c].MO)):"zm_srch1"===b&&(e=zmsuite.getCenterOuter(b).$el.data("data-detail"),c=e.view,h=zmsuite.getCenter(b)[0].getNodes()[2].$el,g="th"===h.find("#"+a).data("ty")?zmList.getListForAllMailsView(zmail.mailObj[a].T,e):zmSearchUtil.getSearchList()),d=$.inArray(a,g),d!==-1&&(f=g[d+1],f||(f=g[d-1])),f&&b===zmTab.currentTab?(zmail.mailObj[f].TH&&0!==zmUtil.getMLConversionValue()&&"zm_srch1"!==b&&(f="t"+f),$.when(zmPrev.cmpClose(b)).then(function(a){a&&zmList.getMailData({msgId:f,type:"lt",opentype:0,tabId:b})})):zmPrev.clsPreview(b)},setCountinPreview:function(a){var c,d,e,f,g=zmPrev.prevDetails(),h=g.msgId;a.rowElem&&a.rowElem.length||($("#"+h).length?a.rowElem=$(a.listElem).find("#"+h):a.rowElem=$(a.listElem).find("#t"+h));var i,j=a.rowElem;if(j.removeClass("zmSLst"),c=$(a.prevElem),c.find(".SC_Popn").length&&c.find(".SC_Popn").remove(),d=zmUtil.getCheckedMailCount(),e=$("<div/>"),e.addClass("SC_pct SC_Popn"),1===d)e.text(b.common.singlemail);else{var k=b.common.multiplemail,l=zmText.applyArgs(k,{count:d});e.text(l)}f=a.mainElem.height()-55,e.height(f),i=c.find(".SC_frt").eq(0).find("ul"),i.eq(0).hide(),i.eq(1).hide(),c.find(".SC_pct").hide(),c.find(".zm_shwconv").parent().hide(),c.find(".SCS_postWra").hide(),zmsuite.getCenter()[1].getNodes()[1].$el.append(e),c.find(".SC_phd").hide(),c.find(".zmQry").hide(),zmUtil.sTopMenu({type:"l"}),zmList.doThreadPath(j,"remove")},removeCountinPreview:function(a){var c,d,e,f=$(a.prevElem);if(c=zmPrev.prevDetails(),d=c.msgId,e=zmUtil.getCheckedMailCount(),e>0)if(1===e)f.find(".SC_Popn").text(b.common.singlemail);else{var g=b.common.multiplemail,h=zmText.applyArgs(g,{count:e});f.find(".SC_Popn").text(h)}else if(f.find(".SC_Popn").remove(),f.find(".SC_pct").show(),f.find(".zm_shwconv").parent().show(),f.find(".SCS_postWra").show(),f.find(".SC_frt").eq(0).find("ul").show(),d){f.find(".SC_phd").show();var i;i="zm_srch1"===zmTab.currentTab?0:zmUtil.getMLConversionValue(),"lt"===c.type&&1===zmail.mailObj[d].TH&&0!==i?a.rowElem=$(a.listElem).find("#t"+d):a.rowElem=$(a.listElem).find("#"+d),a.rowElem.addClass("zmSLst")}},toggleMailContentViewMode:function(a,b,c){var d,e,f,g=$(a),h=g.attr("data-mid"),i=g.attr("id"),j=g.next(),k=!1;if(c=c||zmTab.currentTab,i.indexOf("zmHdrT")||(b=2),3===b?(d={contElem:$(a).closest(".SC_pct"),hdrElem:$(a),viewDetails:{view:"notification"}},d.prevElem=d.contElem.parent(),e=[]):(d=zmList.getElemObj(c),e=d.listElem),zmList.setMailSelection(h,"content",$(e)),0===b){var l=zmsuite.getWorkSpace(c)[1].$el,m=l.find(".SC_ptit").find(".SC_phd"),n=zmPreviewTemplate.getSubjectToPreview(zmail.mailObj[h].SB);m.html(n),!zmail.mailObj[h].TH||(0!==zmUtil.getMLConversionValue()&&zmail.mailLeft.selId!==zmail.folId.sId||"zm_Container"!==zmTab.currentTab)&&"zm_srch1"!==zmTab.currentTab||m.append('<i class="msi-thread" data-event="viewfullthd" data-from="header"></i>'),zmPrev.removeCountinPreview(d),zmPreviewTemplate.setPreviewHeaderHeight(d)}0===j.length&&(k=!0,zmail.mailObj[h].FD!==zmail.folId.dId&&(f=$("<div />"),f.attr("id","zmCon"+i.substr(5)),setTimeout(function(){f.children().length||zmComponent.loadingBand({container:f[0],type:"pagination"})},100),g.after(f)),zmList.getMailData({msgId:h,type:"content",from:g,opentype:b,tabId:c},d)),zmail.mailObj[h].T&&!$("t"+h).length&&$(e).find(".zmL").removeClass("SC_check"),k||zmPreviewTemplate.applyHeaderState(g),0===b&&g.parent().hasClass("js-scrolltop")&&zmPreviewTemplate.alignMailTopToPreview(String(h))},setMailDOMContent:function(a,b){var c=zmPreviewTemplate.getTemplate("content",{data:a,prms:b});c=$(c);var d,e,f,g=b.opentype,h=b.msgId,i=b.tabId||zmTab.currentTab;"content"===b.type?(d=$(b.from),e=$(d.next()),e.html($(c).children().eq(1).html()),c=e,zmPreviewTemplate.applyHeaderState(d),"bulk_mail"!==b.load_action&&d.closest(".SC_pct").addClass("SC_Tfcs"),0===g&&(zmPrev.removeCountinPreview(zmList.getElemObj(i)),d.parent().hasClass("js-scrolltop")&&zmPreviewTemplate.alignMailTopToPreview(String(h)))):(f=c,b.parentElm?$(b.parentElm).append($(f)):zmsuite.getCenter(i)[1].getNodes()[1].push($(f))),3!==g&&zmail.mailObj[h]&&!zmUtil.isSharedFolder(zmail.mailObj[h].FD)&&(b.mailContElem=$(c),zmPreviewTemplate.showNotes(b),zmPreviewTemplate.showTasks(b),zmPreviewTemplate.showProjectsEntities(b)),zmUtil.addSelectMenu($(c).find(".zmPCon")[0]),zmUtil.applyLBDots(c.find("[id^=vfc]").parent())},changeFlag:function(a,b){var c=b.flag;zmPrev.flagMail(a,c),zmUtil.hideMenu()},flagMail:function(a,b){var c,d,e={};d=a.parents(".zmPHdr"),c=d.attr("data-mid"),e.msgId=[c],e.thd=[],e.fVal=b,zmmailAct.applyActions("flag","click",e)},consFlagContextMenu:function(a){var c,d,e;return c=a.target||a.srcElement,d=$(c),d.hasClass("zmflg")&&(e={clk:function(a,b){zmPrev.changeFlag(d,b)},conArr:[{htm:"<i class='zm_icn zmflg zm_fgB'></i>"+b.flagmenu.infoflag,data:{flag:"1"}},{htm:"<i class='zm_icn zmflg zm_fgR'></i>"+b.flagmenu.important,data:{flag:"2"}},{htm:"<i class='zm_icn zmflg zm_fgG'></i>"+b.flagmenu.followup,data:{flag:"3"}},{sep:!0},{htm:"<i class='zm_icn zmflg'></i>"+b.flagmenu.clearflag,data:{flag:"0"}}]},zmsuite.showContextMenu(a,e),zmUtil.stopEvents(a)),!1},getHeader:function(a){return zmPreviewTemplate.getTemplate("header",a)},decreasePreview:function(a){zmail.prevMails&&zmail.prevMails[a]&&zmail.prevMails[a].count>0&&(zmail.prevMails[a].count-=1)},updatePvNtforNewMails:function(){if(zmsuite.isWorkspaceAvailable("zm_Container")&&$(zmail.mailCenter.prevElem).hasClass("shw")){var a,b,c=zmPrev.prevDetails("zm_Container").msgId,d=zmUtil.getFolId();a=$("#"+c).length>0?c:"t"+c,b=zmList.getElemObj("zm_Container"),b.rowElem=$("#"+a),b.listArr=zmail.listObj[d]?zmail.listObj[d].MO:[],zmPrev.PvNt(a,"lt",0,"zm_Container",b)}},show:function(a,d){var e={},f="",g=!1;f=$(d).closest(".SC_pct").find(".zmPHdr").attr("data-mid");var h=$(d).closest("li"),i=[],j=zmail.mailObj[f];if(g=j.streams||zmPreviewTemplate.isMailOpenedViaStreams(d),zmail.folId.dId===j.FD)i=[{htm:c.contextmenu.editdraft,data:{action:"editdraft",msgId:f}},{htm:c.contextmenu.discarddraft,data:{action:"delete",msgId:f}}];else if(g)i=i.concat([{htm:c.contextmenu.editasnew,data:{action:"editasnew",msgId:f}},{sep:!0},{htm:c.contextmenu.save,data:{action:"save",msgId:f}},{htm:c.contextmenu.print,data:{action:"print",msgId:f}},{htm:c.contextmenu.showorg,data:{action:"original",msgId:f}},{htm:c.contextmenu.garbledmsg,data:{action:"garbled",msgId:f}}]),i=i.concat(zmStreamsApp.util.getDropdownMenu(f));else{if(j){var k=j.S?"markunread":"markread",l=j.S?b.maillistopt.markunread:b.maillistopt.markread;i=i.concat([{htm:l,data:{action:k,msgId:f}},{sep:!0}])}var m={allowed:void 0};"2"===zmail.collabVersion&&$.publish("/mail/collab/share/status",{mailID:f,config:m}),m.allowed===!0&&(j.TH?i.push({htm:c.contextmenu.sharethd,data:{action:"share",from:"preview",msgId:f}}):i.push({htm:c.contextmenu.share,data:{action:"share",from:"preview",msgId:f}}));var n=zmText.get("zmreminder").watch.setrem;if(zmList.isRMOBJ(f)&&(n=zmText.get("zmreminder").watch.updrem),i=i.concat([{htm:c.contextmenu.editasnew,data:{action:"editasnew",msgId:f}},{sep:!0}]),zmUtil.isZohoAccount(zmail.accId)&&(i=i.concat([{htm:n,data:{action:"addtowatch",msgId:f}},{sep:!0}])),i=i.concat([{htm:"<i class='msi-larrow'></i>"+c.contextmenu.addto,data:{action:"addtolist"},child:function(){return zmPreviewTemplate.getAddToMenu(f)}},{sep:!0},{htm:c.contextmenu.save,data:{action:"save",msgId:f}},{htm:c.contextmenu.print,data:{action:"print",msgId:f}},{htm:c.contextmenu.showorg,data:{action:"original",msgId:f}},{htm:c.contextmenu.garbledmsg,data:{action:"garbled",msgId:f}},{sep:!0}]),j){if(j.FD===zmail.folId.spId)i=i.concat([{htm:b.maillistopt.notspam,data:{action:"marknotspam",msgId:f}},{sep:!0}]);else{var o=j.AR;o||(i=i.concat([{htm:b.maillistopt.markspam,data:{action:"markspam",msgId:f}},{sep:!0}]))}i.push({htm:b.contextmenu["delete"],data:{action:"delete",msgId:f}})}}var p=[{htm:b.contextmenu.reply,data:{action:"reply",from:"prvInline",msgId:f,par:h}},{htm:b.contextmenu.replyall,data:{action:"replyall",from:"prvInline",msgId:f,par:h}},{htm:b.contextmenu.forward,data:{action:"forward",from:"prvInline",msgId:f,par:h}}],q=[{htm:c.attachmentmenu.downloadaszip,data:{action:"downloadall",msgId:f}}];e.align="pright",e.clk=function(a,b){zmPrev.bindAction(a,b,{sourceDOM:$(d).closest("li")})},"zm_prvRepLst"===a?(e.align="pleft",e.list=p,e.par=$(d).closest("li"),$(d).closest("b").addClass("SC_ddn")):"zm_dldLst"===a?(e.list=q,e.par=$(d).closest("li"),$(d).closest("b").addClass("SC_ddn")):"zm_preaLst"===a&&(e.list=i,e.par=$(d).closest("li"),$(d).closest("b").addClass("SC_ddn")),zmsuite.showMenu(e)},bindAction:function(a,b,c){c=c||{};var d=a.action,e=a.msgId,f={},g=a.from;e||(e=$(b).closest(".SC_pct").find(".zmPHdr").attr("data-mid")),"view"!==d&&zmUtil.hideMenu();var h="t",i=!1,j=null;g&&"prvInline"===g&&(h="p",i=!0,j=a.par);var k=zmail.mailObj[e];switch(k&&k.streams&&(f.groupId=k.groupId,f.streamsView=!0),d){case"reply":i?zmComp.chgReply("reply",h,e,j):(f.mode="reply",zmPrev.composeReply(f,k));break;case"replyall":i?zmComp.chgReply("replyall",h,e,j):(f.mode="replyall",zmPrev.composeReply(f,k));break;case"forward":"2"===zmail.collabVersion&&$.publish("/mail/forwardmail",{mailID:e,workspaceID:zmTab.currentTab,containerDOM:c.containerDOM,mode:"forward"}),i?zmComp.chgReply("fwdi",h,e,j):(f.mode="fwdi",zmPrev.composeReply(f,k));break;case"editasnew":i?zmComp.chgReply("eanew",h,e,j):(f.mode="eanew",f.msgId=e,zmUtil.invokeComposer(f));break;case"save":zmPreviewTemplate.saveHTMLFile({mId:e,mode:"msg"});break;case"print":zmPreviewTemplate.printMsg({mId:e});break;case"original":zmPreviewTemplate.showOrgMsg({mId:e});break;case"garbled":zmPreviewTemplate.garbMsg({mId:e});break;case"delete":zmList.bindAction({action:"delete"});break;case"downloadall":zmAttach.util.downloadAttach({e:e,et:1},"downloadall");break;case"markunread":zmmailAct.applyActions("unread","dropdown",{thd:[],msgId:[e]});break;case"markread":zmmailAct.applyActions("read","dropdown",{thd:[],msgId:[e]});break;case"markspam":zmmailAct.doActions("spam","dropdown",{thd:[],msgId:[e]});break;case"marknotspam":zmmailAct.doActions("notspam","dropdown",{thd:[],msgId:[e]});break;case"editdraft":var l=zmsuite.getCenter()[1].$el;f.mode="draft",f.msgId=e,f.prevElem=l,zmUtil.invokeComposer(f);break;case"addtotasks":var m=zmail.mailObj[e],n=m.SB?_zm.unescapeTags(m.SB):"",o=m.SM?_zm.unescapeTags(m.SM):"";zmUtil.loadTask({action:"addPopupTask",groupId:zmail.zuid,tasks:{SUMMARY:o,TITLE:n},addparams:{msgid:e,accid:zmail.accId,senderid:m.F}});break;case"addtowatch":zmWatch.showWatch({msgId:e,elem:b,openWatch:"preview_dropdown",loadType:"popup"}),_zm.stopEvents();break;case"addtonotes":m=zmail.mailObj[e],n=m.SB?_zm.unescapeTags(m.SB):"",o=m.SM?_zm.unescapeTags(m.SM):"";var p={addparams:{msgid:e,accid:zmail.defAccId,senderid:m.F}};zmUtil.loadNotes("popup",p);break;case"share":if("2"===zmail.collabVersion){var q=$(c.sourceDOM).parents(".zmPHdr").parents(".SC_pct").parent();$.publish("/mail/view/focuscommentbox",{mailID:e,containerDOM:$(q)[0]})}break;case"addfilter":zmPreviewTemplate.createNewFilter(a);break;case"viewfullthd":zmList.getMailData({msgId:e,type:"lt",opentype:2,src:"conversation"});break;case"copylink":case"watch":case"streamsdelete":case"streamsTimeline":a.fn&&a.fn();break;case"addsmartfilter":zmPreviewTemplate.classifySmartFilter(e,a.filtervalue,!0,$(b).closest(".SC_pct"));break;case"addtoprojects":zmUtil.loadProjects(function(){zmail.projectsInteg.util.addTaskBugFromMail(e),zmUtil.hideMenu()})}},updateListOnNavigation:d};return zmail.postJsDeffered.done(function(){zmail.mailContainer=new zmail.Container({store:zmail.prevMails,containerSize:200,evictCount:25,idName:"id",isObjectInUse:zmUtil.isMailContentInUse,considerAsHitOnRetrieval:!1})}),e}(),window.zmmailAct=function(){"use strict";var a,b=zmText.get("mail"),c=b.listing,d=b.actions,e=b.preview,f={},g={},h=[],i=zmail.folviewThread;h=["read","unread","flag","label","move","delete","archive","unarchive","spam","notspam","folderread","sweep"];var j=function(a,b,c){zmAjq.XHR({u:zmail.conPath+"/mA.do",t:"POST",fn:c,p:a,csr:"s",ep:b})},k=function(a,b){a="thd"===b?"zm_tabt"+zmail.mailObj[a].T:"zm_tab"+a,zmsuite.isWorkspaceAvailable(a)&&(zmsuite.closeWorkspace(a),zmsuite.showExistingApp(zmTab.currentTab))},l=function(a,b){void 0!==zmail.mailObj[a].TS&&zmCache.updateObj({mode:"upd",msgId:a,key:"TS",val:b})},m=function(a,b,c){var d,e,g,h,j=[];if(zmail.mailObj[a])switch(g=zmail.mailObj[a],e=g.T,d=$.extend({},f),d.label="",d.attach="",d.flag=b,2!==i&&d.fId===zmail.folId.spId||(d.fId=""),j=zmList.getMailSummaryList(d,e),h=j.length,c){case"0":1===h&&("1"===b?g.TI=!1:"2"===b?g.TM=!1:"3"===b&&(g.TF=!1));break;case"1":g.TI=!0,1===h&&("2"===b?g.TM=!1:"3"===b&&(g.TF=!1));break;case"2":g.TM=!0,1===h&&("1"===b?g.TI=!1:"3"===b&&(g.TF=!1));break;case"3":g.TF=!0,1===h&&("1"===b?g.TI=!1:"2"===b&&(g.TM=!1))}},n=function(a,b){if(zmail.mailObj[a])switch(zmCache.updateObj({mode:"upd",msgId:a,key:"NFG",val:b}),b){case"0":zmail.mailObj[a].TI=!1,zmail.mailObj[a].TF=!1,zmail.mailObj[a].TM=!1;break;case"1":zmail.mailObj[a].TI=!0,zmail.mailObj[a].TF=!1,zmail.mailObj[a].TM=!1;break;case"2":zmail.mailObj[a].TI=!1,zmail.mailObj[a].TF=!1,zmail.mailObj[a].TM=!0;break;case"3":zmail.mailObj[a].TI=!1,zmail.mailObj[a].TF=!0,zmail.mailObj[a].TM=!1}},o=function(a,b,c){if(zmail.mailObj[a]){zmail.mailObj[a].TTAGS=zmail.mailObj[a].TTAGS||[];var d,e,g,h=[],j=zmail.mailObj[a].TTAGS,k=zmail.mailObj[a].T;switch(c){case"add":for(d=0;d<b.length;d++)j.indexOf(b[d])===-1&&zmail.mailObj[a].TTAGS.push(b[d]);break;case"delete":for(d=0;d<b.length;d++)e=j.indexOf(b[d]),g=$.extend({},f),2!==i&&g.fId===zmail.folId.spId||(g.fId=""),g.label=b[d],h=zmList.getMailSummaryList(g,k),e!==-1&&h.length<=1&&j.splice(e,1);break;case"deleteall":zmail.mailObj[a].TTAGS=[]}}},p=function(a,b,c){var d=[];return zmail.listObj[b]?d=zmList.getViewBasedMsgList(b,c):d.push(a),d},q=function(a,b,c,d){var e,g,h,i,j=[];if(i=c.folId,"msg"===d){if(zmCache.updateObj({mode:"move",msgId:a,rFrom:b,addTo:i,type:d}),!zmail.mailObj[a].S&&!zmail.mailObj[a].AR){var k={action:"move",src:b,dest:i};zmmailAct.updateCount({fId:b,mode:"dec",actionObj:k}),zmmailAct.updateCount({fId:i,mode:"inc",actionObj:k})}}else if("thd"===d)for(zmCache.updateObj({mode:"move",msgId:a,rFrom:b,addTo:i,type:d}),e=zmail.mailObj[a].T,j=p(a,e,f),g=j.length,h=0;h<g;h++)zmCache.updateObj({mode:"upd",msgId:j[h],key:"FD",val:i})},r=function(a,b){var c,d,e,g=[],h=zmail.mailObj[a],i=h.FD;if("msg"===b)zmCache.updateObj({mode:"upd",msgId:a,key:"AR",val:1}),$.publish("folder/archived",[zmail.mailObj[a].FD]),zmail.mailObj[a].S||zmmailAct.updateCount({fId:i,mode:"dec"});else if("thd"===b)for(e=h.T,g=p(a,e,f),d=g.length,c=0;c<d;c++)zmCache.updateObj({mode:"upd",msgId:g[c],key:"AR",val:1}),$.publish("folder/archived",[zmail.mailObj[g[c]].FD]);(f.fId&&"archive"!==f.view||!f.fId&&"unread"===f.view)&&zmCache.updateCacheForViews(a)},s=function(a,b){var c,d,e,g=[],h=zmail.mailObj[a],i=h.FD;if("msg"===b)zmCache.updateObj({mode:"upd",msgId:a,key:"AR",val:0}),zmail.mailObj[a].S||zmmailAct.updateCount({fId:i,mode:"inc"});else if("thd"===b)for(e=h.T,g=p(a,e,f),d=g.length,c=0;c<d;c++)zmCache.updateObj({mode:"upd",msgId:g[c],key:"AR",val:0});f.fId&&"archive"===f.view&&zmCache.updateCacheForViews(a)},t=function(b,c){var d,e,h,i=0,j=[],k=[],m=[];if("msg"===c)zmail.mailObj[b].S||(d=zmail.mailObj[b].FD,zmCache.updateObj({mode:"upd",msgId:b,key:"S",val:1}),zmail.mailObj[b].AR||zmmailAct.updateCount({fId:d,mode:"dec"}),k.push(b));else if("thd"===c){h=zmail.mailObj[b].T;var n=$.extend({},f);for("unread"===f.view&&(""===f.fId?n.view="all":n.view=""),zmail.listObj[h]?j=zmList.getViewBasedMsgList(zmail.mailObj[b].T,n):j.push(b),e=j.length,i=0;i<e;i++)zmail.mailObj[j[i]].S||zmCache.updateObj({mode:"upd",msgId:j[i],key:"S",val:1});m.push(b),l(b,1)}if("unread"===f.view&&"mail_preview"!==a){var o=!1;if("zm_Container"!==zmTab.currentTab){var p=zmsuite.getCenterOuter().$el.data("row-detail")?zmsuite.getCenterOuter().$el.data("row-detail").rowId:"";p.indexOf("t")||(b=p.substring(1)),o=!0}else!zmail.mailObj[b].TH&&$(g.prevElem).attr("data-mid")!==b||zmail.mailObj[b].TH&&$(g.prevElem).attr("data-mid")&&zmail.mailObj[$(g.prevElem).attr("data-mid")].T!==zmail.mailObj[b].T?o=!0:"dropdown"===a&&(o=!0);o&&(!zmail.mailObj[b].TH||zmail.mailObj[b].TH&&zmInit.checkThreadRead(zmail.mailObj[b].T))&&zmCache.updateCacheForViews(b)}},u=function(a,b){var c,d,e,g=0,h=[];if("msg"===b)zmail.mailObj[a].S&&(c=zmail.mailObj[a].FD,zmCache.updateObj({mode:"upd",msgId:a,key:"S",val:0}),zmail.mailObj[a].AR||zmmailAct.updateCount({fId:c,mode:"inc"}));else if("thd"===b){e=zmail.mailObj[a].T;var i=$.extend({},f);for("unread"===f.view&&(""===f.fId?i.view="all":i.view=""),zmail.listObj[e]?h=zmList.getViewBasedMsgList(zmail.mailObj[a].T,i):h.push(a),d=h.length,g=0;g<d;g++)zmail.mailObj[h[g]].S&&zmCache.updateObj({mode:"upd",msgId:h[g],key:"S",val:0});l(a,0)}},v=function(a,b,c){var d,e,g,h=[];if("msg"===b){if(0===zmail.mailObj[a].S&&!zmail.mailObj[a].AR){var i={action:"delete",src:zmail.mailObj[a].FD,dest:zmail.folId.tId};zmmailAct.updateCount({fId:zmail.mailObj[a].FD,mode:"dec",actionObj:i}),0===c&&zmmailAct.updateCount({fId:zmail.folId.tId,mode:"inc",actionObj:i})}zmCache.updateObj({mode:"delete",msgId:a,folId:zmail.mailObj[a].FD,type:b})}else if("thd"===b&&(d=zmail.mailObj[a].T,zmail.listObj[d]?h=zmList.getViewBasedMsgList(d,f):h.push(a),g=h.length,0===c))for(e=0;e<g;e++)zmCache.updateObj({mode:"delete",msgId:h[e],folId:zmail.mailObj[h[e]].FD,type:b});!f.fId&&(f.view||f.flag||f.label)&&zmCache.updateCacheForViews(a)},w=function(a,b){var c=$("#"+a),d=a;if(b=b||"zm_Container",zmTab.currentTab.indexOf("zm_tabt"))if(zmail.mailObj[a]&&zmail.listObj[zmail.mailObj[a].T]){var e=zmCenterListing.mailObjectAPI.getViewParentOf("c"+d,b);e&&(c=e.$element)}else d=zmList.getDupThdRowId(a,zmUtil.getFolId()),d&&(c=$(zmail.mailCenter.listElem).find("#t"+d));else d=zmsuite.getCenterOuter().$el.data("row-detail").rowId,c=$(zmail.mailCenter.listElem).find("#"+d);return c},x=function(a,b){zmail.folCount[f.fId]&&zmail.mailObj[a].TH&&(f.fId!==b?($("#zmHdrP"+a).parent().addClass("SC_Tfdr"),$("#zmHdrT"+a).parent().addClass("SC_Tfdr")):($("#zmHdrP"+a).parent().removeClass("SC_Tfdr"),$("#zmHdrT"+a).parent().removeClass("SC_Tfdr")))},y=function(a,b){var c=zmInit.findFolName(b),d="";d=zmail.mailObj[a].AR?c+" ("+e.contentOptions.archived+")":c,$(zmail.mailCenter.listElem).find("#"+a+" .zmFdr span").html(c),$("#zmHdrP"+a+" .zm_folname").html(d),$("#zmHdrT"+a+" .zm_folname").html(d),$("#zmHdrS"+a+" .zm_folname").html(d);var f=$(zmail.mailCenter.listElem).find("#t"+a);f.length&&f.find(".zmFdr span").html(c)},z=function(a){var b=!1;return f.fId&&!f.flag&&!f.label||"all"===f.view?b=!0:0!==zmail.mailObj[a].NFG&&f.flag?"-1"!==f.flag&&f.flag!==zmail.mailObj[a].NFG||(b=!0):zmail.mailObj[a].TAG&&f.label&&("-1"!==f.label&&"-1"===$.inArray(f.label,zmail.mailObj[a].TAG)||(b=!0)),b},A=function(a,b){a.length<99?b.text(a.length+1):b.text("99+")},B=function(a,b){a.length<=100?b.text(a.length-1):b.text("99+")},C=function(a){var b=a.parent(".zmTV");b.prev().find(".zm_td").remove(),b.prev().removeClass("zmTLst"),b.remove()},D=function(){var a="";return a+='<div class="zm_td"><div class="zm_tlb"></div></div>'},E=function(a,b,c){var d,e=z(a),h=$("#"+a),i=zmList.getViewBasedMsgList(zmail.mailObj[a].T,f);if("zm_Container"!==zmTab.currentTab){if(i.length>1&&e){var j=$("#"+i[0]);d=j.parent().prev().find(".zmtCt"),f.fId===b?A(i,d):f.fId===c&&(B(i,d),"1"===d.text()&&C(j))}else if(1===i.length)if(f.fId===zmail.mailObj[a].FD){if(zmPrev.clsPreview(),$("#t"+i[0]).remove(),k("t"+zmail.mailObj[a].T),zmail.listObj[f.fId]){var l=zmail.listObj[f.fId];for(var m in l)l[m]===f.fId&&zmail.listObj[f.fId].MO.splice(m,1)}}else e&&(d=$("#t"+i[0]).find(".zmtCt"),d.text(parseInt(d.text())+1),"2"===d.text()&&d.before(D()));h.remove()}else if(h.length&&e){d=h.parent().prev().find(".zmtCt");var n=0;B(i,d),n=parseInt(d.text()),1===n?C(h):n<1&&(h.parent().prev().remove(),h.parent().remove(),$(g.prevElem).hasClass("shw")&&zmail.mailObj[a].T===zmail.mailObj[zmPrev.prevDetails().msgId].T&&zmPrev.clsPreview()),h.remove()}else if(zmPrev.prevDetails().msgId&&zmail.mailObj[a].T===zmail.mailObj[zmPrev.prevDetails().msgId].T)if(d=$(zmail.mailCenter.listElem).find(".zmSLst .zmtCt"),i.length>1&&e)f.fId===b?A(i,d):f.fId===c&&B(i,d);else if(i.length<=1)if(f.fId===zmail.mailObj[a].FD){if($(zmail.mailCenter.listElem).find(".zmSLst").remove(),zmPrev.clsPreview(),k("t"+zmail.mailObj[a].T),zmail.listObj[f.fId]){var o=zmail.listObj[f.fId];for(var p in o)o[p]===f.fId&&zmail.listObj[f.fId].MO.splice(p,1)}}else e&&(d.text(parseInt(d.text())+1),"2"===d.text()&&d.before(D()))},F=function(a,b){var c=$("#"+a),d=a,e=c.parent(".zmTV");if("msg"===b&&zmail.mailObj[a].T&&zmInit.checkThreadRead(zmail.mailObj[a].T)&&(c=w(a),c.length)){d=c[0].id,0===d.indexOf("t")&&(d=d.substring(1)),c.removeClass("zm_urd"),zmTab.currentTab.indexOf("zm_tabt")||"unread"!==f.view||(c.remove(),e=$("#thd"+d),e.remove());var g=zmUtil.getFolId();if(zmail.listObj[g]){var h=zmUtil.getFirstMsgId(zmail.mailObj[a].T,f);h&&(d=h)}l(d,1)}},G=function(a,b){var c,d=0,e=[],h=0;for(0===zmail.mailObj[a].TC&&(zmail.mailObj[a].TC=1),zmUtil.isFolderId(b)&&(zmail.mailObj[a].FD=b),c=zmList.constructThreadChildRow(a),e=zmList.getMailSummaryList(f,zmail.mailObj[a].T),h=0;h<e.length;h++){var i=zmail.mailObj[e[h]];if(i.R<zmail.mailObj[a].R){d=h;break}}$(g.listElem).find("#"+e[d]).before(c)},H=function(a,b){var c=$("#"+a),d=a;if("msg"===b&&zmail.mailObj[a].T&&!zmInit.checkThreadRead(zmail.mailObj[a].T)&&(c=w(a),c.length)){d=c[0].id,0===d.indexOf("t")&&(d=d.substring(1)),c.addClass("zm_urd");var e=zmUtil.getFolId();if(zmail.listObj[e]){var g=zmUtil.getFirstMsgId(zmail.mailObj[a].T,f);g&&(d=g)}l(d,0)}},I=function(a,b,c){if(!b.preAction){var d,e,h,j,l,m;if(zmail.mailObj[a].AR&&s(a,c),d=zmail.mailObj[a].FD,e=b.folId,"notifier"!==b.from||d!==e||zmUtil.getFolId()!==e){if("msg"===c){if(j=$(zmail.mailCenter.listElem).find("#"+a),y(a,e),x(a,e),f.fId===zmail.folId.spId||d===zmail.folId.tId||zmfolAction.isDeletedFolder(d)||d===zmail.folId.spId||e===zmail.folId.tId||zmfolAction.isDeletedFolder(e)||e===zmail.folId.spId)l=!0;else if(m=zmail.mailObj[a].T,m&&zmail.listObj[m]){var n=zmList.getMailSummaryList(f,m);if(n.length<=1&&b.mailId.indexOf(n[0])!==-1){var o=w(a);o.length&&o.remove(),C(j),$(g.prevElem).attr("data-mid")&&zmPrev.updatePrevOnDeletion(a)}}zmail.mailObj[a].T&&(1===i||2===i&&l)?E(a,e,zmail.mailObj[a].FD):(h=zmUtil.getFolId(),("unread"!==h&&"all"!==h&&"flag"!==h&&!zmUtil.isLabelId(h)&&"search"!==h||h!==zmail.folId.tId&&(e===zmail.folId.tId||zmfolAction.isDeletedFolder(e)))&&(zmail.mailObj[a].T&&0!==i||j.remove())),$(g.prevElem).attr("data-mid")!==a||0!==i&&zmail.mailObj[a].T&&"th"!==$(g.prevElem).attr("data-ty")||k(a,c),zmail.mailObj[a].T&&(""===f.fId||f.fId===e)&&z(a)&&G(a,e)}else if("thd"===c){j=$(zmail.mailCenter.listElem).find("#t"+a),j.length||(j=$(zmail.mailCenter.listElem).find("#"+a));var p,r,t=[],u=zmInit.findFolName(e);if(m=zmail.mailObj[a].T,zmail.listObj[m]&&(t=zmList.getViewBasedMsgList(m,f)),p=t.length,2===i&&f.fId&&f.fId!==e||1===i&&f.fId===d&&d!==e||e===zmail.folId.tId||"archive"===f.view)j.remove(),$(zmail.mailCenter.listElem).find("#thd"+a).remove();else if(j.find(".zmFdr span").html(u),2===i||!f.fId)for(r=0;r<p;r++)$(zmail.mailCenter.listElem).find("#"+t[r]+" .zmFdr span").html(u),$.publish("mail/move",[t[r],"msg",b]);k(a,c)}$.publish("mail/move",[a,"msg",b]),q(a,d,b,c),"msg"===c&&zmPreviewTemplate.updateMailHeaderView(a),0!==i&&f.fId!==zmail.folId.tId&&f.fId!==zmail.folId.dId&&(zmInit.checkThreadRead(zmail.mailObj[a].T)?F(a,c):H(a,c))}}},J=function(a){var b=$(zmail.mailCenter.listElem).find("#"+a);b.remove()},K=function(b,c,d){if(d){if(d.preAction)return;d.from&&(a=d.from)}var e,h,j,k,l=zmail.mailObj[b].FD;if(f=zmInit.getListingDetObj(),l&&$("#"+l+" .SC_ct").hasClass("SC_new")){var m="zmlTreeH",n={};n=zmail.mailLeft.getNodes()[0].getLayer(m),n.clearNew(l)}if("msg"===c){if(e=$(zmail.mailCenter.listElem).find("#"+b),e.removeClass("zm_urd"),h=e.parent(".zmTV"),"mail_preview"!==a||"mail_preview"===a&&!zmTab.currentTab.indexOf("zm_srch"))if("unread"===f.view&&("zm_Container"!==zmTab.currentTab||!$(g.prevElem).attr("data-mid")||$(g.prevElem).attr("data-mid")&&$(g.prevElem).attr("data-mid")!==b&&(!zmail.mailObj[b].TH||zmail.mailObj[b].TH&&zmail.mailObj[b].T!==zmail.mailObj[$(g.prevElem).attr("data-mid")].T)))if(zmail.mailObj[b].T&&0!==i){if(1===zmList.getMailSummaryList(f,zmail.mailObj[b].T).length){C(e);var o=zmCenterListing.mailObjectAPI.getViewParentOf("c"+b,"zm_Container");if(o){var p="t"+o.id;J(p)}}}else e.remove();else h.hasClass("zmTV")&&(h.children("div").hasClass("zm_urd")||h.prev().removeClass("zm_urd"));$("#zmHdrP"+b).find(".zmPT").removeClass("zm_urd"),$("#zmHdrT"+b).find(".zmPT").removeClass("zm_urd"),$("#zmHdrS"+b).find(".zmPT").removeClass("zm_urd")}else if("thd"===c)if(e=$(zmail.mailCenter.listElem).find("#t"+b),e.length||(e=$(zmail.mailCenter.listElem).find("#"+b)),h=$(zmail.mailCenter.listElem).find("#thd"+b),e.removeClass("zm_urd"),h.children("div").removeClass("zm_urd"),"unread"!==f.view||"click"===a||"zm_Container"===zmTab.currentTab&&$(g.prevElem).attr("data-mid")===b)for(j=zmList.getViewBasedMsgList(zmail.mailObj[b].T,f),k=0;k<j.length;k++)$("#zmHdrP"+j[k]).find(".zmPT").removeClass("zm_urd"),$("#zmHdrT"+j[k]).find(".zmPT").removeClass("zm_urd"),$("#zmHdrS"+j[k]).find(".zmPT").removeClass("zm_urd"),$.publish("mail/read",[j[k],"msg"]);else e.remove(),h.remove();$.publish("mail/read",[b,"msg"]),t(b,c),0!==i&&f.fId!==zmail.folId.tId&&f.fId!==zmail.folId.dId&&F(b,c)},L=function(a,b,c){if(!c){var d,e,g,h;if("msg"===b){if(d=$(zmail.mailCenter.listElem).find("#"+a),d.addClass("zm_urd"),e=d.parent(".zmTV").length?d.parent(".zmTV"):$(zmail.mailCenter.listElem).find(".zmSLst").next(),zmail.mailObj[a].T&&0!==i&&e.children("div").hasClass("zm_urd")&&(""===f.fId||""!==f.fId&&f.fId===zmail.mailObj[a].FD)){var j,k;j=e.prev(),j.addClass("zm_urd"),j.length&&(k=j[0].id,0===k.indexOf("t")&&(k=k.substring(1)),l(k,0))}$("#zmHdrP"+a).find(".zmPT").addClass("zm_urd"),$("#zmHdrT"+a).find(".zmPT").addClass("zm_urd"),$("#zmHdrS"+a).find(".zmPT").addClass("zm_urd")}else if("thd"===b)for(d=$(zmail.mailCenter.listElem).find("#t"+a),d.length||(d=$(zmail.mailCenter.listElem).find("#"+a)),d.addClass("zm_urd"),$(zmail.mailCenter.listElem).find("#thd"+a).children("div").addClass("zm_urd"),g=zmList.getViewBasedMsgList(zmail.mailObj[a].T,f),h=0;h<g.length;h++)$("#zmHdrP"+g[h]).find(".zmPT").addClass("zm_urd"),$("#zmHdrT"+g[h]).find(".zmPT").addClass("zm_urd"),$("#zmHdrS"+g[h]).find(".zmPT").addClass("zm_urd"),$.publish("mail/unread",[g[h],"msg"]);$.publish("mail/unread",[a,"msg"]),u(a,b),0!==i&&f.fId!==zmail.folId.tId&&f.fId!==zmail.folId.dId&&H(a,b)}},M=function(a,b){var c,d=zmList.getMailSummaryList(f,zmail.mailObj[a].T),e=0,g=$("#"+a);f.flag?e="-1"===f.flag&&"0"===b||"-1"!==f.flag&&f.flag!==b?0:1:f.label&&(e=b),0===e?g.length?(c=g.parent().prev().find(".zmtCt"),B(d,c),"1"===c.text()&&C(g)):(c=$(zmail.mailCenter.listElem).find(".zmSLst .zmtCt"),B(d,c)):g.length?(c=g.parent().prev().find(".zmtCt"),A(d,c)):(c=$(zmail.mailCenter.listElem).find(".zmSLst .zmtCt"),A(d,c),"2"===c.text()&&c.before(D()))},N=function(a,b,c,d){if(!d){var e,h,j,k,l,o=zmInit.flgClass(b),p="";if("msg"===c){if(e=$(zmail.mailCenter.listElem).find("#"+a),zmail.mailObj[a].TH&&0!==i){if(h=w(a),h.length){p=h[0].id,p.indexOf("t")!==-1&&(p=p.substring(1));var q=zmUtil.getFolId();if(zmail.listObj[q]){var r=zmUtil.getFirstMsgId(zmail.mailObj[a].T,f);r&&(p=r)}}m(p,zmail.mailObj[a].NFG,b),k=zmInit.getThdFlagvalue(p),j=zmInit.flgClass(k),h.find(".zmflg").removeClass().addClass(j)}if($("#zmHdrP"+a+" .zmflg").removeClass().addClass(o),$("#zmHdrT"+a+" .zmflg").removeClass().addClass(o),$("#zmHdrS"+a+" .zmflg").removeClass().addClass(o),f.flag&&"0"===b)zmail.mailObj[a].T?"-1"!==f.flag&&f.flag!==zmail.mailObj[a].NFG||0===zmail.mailObj[a].NFG||(l=zmList.getMailSummaryList(f,zmail.mailObj[a].T),1===i||2===i&&f.fId===zmail.folId.spId?(M(a,b),2===l.length?C(e):1===l.length&&h.length&&(h.remove(),$(g.prevElem).attr("data-mid")===p&&"lt"===$(g.prevElem).attr("data-ty")&&zmPrev.clsPreview()),e.remove()):2===i&&1===l.length&&(C(e),h.length&&(h.remove(),$(g.prevElem).attr("data-mid")===p&&"lt"===$(g.prevElem).attr("data-ty")&&zmPrev.clsPreview()))):(e.remove(),$(g.prevElem).attr("data-mid")===a&&zmPrev.clsPreview()),e.find(".zmflg").removeClass().addClass(o);else if(0===b)e.find(".zmflg").removeClass().addClass(o);else{
if(zmail.mailObj[a].T){if(f.flag)if(l=zmList.getMailSummaryList(f,zmail.mailObj[a].T),1===i||2===i&&f.fId===zmail.folId.spId)if(""===f.fId)if("-1"===f.flag&&"0"===zmail.mailObj[a].NFG||f.flag===b&&zmail.mailObj[a].NFG!==b){if(G(a,""),1===l.length)if($("#t"+l[0]).length)$("#t"+l[0]).find(".zmtCt").before(D());else if($(zmail.mailCenter.listElem).find(".zmSLst").length){var s=zmail.mailCenter.listElem;$(s).find(".zmSLst .zmtCt").before(D())}M(a,b)}else"-1"!==f.flag&&zmail.mailObj[a].NFG!==b&&(2===l.length?C(e):1===l.length&&(e.parent().prev().remove(),e.parent().remove(),zmPrev.clsPreview()),M(a,b),e.remove());else f.fId===zmail.mailObj[a].FD&&("-1"===f.flag&&"0"===zmail.mailObj[a].NFG||f.flag===b&&zmail.mailObj[a].NFG!==b?(G(a,""),M(a,b)):"-1"!==f.flag&&zmail.mailObj[a].NFG===f.flag&&zmail.mailObj[a].NFG!==b&&(M(a,b),e.remove()));else 2===i&&1===l.length&&(""===f.fId&&"-1"!==f.flag&&zmail.mailObj[a].NFG!==b||f.fId===zmail.mailObj[a].FD&&"-1"!==f.flag&&zmail.mailObj[a].NFG===f.flag&&zmail.mailObj[a].NFG!==b)&&(C(e),h.length&&(h.remove(),$(g.prevElem).attr("data-mid")===p&&"lt"===$(g.prevElem).attr("data-ty")&&zmPrev.clsPreview()))}else f.flag&&"-1"!==f.flag&&zmail.mailObj[a].NFG!==b&&e.remove();e.find(".zmflg").removeClass().addClass(o)}zmCache.updateObj({mode:"upd",msgId:a,key:"NFG",val:b})}else if("thd"===c){var t,u,v;for(l=[],v=zmail.mailObj[a].T,l=zmList.getViewBasedMsgList(v,f),t=l.length,u=0;u<t;u++)N(l[u],b,"msg",d);e=$(zmail.mailCenter.listElem).find("#t"+a),e.length||(e=$(zmail.mailCenter.listElem).find("#"+a)),n(a,b),f.flag&&"0"===b?(e.remove(),$(zmail.mailCenter.listElem).find("#thd"+a).remove(),$(g.prevElem).attr("data-mid")===a&&zmPrev.clsPreview()):"0"===b?e.find(".zmflg").removeClass().addClass(o):f.flag&&"-1"!==f.flag&&f.flag!==b?($(zmail.mailCenter.listElem).find("#thd"+a).remove(),e.remove(),$(g.prevElem).attr("data-mid")===a&&zmPrev.clsPreview()):e.find(".zmflg").removeClass().addClass(o)}$.publish("mail/flag",[a,"msg",b]),f.flag&&("-1"===f.flag&&"0"===b||"-1"!==f.flag&&b!==f.flag)&&zmCache.updateCacheForViews(a),0!==i&&f.fId!==zmail.folId.tId&&f.fId!==zmail.folId.dId&&(zmInit.checkThreadRead(zmail.mailObj[a].T)?F(a,c):H(a,c))}},O=function(a,b,c){if(!b.preAction){var d,e,h,j,k,l,m=!1;if("msg"===c){d=$(zmail.mailCenter.listElem).find("#"+a);var n;if(zmail.mailObj[a].TH&&0!==i){if(e=w(a),e.length){h=e[0].id,h.indexOf("t")!==-1&&(h=h.substring(1));var p=zmUtil.getFolId();if(zmail.listObj[p]){var q=zmUtil.getFirstMsgId(zmail.mailObj[a].T,f);q&&(h=q)}}o(h,[b.lId],b.lA)}if("add"===b.lA){if(zmail.mailObj[a].TAG=zmail.mailObj[a].TAG||[],k=zmail.mailObj[a].TAG,zmail.mailObj[a].T&&(1===i||2===i&&f.fId===zmail.folId.spId)&&f.label)if(n=$.inArray(b.lId,zmail.mailObj[a].TAG),""===f.fId){if(f.label===b.lId&&n===-1){if(G(a,""),j=zmList.getMailSummaryList(f,zmail.mailObj[a].T),1===j.length)if($("#t"+j[0]).length)$("#t"+j[0]).find(".zmtCt").before(D());else if($(zmail.mailCenter.listElem).find(".zmSLst").length){var r=$(zmail.mailCenter.listElem).find(".zmSLst .zmtCt");r.before(D())}M(a,1)}}else f.fId===zmail.mailObj[a].FD&&("-1"===f.label&&0===zmail.mailObj[a].TAG.length||f.label===b.lId&&n===-1)&&(G(a,""),M(a,1));n=$.inArray(b.lId,k),n===-1&&zmail.mailObj[a].TAG.push(b.lId)}else if("delete"===b.lA&&zmail.mailObj[a].TAG){var s=zmail.mailObj[a].TAG,t=s.length;zmail.mailObj[a].T?1!==i&&(2!==i||f.fId!==zmail.folId.spId&&f.fId!==zmail.folId.tId)||("-1"!==f.label||1!==zmail.mailObj[a].TAG.length)&&f.label!==b.lId||(M(a,0),j=zmList.getMailSummaryList(f,zmail.mailObj[a].T),2===j.length?C(d):1===j.length&&(e.length&&(e.remove(),$(zmail.mailCenter.listElem).find("#thd"+h).remove(),$(g.prevElem).attr("data-mid")===h&&"lt"===$(g.prevElem).attr("data-ty")&&("zm_Container"===zmTab.currentTab?zmPrev.clsPreview():zmTab.currentTab.indexOf("zm_tab")||$.publish("mail/listing/viewchanged",[]))),m=!0,l=h)):(m=!0,l=a);var u;for(u=0;u<t;u++)if(b.lId===s[u]){zmail.mailObj[a].TAG.splice(u,1);break}}else"deleteall"===b.lA&&zmail.mailObj[a].TAG&&(zmail.mailObj[a].T?(M(a,"0"),f.label&&(j=zmList.getMailSummaryList(f,zmail.mailObj[a].T),2===j.length?C(d):1===j.length&&(e=w(a),e.length&&(e.remove(),$(zmail.mailCenter.listElem).find("#thd"+h).remove(),$(g.prevElem).attr("data-mid")===h&&"lt"===$(g.prevElem).attr("data-ty")&&("zm_Container"===zmTab.currentTab?zmPrev.clsPreview():zmTab.currentTab.indexOf("zm_tab")||$.publish("mail/listing/viewchanged",[]))),m=!0,l=h))):(m=!0,l=a),zmail.mailObj[a].TAG=[]);(f.label&&"deleteall"===b.lA||(f.label===b.lId||"-1"===f.label)&&"delete"===b.lA)&&(d.remove(),$(g.prevElem).attr("data-mid")!==a||zmail.mailObj[a].T&&"th"!==$(g.prevElem).attr("data-ty")||("zm_Container"===zmTab.currentTab?zmPrev.clsPreview():zmTab.currentTab.indexOf("zm_tab")||$.publish("mail/listing/viewchanged",[])))}else if("thd"===c){var v,x,y=zmail.mailObj[a].T;for(j=[],j=zmList.getViewBasedMsgList(y,f),x=0,v=j.length;x<v;x++)("deleteall"===b.lA&&zmail.mailObj[j[x]].TAG||"add"===b.lA&&(!zmail.mailObj[j[x]].TAG||"-1"===$.inArray(b.lId,zmail.mailObj[j[x]].TAG))||"delete"===b.lA&&$.inArray(b.lId,zmail.mailObj[j[x]].TAG>=0))&&O(j[x],b,"msg");if(d=e=$(zmail.mailCenter.listElem).find("#t"+a),d.length||(d=e=$(zmail.mailCenter.listElem).find("#"+a)),o(a,[b.lId],b.lA),"add"===b.lA)zmail.mailObj[a].TAG||(zmail.mailObj[a].TAG=[]),k=zmail.mailObj[a].TAG,$.inArray(b.lId,zmail.mailObj[a].TAG)===-1&&k.push(b.lId);else if("delete"===b.lA&&zmail.mailObj[a].TAG){var z,A=zmail.mailObj[a].TAG,B=A.length;for(z=0;z<B;z++)if(b.lId===A[z]){zmail.mailObj[a].TAG.splice(z,1);break}("-1"===f.label&&0===zmail.mailObj[a].TAG.length||f.label===b.lId)&&($(zmail.mailCenter.listElem).find("#thd"+a).remove(),d.remove(),$(g.prevElem).attr("data-mid")===a&&zmPrev.clsPreview(),m=!0,l=a)}else"deleteall"===b.lA&&zmail.mailObj[a].TAG&&($(zmail.mailCenter.listElem).find("#t"+a+" p").remove(),zmail.mailObj[a].TAG=[]);f.label&&"deleteall"===b.lA&&(d.remove(),zmCache.updateObj({mode:"upd",msgId:a,key:"TAG",val:""}),$(g.prevElem).attr("data-mid")===a&&zmPrev.clsPreview(),m=!0,l=a)}m&&l&&zmCache.updateCacheForViews(l),zmPreviewTemplate.refreshLabelsForMail(a,e),$.publish("mail/label",[a,"msg",b]),0!==i&&f.fId!==zmail.folId.tId&&f.fId!==zmail.folId.dId&&(zmInit.checkThreadRead(zmail.mailObj[a].T)?F(a,c):H(a,c))}},P=function(a,b,c,d){if(!d){var e,g;if("msg"===c)g=$(zmail.mailCenter.listElem).find("#"+a),y(a,zmail.folId.tId),x(a,zmail.folId.tId),zmail.mailObj[a].T&&(zmail.mailObj[a].FD===zmail.folId.dId&&zmUtil.removeDraftMapping(a),E(a,zmail.folId.tId,zmail.mailObj[a].FD)),5!==b&&zmail.mailObj[a].FD===zmail.folId.tId&&(b=5),f.fId===zmail.folId.tId&&zmail.mailObj[a].FD!==zmail.folId.tId&&z(a)&&G(a,zmail.folId.tId),zmail.mailObj[a].TH&&0!==i||g.remove(),$.publish("/mail/msgDiscarded",[{draftId:a,actionType:"discard_draft"}]),zmail.mailContainer.removeObject(a);else if("thd"===c){var h,j,l=[];for(g=$(zmail.mailCenter.listElem).find("#t"+a),g.length||(g=$(zmail.mailCenter.listElem).find("#"+a)),l=zmList.getViewBasedMsgList(e,f),j=l.length,h=0;h<j;h++)$.publish("mail/delete",[l[h],"msg",b]);g.remove(),$(zmail.mailCenter.listElem).find("#thd"+a).remove()}k(a,c),$.publish("mail/delete",[a,"msg",b]),v(a,c,b),"msg"===c&&zmPreviewTemplate.updateMailHeaderView(a),0!==i&&f.fId!==zmail.folId.tId&&f.fId!==zmail.folId.dId&&(zmInit.checkThreadRead(zmail.mailObj[a].T)?F(a,c):H(a,c))}},Q=function(a,b){var c,d,e,g,h=zmail.mailObj[a];c=p(a,h.T,f),e=$(zmail.mailCenter.listElem).find("#"+a),g=Boolean(f.fId),d=e.length?e.parent().prev().find(".zmtCt"):$(zmail.mailCenter.listElem).find(".zmSLst .zmtCt"),g&&("unarchive"===b&&1===h.AR||"archive"===b&&0===h.AR)&&(B(c,d),"1"===d.text()&&C(e))},R=function(a,b,c){if(!c){var d,e,g=zmail.mailObj[a];"msg"===b?(d=$(zmail.mailCenter.listElem).find("#"+a),d.addClass("zmarch"),g.TH&&0!==i&&Q(a,"archive"),("archive"!==f.view&&f.fId||!f.fId&&"unread"===f.view)&&d.remove()):"thd"===b&&(d=$(zmail.mailCenter.listElem).find("#t"+a),e=$(zmail.mailCenter.listElem).find("#thd"+a),d.addClass("zmarch"),"archive"!==f.view&&""!==f.fId&&(d.remove(),e.remove())),k(a,b),$.publish("mail/archive",[a,"msg"]),r(a,b),y(a,g.FD),0!==i&&f.fId!==zmail.folId.tId&&f.fId!==zmail.folId.dId&&(zmInit.checkThreadRead(zmail.mailObj[a].T)?F(a,b):H(a,b))}},S=function(a,b,c){if(!c){var d,e,g=zmail.mailObj[a];"msg"===b?(d=$(zmail.mailCenter.listElem).find("#"+a),d.removeClass("zmarch"),g.TH&&0!==i&&Q(a,"unarchive"),"archive"===f.view&&d.remove()):(d=$(zmail.mailCenter.listElem).find("#t"+a),e=$(zmail.mailCenter.listElem).find("#thd"+a),d.removeClass("zmarch"),"archive"===f.view&&(d.remove(),e.remove())),k(a,b),$.publish("mail/unarchive",[a,"msg"]),s(a,b),y(a,g.FD),0!==i&&f.fId!==zmail.folId.tId&&f.fId!==zmail.folId.dId&&(zmInit.checkThreadRead(zmail.mailObj[a].T)?F(a,b):H(a,b))}},T=function(a,b,c){if(!c){var d,e;if("msg"===b){if(d=zmail.mailObj[a].FD,e=zmail.folId.spId,y(a,e),x(a,e),zmail.mailObj[a].T&&0!==i&&E(a,e,d),zmail.mailObj[a].TH&&0!==i||$(zmail.mailCenter.listElem).find("#"+a).remove(),zmCache.updateObj({mode:"move",msgId:a,rFrom:d,addTo:e,type:b}),0===zmail.mailObj[a].S&&!zmail.mailObj[a].AR){var g={action:"spam",src:d,dest:e};zmmailAct.updateCount({fId:d,mode:"dec",actionObj:g}),zmmailAct.updateCount({fId:e,mode:"inc",actionObj:g})}}else if("thd"===b){var h,j,l,m=[];for(d=zmail.mailObj[a].FD,e=zmail.folId.spId,l=zmail.mailObj[a].T,$("#t"+a).remove(),$("#thd"+a).remove(),zmPrev.clsPreview(),zmCache.updateObj({mode:"move",msgId:a,rFrom:d,addTo:e,type:b}),m=p(a,l,f),h=m.length,j=0;j<h;j++)zmCache.updateObj({mode:"upd",msgId:m[j],key:"FD",val:zmail.folId.spId})}k(a,b),"msg"===b&&zmPreviewTemplate.updateMailHeaderView(a),$.publish("mail/spam",[a,"msg"]),0!==i&&f.fId!==zmail.folId.tId&&f.fId!==zmail.folId.dId&&(zmInit.checkThreadRead(zmail.mailObj[a].T)?F(a,b):H(a,b))}},U=function(a,b,c){var d,e,h,j,l,m;if(d=zmail.folId.spId,b){if(e=b.length,"msg"===c){if(h=b[0].folId,j=b[0].detail.m,y(a,h),x(a,h),(1===i||2===i&&f.fId===zmail.folId.spId)&&zmail.mailObj[a].T&&f.fId===d&&E(a,h,d),$(g.prevElem).attr("data-mid")!==a||0!==i&&zmail.mailObj[a].T&&"th"!==$(g.prevElem).attr("data-ty")||zmPrev.clsPreview(),(0===i||!zmail.mailObj[a].TH||zmail.mailObj[a].TH&&"unread"!==f.view)&&$(zmail.mailCenter.listElem).find("#"+a).remove(),zmCache.updateObj({mode:"move",msgId:a,rFrom:zmail.folId.spId,addTo:h,type:c}),0===zmail.mailObj[a].S&&!zmail.mailObj[a].AR){var n={action:"notspam",src:d,dest:h};zmmailAct.updateCount({fId:d,mode:"dec",actionObj:n}),zmmailAct.updateCount({fId:h,mode:"inc",actionObj:n})}}else for($("#t"+a).remove(),$("#thd"+a).remove(),zmPrev.clsPreview(),l=0;l<e;l++)for(h=b[0].folId,j=b[0].detail.m,zmCache.updateObj({mode:"insert",msgId:a,rt:zmail.mailObj[a].R,folId:h,type:c}),m=0;m<j.length;m++)if(zmail.mailObj[j[m]]&&(zmCache.updateObj({mode:"upd",msgId:j[m],key:"FD",val:h}),0===zmail.mailObj[j[m]].S&&!zmail.mailObj[j[m]].AR)){var o={action:"notspam",src:d,dest:h};zmmailAct.updateCount({fId:d,mode:"dec",actionObj:o}),zmmailAct.updateCount({fId:h,mode:"inc",actionObj:o})}k(a,c),"msg"===c&&zmPreviewTemplate.updateMailHeaderView(a),$.publish("mail/notspam",[a,"msg",b]),0!==i&&f.fId!==zmail.folId.tId&&f.fId!==zmail.folId.dId&&(zmInit.checkThreadRead(zmail.mailObj[a].T)?F(a,c):H(a,c))}},V=function(a,b){var e={read:c.maillistopt.markread,unread:c.maillistopt.markunread,flag:d.common.flag,label:d.common.label,move:d.common.move,"delete":d.common["delete"],spam:c.maillistopt.markspam,notspam:c.maillistopt.notspam,archive:c.maillistopt.archive,unarchive:c.maillistopt.unarchive};if("success"===a.result)return zmUtil.succErrMsg("s",zmText.applyArgs(d.bulkaction.common.info,{actionname:e[b.action]})),void zmList.unchkAll()},W=function(a,b){var c,d,e,f,g,h,j=a.length,k=b.length,l=zmPrev.prevDetails().msgId,m=zmail.mailObj[l]&&zmail.mailObj[l].TH&&i||0,n=!1,o=!1,p=!0;if((1===j&&0===k||0===j&&1===k)&&(d=j?a[0]:b[0],l===d&&(n=!0)),m&&j>0&&0===k){var q=zmail.mailObj[l].T;for(g=0;g<j;g++)if(zmail.mailObj[a[g]].T!==q){p=!1;break}if(p)return}if(!n&&!o)for(g=0,e=j;g<e;g++)if(l===a[g]){o=!0;break}if(!n&&!o)for(c=zmInit.getListingDetObj(),g=0,e=k;!o&&g<e;g++){if(l===b[g]){o=!0;break}for(a=zmList.getMailSummaryList(c,zmail.mailObj[b[g]].T),h=0,f=a.length;h<f;h++)if(l===a[h]){o=!0;break}}n?zmPrev.updatePrevOnDeletion(d):o&&zmPrev.clsPreview()},X=function(){var a=zmUtil.getFolId();if(a&&zmail.listObj[a]){var b=parseInt(zmail.mailOpt.range)||50,c=zmail.listObj[a].MO&&zmail.listObj[a].MO.length;c<b&&zmInit.fillMails(b)}},Y=function(){var a,b=[{id:"zm_Container",view:zmUtil.getFolId()},{id:"zm_srch1",view:"search"}],c=b.length,d=0;for(d=0;d<c;d++){var e,f,g,h=b[d].id,i=b[d].view;zmsuite.isWorkspaceAvailable(h)&&(g=zmsuite.getCenter(h)[0].getNodes()[2].$el,f=zmPrev.prevDetails(h),e=f.msgId,e&&0===g.find(".zmL.zmSLst").length&&(a=zmList.getDupThdRowId(e,i),a&&zmList.setMailSelection(a,"lt",g)))}},Z=function(a,b){var c,e,h,j,k,l,m,n=[];if(g=zmList.getElemObj(),"success"===a.result){var o=zmUtil.getMLConversionValue();if(zmUtil.hideMenu(),f=zmTab.currentTab.indexOf("zm_tab")?zmTab.currentTab.indexOf("zm_srch")?zmInit.getListingDetObj():zmSearchUtil.getSearchViewDetails():zmsuite.getCenterOuter().$el.data("data-detail"),i=f.fId===zmail.folId.sId&&0!==o?1:o,n.push(b.mailId),n.push(b.tmailId),h=n.length,b.source&&"popup"===b.source&&("move"===b.action||"delete"===b.action||"archive"===b.action&&("archive"!==f.view&&f.fId||!f.fId&&"unread"===f.view)||"unarchive"===b.action&&"archive"===f.view||"spam"===b.action)&&""!==zmPrev.prevDetails().msgId){var p=b.mailId||[],q=b.tmailId||[];W(p,q)}for(j=0;j<h;j++)for(c=n[j],k=0===j?"msg":"thd",e=c?c.length:0,l=0;l<e;l++)if(m=c[l],zmUtil.isMetaDataAvailable(m))switch(b.action){case"move":I(m,b,k);break;case"delete":P(m,b.fT,k,b.preAction);break;case"archive":R(m,k,b.preAction);break;case"unarchive":S(m,k,b.preAction);break;case"spam":T(m,k,b.preAction);break;case"notspam":U(m,a.desFol||b.resp.desFol,k)}if(b.isUserAction&&(b.resp=a,b.msgId=m,b.type=k,b.isUserAction=!1,b.preAction=!1,zmCrosstab.renew("zm_mail",{key:"moveActions",info:b})),a.count)for(var r in a.count){var s=a.count[r];for(var t in s)zmmailAct.updateCount({fId:t,mode:"binc",count:parseInt(s[t])})}"mail"===b.from||zmTab.currentTab.indexOf("zm_tab")!==-1||!f.fId&&((f.fId||"unread"!==f.view)&&"search"!==f.view||"delete"!==b.action&&"move"!==b.action&&"archive"!==b.action&&"spam"!==b.action&&"notspam"!==b.action)||("notifier"!==b.from&&(zmList.unchkAll(),zmUtil.sTopMenu({type:"l"}),"move"===b.action&&zmUtil.succErrMsg("s",d.info.moveSuccess)),$(g.prevElem).attr("data-mid")&&$(".SC_Popn").length&&zmPrev.removeCountinPreview(g)),Y(),X()}else{var u=d.common.errorprocessing;a.result?u=a.result:a.error&&(u=a.error),zmsDialog.alert(u)}$.publish("/maction/"+b.action)},_=function(a,b){var c,e,h,j,k,l,m,n=[];if(g=zmList.getElemObj(),"success"===a.result){var o=zmUtil.getMLConversionValue();for(f=zmTab.currentTab.indexOf("zm_tab")?zmTab.currentTab.indexOf("zm_srch")?zmInit.getListingDetObj():zmSearchUtil.getSearchViewDetails():zmsuite.getCenterOuter().$el.data("data-detail"),i=f.fId===zmail.folId.sId&&0!==o?0:o,n.push(b.mailId),n.push(b.tmailId),k=n.length,j=0;j<k;j++)for(e=0===j?"msg":"thd",h=0,l=n[j],l&&(h=l.length),m=0;m<h;m++)if(c=l[m],zmUtil.isMetaDataAvailable(c))switch(b.action){case"read":K(c,e,b);break;case"unread":L(c,e,b.preAction);break;case"flag":N(c,b.fVal,e,b.preAction);break;case"label":O(c,b,e);break;case"spam":T(c,e)}if(b.isUserAction&&(b.resp=a,b.msgId=c,b.type=e,b.preAction=!1,b.isUserAction=!1,zmCrosstab.renew("zm_mail",{key:"markFlag",info:b})),"notifier"!==b.from&&0===zmPreviewTemplate.currentWorkSpace&&("read"===b.action&&"unread"===f.view||"flag"===b.action&&f.flag||"label"===b.action&&f.label)&&(zmList.unchkAll(),zmUtil.sTopMenu({type:"l"})),a.count)for(var p in a.count){var q=a.count[p];for(var r in q)zmmailAct.updateCount({fId:r,mode:"binc",count:parseInt(q[r])})}$(g.prevElem).attr("data-mid")&&$(".SC_Popn").length&&zmPrev.removeCountinPreview(g),Y(),X()}else{var s=d.common.errorprocessing;a.result?s=a.result:a.error&&(s=a.error),zmsDialog.alert(s)}},aa=function(a,b,c){var d,e,h,i,j,k,l,m=[],n=[],o=[];for(n=c.mailId||c.amailId,o=c.tmailId,m.push(n),m.push(o),d=m.length,g=zmList.getElemObj(),("move"===a||"delete"===a||"archive"===a&&("archive"!==f.view&&f.fId||!f.fId&&"unread"===f.view)||"unarchive"===a&&"archive"===f.view||"spam"===a)&&""!==zmPrev.prevDetails("zm_Container").msgId&&W(n,o),e=0;e<d;e++)for(k=0===e?"msg":"thd",i=0,j=m[e],j&&(i=j.length),h=0;h<i;h++)switch(l=j[h],a){case"read":K(l,k);break;case"unread":L(l,k);break;case"flag":N(l,b.fA,k);break;case"label":c.preAction=!1,O(l,c,k);break;case"move":c.preAction=!1,I(l,c,k);break;case"delete":P(l,c.fT,k);break;case"archive":R(l,k);break;case"unarchive":S(l,k);break;case"spam":T(l,k)}},ba=function(a,b,c,e){if(b<2||e.fId===zmail.folId.spId&&"delete"===a)return void c();var f,g={msg_dontshow:d.convDialog.suppresstext,msg_mvact:d.convDialog.movefullthreadtotrash,msg_delact:d.convDialog.deletefullthread,msg_spamact:d.convDialog.markfullthreadspam,msg_mfwdact:d.info.fwdConversations,msg_cont:d.common["continue"],msg_multiplemail:d.convDialog.selectionThread,txt_ok:d.common.ok,txt_cancel:d.common.cancel,msg_folspec:d.convDialog.note,msg_selectiontext:d.convDialog.selectiontext,msg_actiontext:d.convDialog.actiontext.doyou,mail_folderspec:d.convDialog.folderwise,mail_acrossfolders:d.convDialog.acrossfolders,msg_rememberaction:d.convDialog.rememberselection,1:{msg_mvtotrashact:d.convDialog.movefullthreadtotrash,msg_delact:d.convDialog.deletefullthread,msg_spamact:d.convDialog.markfullthreadspam,msg_mvact:d.convDialog.markentireconv},2:{msg_mvtotrashact:d.convDialog.actiontext.movetotrash,msg_delact:d.convDialog.actiontext["delete"],msg_spamact:d.convDialog.actiontext.markasspam,msg_mvact:d.convDialog.actiontext.move}};switch(a){case"delete":f=g[i].msg_delact;break;case"trash":f=g[i].msg_mvtotrashact;break;case"spam":f=g[i].msg_spamact;break;case"multipleforward":f=g.msg_mfwdact;break;case"move":f=g[i].msg_mvact}var h,j,k,l,m,n,o;if(1===i){var p=zmText.applyArgs(d.convDialog.convcount,{count:b}),q=f+". "+g.msg_cont+"?",r=g.msg_multiplemail+". "+p+". "+f+"?",s=1===b?q:r,t=e.fId===zmail.folId.spId||e.fId===zmail.folId.tId;n="conv_conf",o=["DIV",{attrs:{id:n,style:"display: none;"},child:[["DIV",{attrs:{"class":"paraDiv"},child:[["text",s],["DIV",{child:[["text",t?g.msg_folspec:""]]}],["DIV",{child:[["SPAN",{child:[["I",{attrs:{"class":"msi-uncheck"}}],["text",g.msg_dontshow]]}]]}]]}]]}],h=_zm.getDOM(o)}else 2===i&&(n="conv_conf",o=["DIV",{attrs:{id:n,style:"display:none;"},child:[["DIV",{attrs:{"class":"paraDiv"},child:[["text",g.msg_selectiontext],["BR",{}],["BR",{}],["text",f],["DIV",{attrs:{"class":"mail_opt"},child:[["I",{attrs:{"class":"msi-option",value:"1"}}],["SPAN",{child:[["text",g.mail_folderspec]]}]]}],["DIV",{attrs:{"class":"mail_opt"},child:[["I",{attrs:{"class":"msi-unoption",value:"2"}}],["SPAN",{child:[["text",g.mail_acrossfolders]]}]]}],["BR",{}],["DIV",{child:[["SPAN",{child:[["I",{attrs:{"class":"msi-uncheck"}}],["text",g.msg_rememberaction]]}]]}]]}]]}],h=_zm.getDOM(o),l=$("div.mail_opt",h),m=$("i",l),l.on("click",function(){m.removeClass().addClass("msi-unoption"),$(this).closest("div").find("i").removeClass().addClass("msi-option")}));j=$("i.msi-uncheck",h).closest("span").eq(0),k=$("i.msi-uncheck",h).eq(0),j.on("click",function(){k.toggleClass("msi-uncheck"),k.toggleClass("msi-check")});var u=function(){zmsDialog.remove()},v=function(){var a=$("i.msi-option",l).attr("value");if(k.hasClass("msi-check")){var b=zmAdHocSettings.getSuppressedMessagesState();b.conversationAction="off",zmAdHocSettings.setSuppressedMessagesState(b),2===i&&zmAdHocSettings.setConversationActionType(a)}setTimeout(function(){c(a)},0),u()},w={style:{width:"500px"},buttons:[{txt:g.txt_ok,callback:v,selected:!0},{txt:g.txt_cancel,callback:u,isCancel:!0}],mask:!0,hideclose:!1,pos:"center",title:d.convDialog.title,closeaction:function(){$("#"+n).remove()}};document.body.appendChild(h),zmsDialog.create(n,w)},ca=function(){var a,b=[],c=[],d=[],e="",f=[],g=[],h=zmail.mailObj;for(d=zmUtil.getCheckedMailList(),f=d[0],g=d[1],f.length&&g.length?e=parseInt(h[f[0]].R)>=parseInt(h[g[0]].R)?parseInt(h[f[0]].R):parseInt(h[g[0]].R):f.length?e=parseInt(h[f[0]].R):g.length&&(e=parseInt(h[g[0]].R)),a=0;a<f.length&&parseInt(h[f[a]].R)===e;a++)b.push(f[a]);for(a=0;a<g.length&&parseInt(h[g[a]].R)===e;a++)b.push(g[a]);return{receivedTime:e,list:[b,c]}},da=function(){$.subscribe("/mail/draftsaved",function(a,b){b=b||{},zmUtil.isInlineCompose()&&zmUtil.getMailContent(String(b.draftId),{reload:!0}),zmmailAct.updateDraftCountInUI(b.msgId,"save_draft","","zm_Container")})},ea=function(){var a={lbl_dontshow:b.sharemailtipdialog.dontshow,lbl_diagtitle:b.sharemailtipdialog.didyouknow,txt_tipmessage:b.sharemailtipdialog.tipmessage,lbl_dialog_ok:b.sharemailtipdialog.gotit},c="share-mail-tip-dialog",d=['<div id="'+c+'" style="">','<div class="paraDiv">','<span x-id="message">'+a.txt_tipmessage+"</span>","<div>",'<span x-id="checkbox-holder" style="margin-left: 5px; cursor: pointer;">','<i x-id="checkbox" class="msi-uncheck" style="margin-right: 5px;"></i>',a.lbl_dontshow,"</span>","</div>","</div>","</div>"].join(""),e=$(d),f=e.find("[x-id=checkbox]"),g=e.find("[x-id=checkbox-holder]");e.find("[x-id]").removeAttr("x-id");var h=!1,i=function(){f.toggleClass("msi-check").toggleClass("msi-uncheck"),h=f.hasClass("msi-check")},j=function(){zmsDialog.remove(),$("#"+c).remove()},k=function(){if(h){var a=zmAdHocSettings.getSuppressedMessagesState();a.mailShareTip="off",zmAdHocSettings.setSuppressedMessagesState(a),h=!1,f.removeClass("msi-check").addClass("msi-uncheck")}j()},l={style:{width:"500px"},buttons:[{txt:a.lbl_dialog_ok,callback:k,selected:!0}],mask:!0,hideclose:!1,pos:"center",title:a.lbl_diagtitle,closeaction:function(){$("#"+c).remove()}},m=function(){e.hide(),e.appendTo(document.body),zmsDialog.create(c,l),e.show(),g.off().on("click",i)};return{show:function(){zmUtil.isZohoAccount(zmail.accId)&&zmail.isOrg&&m()}}}(),fa={applyActions:function(b,c,e){var g,k,l,m,n,o,p,q,r=!0,s=[],t=zmUtil.getMLConversionValue();if(a=c,k={accId:zmail.accId,mode:"markas"},l={action:b},zmInit.listingBand.isBulkActionSet){var u=ca();o=u.list,k.mode="bulkaction",k.receivetime=u.receivedTime,zmTab.currentTab.indexOf("zm_srch")||(k=$.extend(k,zmSearchUtil.getRequestParams()))}else{var v=zmUtil.getCheckedMailCount(),w=200,x=!0;if(o=zmUtil.getSelectedMails(),o[0].length<=w&&o[1].length<=w&&(x=!1),v>w&&x)return}if(l.mailId=g=e&&e.msgId?e.msgId:o[0],n=e&&e.thd?e.thd:o[1],l.tmailId=n,f=zmTab.currentTab.indexOf("zm_tab")?zmTab.currentTab.indexOf("zm_srch")?zmInit.getListingDetObj():zmSearchUtil.getSearchViewDetails():zmsuite.getCenterOuter().$el.data("data-detail"),i=f.fId===zmail.folId.spId&&2===t?1:f.fId===zmail.folId.sId||f.fId===zmail.folId.tId?0:t,f.fId&&(k.viewfolId=f.fId,q=f.fId),f.view&&(k.view=f.view,q=f.view),f.flag&&(k.flag=f.flag,q="flag"),f.label&&(k.label=f.label,q=f.label),f.attach&&(k.attach=f.attach,q=f.attach),zmInit.listingBand.isBulkActionSet||(1===i||2===i&&(q===zmail.folId.spId||q===zmail.folId.tId)?k.folderSpec=1:k.folderSpec=i),n&&n.length&&(s=zmUtil.getThreadIdArr(n)),"zm_Container"===zmTab.currentTab&&"unread"===q&&$(zmail.mailCenter.prevElem).hasClass("shw")&&s.length){var y,z=zmPrev.prevDetails(),A=z.msgId,B=-1,C=$.extend({},f);if(y=zmail.mailObj[A].T,B=s.indexOf(y),zmail.mailObj[A].TH&&B!==-1){""===f.fId?C.view="all":C.view="";var D=zmList.getMailSummaryList(f,zmail.mailObj[A].T);0===D.length&&(D=zmList.getMailSummaryList(C,zmail.mailObj[A].T),g=g.concat(zmail.listObj[zmail.mailObj[A].T].MO),l.mailId=g,n.splice(B,1),l.tmailId=n)}}if((f.fId===zmail.folId.tId||f.fId===zmail.folId.dId||0===i)&&n&&n.length&&(g=g.concat(n),n=[],l.mailId=g,l.tmailId=[]),g&&g.length){if(m=zmmailAct.separateArchive(g),m[0].length>200)return void zmUtil.succErrMsg("e",d.info.maxmailselection);k.mailId=m[0].join(),k.mailId.length||(delete k.mailId,delete l.mailId),m[0].length>0&&zmUtil.isSharedFolder(f.fId)&&(k.shId=l.shId=zmUtil.getShareId(f.fId),zmail.opType[b]?k.opType=zmail.opType[b]:k.opType=0)}if(m&&m[1].length>0){if(m[1].length>200)return void zmUtil.succErrMsg("e",d.info.maxarchivemails);l.amailId=m[1],k.amailId=m[1].join(),zmUtil.isSharedFolder(f.fId)&&(k.shId=l.shId=zmUtil.getShareId(f.fId),zmail.opType[b]?k.opType=zmail.opType[b]:k.opType=0)}if(n&&n.length){if(s.length>200)return void zmUtil.succErrMsg("e",d.info.maxconvselection);k.tmailId=s.join(),zmUtil.isSharedFolder(f.fId)&&(k.shId=l.shId=zmUtil.getShareId(f.fId),zmail.opType[b]?k.opType=zmail.opType[b]:k.opType=0)}if(k.todo=$.inArray(b,h),"flag"===b?(k.fA=e.fVal,l.fVal=e.fVal):"label"===b?(l.lA=e.lA,e.lId&&(k.lId=l.lId=e.lId),"add"===e.lA?(k.mailId&&k.mailId.length?p=zmmailAct.rmDuplicateLabel(k.mailId,e.lId,"msg"):(delete k.mailId,delete l.mailId),p&&p.length>0?(k.mailId=p.join(),k.lA=0):n&&n.length?(k.lA=0,r=!0):k.amailId&&k.amailId.length?(p=zmmailAct.rmDuplicateLabel(k.amailId,e.lId,"msg"),p&&p.length>0&&(k.amailId=p.join()),k.lA=0):(zmUtil.hideMenu(),r=!1)):"delete"===e.lA?k.lA=2:k.lA=3,"default"===e.accType&&(k.accId=zmail.defAccId)):k.todo===-1&&(r=!1),r&&"zmStreamsApp"!==zmTab.currentTab){var E=_;if(zmInit.listingBand.isBulkActionSet?(l.preAction=!1,E=V):k.shId?l.preAction=!1:l.preAction=!0,l.isUserAction=!0,j(k,l,E),l.preAction){var F=$.extend({},k),G=$.extend({},l);aa(b,F,G)}}},doActions:function(b,c,e){var g,k,l,m,n,o,p={accId:zmail.accId,mode:"moveto"},q={action:b,from:c},r=!0,s=[],t=zmUtil.getMLConversionValue();if(a=c,f=zmTab.currentTab.indexOf("zm_tab")?zmTab.currentTab.indexOf("zm_srch")?zmInit.getListingDetObj():zmSearchUtil.getSearchViewDetails():zmsuite.getCenterOuter().$el.data("data-detail"),i=f.fId===zmail.folId.spId&&2===t?1:f.fId===zmail.folId.sId||f.fId===zmail.folId.tId?0:t,"newm"!==b){if("sweep"===b){p.mode="bulkaction";var u=zmUtil.createSearchParams(e.senderList,f);p=$.extend(p,u),l=zmUtil.getSelectedMails(),l[0]=l[0].concat(l[1])||[];var v=zmUtil.getFolId(f);zmail.listObj[v]&&zmail.listObj[v].MO.length?p.receivetime=zmail.mailObj[zmail.listObj[v].MO[0]].R:p.receivetime=zmail.mailObj[l[0][0]].R,"delete"===e.actionType?p.sA=0:"archive"===e.actionType&&(p.sA=1,$.publish("folder/archived",[f.fId])),q.action=e.actionType}else if(zmInit.listingBand.isBulkActionSet){var w=ca();l=w.list,p.mode="bulkaction",p.receivetime=w.receivedTime,zmTab.currentTab.indexOf("zm_srch")||(p=$.extend(p,zmSearchUtil.getRequestParams()))}else{var x=zmUtil.getCheckedMailCount(),y=200;if(x>y)return;l=zmUtil.getSelectedMails()}if(q.mailId=g=e&&e.msgId?e.msgId:l[0],m=e&&e.thd?e.thd:l[1],q.tmailId=m,"sweep"!==b&&(f.fId&&(p.viewfolId=f.fId,n=f.fId),f.view&&(p.view=f.view,n=f.view),f.flag&&(p.flag=f.flag,n="flag"),f.label&&(p.label=f.label,n=f.label),f.attach&&(p.attach=f.attach,n=f.attach)),m&&m.length&&(s=zmUtil.getThreadIdArr(m)),"zm_Container"===zmTab.currentTab&&"unread"===n&&$(zmail.mailCenter.prevElem).hasClass("shw")&&s.length){var z,A=zmPrev.prevDetails(),B=A.msgId,C=-1,D=$.extend({},f);if(z=zmail.mailObj[B].T,C=s.indexOf(z),zmail.mailObj[B].TH&&C!==-1){""===f.fId?D.view="all":D.view="";var E=zmList.getMailSummaryList(f,zmail.mailObj[B].T);0===E.length&&(E=zmList.getMailSummaryList(D,zmail.mailObj[B].T),g=g.concat(E),q.mailId=g,m.splice(C,1),q.tmailId=m)}}if((f.fId===zmail.folId.dId||f.fId===zmail.folId.tId||0===i)&&m&&m.length&&(g=g.concat(m),m=[],q.mailId=g,q.tmailId=[]),g&&g.length){if(k=zmmailAct.separateArchive(g),k[0].length>200)return void zmUtil.succErrMsg("e",d.info.maxmailselection);p.mailId=k[0].join(),p.mailId.length||(delete p.mailId,delete q.mailId),k[0].length>0&&zmUtil.isSharedFolder(f.fId)&&(p.shId=q.shId=zmUtil.getShareId(f.fId),zmail.opType[b]?p.opType=zmail.opType[b]:p.opType=0)}if(k&&k[1].length>0){if(k[1].length>200)return void zmUtil.succErrMsg("e",d.info.maxarchivemails);q.amailId=k[1],p.amailId=k[1].join(),zmUtil.isSharedFolder(f.fId)&&(p.shId=q.shId=zmUtil.getShareId(f.fId),zmail.opType[b]?p.opType=zmail.opType[b]:p.opType=0)}if(m&&m.length){if(s.length>200)return void zmUtil.succErrMsg("e",d.info.maxconvselection);p.tmailId=s.join(),zmUtil.isSharedFolder(f.fId)&&(p.shId=q.shId=zmUtil.getShareId(f.fId),zmail.opType[b]?p.opType=zmail.opType[b]:p.opType=0)}}if(p.todo=$.inArray(b,h),"move"===b){var F,G;if(p.folId=q.folId=e.folId,p.mailId){for(F=p.mailId.toString().split(","),p.mailId="",G=0;G<F.length;G++)e.folId!==zmail.mailObj[F[G]].FD&&(0!==G&&""!==p.mailId&&(p.mailId+=","),p.mailId+=F[G]);p.mailId||delete p.mailId}if(p.tmailId&&1===i&&zmail.folCount[f.fId])for(F=m.toString().split(","),p.tmailId="",G=0;G<F.length;G++)e.folId!==zmail.mailObj[F[G]].FD&&(0!==G&&""!==p.tmailId&&(p.tmailId+=","),p.tmailId+=zmail.mailObj[F[G]].T)}else if("delete"===b)f.fId===zmail.folId.dId?p.fT=q.fT=1:f.fId===zmail.folId.teId?p.fT=q.fT=2:f.fId===zmail.folId.spId?p.fT=q.fT=4:f.fId===zmail.folId.tId?p.fT=q.fT=5:f.fId===zmail.folId.oId?p.fT=q.fT=6:p.fT=q.fT=0,p.mailId&&zmail.mailObj[p.mailId]&&zmail.mailObj[p.mailId].FD===zmail.folId.dId&&(p.fT=q.fT=1);else if("notspam"===b){var H,I;if(p.mailId){for(H=p.mailId.toString().split(","),I=0;I<H.length;I++)zmail.mailObj[H[I]].FD!==zmail.folId.spId&&H.splice(I,1);p.mailId=H.join()}}else if("newm"===b){var J=e.accId,K=$.parseJSON(e.cs);if(r=!1,K)if(zmail.accId===J)for(var L in K){var M=K[L];if(zmail.mailObj[M.M]=M,M.DT=M.RDT||M.DT,M.SN=M.NSN||M.SN,M.SHID&&zmUtil.isSharedFolder(M.SHID))zmail.mailObj[M.M].FD=M.SHID;else{var N=M.FD;M.S||(M.FD===zmail.folId.spId||M.FD===zmail.folId.tId?zmmailAct.updateCount({fId:N,mode:"inc",count:1,isHighlight:!1}):zmmailAct.updateCount({fId:N,mode:"inc",count:1,isHighlight:!0}))}$.publish("/maction/newm",[[M]])}else zmUtil.updateCountForAcc(J,"inc",1)}else p.todo===-1&&(p.todo=-1);var O=zmAdHocSettings.getSuppressedMessagesState();if(f.fId!==zmail.folId.dId&&f.fId!==zmail.folId.tId&&q.tmailId&&q.tmailId.length&&"on"===O.conversationAction&&(!e||!e.scac)){var P,Q;switch(b){case"delete":P=f.fId===zmail.folId.tId||f.fId===zmail.folId.spId?"delete":"trash";break;case"spam":case"move":P=b}if(e=e||{},e.scac=!0,P)return Q=(q.mailId&&q.mailId.length||0)+zmUtil.getTotalMailCountInThreads(q.tmailId)+(q.amailId&&q.amailId.length||0),void ba(P,Q,function(c){e.listingType=c,zmmailAct.doActions(b,a,e)},f)}if(p.mailId||p.tmailId||p.amailId||"newm"===b||(zmUtil.hideMenu(),r=!1),"bulkaction"!==p.mode&&(1===i||2===i&&(n===zmail.folId.spId||n===zmail.folId.tId)||n===zmail.folId.dId?p.folderSpec=1:p.folderSpec=i,o=e&&e.listingType?e.listingType:zmAdHocSettings.getConversationActionType(),2!==p.folderSpec||"delete"!==b&&"spam"!==b&&"move"!==b||(p.folderSpec=parseInt(o))),r){var R=Z;if("bulkaction"===p.mode?(q.preAction=!1,R=V):p.shId||"notspam"===b?q.preAction=!1:q.preAction=!0,q.isUserAction=!0,j(p,q,R),q.preAction){var S=$.extend({},p),T=$.extend({},q);aa(b,S,T)}}},rmDuplicateLabel:function(a,b){for(var c,d,e,f=a.toString().split(","),g=f.length,h=[],i=0;i<g;i++){if(e=f[i],d=zmail.mailObj[e].TAG,c=!1,d){var j;for(j=0;j<d.length;j++)if(d[j]===b){c=!0;break}}c||h.push(e)}return h},separateArchive:function(a){for(var b=[],c=[],d=a.length,e=zmail.mailObj,f=0;f<d;f++)1===e[a[f]].AR?c.push(a[f]):b.push(a[f]);return[b,c]},updateCount:function(a){var b=a.fId,c=a.mode,d=a.count,e=a.actionObj,g=a.isHighlight,h=!1;if(!zmUtil.isSharedFolder(b)&&b!==zmail.folId.sId&&b!==zmail.folId.dId){if(e){var i=e.src,j=e.dest,k=e.action,l=["move","spam","notspam","delete"],m=[zmail.folId.spId,zmail.folId.tId,zmail.folId.sId];k&&l.indexOf(k)!==-1&&(m.indexOf(b)===-1||b!==i&&b!==j||(h=!0))}else h=!0;var n,o="zmlTreeH",p={};p=zmail.mailLeft.getNodes()[0].getLayer(o),p.updateCount(b,c,d,g,!0),h&&(n=zmInit.getUnreadViewCount(),o="zmlviewH",p=zmail.mailLeft.getNodes()[0].getLayer(o),p.updateCount("zm_unread","upd",n),zmUtil.updateCountForAcc(zmail.accId,"upd",n)),f=zmInit.getListingDetObj(),(f.fId||"unread"===f.view&&h)&&zmInit.updateHeaderBand("notification"),zmWinTitle.updateTitle()}},handleWMSEvents:function(a,b,c){
var d,e,f,g,h,i;if(d=["moveMail","markFlagged"],d.indexOf(a)!==-1&&c.AID===zmail.accId)if("moveMail"===a){var j=c.FD&&"null"!==c.FD?c.FD:"";if(f=c.MLIST||[],e=[],!j||!f.length)return;if(zmail.mailObj[f[0]]){var k=zmail.mailObj[f[0]].FD;if(j===zmail.folId.tId&&""!==zmfolAction.getEmptyFolderStatus(k))return}for(g in f)h=f[g].M||"",i=zmail.mailObj[h],h&&"null"!==h&&i&&i.FD!==j&&e.push(String(h));if(!e.length)return;Z({result:"success"},{action:"move",mailId:e,folId:j,from:"notifier"})}else if("markFlagged"===a){f=c.MLIST,e=[];var l="1"===c.S?"read":"unread",m=c.S;if("string"==typeof f&&(f=f.split(",")),f=f||[],!f.length)return;for(g in f)h=f[g]||"",i=zmail.mailObj[h],h&&"null"!==h&&i&&m!==String(i.S)&&e.push(String(f[g]));if(!e.length)return;_({result:"success"},{action:l,mailId:e})}},createCommentEntity:function(){var a={no_data:{code:0,message:b.publishcomment.error.maildatanotavlbl},no_mention:{code:1,message:b.publishcomment.error.userorgrouprequire},req_fail:{code:2,message:b.publishcomment.error.requestfail}};return function(b,c,d){var e=$.Deferred();return b=String(b||""),c=c||"",b?c&&c.length?zmAjq.XHR({u:zmail.conPath+"/mA.do",t:"POST",fn:function(){e.resolve()},p:{mode:"createCommentEntity",messageID:b,shareWith:c,shareConversation:d},csr:"s",efn:function(){e.reject({error:a.req_fail})}}).fail(function(){e.reject({error:a.req_fail})}):e.reject({error:a.no_mention}):e.reject({error:a.no_data}),e.promise()}}(),retrieveComments:function(){var a={};return function(b){var c=$.Deferred();b||c.reject();var d="comments_"+b;return a[d]?c=a[d]:(a[d]=c,c.always(function(){a[d]=void 0,delete a[d]}),zmAjq.XHR({u:zmail.conPath+"/mailComments.do",p:{accId:zmail.accId,entityId:b,groupId:zmail.zuid,comments:!0,entityType:1},t:"post",fn:function(a){c.resolve(a)},efn:function(){c.reject()}})),c.promise()}}(),notifyBulkAction:function(a){var c,e=a.bulk,f="",g="",h="",i=zmUtil.getFolId(),j="";if(e){zmInit.getFolderTreeCount(),e.indexOf("'")!==-1&&(e=e.replace(/'/gi,'"')),e=$.parseJSON(e);var k={SEARCH:{text:b.filterview.search,id:"search"},FOLDER:{text:zmInit.findFolName(e.fId)+" "+b.filterview.folder,id:e.fId},LABEL:{text:zmUtil.findTagName(e.label)+" "+b.filterview.tagview,id:e.label},UNREAD:{text:b.filterview.unreadview,id:"unread"},ALLMESSAGE:{text:b.filterview.allmsgview,id:"all"},FLAGED:{text:b.filterview.flagview,id:"flag"}};switch(c=e.action,g=e.view,h=k[g].text,j=k[g].id,"SEARCH"===g||zmPrev.prevDetails("zm_Container").msgId||i===j&&$.publish("/mail/listMails",{}),c){case"READ":f=zmText.applyArgs(d.bulkaction.view.readcomplete,{viewtype:h});break;case"UNREAD":f=zmText.applyArgs(d.bulkaction.view.unreadcomplete,{viewtype:h});break;case"MOVE_TO":var l=e.actionList,m=zmInit.findFolName(l);f=zmText.applyArgs(d.bulkaction.view.movecomplete,{destinationfolder:m,viewtype:h});break;case"SPAM":f=zmText.applyArgs(d.bulkaction.view.spamcomplete,{viewtype:h});break;case"NOTSPAM":f=zmText.applyArgs(d.bulkaction.view.notspamcomplete,{viewtype:h});break;case"LABEL":var n=e.actionList,o=zmUtil.findTagName(n);f=zmText.applyArgs(d.bulkaction.view.tagadded,{tagname:o,viewtype:h});break;case"UNLABEL":n=e.actionList,o=zmUtil.findTagName(n),f=zmText.applyArgs(d.bulkaction.view.tagremoved,{tagname:o,viewtype:h});break;case"FLAG":case"CLEAR_FLAG":var p=parseInt(e.actionList);switch(p){case 0:f=zmText.applyArgs(d.bulkaction.view.clearflag,{viewtype:h});break;case 1:f=zmText.applyArgs(d.bulkaction.view.infoflag,{viewtype:h});break;case 2:f=zmText.applyArgs(d.bulkaction.view.impflag,{viewtype:h});break;case 3:f=zmText.applyArgs(d.bulkaction.view.followupflag,{viewtype:h})}break;case"DELETE":case"DELETE_FROM_SPAM":case"DELETE_FROM_TEMPLATE":case"DELETE_FROM_DRAFT":case"DELETE_FROM_TRASH":f=zmText.applyArgs(d.bulkaction.view.deletecomplete,{viewtype:h});break;case"ARCHIVE":f=zmText.applyArgs(d.bulkaction.view.archivecomplete,{viewtype:h});break;case"UNARCHIVE":f=zmText.applyArgs(d.bulkaction.view.unarchivecomplete,{viewtype:h})}zmUtil.succErrMsg("s",f)}else if(a.sweep){switch(e=a.sweep,zmInit.getFolderTreeCount(),e.indexOf("'")!==-1&&(e=e.replace(/'/gi,'"')),e=$.parseJSON(e),c=e.action){case"DELETE":f=d.bulkaction.sweep.deletecomplete;break;case"ARCHIVE":f=d.bulkaction.sweep.archivecomplete}zmUtil.succErrMsg("s",f)}},updateDraftCountInUI:function(a,b,d,e){var f,g;""!==b&&void 0!==b&&(f=0===i?$(zmail.mailCenter.listElem).find("#"+a):w(a,e),"discard_draft"===b?d?(g=d>1?d+" "+c.common.draftPlural:d+" "+c.common.draft,f.find(".SC_dft span").html(g)):f.find(".SC_dft span").html(""):"save_draft"===b&&zmail.mailObj[a]&&!zmail.mailObj[a].DMID&&(f.length&&(a=f.attr("id"),0===a.indexOf("t")&&(a=a.substring(1))),d=zmail.mailObj[a].DC?zmail.mailObj[a].DC+1:1,g=d>1?d+" "+c.common.draftPlural:d+" "+c.common.draft,f.find(".SC_dft span").html(g)))},rapplyAction:_,rdoAction:Z,confThreadAction:ba,mailShareTip:ea,updateUnreadStatusforThd:l,updateFlagStatusforThd:m,setFlagStatusforThd:n,updateLabelsforThd:o};return da(),fa}(),window.zmUrlAct=function(){"use strict";var a={},b=["folder","share","tags","views","all"],c=["view_unread","view_archive","view_all","flag_all","flag_1","flag_2","flag_3","label_all","label","view_attach","attach_1","attach_2"],d={},e={},f={prev:[],curr:[]},g=function(){zmail.mailOpt.isFol?f.curr=["folder","inbox"]:f.curr=["views","unread"]},h=function(a){f.curr.length&&(f.prev=f.curr),f.curr=a},i=function(a){var b=[];if(a.viewId)if(a.viewId&&"-1"===a.viewId)"label"===a.view?b.push("tags"):b.push(a.view),b.push("all");else{if(!a.viewId||"-1"===a.viewId)return!1;"label"===a.view?b.push("tags"):"attach"===a.view?b.push("attach"):b.push(a.view),b.push(a.viewId)}else"all"===a.view?b=[]:(b.push("view"),b.push(a.view));return b},j=function(a,b){a.length||(a=f.curr());for(var c=b.length,d=0;d<c;d++)if(a.indexOf(b[d])!==-1){a=a.slice(0,a.indexOf(b[d]));break}return a},k=function(){var a=zmail.mailLeft.selLayerId,c="";return"zmlTreeH"===a?c=b[0]:"zmlSTreeH"===a?c=b[1]:"zmllabelH"===a?c=b[2]:"zmlviewH"===a&&(c=b[3]),c},l=function(a){var b="",c="";if(a===zmail.folId.iId||"inbox"===a)b+="inbox",c=zmail.folId.iId;else if(a===zmail.folId.dId||"drafts"===a)b+="drafts",c=zmail.folId.dId;else if(a===zmail.folId.spId||"spam"===a)b+="spam",c=zmail.folId.spId;else if(a===zmail.folId.teId||"templates"===a)b+="templates",c=zmail.folId.teId;else if(a===zmail.folId.sId||"sent"===a)b+="sent",c=zmail.folId.sId;else if(a===zmail.folId.tId||"trash"===a)b+="trash",c=zmail.folId.tId;else if(a===zmail.folId.oId||"outbox"===a)b+="outbox",c=zmail.folId.oId;else if("unread"===a||"zm_unread"===a)b+="unread",c="zm_unread";else if("all"===a||"zm_all"===a)b+="all",c="zm_all";else if("flag"===a||"flagged"===a||"zm_flag"===a)b+="flagged",c="zm_flag";else if(/^\+?(0|[1-9]\d*)$/.test(a)){if(!(zmUtil.isFolderId(a)||zmUtil.isSharedFolder(a)||zmUtil.isLabelId(a)||zmUtil.isViewId(a)))return{folId:!1};b+=a,c=a}return{hashTxt:b,folId:c}},m=function(a){var b=[],c="",d="";return c=k(),d=l(a),b.push(c),b.push(d.hashTxt),{hashTxt:b,folId:d.folId}};a.update=function(a){var b,c,d,e=zmsuite.getAppRouter("zm_Container");if(b=a.from?a.from:a.folId&&!a.view||a.view&&a.folId===a.viewId||a.folId&&"zm"===a.folId.substring(0,2)?"zmLeft":"dropMenu","zmLeft"===b){var g=m(a.folId);c=g.hashTxt}else if("dropMenu"===b){var k=i(a);d=f.curr;var l=["view","tags","flag","attach","p"];d.length>2&&(d=j(d,l)),c=d.concat(k)}else{if("zmCenter"!==b)return;var n=function(){var b=zmail.folId,c=zmUtil.getFolId();if(c!==b.teId&&c!==b.oId&&c!==b.dId&&0===a.opentype){var d=a.msgId;return"t"===d.charAt(0)&&(d=d.substring(1)),"th"===a.type&&(d=zmCenterListing.mailObjectAPI.getViewParentOf("c"+a.msgId).id),d}};if(d=f.curr,d.length>2&&(d=j(d,["p"])),a.remove)c=d;else{var o=n();c=o?d.concat(["p",o]):d}}c.toString()!==f.curr.toString()&&(h(c),e.setParams(c),e.update())};var n=function(a){var f,g,h={};h[0]=function(a){if(!a[0]||!a[1])return!1;if(b.indexOf(a[0])!==-1){var c=l(a[1]);return!!c.folId&&(d.fId=c.folId,!0)}return!1},h[1]=function(a){var b;return"tags"===a[0]&&(a[0]="label"),b="label"===a[0]&&"all"!==a[1]?a[0]:a[0]+"_"+a[1],c.indexOf(b)!==-1&&("view"===a[0]?"all"!==a[1]&&(d.view=a[1]):(d.view=a[0],"all"!==a[1]?d.viewId=a[1]:d.viewId=-1),!0)},h[2]=function(a){var b;return"p"===a[0]&&(b="t"===a[1].charAt(0)?a[1].substring(1):a[1],!!/^\+?(0|[1-9]\d*)$/.test(b)&&(e.msgId=a[1],e.type="lt",e.opentype=0,!0))};for(var i=0;i<a.length;i+=2)if(g=i/2,2===i&&"p"===a[i]&&(g=i),f=h[g]([a[i],a[i+1]]),!f)return!1;return!0},o=function(a){d={},e={};var b=function(b){var c=a.toString();return b=c.toLowerCase(),b=b.split(",")},c=function(){var b,c,d,e;return!f.curr.length||(d=f.curr.indexOf("p")===-1?f.curr.length:f.curr.indexOf("p"),e=a.indexOf("p")===-1?a.length:a.indexOf("p"),b=f.curr.slice(0,d),c=a.slice(0,e),b.toString()!==c.toString())},g=function(){var b;b="t"===e.msgId.charAt(0)?e.msgId.substring(1):e.msgId,zmail.mailObj[b]&&($(zmail.mailCenter.listElem).find("#"+b).length||$(zmail.mailCenter.listElem).find("#t"+b).length)?zmList.showMailPreview(e):(zmsuite.isMaxLimitReached()||zmList.getMailData({msgId:e.msgId,opentype:2,type:"lt",src:"external"}),a=f.curr.length?f.curr:a.slice(0,a.indexOf("p")))};if(a=b(a),n(a)){if(d.fId)if("m"!==zmApp.currentApp&&zmApp.showApp("m"),"zm_Container"!==zmTab.currentTab&&zmsuite.showExistingApp("zm_Container"),c())if("attach"===d.view&&"2"===d.viewId)zmList.loadAttachviewer();else if(e.msgId){var h=$.Deferred();zmList.showMailListing(d,{retainPreview:!1,sortAscending:void 0,mlDefObj:h}),$.when(h).done(function(){g()})}else zmList.showMailListing(d);else e.msgId?g():zmPrev.prevDetails().msgId&&zmPrev.clsPreview();return!0}return!1},p=function(a){var b="lt",c=function(){var c=zmail.mailObj[a];c&&c.TH&&(b="th"),zmList.getMailData({msgId:a,opentype:2,type:b,src:"external"})},d=function(){a=a.substring(1),zmList.getMailData({msgId:a,opentype:2,type:b,src:"external",tId:a})};"t"!==a.charAt(0)?c():d()},q=function(a){return a.length?1===a.length&&("inbox"===a[0]?a.unshift("folder"):"unread"===a[0]&&a.unshift("views")):1===zmail.mailOpt.isFol?(a.push("folder"),a.push("inbox")):(a.push("views"),a.push("unread")),a};return a.manualHandler=function(a){var b=!1;a=q(a);var c={tab:{handler:function(a){zmsuite.isMaxLimitReached()||(p(a[1]),b=!0)}},"switch":{handler:function(a){var c=a[1];c&&zmail.aInfo[c]&&(zmUtil.switchAccount(c),b=!0)}}};return a[0]in c?(c[a[0]].handler(a),{updateParams:b,defaultAction:!1}):{updateParams:o(a)}},g(),a}(),window.zmRestore=function(){"use strict";var a={},b="zm_Container",c=["listing","expandThd","preview","tab"],d=function(){return"restore"===zmAdHocSettings.getLPageType()};a.saveState=function(a,e){if(d()){if(c.indexOf(a)===-1)return;var f=zmsuite.getAppObj(b).obj.stateData.data;"listing"===a?f.listing.view=e:"expandThd"===a?f.listing.expand=e:"preview"===a&&(f.preview=e),zmState.sendRequestToSaveState()}},a.restoreTabs=function(a){a.app&&a.category&&$.publish(a.app+"/"+a.category,[a])};var e=function(a){if(a){var c=zmail.mailObj[a];if(c){var d;c.TH&&(d=zmCenterListing.mailObjectAPI.getViewParentOf("c"+a)),c.TH&&zmUtil.getFolId()!==zmail.folId.sId&&zmUtil.getMLConversionValue()&&d&&d.id===a?zmUtil.initScroll(zmsuite.getCenter(b)[0].getNodes()[2].$el,"t"+a,"t"+a):zmUtil.initScroll(zmsuite.getCenter(b)[0].getNodes()[2].$el,a,a)}}},f=function(a,c){if(a){var d=$.Deferred();if($.when(d).done(function(){zmPrev.prevDetails(b).msgId&&e(a),c.deferred.resolve()}),zmail.mailObj[a]&&($(zmail.mailCenter.listElem).find("#"+a).length||$(zmail.mailCenter.listElem).find("#t"+a).length)){var f=$("#"+a).attr("data-ty")||$("#t"+a).attr("data-ty"),g={msgId:a,type:f,opentype:zmail.mailOpt.isPopup},h=zmList.getListingElemObj(g);zmList.showMailPreview({msgId:a,opentype:0,type:f,tabId:b},h,void 0,d)}else zmsuite.isMaxLimitReached()||zmList.getMailData({msgId:a,opentype:2,type:"lt",src:"external"},void 0,d)}},g=function(a,b){var c=$(zmail.mailCenter.listElem).find("#t"+a);if(!c.length)return void(b&&b.resolve());var d=$("#t"+a).attr("data-ty"),e={msgId:a,type:d,opentype:zmail.mailOpt.isPopup},f=zmList.getListingElemObj(e),g=$(c).find(".zmtCt"),h=$(g);f.rowElem=$(g).closest(".zmL"),zmList.showHideThread(h,f,void 0,b)},h=function(a){var b=a.listing.view.fId,c=a.listing.view.view,d=a.listing.view.viewId;return!(b===zmail.folId.iId&&zmail.mailOpt.isFol&&""===c&&""===d||"zm_unread"===b&&!zmail.mailOpt.isFol&&"unread"===c&&""===d)};return $.subscribe("/mail/switchAccount",function(a,c){var d=zmsuite.getAppObj(b).obj.stateData.data;d.accId=c}),a.restoreMailApp=function(a,b){try{var c=a.accId;if(zmail.accId===c){var d=$.Deferred();if($.when(d).done(function(){var c=$.Deferred();a.listing.expand.mId?g(a.listing.expand.mId,c):c.resolve(),$.when(c).done(function(){window.setTimeout(function(){a.preview.p?f(a.preview.p,b):b.deferred.resolve()},400)})}),h(a)){var e=a.listing.view;if("attach"===e.view&&"2"===e.viewId)return zmList.loadAttachviewer(),void b.deferred.resolve();zmList.showMailListing(a.listing.view,{retainPreview:!1,sortAscending:void 0,mlDefObj:d})}else d.resolve()}else b.deferred.resolve()}catch(i){b.deferred.resolve()}},a}();