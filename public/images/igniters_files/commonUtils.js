window.zmUtil=function(){"use strict";var a=zmText.get("commonUtils");zmail.isCRMUser=!0;var b=function(){$(".SC_ddnB").removeClass("SC_ddnB"),$(".SC_ddn").removeClass("SC_ddn"),$(".SC_bsel").removeClass("SC_bsel")},c=function(a,b){var c=b.groupId||zmail.zuid;switch(a){case"CreateNote":zmUtil.hideMenu();var d={descHTML:b.html,desc:b.text,groupId:c,richText:!0};zmUtil.loadNotes("popup",d);break;case"CreateTask":zmUtil.hideMenu(),zmUtil.loadTask({action:"addCTask",groupId:c,tasks:{SUMMARY:b.text}});break;case"CreateEvent":zmUtil.hideMenu(),zmApp.loadCalendar("/calendar/event",{SUM:b.text});break;case"CreatePost":zmUtil.hideMenu(),zmUtil.loadNewPostDialog(b.text);break;case"CreateLink":var e={mode:"create",groupId:zmail.zuid,catid:""},f=zmUtil.parseURLS(b.text,{httpOnly:!0});if(f.length){var g=f[0];e.link=g.url,b.text!==g.url&&(e.summary=b.text)}else e.summary=b.text;zmUtil.loadLink(e)}},d=function(){var a=0,b=0,c=0,d=0;if(window.getSelection&&document.createRange&&"undefined"!=typeof document.createRange().getBoundingClientRect){var e=window.getSelection();if(e.rangeCount>0){var f=e.getRangeAt(0).getBoundingClientRect();a=f.left,b=f.top,c=f.width,d=f.height}}else if(document.selection&&"Control"!==document.selection.type){var g=document.selection.createRange();a=g.boundingLeft,b=g.boundingTop,c=g.boundingWidth,d=g.boundingHeight}return{x:a,y:b,width:c,height:d}},e=function(){return document.getSelection?document.getSelection().toString():document.selection?document.selection.createRange().text:""},f=function(){var a;if(document.selection&&document.selection.createRange)return a=document.selection.createRange(),a.htmlText;if(window.getSelection){var b=window.getSelection();if(b.rangeCount>0){a=b.getRangeAt(0);var c=a.cloneContents(),d=document.createElement("div");return d.appendChild(c),d.innerHTML}return""}return""},g=function(){var a,b,c=zmInit.getListingDetObj();b=zmsuite.getCenter()[0].getNodes()[0].$el.find("li [class=msi-filter]"),a=b.closest("li"),c.fId||c.flag?a.show():a.hide()},h=function(a,b,c){if(a){zmAdHocSettings.fetchFromObject(a.adhocUserSettings,a.adhocAccountSettings),zmPrev.clsPreview(),zmUtil.closeMailTabs(),zmInit.reInitListing(),zmail.accId=b.accId,zmail.folId=a.folId,zmail.folCount=a.folCount,zmail.folTree=a.folTree,zmail.mailList=a.mailList,a.cmpData&&"string"==typeof a.cmpData&&(zmail.updatecmp=!0,zmail.cmpdata=$.parseJSON(a.cmpData)),"m"===zmApp.currentApp?zmsuite.showWorkSpace("zm_Container"):zmApp.showApp("m"),zmail.savedSearchList=a.savedSearchList||{},"string"==typeof a.labInfo?zmail.labInfo=$.parseJSON(a.labInfo):zmail.labInfo=a.labInfo,zmail.accId===zmail.defAccId&&(zmail.zohoAccLabInfo=$.extend({},zmail.labInfo)),a.DEFFRM_ADDR&&(zmail.fromAddr=a.DEFFRM_ADDR),zmail.useCache=!1,zmail.applyState=!1,zmail.saveState=!1,zmail.loadCompleted=!1,zmail.accId===zmUtil.getZohoAccId()?zmail.shrTree=a.shrTree||[]:zmail.shrTree=[],zmInit.constructView(),zmInit.initMailList(),zmInit.updateCountTitle(),zmUtil.sTopMenu({type:"l"}),zmail.loadCompleted=!0;var d=zmInit.getUnreadViewCount();zmUtil.updateCountForAcc(zmail.accId,"upd",d),$.publish("/mail/accountSwitch",{status:"success",accountID:b.accId}),c&&c.resolve()}else $.publish("/mail/accountSwitch",{status:"failed",accountID:b.accId}),c&&c.reject()},i=function(b){var c={},d=zmail.labInfo,e={},f={};return c.type="label",c.search="name",c.display="display_text",c.liAttr={},c.showTooltip=!0,c.showCreate="function"==typeof b.onCreate,c.showCheckbox="function"==typeof b.onStateChange,"default"===b.accType&&(d=zmUtil.getTagList("default")),c.showCheckbox&&(b.labelState.selectedMails?e=zmlab.labelSelectionInfo({type:"selected"}):b.labelState.mailList?e=zmlab.labelSelectionInfo({type:"list",list:b.labelState.mailList}):b.labelState.labelList?b.labelState.labelList.forEach(function(a){e[a]="check"}):"function"==typeof b.labelState.dataCallback&&(e=b.labelState.dataCallback())),b.excludeList&&b.excludeList.forEach(function(a){f[a]=!0}),e=e||{},c.data=[],Object.keys(d).forEach(function(a){f[a]||c.data.push({id:a,name:d[a].label,display_text:zmfolAction.getShortFolderPath(d[a].dispName,{maxLength:20}),color:d[a].color,type:e[a]||"uncheck",tooltip:d[a].dispName})}),b.newLabels&&b.newLabels.forEach(function(a,b){c.data.push({id:void 0,name:a,display_text:zmfolAction.getShortFolderPath(a,{maxLength:20}),color:zmlab.DEFAULT_COLOR,type:e[a]||"uncheck",tooltip:a})}),b.showAllItem&&c.data.unshift({id:"all",name:a.common.all,display_text:a.common.all,color:zmlab.DEFAULT_COLOR,type:"uncheck",tooltip:a.common.all}),c.showCheckbox?c.onSelect=function(a){var c,d=a.type;"uncheck"===a.type||"partial"===a.type?(a.chkboxState(a,"check"),c=!0):(a.chkboxState(a,"uncheck"),c=!1),b.onStateChange(a.id,c,function(){a.chkboxState(d)},a.name)}:c.onSelect=function(a){"function"==typeof b.onSelect&&b.onSelect(a.id)},c.showCreate&&(c.addNew=function(a,c){b.onCreate(c)}),zmComponent.folderLabel(c)},j=function(b){var c,d={};return d.type="folder",d.search="name",d.display="display_text",d.liAttr={},d.showTooltip=!0,d.showCreate="function"==typeof b.onCreate,c=b.showAllItemText||a.common.all,d.data=[],"function"==typeof b.dataCallback&&(d.data=b.dataCallback()),b.showAllItem&&d.data.unshift({id:"all",name:c,display_text:c,tooltip:c}),d.onSelect=function(a){"function"==typeof b.onSelect&&b.onSelect(a.id,a)},d.showCreate&&(d.addNew=function(a,c){b.onCreate(c)}),zmComponent.folderLabel(d)},k=function(a){var b={},c={},d=[];return a.excludeList&&a.excludeList.forEach(function(a){c[a]=!0}),b.data=[],d=zmfolAction.getMailFolderPaths()||[],d.forEach(function(d){c[d.id]||a.excludeChild&&c[d.parentID]||b.data.push({id:d.id,name:d.name,display_text:zmfolAction.getShortFolderPath(d.path,{maxLength:20}),tooltip:d.path})}),a.dataCallback=function(){return b.data},j(a)},l=function(a){return a=a||{},a.type="label",a.ui={search:!1,label:{color:!1}},zmComponent.folderLabel(a)},m=function(a){return a=a||{},a.type="groups",a.ui={search:!0,label:{color:!1},showUnreadCount:a.showUnread},zmComponent.folderLabel(a)},n=function(a,b){var c,d,e,f,g,h,n,o,p,q="zm_flpopup",r=$(b.parentDOM),s=$(b.viewDOM||document.body),t="pleft",u="";u=b.direction||"",c="folder"===a?k(b):"label"===a?i(b):"genericWithCheckBox"===a?l(b):"groups"===a?m(b):j(b),c=$(c),c.attr("id",b.domID||q);var v=c.find(".scrlldiv"),w=v[0].getBoundingClientRect();v.css({height:w.height+"px",width:w.width+"px","max-height":"200px"}),c.on("mousedown",function(a){zmUtil.stopEvents(a,!0)}),e=r[0].getBoundingClientRect(),f=c[0].getBoundingClientRect(),g=s[0].getBoundingClientRect(),h=e.left+f.width+20<g.right?e.left:e.left-(f.width-e.width),"dropdown"===b.displayAs?(n=e.bottom,b.offsets&&(h+=b.offsets.left||0,n+=b.offsets.top||0),c.css("left",h+"px"),c.css("top",n+"px"),b.parWidth&&e.width&&(c.css("width",e.width+"px"),v.css({width:"auto"}))):"popup"===b.displayAs&&(p=$("<li/>").append(c),!u&&g.bottom<e.bottom+f.height&&(u="bottom"),o={par:r,showArrow:!0,liDom:[p[0]],ulClass:"noclass",align:t,spanClass:"SC_ddFil",direction:u},d=new zmDropDownMenu,d.setDropObj(o));var x=function(){c&&(b.hltPar&&(b.hltDOM?$(b.hltDOM).removeClass("SC_ddn"):r.find("b").removeClass("SC_ddn")),c.removeClass("shw"),c.css("display","none"),$(c).remove(),c=void 0,d=void 0,b.onHide&&b.onHide(),$("#zm_flpopup").remove())},y=function(){b.hltPar&&(b.hltDOM?$(b.hltDOM).addClass("SC_ddn"):r.find("b").addClass("SC_ddn")),c.addClass("shw"),c.css("display",""),d&&d.paint(),$.publish("/mail/menuCreated",{menuHandler:x})};return{elem:c,show:y,hide:x}},o={createFolder:function(a){var b=$.Deferred();return zmfolAction.isValidName(a,void 0,{opType:"new"})?(zmfolAction.sendNewFolderReq(a,{reqDoneClbk:function(a,c){a?b.resolve({folderID:c}):b.reject()}}),b.promise()):(b.reject(),b.promise())},createTag:function(a){var b=$.Deferred();return zmlab.isValidName(a)?(zmlab.labelCreate(a,"",{reqDoneClbk:function(a,c){a?b.resolve({tagID:c}):b.reject()}}),b.promise()):(b.reject(),b.promise())}},p=function(){var a=function(a,b){for(var c=zmail.mailObj,d=a.length,e=0;e<d;e++)if(c[a[e]]&&1===c[a[e]].AR?b.unarchive=!0:b.archive=!0,b.unarchive&&b.archive)return};return function(b,c){var d,e,f,g={archive:!1,unarchive:!1},h=zmInit.getListingDetObj(),i=zmail.mailObj,j=zmsuite.getCenter("zm_Container")[0].getNodes()[2].$el;if(b.length&&a(b,g),g.unarchive&&g.archive)return g;for(e=c.length,f=0;f<e;f++)if(d=i[c[f]],d.AR?(g.unarchive=!0,g.archive||(b=zmList.getMailSummaryList(h,d.T),b.length&&a(b,g))):(g.archive=!0,!g.unarchive&&j.find("#thd"+d.M).is(":visible")&&(b=zmList.getMailSummaryList(h,d.T),b.length&&a(b,g))),g.unarchive&&g.archive)return g;return g}}(),q=function(){return zmAppLoader.load("notes")},r=function(){return zmAppLoader.load("task")},s=function(){return zmAppLoader.load("links")},t={},u=function(a){""===a&&(a="mail listing"),t.searchKey=a,zmail.supportWidget&&zmail.supportWidget.updateSearchKey(0,a)},v=function(a){t.emailId=a,zmail.supportWidget&&zmail.supportWidget.updateTicketDetails({supportId:a})},w=function(a){return t[a]},x={taskloaded:!1,taskDeferred:void 0,updateFaqKey:u,updateSupportId:v,getfaqDetails:w,requireNotesModule:q,requireTaskModule:r,requireLinkModule:s,loadNotes:function(a,b,c){zmUtil.requireNotesModule().done(function(){if("popup"===a){var d={};b&&b.richText&&(d.richText=!0,b.richText=void 0),zNote.loadAddNote(b,d)}else"openNote"===a?zNote.loadAndOpenNote({namespaceId:b.gId,id:b.e}):"addNote"===a?zNote.loadAddNote(b,{mountingElem:c.ele,doneCallback:c.callback}):"viewNote"===a&&zNote.streamListNote(b,c.ele)}).fail(function(){zmUtil.debugLog("zmUtil.loadNotes - REQUIRE module failed to load files")})},isNoteReactUser:function(){return!0},loadAppTour:function(a){zmAppLoader.load("zmsitetour").done(function(){zmTour.initAppTour(a)})},loadMailTour:function(a){zmAppLoader.load("mailTour").done(function(){zmTour.apps.mail.init({type:a})})},createTour:function(){var a=[],b={targetElement:"#zmlTree",zohocontext:!0,addWidth:50,addHeight:50};b.slides=[],b.slides.push({img:"ss/share1.png"}),b.slides.push({img:"ss/share2.png"}),b.slides.push({img:"ss/share3.png"}),b.slides.push({img:"ss/share4.png"}),a.push(b);var c={targetElement:".msi-attachment",zohocontext:!0};c.slides=[],c.slides.push({img:"ss/att1.png"}),c.slides.push({img:"ss/att2.png"}),c.slides.push({img:"ss/att3.png"}),a.push(c);var d={targetElement:"#zm_centerHolder .SC_mclst div:first",zohocontext:!0,addWidth:50,addHeight:30};d.slides=[],d.slides.push({img:"ss/conv1.png"}),d.slides.push({img:"ss/conv2.png"}),d.slides.push({img:"ss/conv3.png"}),a.push(d);var e={targetElement:".msi-streams",zohocontext:!0};e.slides=[],e.slides.push({img:"ss/streams1.png"}),e.slides.push({img:"ss/streams2.png"}),e.slides.push({img:"ss/streams3.png"}),e.slides.push({img:"ss/streams4.png"}),e.slides.push({img:"ss/streams5.png"}),a.push(e);var f={targetElement:".zm_comp .msi-barrow",zohocontext:!0};f.slides=[],f.slides.push({img:"ss/more1.png"}),f.slides.push({img:"ss/more2.png"}),f.slides.push({img:"ss/more3.png"}),f.slides.push({img:"ss/more4.png"}),a.push(f)},tourVersions:function(a,b,c){var d=c&&c.version?c.version:"all";a?zmTour.callAppSpecificTour(a,b):"all"===d&&zmUtil.createTour()},bookmark:{loadBookMark:function(a){zmAppLoader.load("links").done(function(){zmCont.isGroupLoaded(a)})},deleteLink:function(a){this.loadBookMark(function(){zmLink.deleteLink(a)})}},loadTask:function(a,b){zmUtil.requireTaskModule().done(function(){"taskapp"===a.load?b&&(zmTask.loadGroup(),b()):zmUtil.getTaskProjects().done(function(){zmUtil.initTaskAction(a,b)})})},getTaskProjects:function(){zmUtil.taskDeferred=zmUtil.taskDeferred?zmUtil.taskDeferred:zmail.Utils.DeferredCollection.create();var a=zmUtil.taskDeferred.has("taskProject"),b=zmUtil.taskDeferred.get("taskProject");return a||zmtCom.getProjects().done(function(){b.resolve()}),b.promise()},initTaskAction:function(b,c){var d;if("addSTask"===b.action)d=zmtCom.createTaskSubtask(b),c(d);else if("viewSTask"===b.action)d=zmtCom.showTasksubTask(b),c(d);else if("addCTask"===b.action||"addPopupTask"===b.action){var e=b.action;b.action="addCTask",d=zmtCom.createTaskSubtask(b);var f=$(".zm_compose"),g=f.offset(),h=g.top+"px",i=g.left+f.width()+"px",j=!1,k={title:a.taskApp.addTask,mask:!0,style:{width:"2000px"},heightPercent:80,customClass:"noanim",buttons:[{txt:a.buttonText.save,callback:function(b){var c=$(b.target||b.srcElement);j||(c.text(a.buttonText.saving),j=d.addTask(zmUtil.hideMenu))}},{isCancel:!0,txt:a.buttonText.cancel,callback:function(){zmUtil.hideMenu()}}],closeaction:zmUtil.hideMenu,afterDisplay:function(){$(".SC_Pop").on("mousedown",function(a){zmUtil.stopEvents(a,!0),$(".zcal_tilst").remove()})}};"addCTask"===e?k.posParent={top:h,left:i}:zmUtil.isZohoAccount(zmail.accId)||d.$el.find("#zt_ws input").attr("disabled","disabled");var l=d.$el;$("#addtask").length||$("body").append('<div id="addtask"></div>'),$("#addtask").html(l),zmsDialog.create("addtask",k),d.setHeightforEle(),$("#zmsdialog_addtask").mousedown(function(a){zmUtil.stopEvents(a,!0),zmtCom.addRemoveMenu("remove"),$(".zcal_cn").remove(),$("#zm_dropDown").remove(),$(".zcal_tilst").remove()}),$("#zmsdialogcont_addtask").mousedown(function(a){zmtCom.addRemoveMenu("remove"),$(".zcal_cn").remove(),$("#zm_dropDown").remove(),$(".zcal_tilst").remove()}),$.publish("/mail/menuCreated",[{menuHandler:function(){zmsDialog.remove()}}])}else"viewCTask"===b.action?zmtCom.openTask(b,"",zmUtil.viewTaskPopup):"addAsTask"===b.action&&(b.action="addCTask",d=zmtCom.createTaskSubtask(b),c(d))},loadLink:function(a,b){zmUtil.requireLinkModule().done(function(){zmLink.isProjLoaded().done(function(){zmUtil.initLinkAction(a,b)})})},initLinkAction:function(a,b){var c;"create"===a.mode?zmLink.constructAddLink(a):"viewSLink"===a.mode&&(c=zmLink.constructLinkBox({data:a.linkapp,groupId:a.groupId,bindClick:!0,from:"streams"}),b(c))},requireCrmInteg:function(){return zmAppLoader.load("crminteg")},viewTaskPopup:function(b){var c={title:a.taskApp.viewTask,mask:!0,style:{width:"2000px"},customClass:"noanim",closeaction:zmUtil.hideMenu},d=b.$el;$("#viewtask").length||$("body").append('<div id="viewtask"></div>'),$("#viewtask").html(d),b.setHeightforEle(),zmsDialog.create("viewtask",c),$("#zmsdialog_viewtask").mousedown(function(a){zmUtil.stopEvents(a,!0),zmtCom.addRemoveMenu("remove"),$(".zcal_cn").remove(),$("#zm_dropDown").remove()}),$("#zmsdialogcont_viewtask").mousedown(function(a){zmtCom.addRemoveMenu("remove"),$(".zcal_cn").remove(),$("#zm_dropDown").remove()}),$.publish("/mail/menuCreated",[{menuHandler:function(){zmsDialog.remove()}}])},postAsNewTask:function(b){var c=$('<div id="postNewTask"><table><tbody><tr><td><div>'+a.taskApp.taskTitle+'</div></td><td><input type="text" id="taskTitle" class="SC_tiput"></td></tr><tr><td>'+a.taskApp.group+'</td><td id="groupId"></td></tr><tr><td valign="top">'+a.taskApp.include+'</td><td><div class="ZMN_checkbox"><span><i class="msi-check" data-val="setSummary"></i>'+a.taskApp.description+'</span></div><div class="ZMN_checkbox"><span><i class="msi-check" data-val="setAssignee"></i>'+a.taskApp.assignee+'</span></div><div class="ZMN_checkbox"><span><i class="msi-check" data-val="setSubTask"></i>'+a.taskApp.subtask+'</span></div><div class="ZMN_checkbox"><span><i class="msi-check" data-val="setAttachment"></i>'+a.taskApp.attachments+'</span></div><div class="ZMN_checkbox"><span><i class="msi-check" data-val="setStatus"></i>'+a.taskApp.status+"</span></div></td></tr></table></div>");c.off("click").on("click",".ZMN_checkbox span",function(){var a=$(this).find("i"),b=a.hasClass("msi-check")?"msi-uncheck":"msi-check";a.attr("class",b)}),c.find("#taskTitle").val(b.title);for(var d="<div class='SC_select'><select><option value='"+zmail.zuid+"'>"+a.taskApp.myTask+"</option>",e="",f=zmCont.getGroupOrder(),g=zmCont.getGroup(),h=0,i=f.length;h<i;h++)e="",d+="<option value='"+f[h]+"'",b.groupId===f[h]&&(e=" selected='selected'"),d+=e+">"+g[f[h]].name+"</option>";d+="</select></div>",c.find("#groupId").html(d);var j={title:a.taskApp.postAsNew,buttons:[{txt:a.buttonText.ok,selected:!0,callback:function(){zmUtil.postNewTask(b.taskId,b.groupId),zmsDialog.remove()}},{txt:a.buttonText.cancel,isCancel:!0,callback:function(){return zmsDialog.remove(),!1}}],mask:!0,hideclose:!1,pos:"center"};$("#postNewTask").length&&$("#postNewTask").remove(),$("body").append(c),zmsDialog.create("postNewTask",j)},postNewTask:function(a,b){var c=$("#postNewTask"),d={};d.title=c.find("#taskTitle").val(),d.groupId=c.find("#groupId select").val(),d.frmGroupId=b,d.entityId=a,d.streamsView="true",d.actionType="addEntity",d.entityType="3",c.find(".ZMN_checkbox i").each(function(){var a=Boolean($(this).hasClass("msi-check"));d[$(this).data("val")]=a}),d.taction="addTaskasNew";var e=function(a,b){zmUtil.succErrMsg("s",zmText.get("task").common.taskAddSuccess),$.publish("/zm/task/addTask",[a,b])};zmAjq.XHR({u:zmail.conPath+"/taskAction.do",t:"POST",fn:e,p:d,ep:d})},taskTab:function(a){var b=zmText.get("task"),c={appname:b.common.app_name,appId:"zm_task_add",appIcon:"msi-task",data:{CNodes:"2"}};zmsuite.setWorkSpace(c);var d=zmsuite.getCenter(),e=d[0].getNodes(),f=d[1].getNodes();e[0].push([]),f[0].push(zmTask.template.addtaskHeader),f[0].setListener("click",function(a){"msi-close"===a&&zmsuite.closeWorkspace("zm_task_add")}),f[1].push(a.$el),e[1].$el.remove(),zmsuite.renderCenter(),d[1].show(),zmsuite.showWorkSpace("zm_task_add"),d[1].$el.addClass("SC_w100");var g=function(a,c,d){zmUtil.succErrMsg("s",b.common.taskAddSuccess),zmsuite.closeWorkspace("zm_task_add"),$.unsubscribe("/zm/task/addTask",g)};$.subscribe("/zm/task/addTask",g),a.$el.find("#ZT_prvSave").off("click").on("click",function(){a.addTask()})},notePopUp:function(a){$("body").append('<div id="nmask" class="whtmsk"></div>'),$("#nmask").append(a[0]),a[0].style.position="absolute",a[0].style.left="40%",a[0].style.top="20%";var b=$(a).find("Div.zn_cont");b.attr("contentEditable","true").focus().click(),$.publish("/mail/menuCreated",[{hideChildMenuFirst:!0,menuHandler:function(){$("#nmask")&&$("#nmask").length&&!$(".SC_Pop.wht").length&&($("#zn_foltagpopup").remove(),$("#nmask").children(".zn_note").find("div.zn_cont").blur(),$("#nmask").children(".zn_note").find("div.zn_tit").blur(),$("#nmask").remove())}}])},addSelectMenu:function(b,g){"undefined"!=typeof zmAdHocSettings&&"0"===zmAdHocSettings.getHelperBlockVisibility()||$(b).off("mouseup.addSelectMenu").on("mouseup.addSelectMenu",function(b){setTimeout(function(){var b=e(),h=f();g=g||{},g.text=b,g.html=h;var i=d();if(b&&b.trim().length){var j=$("<li><span><i data-action='CreatePost'  class=msi-status title='"+a.create.post+"'></i></span><span><i data-action='CreateNote'  class=msi-notes title='"+a.create.note+"'></i></span><span><i data-action='CreateTask' class=msi-task title='"+a.create.task+"'></i></span><span><i data-action='CreateEvent' class=msi-calendar title='"+a.create.event+"'></i></span></li>");zmUtil.parseURLS(b,{httpOnly:!0}).length&&j.append("<span><i data-action='CreateLink'  class=msi-links title='"+a.create.link+"'></i></span>"),$(j[0]).find("span").off("click").on("click",function(a){a.stopPropagation();var b=$(this).find("i").attr("data-action");c(b,g)});var k={};k.clientX=i.x+i.width/2,k.clientX>window.innerWidth&&(k.clientX=(window.innerWidth-i.x)/2+i.x),k.clientY=i.y<0?i.y+i.height-12:i.y-12;var l={left:k.clientX,top:k.clientY,showArrow:!0,liDom:j,ulClass:"selectMenu",spanClass:"minwid"};i.y>0?l.direction="bottom":l.direction="top",zmsuite.showMenu(l)}},0)})},viewAssociatedMail:function(a,b){var c;a[b].email.accid!==zmail.accId&&(c={actionType:"viewGroupMailEntity",entityId:a[b].email.msgid,entityType:"1",streamsView:"true",streams:!0,groupId:a.gnrl.by,accId:a[b].email.accid}),zmList.getMailData({msgId:a[b].email.msgid,opentype:2,type:"lt",src:"external",eprm:c})},sizeConv:function(a){for(var b=0,c=["B","KB","MB","GB"];a>1023;)a/=1024,b++;var d="";return 0===b?d=Math.ceil(a/1024)+" KB":(a=Math.ceil(a),d=a+" "+c[b]),d},sizeValueUnround:function(a){if(!isNaN(a)){var b=[" bytes"," KB"," MB"," GB"," TB"," PB"," EB"," ZB"," YB"],c=Math.floor(Math.log(Number(a))/Math.log(2));c<1&&(c=0);var d=Math.floor(c/10);return a=Number(a)/Math.pow(2,10*d),a.toString().length>a.toFixed(1).toString().length&&(a=a.toFixed(1)),a+b[d]}},fileTyp:function(a){a=a||" ";var b,c="",d="",e=[],f=a,g=a.length,h=a.lastIndexOf(".");if(h!==-1){c=a.substring(h+1,g).toLowerCase(),g>20&&16!==h&&(b=a.substring(h-1,h),f=a.substring(0,16)+"..."+b+"."+c);var i={doc:!0,docx:!0,sxw:!0,odt:!0,rtf:!0,txt:!0,js:!0,java:!0,css:!0,jsp:!0,jspf:!0,c:!0,cpp:!0,xml:!0,go:!0,eml:!0,sh:!0,bat:!0,log:!0};d=i[c]?"msi-attdoc":"pps"===c||"ppt"===c||"pptx"===c||"odp"===c||"sxi"===c?"msi-attppt":"xls"===c||"xlsx"===c||"sxc"===c||"ods"===c||"csv"===c||"tsv"===c?"msi-attsheet":"mp3"===c||"mpa"===c||"wma"===c||"wav"===c||"ra"===c||"m3u"===c||"m4a"===c?"msi-attaudio":"avi"===c||"flv"===c||"mp4"===c||"mpg"===c||"wmv"===c||"vob"===c||"swf"===c||"mov"===c||"3gp"===c||"rm"===c?"msi-attvideo":"pdf"===c?"msi-attpdf":"zip"===c||"rar"===c?"msi-attzip":"jpg"===c||"jpeg"===c||"gif"===c||"png"===c||"bmp"===c?"msi-attimg":"msi-attothers"}else d="msi-attothers";return e.push(f),e.push(d),e.push(c),e},checktype:function(a,b){return a instanceof b},getFolIdByMsg:function(a){var b=null;return zmail.mailObj[a]&&zmail.mailObj[a].FD&&(b=zmail.mailObj[a].FD),b},getFolId:function(a){var b,c={};return c=a?a:zmUtil.isChildWindow()?zmWindow.getListingDetObj():zmInit.getListingDetObj(),b=c.fId||c.label||c.view||c.flag,"-1"!==b&&"1"!==b&&"2"!==b&&"3"!==b||(b="flag"),b},dropDown:function(b,c,d,e){zmUtil.stopEvents(e),"c"===d&&(c=$(c).parent().parent());var f,g=$(c).offset(),h=g.left,i=g.top-5,j=$("#zm_tAction").height();if("zn_actLst"===b&&(f=c.parentNode.parentNode.className,"zn_dd"===f?($("#"+b).html("<ul><li>"+a.common.attachFile+"</li><li>"+a.common.insertImg+"</li><li><div id='znActionAddlabel'>"+a.common.addTags+"</div></li></ul>"),zmUtil.setEditable({ele:$("#znActionAddlabel"),target:znNote.addTags,callback:zmfolAction.sendNewFolderReq,onenter:zmfolAction.isValidFolder,parentdiv:$("#zn_actLst")})):($("#"+b).html("<ul><li>"+a.common.importNotes+"</li><li>"+a.common.exportNotes+"</li><li><div id='znActionNewfolder'>"+a.common.newCat+"</div></li><li><div id='znActionNewlabel'>"+a.common.newTags+"</div></li></ul>"),zmUtil.setEditable({ele:$("#znActionNewfolder"),target:null,callback:zmfolAction.sendNewFolderReq,onenter:zmfolAction.isValidFolder,parentdiv:$("#zn_actLst")}),zmUtil.setEditable({ele:$("#znActionNewlabel"),target:null,callback:zmfolAction.sendNewFolderReq,onenter:zmfolAction.isValidFolder,parentdiv:$("#zn_actLst")}))),"r"===d){var k=$(c).width();h=zmInit.cliWid-(h+k);var l=$(c).children("ul")[0];$(l).addClass("SC_ddr"),$("#"+b).css({right:h+"px",top:i+j+"px"}).show()}else f=c.parentNode.parentNode.className,"zn_dd"===f&&(i-=10),$("#"+b).css({left:h+"px",top:i+j+"px"}).show();$(c).find("b").addClass("SC_ddn")},hasFolSpecConversation:function(a){var b=[zmail.folId.dId,zmail.folId.teId,zmail.folId.sId,zmail.folId.tId,zmail.folId.oId];return!(zmUtil.isChildWindow()||!zmTab.currentTab.indexOf("zm_srch")||!zmUtil.isFolderId(a)||b.indexOf(a)!==-1)},getMLConversionValue:function(a){var b=zmail.folTree;if(a||(a=zmUtil.getFolId()),zmUtil.hasFolSpecConversation(a)){var c=zmfolAction.getParentFolderId(a);return c?b[1][c].CH[a].CV:b[0][a].CV}return zmail.folviewThread},sTopMenu:function(a){var b=a.type,c=a.iconsDiv,d=a.listingType,e=a.info,f=a.tabId||zmTab.currentTab;d=d||zmUtil.getMLConversionValue(),"zm_srch1"===f&&(d=0),zmUtil.hideMenu(),c=c||zmsuite.getCenter(f)[0].getNodes()[0];var h,i=c.$el,j=!1,k={},l=!1;if(zmUtil.isChildWindow()?(k=zmWindow.getListingDetObj(),l=!0):k="zm_srch1"===f?zmSearchUtil.getSearchViewDetails():zmInit.getListingDetObj(),i.find(".msi-folder").closest("li").show(),c.showGroup("view"),c.showGroup("LViewType"),"l"===b){h=f,h=h.indexOf("zm_tab")?h.indexOf("zm_srch")?zmUtil.getFolId():zmSearchUtil.getSearchedFolders()[0]||f:zmsuite.getCenterOuter(f).$el.data("data-detail").fId,zmUtil.isSharedFolder(h)&&(j=!0);var m,n=!a.isClsPrev&&zmUtil.getSelectedMails(f)||[[],[]];if("zm_Container"===f||"zm_srch1"===f)m=p(n[0],n[1]);else{m={archive:!0,unarchive:!0};var o=n[0][0]||"";o.indexOf("t")===-1&&(zmail.mailObj[o]&&zmail.mailObj[o].AR?m.archive=!1:m.unarchive=!1)}var q=n[0].length+n[1].length;c.hideGroup("sendOutbox"),c.showGroup("SortCustom"),zmUtil.isFolderId(h)?c.showGroup("action"):c.hideGroup("action"),q?(c.showGroup("action"),c.showGroup("MoveLabel"),c.showGroup("spamTrash"),c.showGroup("Archive"),h===zmail.folId.spId?(i.find(".msi-spam").closest("li").hide(),i.find(".msi-notspam").closest("li").show(),c.hideGroup("MoveLabel"),c.hideGroup("Archive")):h===zmail.folId.sId||h===zmail.folId.oId||h===zmail.folId.teId||h===zmail.folId.dId?(h!==zmail.folId.teId&&h!==zmail.folId.dId||c.hideGroup("action"),h===zmail.folId.oId&&(c.showGroup("sendOutbox"),c.hideGroup("action")),h!==zmail.folId.sId&&(h===zmail.folId.teId?(i.find(".msi-folder").closest("li").hide(),c.hideGroup("Archive")):(c.hideGroup("MoveLabel"),c.hideGroup("SortCustom"),c.hideGroup("Archive"))),i.find(".msi-spam").closest("li").hide(),i.find(".msi-notspam").closest("li").hide()):(i.find(".msi-notspam").closest("li").hide(),i.find(".msi-spam").closest("li").show(),h===zmail.folId.tId&&c.hideGroup("Archive")),1===q&&(h!==zmail.folId.spId&&h!==zmail.folId.oId&&h!==zmail.folId.dId||c.hideGroup("MoveLabel")),j&&c.hideGroup("MoveLabel"),m.archive||c.hideGroup("Archive")):(f.indexOf("zm_srch")!==-1&&c.hideGroup("action"),c.hideGroup("MoveLabel"),c.hideGroup("spamTrash"),c.hideGroup("Archive"),g(),h===zmail.folId.oId?(c.hideGroup("SortCustom"),c.hideGroup("action"),c.hideGroup("sendOutbox")):h===zmail.folId.dId?(c.hideGroup("action"),c.hideGroup("SortCustom")):h===zmail.folId.teId&&(c.hideGroup("action"),i.find(".msi-sortdateup").closest("li").hide()),zmList.showHideConvIcon()),0!==d&&k.fId!==zmail.folId.sId?(i.find(".msi-sortdatedn").closest("li").hide(),i.find(".msi-sortdateup").closest("li").hide()):zmail.listObj[h]&&h!==zmail.folId.teId?zmail.listObj[h].sortOrder?(i.find(".msi-sortdatedn").closest("li").show(),i.find(".msi-sortdateup").closest("li").hide()):(i.find(".msi-sortdateup").closest("li").show(),i.find(".msi-sortdatedn").closest("li").hide()):(i.find(".msi-sortdatedn").closest("li").hide(),i.find(".msi-sortdateup").closest("li").hide())}else"p"===b&&(c.showGroup("spamTrash"),c.showGroup("MoveLabel"),c.showGroup("SortCustom"),c.hideGroup("sendOutbox"),c.showGroup("Archive"),c.showGroup("action"),$(".msi-spam").closest("li").show(),$(".msi-notspam").closest("li").hide(),l?h=e.fId||zmUtil.getFolId():(h=f,"zm_Container"===h&&(h=zmUtil.getFolId())),zmUtil.isSharedFolder(h)&&(j=!0,c.hideGroup("MoveLabel"),c.hideGroup("Archive")),h===zmail.folId.spId?(c.hideGroup("MoveLabel"),c.hideGroup("Archive"),$(".msi-spam").closest("li").hide(),$(".msi-notspam").closest("li").show()):h===zmail.folId.sId?($(".msi-spam").closest("li").hide(),$(".msi-notspam").closest("li").hide()):h===zmail.folId.oId&&(c.hideGroup("Archive"),$(".msi-spam").closest("li").hide(),$(".msi-notspam").closest("li").hide(),c.showGroup("sendOutbox"),c.hideGroup("action"),c.hideGroup("MoveLabel"),c.hideGroup("SortCustom")));(l&&e.isArchiveMail||"archive"===k.view)&&(c.hideGroup("Archive"),i.find(".msi-spam").closest("li").hide())},cmpHideMenu:function(){$("#zm_afill").hide(),$("#zm_fLst").hide(),$("#zm_SigLst").remove(),$("#zm_TmpLst").hide(),$("#zm_EncLst").remove()},stopEvents:function(a,b){try{a||(a=window.event),a.stopPropagation?(b||a.preventDefault(),a.stopPropagation()):(a.cancelBubble=!0,a.returnValue=!1)}catch(c){}},getCheckedMailList:function(){var a,b=[],c=[],d=zmList.getElemObj().mainElem.find(".SC_mclst").find(".SC_check");return d.each(function(d,e){e=$(e),a=e[0].id,"t"===a.charAt(0)?c.push(a.substr(1,a.length-1)):("lt"===e.attr("data-ty")||"th"===e.attr("data-ty")&&!e.parent().prev().hasClass("SC_check"))&&b.push(a)}),[b,c]},getCheckedMailCount:function(){var a=zmUtil.getCheckedMailList();return a[0].length+zmUtil.getTotalMailCountInThreads(a[1])},getSelectedMails:function(a){var b,c,d,e,f,g,h,i,j,k,l=[],m=[],n={};if(zmUtil.isChildWindow()){var o="";return k=zmWindow.getListingDetObj(),o=$("#zmWindowWrapper .SC_pct").length>1?$("#zmWindowWrapper .SC_Tfcs").children().eq(0).attr("data-mid"):$("#zmWindowWrapper .SC_pct").children().eq(0).attr("data-mid"),l.push(o),[l,m]}for(a=a||zmTab.currentTab,k=zmInit.getListingDetObj(),n=zmList.getElemObj(a),"zm_Container"===a||a.indexOf("zm_srch")!==-1?(b=n.mainElem.find("div.SC_check"),b.length||$(n.prevElem).find(".SC_Tfcs .zmPHdr").length||(b=n.mainElem.find(".zmSLst")),b.length?b.each(function(){i=this.id||$(this).attr("data-detail"),i.indexOf("t")||(i=i.substring(1,i.length)),zmail.mailObj[i]&&zmail.mailObj[i].TH&&"lt"===$(this).data("ty")?m.push(i):l.push(i)}):""!==$(n.prevElem).attr("data-mid")&&(b=$(n.prevElem).find(".SC_Tfcs .zmPHdr").attr("data-mid"),b?l.push(b):(i=zmPrev.prevDetails(a).msgId,i&&l.push(i)))):a.indexOf("zm_tab")!==-1?(b=a.indexOf("zm_tabt")?a.substring(6,a.length):$(".SC_show").find("div.SC_Tfcs").find("div.zmPHdr").attr("data-mid"),b&&l.push(b)):"zmStreamsApp"===a?l.push(zmsuite.getCenter(a)[1].$el.attr("data-mid")):"zmncenter"===a&&(i=zmPrev.prevDetails(a).msgId,i&&l.push(i)),f=m.length,c=0;c<f;c++)if(j=zmail.mailObj[m[c]].T,zmail.listObj[j])for(g=zmail.listObj[j].MO,h=g.length,d=0;d<h;d++)e=$.inArray(g[d],l),e!==-1&&l.splice(e,1);return 0!==zmUtil.getMLConversionValue()&&"zm_srch1"!==a&&("zm_Container"!==a||k.fId!==zmail.folId.tId&&k.fId!==zmail.folId.sId)||(l=l.concat(m),m=[]),[l,m]},checkSelectedMails:function(){var a=zmUtil.getSelectedMails();return!!(a[0].length+a[1].length)},getThreadIdArr:function(a){var b,c,d=[];for(c=a.length,b=0;b<c;b++)d.push(zmail.mailObj[a[b]].T);return d},hasSpecialChars:function(a,b){var c="`~!@#$%^&*()+=[]\\';,./{}|\":<>?";"folderName"===b?c="`~!#%^&*()+=\\';,./{}|\":<>?":"dispName"===b&&(c="`~!#%^&*()+=\\';,/{}|\":<>?");for(var d=c.length,e=0;e<d;e++)if(a.indexOf(c.charAt(e))!==-1)return!0;return!1},hasXSSChars:function(){var a=/[{}[\]()\/'"=<>]+/gim;return function(b){a.lastIndex=0,b=b||"";var c=b.match(a);return!(!c||!c.length)}}(),setEditable:function(){var a="";return function(b){var c,d=b.ele,e=b.target,f=b.callback,g=b.maxLength||50,h=b.parentdiv,i=b.initialize,j=!1,k=!0;b.allowCondition&&(k=b.allowCondition()),k&&(c=h.find("[contentEditable='true']"),c.length>0?d[0].id!==c[0].id&&(c[0].contentEditable="false",c.html(a),j=!0):j=!0,j&&(a=d.text(),d[0].contentEditable="true",i?(d.html(e.children("span").text()),d.focus(),document.execCommand("selectAll",!1,!1)):(d.html("&nbsp;"),d.focus()),d.off("keypress").on("keypress",function(a){var b=a.keyCode?a.keyCode:a.which;13===b&&zmUtil.stopEvents(a)}),d.off("keydown").on("keydown",function(a){return function(b){var c=b.keyCode?b.keyCode:b.which,e=b.ctrlKey,h=String.fromCharCode(c).toLowerCase();13===c?f():27===c?(d[0].contentEditable="false",d.html(a),zmUtil.stopEvents(b)):!(8===c||46===c||c>=33&&c<=40)&&d.text().length>g-1?zmUtil.stopEvents(b):!e||"b"!==h&&"i"!==h&&"u"!==h||zmUtil.stopEvents(b)}}(a))))}}(),quotUnEscape:function(a,b){return a="u"===b?a.replace(/#34/gi,'"').replace(/&#39;/gi,"'"):a.replace(/"/gi,"#34")},replaceHtmlInSubject:function(a){return a=a.replace(/&#39;/gi,"'").replace(/&quot;/gi,'"').replace(/&lt;/gi,"<").replace(/&gt;/gi,">")},succErrMsg:_zm.succErrMsg,msgbean:function(){var a=arguments[0],b=arguments.length;if(void 0!==a)for(var c=1;c<b;c++)a=a.replace("{"+(c-1)+"}",arguments[c]);return a},getZohoAccId:function(){for(var a in zmail.aInfo)if("1"===zmail.aInfo[a].accountType)return a},addToFolderCountObj:function(a){zmail.folCount[a.folId]||(zmail.folCount[a.folId]={},zmail.folCount[a.folId].c="0",a.pfolId?zmail.folCount[a.folId].p=a.pfolId:a.prefolId&&(zmail.folCount[a.folId].p=zmail.folCount[a.prefolId].p))},openWindow:function(a,b,c){var d=parseInt(b*screen.width/100),e=parseInt(c*screen.height/100),f=(screen.width-d)/2,g=(screen.height-e)/2;
return window.open(a,(new Date).getTime(),"height="+e+", width="+d+",status=yes,toolbar=no,top="+g+", left="+f+",scrollbars=yes")},showOverlay:function(){var a;$("#zm_overlay").length?$("#zm_overlay").show():(a=$("<div/>"),a[0].id="zm_overlay",a.addClass("SC_AtMk"),$(document.body).append(a))},consContext:function(a,b){var c="zmCntxtMenu";if(a){var d=a.length;if(d){var e=$("<div/>");c?($("#"+c).remove(),e[0].id=c):e[0].id="zmCntxtMenu",e[0].className="SC_PU",e[0].style.display="block",e.mousedown(function(a){zmUtil.stopEvents(a,!0)});var f=$("<div/>");f[0].className="SC_PUcen",e.append(f);var g=$("<ul/>");g[0].className="SC_Phr",g[0].style.display="block",f.append(g);for(var h=function(b,c){return a[b].eventName},i=0;i<d;i++){var j=$("<li/>"),k=Boolean(a[i].cEdit),l=a[i].id?a[i].id:"";if(a[i].htm)if(k){var m=$("<div/>");m[0].innerHTML=a[i].htm,m[0].id=l,j.append(m)}else j[0].innerHTML=a[i].htm,j[0].id=l;else a[i].sep&&(j[0].className="SC_lne",j[0].id=l);a[i].clk&&j.click(h(i,"clk")),a[i].mouseovr&&j.mouseover(h(i,"mouseovr")),a[i].mouseot&&j.mouseout(h(i,"mouseot")),g.append(j)}var n=zmInit.nn6?b.clientY:b.clientY+10,o=zmInit.nn6?b.clientX:b.clientX+10;$("body").append(e);var p=$("#"+c).height()+n,q=$("#"+c).height(),r=zmInit.cliHgt;if(e)if(p>r&&n-q>=0){var s=r-n;e.css({bottom:s,left:o})}else e.css({top:n,left:o})}}},regWMS:function(){var a=!1;try{zmail.isCustomDomain&&WebMessanger.useSameDomain(),WebMessanger.enableSST(),WebMessanger.setNoDomainChange()}catch(b){}WebMessanger.setLocale(zmail.user.lang,zmail.user.countrycode);var c=WMSSessionConfig.CHAT|WMSSessionConfig.CHAT_PRESENCE|WMSSessionConfig.PRESENCE_ORG|WMSSessionConfig.PRESENCE_PERSONAL|WMSSessionConfig.MULTI_DISPATCH|WMSSessionConfig.CROSS_PRD;WebMessanger.setConfig(c),WebMessanger.setZIndex("auto"),("false"===zmail.showTop||zmail.fromOtherService)&&(a=!0),WebMessanger.register("VO",zmail.zuid,a),zmail.fromOtherService||WebMessanger.enableGlobalSearch()},loadWms:function(){$.when(zmAppLoader.loadFiles("extjs",zmail.wms.wmsjs),zmAppLoader.loadFiles("extcss",zmail.wms.wmscss)).done(function(){zmAppLoader.load("wmsInteg").done(function(){zmUtil.regWMS()})})},removeDocSelection:function(){document.selection?document.selection.clear():window.getSelection().removeAllRanges()},prevCache:function(a,b){var c=zmail.mailContainer,d=c.getObject(a);d?c.rememberAsRecent(d.id):c.addObject({id:a,data:b})},cacheThreadList:function(a,b){var c,d,e=b.thId,f=[];if(a.tdata&&e){if(zmail.listObj[e]=zmCache.dolistObj(e,a.tdata),zmUtil.isInlineCompose()&&zmUtil.mapDraftId(e),zmPrev.prevDetails("zm_Container").msgId){var g=zmPrev.prevDetails("zm_Container").msgId;zmail.mailObj[g].T===e&&(c=!0,f=zmPreviewTemplate.getMissingMailList(e,"P"))}zmsuite.isWorkspaceAvailable("zm_tabt"+e)&&(d=!0,f=zmPreviewTemplate.getMissingMailList(e,"T")),c&&$.publish("/mail/updatemailview",[{list:f,opentype:0,mode:"sdraft"}]),d&&$.publish("/mail/updatemailview",[{list:f,opentype:2,mode:"sdraft"}])}},mapDraftId:function(a){if(a&&zmail.listObj[a]){var b=zmail.listObj[a].MO,c=b.length,d=0,e="";for(d=0;d<c;d++)zmail.mailObj[b[d]].FD===zmail.folId.dId&&(e=zmail.mailObj[b[d]].PA,(e||zmail.mailObj[e]&&!zmail.mailObj[e].DMID)&&(zmail.mailObj[e].DMID=b[d]),b.splice(d,1),c--,d--,e="");zmail.listObj[a].MO=b}},removeDraftMapping:function(a){var b=zmail.mailObj[a];if(b&&b.PA){var c=b.PA,d=zmail.mailObj[c];if(d&&d.DMID&&delete d.DMID,!zmUtil.isChildWindow()){if(0!==zmUtil.getMLConversionValue()){var e=zmList.getViewBasedMsgList(b.T,zmInit.getListingDetObj(),!0);if(e.length>0){var f=zmUtil.excludeDraftSentMails(e);c=f.length?f[0]:e[0]}}d=zmail.mailObj[c]||{},d.DC&&d.DC>0&&(d.DC-=1),zmmailAct.updateDraftCountInUI(c,"discard_draft",d.DC,"zm_Container")}}},postMailActionsOnSend:function(a){if(!zmUtil.isChildWindow()){var b=a.action,c=a.msgId,d=a.draftObj,e=a.draftDataObj,f=a.draftId,g=a.schedule,h=a.mode,i=zmInit.getListingDetObj(),j=i.fId,k="";if("sdraft"!==b&&"stemplate"!==b?j!==zmail.folId.oId||!g&&"outbox"!==h?j!==zmail.folId.oId&&g?(k="",zmmailAct.updateCount({fId:zmail.folId.oId,mode:"inc"})):j===zmail.folId.dId&&f&&!g&&zmUtil.deleteMsg(f):k=zmail.folId.oId:"sdraft"===b?k=zmail.folId.dId:"stemplate"===b&&(k=zmail.folId.teId),"sdraft"===b&&d&&d.TH&&zmPreviewTemplate.postSaveDraftAction(c,d,e),k&&j===k){var l={};if(i.fId){var m=i.view,n=i.label||i.flag;l={fId:j,view:m,viewId:n}}else l={fId:"zm_"+i.view};$.publish("/mail/listMails",l)}}},isDraftMail:function(a){return!(!zmail.mailObj[a]||zmail.mailObj[a].FD!==zmail.folId.dId)},getNotify:function(){var a=$("#zmnotify span");if(a){var b=parseInt(a.html())+1;a.html(b)}},setScrollShadow:function(a){var b=function(a){var b,c,d,e;b=a.target||a.srcElement,d=$(b),e=d.attr("id"),c=e&&!e.indexOf("zmW")?d.closest(".SC_pvn"):d.closest(".SC_pv"),d.scrollTop()?c.hasClass("SC_scroll")||c.addClass("SC_scroll"):c.removeClass("SC_scroll")};b({target:a[0]}),a.off("scroll",b),a.on("scroll",b)},isFolderId:function(a){return!!zmail.folCount[a]},isSharedFolder:function(a){if(a&&zmail.shrTree.length){var b=zmail.shrTree[0][a];return!(!b||"-1"===b.SHID)}return!1},isViewId:function(a){return"zm_unread"===a||"zm_all"===a||"zm_flag"===a},isLabelId:function(a){return!!zmail.labInfo[a]},isSystemLabel:function(a){var b=zmail.labInfo[a];return!(!b||"1"!==b.system)},getShareId:function(a){var b=zmail.shrTree[0][a];return b&&"-1"!==b.SHID?b.SHID:""},getFolderIdwithShId:function(a){var b="";for(var c in zmail.shrTree[0])zmail.shrTree[0][c].SHID===a&&(b=c);return b},regExpEscape:function(a){return a=a||"",a.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"$&")},updateListingAfterCompose:function(a){if(!zmUtil.isChildWindow()){var b=zmInit.getListingDetObj().fId,c=!1;switch(a){case"drafts":b===zmail.folId.dId&&(c=!0);break;case"templates":b===zmail.folId.teId&&(c=!0);break;case"outbox":b===zmail.folId.oId&&(c=!0)}c&&$.publish("/mail/listMails",{fId:b})}},outboxCnt:function(){zmmailAct.updateCount({fId:zmail.folId.oId,mode:"dec"})},updOutbox:function(b){if(b.error&&zmail.accId===b.accId){var c=zmInit.getListingDetObj();if(zmsuite.isWorkspaceAvailable("zm_Container")&&zmail.folId.oId===c.fId?($(zmail.mailCenter.listElem).html(""),zmCache.clearListObj(),zmInit.setListingDetObj({}),zmInit.foldView({folId:zmail.folId.oId})):zmmailAct.updateCount({fId:zmail.folId.oId,mode:"dec"}),"true"===b.error){var d=a.error.outboxErr;zmUtil.succErrMsg("e",d)}}},updSendErrorStatus:function(a,b){var c=$("#"+b);a?c.addClass("SC_redtxt"):c.removeClass("SC_redtxt")},cloudCallBack:function(b,c){var d=b.result;"success"===d?_zm.succErrMsg("s",a.common.succUpload):_zm.succErrMsg("e",a.error.errUpload),delete zmUtil.cloudRespObj[c.cloudUplId]},cloudUpload:function(a,b,c,d){zmAttachUtility.cloudUpload(a,b,c,d)},cloudClose:function(){zmAttachUtility.addToCloudClose()},cloudRespObj:{},cloudUploader:function(a){function b(){zmAttachUtility.addToCloud(a)}zmUtil.loadAttachUtilFiles(b)},isZohoAccount:function(a){var b=!1;return a===zmUtil.getZohoAccId()&&(b=!0),b},showMenu:function(a){var b;return b=new zmDropDownMenu,b.setDropObj(a),b.paint(),b},getComposeType:function(){var a={0:"w",1:"t",2:"p"};return zmUtil.isChildWindow()&&1===zmail.mailOpt.compTab&&(a[1]="p"),a[parseInt(zmail.mailOpt.compTab)]},isInlineCompose:function(){var a=!1;return"p"===zmUtil.getComposeType()&&(a=!0),a},isComposeWindow:function(){var a=!1;return"w"===zmUtil.getComposeType()&&(a=!0),a},cmpDialog:function(a,b){var c;c=a?function(){zmComp.cmpDialog(a)}:function(){zmComp.cmpDialog()},zmUtil.requireComposeModule().done(function(){c()}),_zm.stopEvents(b)},modifyComposeObj:function(a){a.appId&&(a.appId=zmUtil.getCmpAppId()),a.appObj.appId&&(a.appObj.appId=zmUtil.getCmpAppId()),zmUtil.addCmpAppObj(a.appId,a.data),zmUtil.addCmpAppId()},addCmpAppObj:function(a,b){zmUtil.cmpObj.appData[a]=b},addCmpAppId:function(){zmUtil.cmpObj.cId+=1},getCmpAppId:function(){return"Cmp"+zmUtil.cmpObj.cId},cmpObj:{cId:1,appData:{}},cmpWindow:function(a){zmUtil.cmpClose();var b=a.mode,c=zmail.conPath+"/comp.do?accId="+zmail.accId;c+="&originalMode="+b;var d,e,f=a.msgId,g=a.type;if(f&&(d=zmUtil.getFolIdByMsg(f),c+="&msgId="+f),"fwdme"===b){var h=zmUtil.getFwdArr(f,g);h.mId&&(c+="&fwdMsgIds="+h.mId),h.tId&&(c+="&fwdtId="+h.tId),h.folderId&&(d=h.folderId)}d&&(c+="&folId="+d),d&&zmUtil.isSharedFolder(d)&&(e=zmUtil.getShareId(d)),e&&(c+="&shareId="+e),zmUtil.openWindow(c,60,80)},getCmpData:function(){var a=$.Deferred();return zmUtil.requireComposeModule().done(function(){var b=zmComp.getCmpData();a.resolve(b)}),a.promise()},cmpClose:function(){var a=window.addEventListener?"addEventListener":"attachEvent",b=window[a],c="attachEvent"===a?"onmessage":"message";b(c,function(a){zmUtil.debugLog(a)},!1)},composeWindow:function(a){zmUtil.cmpWindow(a)},compose:function(a,b,c){if(0!==zmail.mailOpt.compTab||a)zmUtil.composeTab(a,b,c);else{var d={};d.mode="compose",zmUtil.cmpWindow(d)}},composeTab:function(a,b,c){var d;zmsuite.isMaxLimitReached()||(d=a?function(){zmComp.compose(a,c)}:function(){zmComp.compose()},zmUtil.requireComposeModule().done(function(){d()})),_zm.stopEvents(b)},invokeComposer:function(a){if(a&&a.mode){var b,c=a.msgId,d=a.draftId,e=a.mode,f=a.draftCont,g=a.prevElem||[],h=a.disableScroll||!1,i=a.loadType,j=a.reopen,k=a.cmpId,l=a.cdata,m=a.loadMode||"",n=zmUtil.isInlineCompose();b=zmUtil.getCmpViewType(),b.type=zmUtil.getComposeType(),c&&(b.msgId=c),l&&(b.cdata=l),m&&(b.loadMode=m),b.mode=e,n&&(b.draftId=d,b.data=f,g.length&&(d?b.prevDOM=g.find("#zmCon"+b.elemPrefix+d):b.prevDOM=g.find("#zmCon"+b.elemPrefix+c)),i&&(b.loadType=i),j&&(b.reopen=j),k&&(b.cmpId=k),h?b.disableScroll=h:b.disableScroll=!1),zmUtil.cmpReply(b)}},getFwdArr:function(a,b){var c=[],d=[];if(a)c=[a];else if("r"===b){var e=zmInit.rclkId;e.indexOf("t")!==-1&&(e=zmComp.zmsubStr(e,"t")),c=[e]}else{var f=zmUtil.getSelectedMails();f[0].length&&(c=f[0]),f[1].length&&(d=f[1])}if(d.length){var g=d.length;if(g>10){var h=zmText.get("zmcompose").message_fwdmul;return h=zmText.applyArgs(h,{NUMBER:g}),Dialog.alert(h),!1}}if(c.length){var i=c.length;if(i>100){var j=zmText.get("zmcompose").conversation_fwdmul;return j=zmText.applyArgs(j,{NUMBER:i}),Dialog.alert(j),!1}}var k;c.length&&(k=1===c.length?zmUtil.getFolIdByMsg(c[0]):zmUtil.getFolId());var l={};return c.length&&(l.mId=c),d.length&&(l.tId=d),k&&(l.folderId=k),l},cmpReply:function(a){var b=a.type,c=!1;a.msgId&&(c=zmUtil.isSharedFolder(zmUtil.getFolIdByMsg(a.msgId))),"w"!==b||c?zmUtil.cmpTabView(a):zmUtil.cmpWindow(a)},cmpTabView:function(a){a=a||{},zmUtil.requireComposeModule().done(function(){zmUtil.createCmpContainer(a)})},cmpRestore:function(a,b){b=b||{};var c=a.data.obj;b["new"]&&(zmUtil.modifyComposeObj(a),zmsuite.setWorkSpace(a.appObj));var d={};d._restoreId=a.appId,c._restore_obj=d,zmUtil.requireComposeModule().done(function(){zmComp.cmpReply(c)})},requireComposeModule:function(){var a=$.Deferred();return $.when(zmAppLoader.load("zmcompose"),ZE_Init.editorCoreLoaded).done(function(){a.resolve()}),a.promise()},createCmpContainer:function(a){if(zmUtil.isInlineCompose()&&"template"!==a.mode){var b,c,d,e,f,g=a.msgId,h=zmail.mailObj[g];h&&"p"===a.type&&"draft"!==a.mode&&"eanew"!==a.mode&&!h.DMID&&"outbox"!==a.mode&&(e=a.prevDOM.closest(".SC_Twpr"),f=a.viewType+g+"New",c="zmCon"+f,d=e.find("#"+c),d.length?zmPreviewTemplate.addFocusOnclick(d,e):(zmUtil.viewComposeOptions(!1,a.prevDOM.find(".zm_ry")),a.prevDOM.length&&(b=zmUtil.getCmpContainerTemplate(f,g),$(b).insertAfter(a.prevDOM.closest(".SC_pct")),a.prevDOM=$(b).find("#"+c))))}zmComp.cmpReply(a)},getCmpContainerTemplate:function(a,b){var c=["DIV",{attrs:{"class":"SC_pct SC_Drft"},child:[["DIV",{attrs:{id:"zmHdr"+a,"class":"zmPHdr","data-mid":b}}],["DIV",{attrs:{id:"zmCon"+a}}]]}];return _zm.getDOM(c)},zmsubStr:function(a,b){return a.indexOf(b)!==-1&&(a=a.substring(b.length,a.length)),a},isChildWindow:function(){return 1===zmPreviewTemplate.currentWorkSpace},switchAccount:function(b){var c,d=$.Deferred();$.publish("/mail/switchAccount",[b]);var e=function(a,b){h(a,b,d)};return c=zmComponent.loadingMasks({maskText:a.switchAccount}),zmAjq.XHR({u:zmail.conPath+"/swAcc.do",t:"POST",fn:e,onerror:function(){d.reject()},csr:"s",p:{accId:b,mode:"json"},ep:{accId:b}}),d.always(function(){c.remove()}).done(function(){zmUtil.succErrMsg("s",a.accSwitchSuccess)}).fail(function(){zmUtil.succErrMsg("e",a.accSwitchFail,{noHide:!0})}),d.promise()},loadCrm:function(a){zmAppLoader.load("crminteg").done(function(){zmail.crmInteg.init.getModel(a)})},loadProjects:function(a){zmAppLoader.load("projectsinteg").done(function(){a()})},downloadTempAttachment:function(a){var b,c=a.n||a.name,d={mode:"tmpdwn",entityType:1,accId:a.accId||zmail.accId,fpath:a.fP,fstorename:a.sN};c=c.substring(0,c.lastIndexOf(".")),c=c.replace(/[`<>{}[\]\\/]/gi,""),b=zmail.conPath+"/FileDownload/"+zmUtil.encodeFileName(c+"."+zmUtil.fileTyp(a.name)[2]),zmAjq.formSubmit(d,b)},downloadAttachment:function(a){var b,c=a.e,d="",e={},f=a.n||a.fn;if(e={mode:"dwn",attachId:a.Id,entityType:a.et,entityId:a.e},a.sid?(e.groupId=a.sid,e.streamsView=!0,a.gId===zmail.zuid?e.actionType="viewSelfData":e.actionType="viewGroupEntity"):a.type?(2===a.et?e.streamsView="Notes":e.streamsView=!0,e.actionType=a.type,e.groupId=a.gId):(e.groupId=zmail.zuid,1===a.et&&(e.accId=zmail.accId,e.partId=a.p)),zmail.mailObj&&zmail.mailObj[c]&&zmUtil.isSharedFolder(zmail.mailObj[c].FD)){var g=zmUtil.getShareId(zmail.mailObj[c].FD);e.shId=g,delete e.groupId}b=f.lastIndexOf("."),f=f.replace(/;/gi,""),b!==-1?(f=f.substring(0,b),f=zmUtil.encodeFileName(f+"."+zmUtil.fileTyp(a.fn)[2])):f=zmUtil.encodeFileName(f),d+=zmail.conPath+"/FileDownload/"+f,zmAjq.formSubmit(e,d)},addEventsToCal:function(a){zmAppLoader.load("attachmentUtility").done(function(){zmAttachUtility.addEventsToCal(a)})},isAddToCloudAllowed:function(){return!zmail.isCustomDomain||"false"!==zmail.isCloudServiceEnabled&&!zmail.isBaihui},loadZDocs:function(a){try{var b=[],c=[];"undefined"==typeof ZDDialog?(zmail.staticUrls&&zmail.staticUrls.docsJS||(zmail.staticUrls=zmail.staticUrls||{},zmail.staticUrls.docsJS="//"+zmail.jstatic+"/personal/"+zmail.docsStaticVersion+"/docscomponents/js/docscomponent_mail.js",zmail.staticUrls.docsCSS="//"+zmail.jstatic+"/personal/"+zmail.docsStaticVersion+"/docscomponents/css/lightgrey/docscomponent_mail.css"),b.push(zmail.staticUrls.docsJS),c.push(zmail.staticUrls.docsCSS),LazyLoad.css(c,function(){}),LazyLoad.js(b,function(){a&&a()})):a&&a()}catch(d){zmUtil.debugLog("DEBUG",d)}},loadAttachComponentFiles:function(a,b){zmAppLoader.load("attachComponent").done(function(){b.attachFrom&&b.attachFrom.indexOf("zDocs")>=0?zmUtil.loadZDocs(a):a()})},loadAttachUtilFiles:function(a){zmAppLoader.load("attachmentUtility").done(function(){zmUtil.loadZDocs(a)})},isPreviewAvailable:function(a){var b,c=zmUtil.fileTyp(a),d={txt:!0,js:!0,java:!0,css:!0,jsp:!0,jspf:!0,c:!0,cpp:!0,html:!0,htm:!0,xml:!0,go:!0,eml:!0,sh:!0,bat:!0,log:!0},e={xml:!0,js:!0,css:!0},f={mp3:!0,mp4:!0,py:!0,python:!0,properties:!0,conf:!0,text:!0},g=!1;return"msi-attimg"===c[1]||f[c[2]]?(g=!0,b="FileDownload"):"msi-attdoc"!==c[1]&&"msi-attppt"!==c[1]&&"msi-attsheet"!==c[1]||d[c[2]]?("msi-attpdf"===c[1]||"msi-attdoc"===c[1]&&d[c[2]]||"msi-attothers"===c[1]&&d[c[2]])&&(g=!0,b="FileDownload",(window.ActiveXObject||"ActiveXObject"in window)&&e[c[2]]&&(g=!1)):(g=!0,b="OpenDocument"),{isPrev:g,apiName:b}},initAttachListing:function(a,b){zmAppLoader.load("attachmentUtility").done(function(){b?b(zmAttachUtility.initAttachListing(a)):zmAttachUtility.initAttachListing(a)})},initAttachComponent:function(a,b){var c=function(){b&&"function"==typeof b?b(zmAttachComponent.init(a)):zmAttachComponent.init(a)};zmUtil.loadAttachComponentFiles(c,a)},initAttSlideShow:function(a,b,c,d,e){zmAppLoader.load("slideshowComp").done(function(){var f={};a instanceof Array?(f.startIndex=b||0,f.attObjList=a,f.hideAllOptions=c,d&&(f.hideIcons=d.hideOptions,f.addIcons=d.extraIcons),f.targetEle=e):f=a,zmAttachUtility.initSlideshow(f)})},loadAttachmentViewFiles:function(a){LazyLoad.css(zmail.postcss.jplayer,function(){}),LazyLoad.js(zmail.postjs.attwithutil,a)},listAttachmentInAttSearchView:function(a){var b;zmAppLoader.load("attachmentSearch").done(function(){"s"===a.type&&(b={dn:a.srchStr},zmAttachmentSearch.core.searchAttachment("sender",b,3))})},cacheImageForPreview:function(a){for(var b,c,d,e=0,f=a.length;e<f;e++)d=a[e],101===d.ft&&(c=zmUtil.getTheSrc("FileDownload",d),c+="&height=640&width=640",b=zmUtil.createImage(),$(b).attr("src",c).hide(),$("body").append(b))},createImage:function(){var a=new Image;return $(a).on("load error",function(){$(this).remove()}),a},getSubString:function(a,b){b=b||"";var c=b.lastIndexOf(".");return c>a?b=b.substring(0,a-2)+"..."+zmUtil.fileTyp(b)[2]:c===-1&&b.length>a&&(b=b.substring(0,a-2)+"..."),b},getDummyFilename:function(a){a=a||" ";var b=a.substring(0,a.lastIndexOf("."));return b=b.replace(/[`~!@#$%^&*()|+\-=?;:'",.<>{}[\]\\/]/gi,""),encodeURIComponent(b+"."+zmUtil.fileTyp(a)[2])},getTheSrc:function(a,b,c){var d,e,f="",g=zmUtil.getDummyFilename(b.fn);return void 0===c&&(c="view"),"FileDownload"===a?f=zmail.conPath+"/FileDownload/"+g+"?mode="+c+"&":"OpenDocument"===a&&(f=zmail.conPath+"/OpenDocument/"+g+"?"),f+="attachId="+b.Id+"&entityType="+b.et+"&entityId="+b.e,1!==b.et||void 0!==b.gId&&b.gId!==zmail.zuid||(f+="&partId="+b.p,void 0===b.sid&&(f+="&accId="+zmail.accId)),b.sid?(d=b.sid,e=b.gId===zmail.zuid?"viewSelfData":"viewGroupEntity",f+="&streamsView=true&actionType="+e+"&groupId="+d):b.type?(d=b.gId,e=b.type,f+="&streamsView=true&actionType="+e+"&groupId="+d):b.gId&&b.gId!==zmail.zuid&&(d=b.gId,e="viewGroupData",f+="&streamsView=true&actionType="+e+"&groupId="+d),b.shId?f+="&shId="+b.shId:zmail.mailObj&&zmail.mailObj[b.e]&&zmUtil.isSharedFolder(zmail.mailObj[b.e].FD)&&(f+="&shId="+zmUtil.getShareId(zmail.mailObj[b.e].FD)),f},getSrcForTempAtt:function(a,b){var c,d=zmUtil.isPreviewAvailable(a.name);return d.isPrev&&(b=b||zmail.accId,c=zmail.conPath+"/"+d.apiName+"/"+zmUtil.getDummyFilename(a.name),c+="?mode=tmpview&entityType=1&accId="+b+"&fpath="+encodeURIComponent(a.fP)+"&fstorename="+a.sN),c},isIE:function(){return!("function"!=typeof window.ActiveXObject||!document.documentMode)},openComposeWithAtt:function(a){var b={};b.NEWATT=a,zmUtil.compose(b)},getLayerObj:function(a){var b=zmsuite.getLeft(),c=b.getNodes(),d=c[0].getLayer(a);return d},modeChange:function(a){"undefined"!=typeof zmComp&&zmComp.modeChange(a)},initScroll:function(a,b,c,d,e){var f,g;e?(f=b,g=c):(f=a.find("#"+b),g=a.find("#"+c));var h,i,j=a.scrollTop(),k=f.offset().top,l=g.offset().top,m=a.height()/2;"prev"===d?(i=l-k,a.scrollTop(j-i)):"next"===d&&(i=k-l,a.scrollTop(j+i)),k<0?(h=m-k,a.scrollTop(j-h)):k>a.height()&&(h=k-m,a.scrollTop(j+h))},closeMailTabs:function(){var a,b=zmsuite.getAppObj();for(a in b)a.indexOf("zm_tab")===-1&&"attView"!==a&&a.indexOf("zm_srch")===-1||zmsuite.closeWorkspace(a)},getComposeData:function(){function a(a,b){var c=a.split(b);return c[0]&&c[1]?c:null}var b=/\?|(?:&amp;)|&/,c={mailto:"TO",to:"TO",cc:"CC",bcc:"BCC",subject:"SUBJECT",body:"CONTENT",content:"CONTENT"};return function(d){var e,f=d.split(b),g={},h=f.length,i=[];if(f.length){for(i=a(f[0],":"),i.length>1&&(g[c[i[0].toLowerCase()]]=decodeURIComponent(i[1])),e=1;e<h;e++)i=a(f[e],"="),i.length>1&&(g[c[i[0].toLowerCase()]]=decodeURIComponent(i[1]));return g}}}(),getSelectedMailsWithLabels:function(){var a,b,c,d=zmUtil.getSelectedMails(),e=d[0],f=d[1],g=zmail.mailObj;for(c=0,b=e.length;c<b;)a=g[e[c]].TAG,a&&a.length?c++:(e.splice(c,1),b--);for(c=0,b=f.length;c<b;)a=g[f[c]].TAG,a&&a.length?c++:(f.splice(c,1),b--);return[e,f]},constructDatePicker:function(a,b){var c,d;return a=$(a),d=a.offset(),c=$("<div id='zm_dpHolder' class='SC_calpick'><div style='white-space:nowrap'></div></div>"),b||(b={left:a.outerWidth()+d.left,top:d.top}),c.css({left:b.left,top:b.top}),$("#zm_dpHolder").remove(),$(document.body).append(c),$.publish("/mail/menuCreated",[{element:c[0]}]),c},showDatePicker:function(a,b){var c,d,e;c=$(a),d={mode:"inline",today:zmail.userDateVal,dform:zmail.userDateFormat.toUpperCase()},e=zmUtil.constructDatePicker(c),ZEVENTS(e.children("div")[0]).picker("date",d).on("dateclick",function(){var a;a=this.getDate(),b(a),zmUtil.hideMenu()}).bind()},showDateRangePicker:function(a,b){var c,d,e;c=$(a),d=zmUtil.constructDatePicker(c),d.mousedown(function(a){_zm.stopEvents(a,!0)}),e=zmUtil.getDateObjFromDate(),ZEVENTS(d.children("div")[0]).picker("range",{wkst:0,dform:zmail.userDateFormat,range:["",zmUtil.getDateFromDateObj(e)]}).on("select",function(){b(this.getDateRange.from,this.getDateRange.to),zmUtil.hideMenu()}).bind();var f=$(d.children("div")[0]),g=f[0].getBoundingClientRect(),h=document.body.getBoundingClientRect();g.width+g.left>h.width&&(d[0].style.left="auto",d[0].style.right=h.width-c[0].getBoundingClientRect().left+"px")},getDateFromDateObj:function(a){var b,c,d,e;return a&&(b=a.getDate(),c=a.getMonth()+1,d=a.getFullYear()),"dd/mm/yyyy"===zmail.userDateFormat.toLowerCase()?e=b+"/"+c+"/"+d:"mm/dd/yyyy"===zmail.userDateFormat.toLowerCase()&&(e=c+"/"+b+"/"+d),e},getDateObjFromDate:function(a){var b,c,d,e,f,g,h="";h=a&&a.dateFormat||zmail.userDateFormat,b=a&&a.dateValue||zmail.userDateVal;try{d=b.split("/"),"MM/dd/yyyy"===String(h)?(e=d[0],f=d[1]):"dd/MM/yyyy"===String(h)&&(e=d[1],f=d[0]),g=d[2],c=new Date(g,e-1,f)}catch(i){h="MM/dd/yyyy",c=new Date}return c},getCurrentDateObj:function(a){var b=new Date,c=a||zmail.timeZoneOffset,d=b.getTime()+6e4*b.getTimezoneOffset(),e=new Date(d+c);return e},getTotalMailCountInThreads:function(a){var b=0;return a=a||[],a.forEach(function(a){b+=zmail.mailObj[a]&&zmail.mailObj[a].TC||0}),b},encodeFileName:function(a){try{a=encodeURIComponent(a)}catch(b){}return a},encodeHTMLEntities:function(a){var b="<div/>",c=$(b).text(a||"");return c.html()},decodeHTMLEntities:function(a,b){var c=b?"<textarea/>":"<div/>",d=$(c).html(a||"");return b?d[0].value:d.text()},replaceHTMLEntities:function(){var a=/(&#?[^\s&#;]+;)/gim,b=document.createElement("div"),c={};return function(d){return d?(a.lastIndex=0,d=d.replace(a,function(){var a,d=arguments[1];return d?c[d]?c[d]:(b.innerHTML=d,a=b.textContent||b.innerText,c[d]=a,a):""})):""}}(),wmsBarHeight:function(){var a=_zm("#","wmstoolbar"),b=a?a.getBoundingClientRect().height:0;return b},getFolderForShID:function(a,b){var c={};if(b)c=zmail.shrTree[0];else{var d,e=zmail.folTree[1],f={};for(d in e)$.extend(!0,f,e[d].CH);$.extend(!0,c,zmail.folTree[0],f)}var g,h,i;for(g in c)if(i=c[g],h=b?i.SHID:i.SH,h===a)return g},isSystemFolder:function(a){var b=!1;return Object.keys(zmail.folId).forEach(function(c){a===zmail.folId[c]&&(b=!0)}),b},isMailContentInUse:function(a,b,c){var d,e,f,g,h,i,j="";if(a&&0===a.indexOf("t")&&(a=a.substring(1)),f=zmail.mailObj[a],b)switch(b){case"preview":if(c)switch(c){case"zm_Container":g=!0;break;case"zm_srch1":h=!0}else g=!0,h=!0;break;case"tab":i=!0}else g=!0,h=!0,i=!0;if(g&&zmsuite.isWorkspaceAvailable("zm_Container")){if(d=zmPrev.prevDetails("zm_Container"),("lt"===d.type||"th"===d.type)&&d.msgId===a)return!0;if(f&&zmail.mailObj[d.msgId]&&f.T&&f.T===zmail.mailObj[d.msgId].T)return!0}if(h&&zmsuite.isWorkspaceAvailable("zm_srch1")&&(e=zmPrev.prevDetails("zm_srch1"),("lt"===e.type||"th"===e.type)&&e.msgId===a))return!0;if(i){if(j="zm_tab"+a,zmsuite.isWorkspaceAvailable(j))return!0;if(f&&f.TH&&(j="zm_tabt"+f.T,zmsuite.isWorkspaceAvailable(j)))return!0}return!1},getFolderObject:function(a){var b,c,d,e=zmail.folTree[0]||[],f=zmail.folTree[1]||[],g={};for(b in e)g[b]=e[b];for(b in f){d=f[b].CH||{};for(c in d)g[c]=d[c]}return g[a]},isMailOpenInPreview:function(a,b){var c=zmUtil.isMailContentInUse(a,"preview",b);return c},commaSeparateNum:function(a,b){var c="",d="",e="",f=/\d{1,2}/g,g=/\d{1,3}/g,h=zmUtil.reverseString;if("undefined"!=typeof a)return a<0&&(e="-"),a=String(a),a.indexOf(".")!==-1&&(c="."+a.substr(a.lastIndexOf(".")+1),a=a.substring(0,a.lastIndexOf("."))),a.length<4?e+a+c:b?e+h(h(a).match(g).join(","))+c:(d=","+a.substr(a.length-3),a=a.substr(0,a.length-3),e+h(h(a).match(f).join(","))+d+c)},reverseString:function(a){var b,c="";for(a=a||"",b=a.length;b>=0;b--)c+=a.charAt(b);return c},removeHighlight:b,removeRightClickSelection:function(a){a&&$(a).length&&$(a).closest(".SC_rgtClk").removeClass("SC_rgtClk")},createFLComp:n,FLCompCreateAPI:o,mixin:function(a,b,c){c=c||Object.keys(b);var d,e,f=c.length;for(e=0;e<f;e++)d=c[e],a[d]=b[d]},arrayExtractor:function(a,b,c){var d=a.indexOf(b),e=a.indexOf(c);return d<e?a.slice(d,e+1):a.slice(e,d+1)},getCmpViewType:function(a){var b,c,d={};return zmUtil.isChildWindow()?(b="W",c="W"):(a=a||zmTab.currentTab,"zm_Container"===a?(b="P",c="P"):a.indexOf("zm_srch")?a.indexOf("zm_tab")||(b="T",c="T"):(b="S",c="S")),d.viewType=b,d.elemPrefix=c,d},discardFromThread:function(a){var b,c=a.fId,d=a.viewId,e=[];if(zmail.listObj[c]?e=zmail.listObj[c].MO:zmail.listObj[d]&&(e=zmail.listObj[d].MO),b=e.length,e.length>0){var f,g,h,i={},j={},k=[];for(f=0;f<b;f++)if(j=zmail.mailObj[e[f]],j&&j.TH)for(i={fId:c},k=zmList.getMailSummaryList(i,j.T),h=k.length,g=0;g<h;g++)zmUtil.discardMsg({draftId:k[g],actionType:"discard_draft"})}},getFirstMsgId:function(a,b){var c=zmList.getViewBasedMsgList(a,b,!0);return b.fId===zmail.folId.sId?c[0]:(c=zmUtil.excludeDraftSentMails(c),c[0])},excludeDraftSentMails:function(a){var b,c=[],d=0,e=a.length;for(d=0;d<e;d++)b=zmail.mailObj[a[d]],b.FD!==zmail.folId.sId&&b.FD!==zmail.folId.dId&&c.push(a[d]);return c},bindInputTextChange:function(a){var b,c,d,e,f={},g=a.input,h=a.textElem||a.input,i=a.checkInterval||200,j=a.idleTime||500,k=a.checkContent||!1,l=function(){var b=d||"",c="";c="TEXTAREA"===h.tagName||"INPUT"===h.tagName?h.value:$(h).text(),c=c||"",d=c,b.length!==c.length&&a.callback()},m=function(){var b=Date.now(),d=b-c;d>=j&&(k?l():e||(a.callback(),e=!0))},n=function(){c=Date.now(),e=!1},o=function(){n(),l(),b=setInterval(m,i)},p=function(){n(),l(),clearInterval(b)};if(g)return $(g).on("focus",o),$(g).on("blur",p),$(g).on("keyup",n),$(g).on("paste",l),$(g).on("cut",l),f.unbind=function(){$(g).off("focus",o),$(g).off("blur",p),$(g).off("keyup",n),$(g).off("paste",l),$(g).off("cut",l)},f},parseURLS:function(){var a=/((?=http|https)[\S]*:\/\/[\S]+)|([\S]*(?:\w{2}\.\w+\.\w+)[\S]*)/gi,b=/((?=http|https)[\S]*:\/\/[^\s"]+)/gi;return function(c,d){var e=[];d=d||{};var f,g=d.httpOnly||!1,h=null,i=!1;for(f=a,g&&(f=b),f.lastIndex=0;!i;)if(h=f.exec(c),null===h)i=!0;else{h.index===f.lastIndex&&f.lastIndex++;var j=h[0]||"";j.indexOf("@")!==-1&&j.indexOf("/")===-1||e.push({url:j,startIndex:h.index,endIndex:h.index+j.length})}return e}}(),loadImage:function(a){var b,c=document.createElement("img"),d=!1;return c.onload=function(){d=!0,b&&b(c)},c.onerror=function(){d=!0,b&&b()},c.src=a||"",{then:function(a){"function"==typeof a&&(b=a),d&&b&&b(c)}}},getSystemLabels:function(){var a,b=zmail.labInfo,c=[];for(a in b)"1"===b[a].system&&c.push(a);return c},setInlineCmpScope:function(a){if(!zmUtil.isChildWindow())if(a)zmComponent.keybindings.setScope("inlineCmp");else{var b=zmComponent.keybindings.getScope();"inlineCmp"===b&&zmComponent.keybindings.setScope(zmTab.currentTab)}},isMetaDataAvailable:function(a){return Boolean(zmail.mailObj[a])},removeComposer:function(a,b){if(b&&b.prevDOM&&b.prevDOM.length){var c=b.actionType;"discard_draft"===c?zmUtil.discardInlineDraft(b):"replace_draft"===c&&zmPreviewTemplate.showDraftedBand(b)}},hasInlineDraft:function(a){return!!zmUtil.isInlineCompose()&&Boolean(zmail.mailObj[a].DMID)},viewComposeOptions:function(a,b){a?b.show():b.hide()},discardInlineDraft:function(a){var b=a.draftId||"",c=a.msgId||"",d=a.prevDOM;if(c&&d.length){d=d.closest(".SC_Twpr");var e=d.find(".SC_pct").find("[data-mid='"+c+"']"),f=d.find(".SC_Drft").find("[data-mid='"+b+"']");f.length||(f=d.find(".SC_Drft").find("[data-mid='"+c+"']")),c=f.attr("id"),c?(c=c.substring(6),$.publish("/mail/msgDiscarded",{draftId:b,msgId:c,actionType:a.actionType})):$.publish("/mail/msgDiscarded",{draftId:b,actionType:a.actionType});var g=e.closest(".SC_pct").find(".zm_ry");zmUtil.viewComposeOptions(!0,g)}},requireMailCollab:function(){return zmAppLoader.load("mailCollaboration").done(function(){zmUtil.debugLog("mailCollab JSLoad complete callback",arguments)})},getMailContent:function(a,b){var c=$.Deferred();b=b||{};var d=b.reload||!1,e=b.nocache||!1,f=b.params||{};if(a)if(!d&&zmail.prevMails[a])c.resolve(zmail.prevMails[a].data.mdata);else{var g={accId:zmail.accId,split:!0,summary:!0},h={};g.msgId=h.msgId=a;for(var i in f)g[i]=f[i];zmUtil.sendMailDataReq(g,h,function(b,d){if(d=d||{},b=b||{},b.mdata){var f=Object.keys(b.mdata).length;0===f||1===f&&b.mdata.MSGID?c.reject():(e||zmUtil.updateMailContent(b,d),c.resolve(zmail.prevMails[a].data.mdata))}else c.reject()},function(a){c.reject()})}else c.reject();return c.promise()},updateMailContent:function(a,b){if(a.mdata){var c=b.msgId;zmail.mailContainer.removeObject(c),zmUtil.prevCache(c,{mdata:a.mdata})}},deleteMsg:function(a){var b=zmail.mailObj[a];if(b&&zmUtil.getFolId()===b.FD){var c={action:"delete"};b.TH&&b.FD!==zmail.folId.dId&&b.FD!==zmail.folId.tId&&!b.AR?(c.mailId=[],c.tmailId=[a]):(c.mailId=[a],c.tmailId=[]),zmmailAct.rdoAction({result:"success"},c)}},discardMsg:function(a){var b=a.draftId,c=a.msgId;if("discard_draft"===a.actionType){var d,e,f=zmail.mailObj[b],g=0;f&&f.TH&&(d=f.T,e=zmail.listObj[d],e&&(g=e.MO.indexOf(b),g!==-1&&e.MO.splice(g,1),zmPreviewTemplate.discardMsgPreview(b)),f.FD===zmail.folId.dId&&zmUtil.removeDraftMapping(b)),c&&zmUtil.isInlineCompose()&&zmPreviewTemplate.discardMsgPreview(c)}},sendMailDataReq:function(a,b,c,d){if(b=b||{},"tIcon"!==b.from){a.comments=!0;var e=zmail.mailObj[a.msgId]||{};a.entityId=a.entityId||e.T||a.msgId,a.groupId=a.groupId||zmail.zuid,a.entityType=1}var f={u:zmail.conPath+"/md.do",t:"POST",fn:c,p:a,ep:b};"function"==typeof d&&(f.efn=d),zmAjq.XHR(f)},selectFolderInLHS:function(a){zmInit.foldView({folId:a,reInitialize:!0}),zmail.mailLeft.selRow(a,"zmlTreeH",!0),zmInit.updateHeaderBand()},getHostName:function(){var a=document.createElement("a");return function(b){return(b=b||"")?(a.href=b,a.hostname||""):""}}(),applyLBDots:function(a){return a=$(a),1===a.length&&a.hasClass("SC_simg")&&(a.children().removeClass("SC_ldot"),a.children().each(function(a,b){"none"!==$(b).css("display")&&$(b).addClass("SC_ldot")})),a},addClickHandlerForTasks:function(){_zm.registerLeftClickHandlers({tagName:"a",attrName:"href",attrVal:".*/zm/#task/.*",callback:function(a){var b=zmHash.decode(a.href);if("task"===b.key){var c=b.params;zmTask.tasklinkClickHandler(c)}}})},addClickHandlerForMailTo:function(){_zm.registerLeftClickHandlers({tagName:"a",attrName:"href",attrVal:"mailto:(.+)",callback:function(a){var b=a.getAttribute("href");zmUtil.compose(zmUtil.getComposeData(b))}})},findTagName:function(a){return zmail.labInfo[a]?zmail.labInfo[a].dispName:""},findFlagName:function(a){var b=zmText.get("mail"),c=b.listing.flagmenu,d={1:c.infoflag,2:c.important,3:c.followup};return d[a]||""},getTagList:function(a){return"default"===a?zmail.zohoAccLabInfo:zmail.labInfo},debugLog:function(){var a=Array.prototype.slice.apply(arguments);a.unshift("ZM_DEBUG > "),zmail.debug===!0&&window.console.log.apply(window.console,a)},saveTabState:function(a){a.appId&&a.app&&a.appObj&&a.category&&zmState.saveTabState(a.appId,a)},restoreLeftState:function(a,b){zmRestore.restoreMailApp(a.data,b)},restoreTabs:function(a){zmRestore.restoreTabs(a)},setPreviewScroll:function(a,b){$(a).length&&$(b).length&&$(b).animate({scrollTop:$(b).scrollTop()+$(a).offset().top-$(b).offset().top})},disableNavigation:function(a,b){if(zmsuite.isWorkspaceAvailable(a)){var c=zmsuite.getCenter(a)[1].getNodes()[0].$el,d=c.find(".msi-prev").parents("b"),e=c.find(".msi-next").parents("b");"prev"===b?d.unbind("click").addClass("SC_opy3"):"next"===b?e.unbind("click").addClass("SC_opy3"):(d.unbind("click").addClass("SC_opy3"),e.unbind("click").addClass("SC_opy3"))}},enableNavigation:function(a,b){if(zmsuite.isWorkspaceAvailable(a)){var c=zmsuite.getCenter(a)[1].getNodes()[0].$el,d=c.find(".msi-prev").parents("b"),e=c.find(".msi-next").parents("b");
"prev"===b?d.removeClass("SC_opy3"):"next"===b?e.removeClass("SC_opy3"):(d.removeClass("SC_opy3"),e.removeClass("SC_opy3"))}},updateCountForAcc:function(a,b,c){if(a&&b){var d={accId:a};switch(b){case"inc":d.mode="inc";break;case"upd":d.mode="update",void 0!==c?d.count=c:d.count=0}$.publish("/acc/unreadCountChange",d)}},getWindowVisibilityStatus:function(){return zmail.windowVisibility},getDesktopNotificationPermission:function(){var a=-1;if("Notification"in window){var b=Notification&&_zm.getProperty(Notification,"permission");switch(b){case"default":case 1:a=1;break;case"granted":case 0:a=0;break;case"denied":case 2:a=2}}return a},getDefaultAccountID:function(){var a,b=zmail.aInfo||{};for(var c in b)if(c=String(c),a=b[c],"1"===String(a.accountType))return c},textReadTime:function(b){var c=$(b).text(),d=zmail.Utils.TextUtil.calculateReadTime(c)/1e3/60,e=Math.floor(d),f=100*Math.round(.6*(d-e)),g="";return 0!==e?(f>30&&(e+=1),g=e>60?zmText.applyArgs(a.readTime.hrRead,{time:"> 1"}):zmText.applyArgs(a.readTime.minRead,{time:e})):f>59?(e+=1,g=zmText.applyArgs(a.readTime.minRead,{time:e})):g=zmText.applyArgs(a.readTime.minRead,{time:"< 1"}),g},isCRMIntegrationsEnabled:function(){return!0},createSearchParams:function(a,b){var c={};if(b=b||{},a.length)return a=a.join(),c.SearchStr=encodeURIComponent(a),c.view="search",b.fId?c.viewfolId=b.fId:(b.flag&&(c.flag=1),b.label&&"-1"!==b.label&&(c.label=b.label),"unread"===b.view&&(c.unreadStatus=1)),c}};x.DraftShare={loadComments:function(){if(zmail.isOrg&&zmUtil.isZohoAccount(zmail.accId)&&"2"===zmail.collabVersion){var a=arguments[0]||{},b=$.Deferred();return $.publish("/draft/openedincompose",{draftID:a.draftID,appendCallback:a.appendCallback,onResize:a.onResize,containerDOM:a.parentElem,deferred:b,context:a.context}),b.promise()}},notifyUpdate:function(){if(zmail.isOrg&&zmUtil.isZohoAccount(zmail.accId)&&"2"===zmail.collabVersion){var a=arguments[0]||{},b=$.Deferred();return $.publish("/draft/sharing/notifyupdates",{draftID:a.draftID,zohoID:a.zuid||zmail.zuid,accountID:a.accId||zmail.accId,deferred:b}),b.promise()}}};var y=function(){$.subscribe("contacts/openingCard",function(b,c){var d=[];c=c||{},!zmUtil.isChildWindow()&&zmail.isCRMUser&&"mail"===c.source&&d.push({htm:a.common.viewcrminfo,clk:function(a){zmUtil.hideMenu(),zmUtil.loadCrm(a.eid)},id:"crminfo"}),c.insertItems(d)})};return y(),x}(),window.zmUtil=function(a){"use strict";return a.requireStreamsApp=function(){var a="streamsApp";return zmAppLoader.load(a)},a.requireStreamsComments=function(){return zmAppLoader.load("streamsComments")},a.loadStreams=function(){return a.requireStreamsApp()},a.openPost=function(b){$.when(a.requireStreamsApp()).done(function(){zmCont.isGroupLoaded(a.callStreamPost,[b,"singlePostpopUp"])})},a.callStreamPost=function(){var a;return _.debounce(function(b,c){if("singlePostpopUp"===c){var d=$("#postpopUp");d.length&&d.remove(),$("body").append('<div id="postpopUp"></div>'),d=$("#postpopUp"),a&&a.$els&&a.remove(),b.commentId?b.allComments=!0:b.commentsToFetch=10,b.elm=d[0],b.callback=function(){var b,c,e={},f="zm_notes"===zmTab.currentTab;return e.$content=d,e.ignoreMouseDown=!1,e.dialogDidMount=function(a){var b=$("body").height();a.$els.$content.css("max-height",b-15*b/100+"px")},e.closeAction=function(){$.publish("/stream/closeDialog",[d[0]]),$.unsubscribe("zmstreamsapp/deletePost",c),$.unsubscribe("zmstreamsapp/closeDialog",c)},a=Dialog["new"](e),b=function(a){a=a.substring(a.indexOf("#")+1,a.length);var b=$("#"+a);b.length&&(b.remove(),znNote.setTopLeft())},c=function(){a.remove(),$.unsubscribe("zmstreamsapp/deletePost",c),$.unsubscribe("zmstreamsapp/closeDialog",c),f&&b(arguments[1].id)},$.subscribe("zmstreamsapp/deletePost",c),$.subscribe("zmstreamsapp/closeDialog",c),$("#postpopUp").find(".SCS-post").addClass("SC_p10"),a},zmStreamsApp.PostApp.singlePost(b)}},500,!0)}(),a.updateStreamUnread=function(){var b=function(b,c){"string"==typeof c.group&&(c.group=$.parseJSON(c.group)),"string"==typeof c.shgroup&&(c.shgroup=$.parseJSON(c.shgroup));var d=c.shgroup||c.group,e=c.ntype,f="30"===e||"4"===e||"41"===e||"46"===e||"25"===e||"44"===e||"43"===e||"79"===e||"61"===e;if(f&&c.nby!==zmail.zuid){var g=zmCont.isGroup(d.id)?d.id:zmail.zuid;zmCont.changeUnread(g,!0)}var h="31"===e||"45"===e||"38"===e;h&&c.nby!==zmail.zuid&&zmUtil.streamUpdate({groupId:d.id,newcomment:!0,reflist:c.refList}),"50"!==e&&"75"!==e&&"51"!==e||c.memberzuid!==zmail.zuid||$.when(a.requireStreamsApp()).done(function(){zmStreamsApp.GroupApp.requestGroupId=d.id,zmStreamsApp.GroupApp.updateGroupListing(!zmCont.isGroup(d.id))})};zmNCenter.handlers.add("streams",b)},a.addClickHandlerForStreams=function(){_zm.registerLeftClickHandlers({tagName:"a",attrName:"href",attrVal:".*/zm/#stream/.*",callback:function(a){var b=zmHash.decode(a.href);if("stream"===b.key){var c=b.params;"tab"===c[0]?zmUtil.loadStreamsInTab({pid:c[2],gid:c[1],etype:c[3],actionType:c[4]}):zmUtil.loadStreamsInTab({pid:c[1],gid:c[0],etype:c[2],actionType:c[3],commentId:c[4]})}}})},a.streamUpdate=function(a){var b={},c=a.groupId;if(b=zmail.mailLeft.getNodes()[0].getLayer("zmStreamTree"),b.listObject[c])if(a.newcomment){var d=_.size(a.reflist)?a.reflist.split(","):[],e=_.find(d,function(a){if(a===zmail.zuid)return!0});e||b.addClassAtStart(c,"msi-lcmnt")}else{var f=void 0!==a.incFlag&&a.incFlag;b.updateCount(c,"upd",a.count,f,!1),f||b.clearNew(c)}},a.loadStreamsInTab=function(a){$.when(zmUtil.loadStreams(2)).done(function(){zmStreamsApp.events.openPostInTab(a)})},a.loadNewPostDialog=function(b,c){void 0===c&&(c=[]),a.requireStreamsApp().done(function(){zmStreamsApp.updateBox({content:b,attachment:c},!0)})},a.cmpDraft=function(a,b){var c=function(){zmComp.getAppDOM(a,b)};zmUtil.requireComposeModule().done(function(){c()})},a}(window.zmUtil||{}),function(){"use strict";var a={},b={TextDIVWithWrapper:['<div id="text-area-resizer-wrapper">','<div id="resize-duplicate"></div>',"</div>"].join("\n")},c={TextDIVWrapper:{opacity:"0",position:"fixed",left:"0",top:"0",padding:"0",margin:"0",overflow:"hidden",display:"block","pointer-events":"none",border:"none",outline:"none"},TextDIV:{opacity:"0",height:"auto","max-height":"auto","min-height":"auto",overflow:"hidden",display:"block",position:"static","pointer-events":"none"}},d={heightResize:100,scrollAdjust:100},e=function(){var a;return function(d){if(d=d||{},!a){var e=$(b.TextDIVWithWrapper);e.css(c.TextDIVWrapper),a=$("#resize-duplicate",e),a.css(c.TextDIV),e.appendTo(document.body)}return a}}(),f=function(a){a=$(a)[0];var b,c={};return a&&"function"==typeof window.getComputedStyle?(b=window.getComputedStyle(a),Array.prototype.forEach.apply(b,[function(a){c[a]=b[a]}]),c):c},g=function(a){a=a||{};var b,c,d,e,f,g;e=a.scrollParent,f=a.scrollTopBeforeResize,g=a.scrollAdjustDuration,d=e.scrollTop(),c=Math.round(document.body.clientHeight/10),b=d-f,0!==b&&(b<0&&(c=-c),e.animate({scrollTop:e.scrollTop()+c},{duration:g,queue:!1,easing:"linear"}))},h=function(a,b){if(b=b||{},a){var h,i,j,k,l,m,n,o,p,q,r,s,t,u;if(t=d.heightResize,u=d.scrollAdjust,h=a.value||"",h=h.replace(/\n/gim,"\n_"),i=f(a),b.minHeight&&window.isFinite(b.minHeight)?j=b.minHeight:(j=i["min-height"],j=window.parseInt(j),window.isFinite(j)||(j=i["line-height"],j=window.parseInt(j),window.isFinite(j)||(j=0),j*=2)),j=j||0,i=$.extend(i,c.TextDIV),k=e(),l=k[0],k.css(i),k.text(h),m=l.offsetHeight+j,n=a.offsetHeight,o=m-n,0!==o){s="hidden",b.maxHeight?(r="function"==typeof b.maxHeight?b.maxHeight():b.maxHeight,r<=0?r=m:m>=r&&(s="auto",t=0,u=0)):r=m,p=$(a).scrollParent(),q=p.scrollTop();var v=function(){"function"==typeof b.onResize&&b.onResize({element:$(a)[0],height:m,maxHeight:r,overflow:s,change:o}),g({scrollParent:p,scrollTopBeforeResize:q,scrollAdjustDuration:u})};$(a).animate({height:m+"px","max-height":r+"px","overflow-y":s},{duration:t,easing:"linear",queue:!1,complete:v})}}};a.resize=h,window.zmail=window.zmail||{},window.zmail.Utils=window.zmail.Utils||{},window.zmail.Utils.TextAreaResizer=a}(),function(){"use strict";var a=zmail.Core.Namespaces,b=a.create("zmail.Utils.TextArea"),c=function(a){a=$(a)[0];var b,c={};return a&&"function"==typeof window.getComputedStyle?(b=window.getComputedStyle(a),Array.prototype.forEach.apply(b,[function(a){c[a]=b[a]}]),c):c},d=function(a){return a.selectionEnd||a.selectionStart||0},e=function(a,b){b=b||{};var d=a.getBoundingClientRect(),e=d.width+"px",f=d.height+"px";b.autoWidth&&(e="auto");var g=$("<div>")[0],h=c(a);return h=$.extend(h,{position:"absolute",top:"0",left:"0",width:e,height:f,opacity:"0",margin:"0","pointer-events":"none"}),$(g).css(h),$(document.body).append(g),g},f=function(a,b){var c=a.value||"";c=c.substr(0,b);var d=/(?:(?=\s*)([\S]+[^\S\n]*)$)/i,e=d.exec(c),f=e?e[1]:" ";return f},g=function(a,b){if(b=b||{},a=$(a)[0],!a)return null;var c=e(a,b),g=a.value||"",h=d(a),i=f(a,h);g=g.substring(0,h),g=g.substr(0,g.length-i.length);var j=document.createElement("span");j.setAttribute("class","content-span"),j.appendChild(document.createTextNode(g));var k=document.createElement("span");k.setAttribute("class","content-span-last-word"),k.appendChild(document.createTextNode(i)),c.appendChild(j),c.appendChild(k);var l=k.getBoundingClientRect();return $(c).remove(),c=null,l},h=function(a,b){b=b||{};var c=$(e(a,b)),d=$("<span></span>");d.text(a.value),c.append(d);var f=c[0].getBoundingClientRect();c.remove(),c=null,d=null,b.suppressResize||$(a).css({width:f.width+"px"});var g=f.width,h=f.height;return b.minWidth&&(g=Math.max(g,b.minWidth)),{width:g,height:h}};b.findCurrentTypingWord=f,b.findCursorPosition=g,b.fitInputWidth=h}(),window.zmUtil=function(a){"use strict";var b=[],c=function(a){b.push(a)},d=function(a){var c,d,e=b.length-1;for(d=e;d>=0;d--)if(c=b[d].element){if(document.body.contains(c))break;b.splice(d,1)}b.length&&(b[d].activeMenu=a)},e=function(a,b,c){var d=a.element,e=a.activeMenu||{},f=a.waitForActiveMenuHandler,g=!0;return d?(document.body.contains(d)&&(b&&!f||!e.activeMenuHandler||(g=e.activeMenuHandler.apply(a,e.activeMenuArgsArray)),g=g?!c:g,g&&(_zm.blindRemoveElement(d),a.menuHandler&&a.menuHandler.apply(a,a.menuArgsArray))),g):(a.menuHandler&&a.menuHandler.apply(a,a.menuArgsArray),!0)},f=function(a,b,c){var d,f,g=a.length-1;for(f=g;f>=1;f--){if(d=a[f],!e(d,b,c))return!1;a.pop()}return!0};return a.hideMenu=function(a,c){var d,g=b.length,h=!0;if(g){if(d=b[0],g>1&&(h=!!f(b,a,c)&&!d.hideChildMenuFirst),!h||!e(d,a,c))return!1;b.pop()}return!0},function(){$.subscribe("/mail/menuCreated",function(a,b){c(b)}),$.subscribe("/mail/activeMenu",function(a,b){d(b)})}(),a}(window.zmUtil||{}),function(){"use strict";var a=zmail.Core.Namespaces,b=a.create("zmail.Utils.TextUtil"),c=function(a,b){a=a||"",b=b||{};var c,d=1e3,e=0,f=0,g=0;return b.breakPeriods===!0&&(a=a.replace(/\./g," ")),a=a.replace(/\s+/g," "),(a.split(" ")||[]).forEach(function(a){a=a||"",a.length>=7?g++:a.length>3?f++:e++}),c=Math.round(e/6)+Math.round(f/3)+Math.round(g/1),c=1e3*c+d};b.calculateReadTime=c}(),function(){"use strict";var a=zmail.Core.Namespaces,b=zmail.Utils.EmailValidator,c=a.create("zmail.Utils.EmailParser"),d=function(a,b){return"function"==typeof String.prototype.repeat?a.repeat(b):new Array((++b)).join(a)},e=function(a){var b;return b=a,b=b.replace(/\\"/gim,"__"),b=b.replace(/("[^"]*")/gim,function(a){return d("_",a.length)})},f=function(a){var b,c,d=/(?:([^;,]+)[;,]?)/gim,f=[];for(c=e(a),b=d.exec(c);null!==b;)f.push({index:b.index,length:b[1].length}),b=d.exec(c);return f},g=function(a){var b,c,d,f,g,h=/(?:([^ ]*)( +)([^@ ]+)(@)([^@ ]+))/gim,i=/(?:(.*)(<)([^@ ]+)(@)([^@ ]+)(>))/gim,j=0;return b=e(a),c=i.exec(b),null===c&&(c=h.exec(b)),c?(d=a.substr(j,c[1].length),d=d.trim(),j+=c[1].length+c[2].length,f=a.substr(j,c[3].length),f=f.trim(),j+=c[3].length+c[4].length,g=a.substr(j,c[5].length),g=g.trim(),'"'===d.charAt(0)&&'"'===d.charAt(d.length-1)&&(d=d.substr(1,d.length-2)),"<"===f.charAt(0)&&(f=f.substr(1)),">"===g.charAt(g.length-1)&&(g=g.substr(0,g.length-1)),{name:d,local:f,domain:g}):null},h=function(a){var c,d,e,f={},h=!1;return a=a.trim(),e=g(a),e?(h=!0,c=e.local+"@"+e.domain):c=a,d=b.validate(c),h?f.name=e.name:(f.name=a.substr(0,a.lastIndexOf("@")),f.name=f.name.replace(/[^a-z0-9\- _]*/gim,"")),f.email=c,f.valid=d.status,d.status||(f.errorCode=d.errorCode,f.errorMessage=d.errorMessage),f},i=function(a,b){var c=[],d=[];return b=b||{},a=a||"",c=f(a),c.forEach(function(b){var c=a.substr(b.index,b.length),e=h(c);d.push(e)}),d};c.parse=i}(),function(){"use strict";var a=zmail.Core.Namespaces,b=a.create("zmail.Utils.Image"),c=zmail.Utils.DeferredCollection,d=c.create({keepDeferreds:!1}),e=function(a,b,c){c=c||{};var d=$("<img />")[0],e=function(){d.onload=void 0,d.onerror=void 0,d=void 0,e=void 0};d.onload=b.resolve,d.onerror=b.reject,d.src=a,d.complete&&b.resolve(),b.always(e)},f=function(a,b){a=(a||"").trim(),b=b||{};var c=this._deferreds||d;if(!a)return $.Deferred().reject().promise();b.forceRequest===!0&&c.clear(a);var f=c.has(a),g=c.get(a);return f||e(a,g,b),g.promise()},g=function(a){a=a||{};var b={_deferreds:c.create({keepDeferreds:a.storeRequests===!0})};return b.load=f,b};b.load=f,b.createLoader=g}(),function(){"use strict";var a=zmail.Core.Namespaces,b=a.create("zmail.Utils.Image"),c=b.load,d=function(a,b,c){c=c||{};var d,e=$("<img />"),f=$("<canvas />"),g=function(){try{f.css({height:e.outerHeight()+"px",width:e.outerWidth()+"px"}),d=f[0].getContext("2d"),d.drawImage(e[0],0,0),b.resolve(f[0].toDataURL())}catch(a){b.reject()}},h=function(){e.remove(),e=void 0,f.remove(),f=void 0,d=void 0,g=void 0,h=void 0},i={opacity:"0",position:"fixed",top:"0",left:"0",height:"auto",width:"auto",zIndex:"-100",overflow:"hidden"};e.css(i),f.css(i),e.appendTo(document.body),f.appendTo(document.body),e.on("load",function(){g()}),e.on("error",b.reject),e.attr({src:a}),e[0].complete&&g(),b.always(h)},e=function(a,b){b=b||{};var e=$.Deferred();return(a=a||"")?("string"!=typeof a&&(a=a.src),a=a.trim(),c(a).done(function(){d(a,e,b)}).fail(e.reject),e.promise()):e.reject().promise()};b.getDataURL=e}(),zmail.avatar=function(a){"use strict";var b=zmail.Utils.Image.createLoader({storeRequests:!0}),c={str:function(a){var b,c="";return a.photoURL?(c="src='"+a.photoURL+"'",b="<img alt='"+a.initials+"' "+c+"/>"):b=a.initials,"<div class='"+a.colorClass+"'>"+b+"</div>"},template:function(a){var b=["DIV",{attrs:{"class":a.colorClass},child:[]}];return a.photoURL?b[1].child.push(["IMG",{attrs:{alt:a.initials,src:a.photoURL}}]):b[1].child.push(["text",a.initials]),b},dom:function(a){return _zm.getDOM(c.template(a))}},d=function(){var a={},b=function(a){return a.zuid||a.zohoUserID||a.emailAddress||a.email||a.displayName||(a.firstName||"")+(a.lastName||"")||a.nickName},c=["avtrBg1","avtrBg2","avtrBg3","avtrBg4","avtrBg5","avtrBg6","avtrBg7"],d=function(){return c[Math.floor(Math.random()*c.length)]};return{getColorClass:function(c){var e=b(c);return e in a||(a[e]=d()),a[e]}}}(),e=function(){var a=function(a){return a=a||"",a=$.trim(a),a=a.split(/\s+/),a.length>=2?a[0][0]+a[1][0]:(a=a[0],a[0]||"")};return{getInitials:function(b){var c=b.displayName||(b.firstName||"")+(b.lastName||"")||b.nickName||b.emailAddress||b.email;return a(c)}}}(),f=function(a,b){a.colorClass="SC_avtr "+(b.colorClass||d.getColorClass(a)),a.initials=e.getInitials(a);var f=c[b.type]||c.template;return f(a)},g=function(a){if(a.displayName||a.email)return{displayName:a.displayName,emailAddress:a.email}},h={validateEmail:function(a){var b=a.emailAddress||a.email;if(b){var c=zmail.Utils.EmailValidator.validate(b);return c.status}return!1}};return a.get=function(a){a=a||{},a.request=void 0===a.request||a.request;var c,d=$.Deferred(),e=function(){d.resolve(f(c,a))},i=function(){c=c||g(a),c?(delete c.photoURL,d.resolve(f(c,a))):d.reject()};a.validateEmail&&!h.validateEmail(a)&&i();var j=function(a){a&&a.photoURL?b.load(a.photoURL).done(e).fail(i):i()},k=zmCont.getContactInfo(a);return a.request?k.done(function(a){c=a,j(c)}).fail(i):(c=k,j(c)),d.promise()},a}(zmail.avatar||{}),function(a){"use strict";var b={},c=document,d=zmText.get("commonUtils").clipBoard,e=function(a){var b,d=window;c.selection?(b=c.body.createTextRange(),b.moveToElementText(a),b.select()):d.getSelection&&(b=c.createRange(),b.selectNode(a),d.getSelection().removeAllRanges(),d.getSelection().addRange(b))};b.setData=function(a,b){b=b||{};var f=c.createElement("DIV");"html"===b.type?f.appendChild(a):f.textContent=a,f.style.opacity="0",c.body.appendChild(f),e(f),c.execCommand("copy"),b.hasOwnProperty("onSuccess")&&"function"==typeof b.onSuccess?b.onSuccess():(b.hasOwnProperty("showSuccessMessage")||"undefined"==typeof b.showSuccessMessage)&&_zm.succErrMsg("s",d.success,{hide:""}),f.remove()},b.isSupported=function(){return!!c.queryCommandSupported("copy")},a.clipBoardAPI=b}(window.zmComponent||{});