window.zmStreamsApp=window.zmStreamsApp||{},window.zmStreamsApp.constants=function(){"use strict";var a={};return a.rightClickId="",a.workspaceId="zmStreamsApp",a.popupId="zms_dropdown",a.elements={},a.setElements=function(){var b=zmsuite.getCenter()[0].getNodes(),c=b[2]&&b[2].$el.find(".SCS_rgt").length?b[2].$el.find(".SCS_rgt"):zmsuite.getCenter()[0].getNodes()[2].$el;a.elements={center:zmsuite.getCenter()[1],zm_stHdr:b[0].$el[0],streamListWrapper:b[2].$el[0],zm_stMain:b[1].$el[0].parentElement,zm_stPView:zmsuite.getCenter()[1].$el[0],preview:zmsuite.getCenter()[1],zm_stream:b[0].$el[0].parentElement,centerOuter:zmsuite.getCenterOuter().$el[0],leftHolder:b[2].$el.find(".zmGroupLft"),postHolder:c}},a.removeNotificationPreview="/ncenter/closePreview",a.closeDialog="/stream/closeDialog",a.reconnect="zmailReconnect",a.appSwitch="/apps/tabSwitched",a.mailPreviewUnload="mail/preview/unload",a.taskCloseTab="/zm/task/closetab",a.notifications={mail_type:"4",like:"23",unlike:"24",post_mention:"25",unlike_comment:"26",unshared:"27",invite:"29",add_post:"30",add_comment:"31",delete_post:"32",delete_comment:"34",delete_private_comment:"35",add_private_comment:"36",change_entity:"37",comment_mention:"38",bulk_update:"39",bulk_delete:"40",add_task:"41",reminder_task:"42",add_share_comment:"43",post_group_mention:"44",comment_group_mention:"45",add_event:"46",update_event:"47",delete_event:"48",like_comment:"49",add_group_member:"50",remove_group_member:"51",resource_share:"52",shareperm_change:"53",shareperm_removal:"54",update_event_status_yes:"55",update_event_status_no:"56",update_event_status_maybe:"57",task_assign:"58",mail_reminder:"59",accept_share:"60",mail_share:"61",add_attachment:"62",change_task_due_date:"63",change_task_assignee:"64",change_task_status:"65",change_task_priority:"66",change_task_category:"67",change_task_title:"68",change_task_description:"69",remove_attachment:"70",draft_share:"71",draft_shareupdate:"72",draft_mailmention:"73",share_unsubscribe:"74",stream_group_enable:"75",stream_group_disable:"76",mail_streams_enable:"77",mail_streams_disable:"78",add_link:"79",change_link_category:"80",change_link_title:"81",change_link_description:"82",change_link_url:"83",mark_link_fav:"84",calendar_reminder:"85",calendar_reminder_mailid_change:"86",calendar_sharing:"87",calendar_unsubscribe:"88",biz_sub_online_renew_due_fewday:"89",biz_sub_online_renew_tdy:"90",biz_sub_online_renew_overdue:"91",biz_sub_online_renew_overdue_tdy:"92",biz_sub_offline_renew_due_fewday:"93",biz_sub_offline_renew_tdy:"94",biz_sub_offline_renew_overdue:"95",biz_sub_offline_renew_overdue_tdy:"96",biz_sub_purchase_more:"97",biz_sub_purchase:"98",domain_not_verified:"99",domains_not_verified:"100",mail_hosting_nil:"101",mx_not_pointed_to_zoho:"102",reg_domain_auto_renew:"103",reg_domain_manual_renew:"104",add_subtask:"105",edit_link:"106",lock_invites:"107",unlock_invites:"108"},a}(),zmStreamsApp.i18ntext=function(){"use strict";var a={};return a.streams=zmText.get("streams","streams"),a}(),window.zmStreamsApp=window.zmStreamsApp||{},zmStreamsApp.util=function(){"use strict";var a=zmStreamsApp.constants,b=zmText.get("streams"),c={hideMenu:function(){$("#zm_dropDown").remove(),$(".SCS_postHover").removeClass("SCS_postHover"),$(".SC_ddn").removeClass("SC_ddn")},getTabElement:function(a){var b,c=zmsuite.getCenter()[0].$el,d=c.find(".SCS_tabWrapper.posFixed").is(":visible"),e=void 0!==a?a:d,f=e?"zm_staticTab":"zm_fixedTab";return b=c.find(".SCS_tabWrapper."+f)},orderComments:function(a,b){var c=_(b).map(function(b,c){var d=a[b];return d.sequence=c+1,d});return c},groupManagement:function(a){var b=a.members,c=a.groupId;"addMember"===a.mode?(b||[]).forEach(function(a){zmCont.GroupAPI.addMember(c,a)}):"removeMember"===a.mode?zmCont.GroupAPI.removeMember(c,b):"addModerator"===a.mode?zmCont.GroupAPI.addModerator(c,b):"removeModerator"===a.mode&&zmCont.GroupAPI.removeModerator(c,b)},showGroupDetails:function(a){var b=zmsuite.isWorkspaceAvailable("zmStreamsApp")?zmsuite.getCenter("zmStreamsApp")[0].$el[0]:"",c=zmUtil.createFLComp("groups",{data:a.groupInfo,search:"name",display:"name",displayAs:"dropdown",onSelect:a.fn,showCheckbox:!1,showCreate:!1,parentDOM:$(a.elm),removehandler:!0,viewDOM:b,showUnread:a.showUnread});$(a.elm).addClass("SC_ddn"),$.publish("/mail/menuCreated",{menuHandler:function(){$(".SC_ddn").removeClass("SC_ddn")}}),c.show()},getNameOfInvitee:function(a,b,c){var d,e,f,g="",h=0;a=a.split(",");for(var i=0;i<a.length;i++){if(d=a[i],zmCont.isGroup(d))e=zmCont.getGroup(d),g+=e.name;else{f=!1;for(var j in b)String(j)===d&&(g+=b[j],f=!0);f||(g+=zmCont.getOrgContacts(d)[d].fn),!g&&c&&(g=c)}h++,h!==a.length&&(g+=", ")}return g},publishDeletePost:function(a){$.publish("zmstreamsapp/deletePost",a)},getHourAndTime:function(a){var b=new Date(a),c=b.getHours(),d=b.getMinutes(),e=c>=12?"PM":"AM";return c%=12,c=c?c:12,(c<10?"0":"")+c+":"+(d<10?"0":"")+d+" "+e},getFullDateFormat:function(a){var b=new Date(a);return"undefined"==typeof b.getDateBy?b="":(b=b.getDateBy(zmail.userDateFormat.toUpperCase()),b+" "+zmStreamsApp.util.getHourAndTime(a))},updateTime:function(a){var b,c,d=new Date(a),e=new Date;return c=d.toDateString()===e.toDateString(),b=e-d,b=Math.round(b/6e4),!!(b&&b>0)&&(c?b<60?b+" mins ago":zmStreamsApp.util.getHourAndTime(a):d.toDateString().slice(0,10).toUpperCase())},getMentionList:function(a){var b=[],c=a.myact?a.myact:a.get("myact");b=c.showinvite?[]:c.mention;var d=a.gnrl?a.gnrl:a.get("gnrl"),e=d.group.id;if(c.showinvite)b="org";else if(!c.showinvite&&zmCont.isGroupMember(zmail.zuid,e)){var f=c.inviteeList||[],g=zmCont.getGroup(e).members||[];if(b=g.concat(f),b=b.concat(e),d.shared){var h,i=c.shGroup;for(var j in i)h=i[j].id,h!==zmail.zuid&&zmCont.isGroupMember(zmail.zuid,h)&&(b=b.concat(h))}}return b},getMentionData:function(a){var b,c="",d=zmMention.getMentions($(a)),e=[],f=d.length;for(b=0;b<f;b++)e.push(d[b].zid);c=e.join(",");var g;return c.length&&(g=zmAutoFill.mentionData($(a))),{offset:g,mention:c}},getPostType:function(a){var c=zmStreamsApp.PostApp.constants.streamTypeInfo[a];return b.streams.post.postType[c]},sendRemove:function(a,b,c){b?$(a).removeClass("zs_snd"):void 0!==b&&$(a).addClass("zs_snd"),$(a).text(c)},membersFilter:function(a,b){var c=zmCont.getGroup(a),d=zmCont.getOrgContacts(c.members.join(","),"Array"),e=zmAutoFill.filterArray(d,["fn","eid","nn"],b,!0);return e},showMembersDialog:function(a,b){var c=zmStreamsApp.template.listMembers(a),d={};d.$content=c,d.title=b,Dialog["new"](d)},createDialog:function(a){var c=a.items,d=a.shGroup,e={};for(var f in c)if(zmCont.isGroup(f))e[f]=zmCont.getGroup(f);else{for(var g in d)String(d[g].id)===f&&(e[f]=d[g],e[f].isGroupid=!0);void 0===e[f]&&(e[f]=zmCont.getOrgContacts(f)[f])}var h=_.pick(a.items,function(a){return a===String(zmail.zuid)}),i=_.pick(a.items,function(a){return a!==String(zmail.zuid)}),j=[],k=[];j.push(i),k.push(h);var l=_.size(j[0])%2;if(l&&0!==_.size(k[0])){var m=Object.keys(k[0])[0],n={};n[m]=k[0][m],j.push(n),delete k[0][m]}var o=zmStreamsApp.template.popup[a.type](k,a.showInvite,e,a.isOwner),p={};p.$content=o,p.dialogDidMount=a.dialogDidMount,p.dialogWillMount=function(b){$(b.$els.$content).append(zmStreamsApp.template.popup[a.type](j,a.showInvite,e,a.isOwner));var c=_.size(j[0])+_.size(k[0]);if(a.showInvite){var d=zmStreamsApp.template.invitee_input();$(b.$els.$content).after(d),c>1&&$(d).css("width",500),setTimeout(function(){$(d).find("input").focus()},500)}c>1&&$(b.$els.$contentWrapper).css("width",500),$(b.$els.$content).css("max-height",.8*$(window).height())},a.buttons&&a.buttons.length>0&&(p.buttons=a.buttons),p.title=b.common.labels.invitee,Dialog["new"](p)},createPopup:function(b){var c=b.items,d=b.shGroup,e={};for(var f in c)if(zmCont.isGroup(f))e[f]=zmCont.getGroup(f);else{for(var g in d)String(d[g].id)===f&&(e[f]=d[g]);void 0===e[f]&&(e[f]=zmCont.getOrgContacts(f)[f])}var h=zmStreamsApp.template.popup[b.type](b.items,b.invite,e,b.showInvite),i={par:b.parent,showArrow:!0,liDom:h,ulClass:b.ulclass,spanClass:b.parentClass,id:a.popupId};return b.callback&&(i.clk=b.callback),b.buttons&&b.buttons.length>0&&(i.buttons=b.buttons),b.hoverElm&&$(b.hoverElm).addClass("SC_ddn"),b.direction&&(i.direction=b.direction),b.noArrow&&(i.showArrow=!1),void 0!==b.liHover&&(i.liHover=b.liHover),b.align&&(i.align=b.align),b.container&&(i.container=b.container),b.onhide&&(i.onHide=b.onhide),b.avoidScroll&&(i.avoidScroll=b.avoidScroll),zmsuite.showMenu(i),b.done&&b.done($("#zm_dropDown")),$("#zm_dropDown")},closePreview:function(){var a=zmsuite.getCenter(),b=$(a[1].$el),c=b.data("view");c||(b=$(a[0].$el),c=b.data("view")),c&&c.remove(),a[1].$el.parent().removeClass("SC_sw"),a[1].close();var d=a[0].$el.find(".streamsList").filter(".zmSLst");d.length&&(d.removeClass("zmSLst"),"unread"===zmStreamsApp.events.getCurrentView().view&&d.remove())},bindEntityElements:function(a){var b=a.entityElem,c=a.entityId,d=zmail.mailObj[c].TH,e=zmsuite.getCenter(),f=$(e[1].$el),g=f.data("view");g||(f=$(e[0].$el),g=f.data("view"),g||(f=a.entityElem.parents(".SCS_postMail"),g=f.data("view"))),d||(f=""),b.hasClass("msi-fav")?g.addLabel(b,"","",f):b.hasClass("zmst_lbl")&&g.applyLabel(b,!0)},getDropdownMenu:function(a){var c=$(zmsuite.getCenter()[1].$el).data("view");c||(c=$(zmsuite.getCenter()[0].$el).data("view"));var d=zmStreamsApp.PostApp.getModelForMail(a),e=[{htm:b.common.labels.copylink,data:{action:"copylink",fn:function(){c.showDialogLink.apply(c)}}}];return e.push({htm:d.get("myact").watching?b.common.labels.unwatch+" "+b.streams.post.postType.mail:b.common.labels.watch+" "+b.streams.post.postType.mail,data:{action:"watch",fn:function(){c.watchPost.apply(c)}}}),d.get("myact").showdelete&&e.push({htm:b.common.labels.deleteOnly+" "+b.streams.post.postType.mail,data:{action:"streamsdelete",fn:function(){c.deletePost.apply(c)}}}),e.push({htm:b.streams.activitylog.timeline,data:{action:"streamsTimeline",fn:function(){zmStreamsApp.PostActions.getActivityLogs(d,!1,c.$el),setTimeout(function(){var a=c.$el.find(".SCS_postAct"),b=_zm("<","body")[0].getBoundingClientRect(),d=c.$el.find(".SCS_activitiyFeed").offset().top;a&&d>b.height&&a[0].scrollIntoView({behavior:"smooth"})},500)}}}),e},hideOptions:function(){var a=zmsuite.getCenter();_zm(".","msi-gototop",a[0].$el[0])[0].parentElement.parentElement.style.visibility="hidden",_zm(".","msi-status",a[0].$el[0])[0].parentElement.parentElement.style.visibility="hidden"},removeViews:function(a,b,c){b=b.element?b.element:b,zmStreamsApp.util.detachAndRemove(b,c)},detachAndRemove:function(a,b){var c=$.Deferred();try{b=b||zmTab.currentTab,a=a||zmsuite.getCenter(b)[0].$el;var d=$(a).find("#s_postview");if(d=d.length?$(d):$(a),d.length){var e=$(d).find("div.SCSpostAct");e.length&&zmStreamsApp.PostActions.removeViews(e);var f=$(d).find("div.sc_cmdv");f.length&&zmStreamsApp.CommentModule.removeViews(f);var g=$(d).find("div.SCS_post");!g.length&&$(d).hasClass("SCS_post")&&(g=$(d)),g.length&&zmStreamsApp.PostApp.removeViews(g);var h=$(d).find("div.zmL");h.length&&zmStreamsApp.PostApp.removeViews(h),c.resolve()}else c.resolve()}catch(i){zmUtil.debugLog(i),c.resolve()}return c},restoreStreams:function(a,c){var d=zmStreamsApp.RouteHelper,e={appname:b.common.labels.appName,appId:a,data:{CNodes:"3"},appIcon:"msi-streams",searchPlaceHolder:b.common.labels.searchStreams,faqKey:"Streams",router:d,onDelete:function(){return $.publish(zmStreamsApp.constants.removeNotificationPreview,{element:zmsuite.getCenter(a)[0].$el[0]}),!0}};return{streamAppObj:e,tabRouter:d}},printEntity:function(a){a.dataRequest=!0,a.callback=function(a){var c=a,d=c.gnrl.type,e=zmStreamsApp.PostApp.template.post({data:a,grid:!0,type:"Status",id:a.id,isPrint:!0}),f=$(e).find(".postMsg");d===zmStreamsApp.PostApp.constants.streamTypeName.task?zmStreamsApp.PostApp.components.addTask(a,f):d===zmStreamsApp.PostApp.constants.streamTypeName.note?zmStreamsApp.PostApp.components.addNote(a,f):d===zmStreamsApp.PostApp.constants.streamTypeName.event?zmStreamsApp.PostApp.components.addEvent(a,f):d===zmStreamsApp.PostApp.constants.streamTypeName.link&&zmStreamsApp.PostApp.components.addLink(a,f);var g={elm:$(e).find(".SCS_postWra"),by:c.gnrl.by,id:c.id,etype:d,groupId:c.gnrl.group.id,showinvite:c.myact.showinvite,like:c.myact.like,invitee:parseInt(c.act.invitees),likes:parseInt(c.act.likes),postUuid:c.gnrl.on,inviteeList:c.myact.inviteeList,isOwner:c.gnrl.by===zmail.zuid,lockInvites:c.gnrl.lockInvites,shGroup:c.myact.shGroup,mentionList:c.myact.mention,isDraft:c.gnrl.draft,shared:c.gnrl.shared};zmStreamsApp.PostActions.getPostTemplate(g);var h=zmStreamsApp.util.orderComments(c.cmnt.comments,c.cmnt.order);h.total=c.cmnt.total;var i={elm:$(e).find(".SCS_postWra"),comments:h,id:c.id,isShare:!1,groupId:c.gnrl.group.id,etype:d,owner:c.gnrl.by,isDisableAdd:!0,shGroup:c.myact.shGroup,isPrint:!0};zmStreamsApp.CommentModule.getCommentTemplate(i),zmail.Printer.print({title:b.common.labels.titlePrint,content:e,css:["streams.css"]})},zmStreamsApp.PostApp.singlePost(a)},reconnectActions:function(){zmCont.getGroupOrder().length&&(window.console.log("Updating streams View, in respond to zmailReconnect - "+new Date),"undefined"!=typeof zmStreamsApp.GroupApp&&zmStreamsApp.GroupApp.getAllUnread(),"undefined"!=typeof zmStreamsApp.PostApp&&zmStreamsApp.PostApp.updateCurrentListing(),c.setStreamsAppSelection())},setStreamsAppSelection:function(b,c,d){c=c||zmTab.currentTab;var e=a.workspaceId;c!==e&&d===e&&"m"===zmApp.selectedApp?zmail.mailLeft.getNodes()[0].resetDefaultSelection():c===e&&zmStreamsApp.GroupApp&&zmStreamsApp.GroupApp.GroupId&&zmail.mailLeft.getNodes()[0].setTempSelection("zmStreamTree",zmStreamsApp.GroupApp.GroupId)}};return c}(),window.zmStreamsApp=window.zmStreamsApp||{},window.zmStreamsApp=function(a){"use strict";var b=zmText.get("streams"),c=zmStreamsApp.constants;a.constructWorkSpace=function(d,e){var f=c.workspaceId;zmNCenter.icon.defaultStreamIcon();var g,h=zmStreamsApp.util.restoreStreams(f);"restore"===e&&zmsuite.isWorkspaceAvailable(f)?zmsuite.resetWorkspace(f,h.streamAppObj):zmsuite.setWorkSpace(h.streamAppObj);var i=zmsuite.getAppObj(zmTab.currentTab);$(i).on("tabFocused",function(){zmail.trialUsers||"zm_Container"!==zmTab.currentTab||"zmStreamTree"!==zmail.mailLeft.selLayerId||zmHash.setHash("stream")}),g=a.getCenter($(zmStreamsApp.constants.elements.postHolder));var j={text:"",rIcons:[[{tooltip:b.common.tooltips.close,iconClass:"msi-close",data:"close"}]]},k=zmsuite.getCenter()[1].getNodes();zmail.trialUsers||(g[2].$el.append($("<div id='zm_stHolder' class='SC_mc'><div class='SCS_lft zmGroupLft' ></div><div class='SCS_rgt SC_grid'></div>")),k[0].push(j)),zmsuite.renderWorkSpace(),zmsuite.showWorkSpace(f),d=void 0===d?"grid"===zmAdHocSettings.getStreamsListType():d,"default"===zmAdHocSettings.getStreamsListType()&&(d=!0);var l="SC_streams"+(d||zmail.trialUsers?"":" SC_list");$(g[1].$el[0].parentElement).addClass(l),c.setElements()};var d=function(a){var b=zmStreamsApp.events.getCurrentView().elm.parent().children();b.each(function(b,c){$(c).find("div.SC_nmsg").length||$.when(zmStreamsApp.util.detachAndRemove(c)).done(function(){$(c).data({grid:"grid"===a,request:!1,next:""}).empty()})})},e=function(a){var b,e,f="msi-gridview"===a;if(c.setElements(),b=c.elements.zm_stHdr,e=$(b).find(".SC_sel i").hasClass(a),!e){var g=$(c.elements.zm_stMain).find(".SCS_lft");g.length&&$(c.elements.zm_stMain)[f?"removeClass":"addClass"]("SC_list"),$(b).find(".SC_sel").removeClass("SC_sel"),$(b).find("."+a).parents("b").addClass("SC_sel");var h=zmStreamsApp.events.getCurrentGroupId();d(f?"grid":"list");var i=zmStreamsApp.events.getCurrentView();if(i.elm.parent()[f?"addClass":"removeClass"]("SCS_rgtIn"),"files"===i.view)zmStreamsApp.PostApp.postTabs(void 0,h);else{var j={view:i.view,gridview:f,switchView:!0};zmStreamsApp.PostApp.init(i.elm,h,j,!1)}var k=f?"grid":"list";zmAdHocSettings.setStreamsListType(k)}};a.getCenter=function(a,c){var d=zmsuite.getCenter(),f=d[0].getNodes(),g={iconList:["msi-add"],tooltip:b.common.tooltips.groupSubscription,data:"subscribe"};zmail.trialUsers&&(g="",c&&(g={iconList:["msi-add"],tooltip:b.common.labels.addNewMember,data:"addmember"},zmCont.getGroup(c).isOwner||(g.hideIcon=!0)));var h={list:{left:[],right:[{actionArr:[{iconList:["msi-status"],tooltip:b.common.tooltips.writeStatus,data:"status"},{iconList:["msi-gototop"],tooltip:b.common.tooltips.toTop,data:"gototop"}]},{actionArr:[{iconList:["msi-gridview"],tooltip:b.common.tooltips.gridView,data:"grid"},{iconList:["msi-listview"],tooltip:b.common.tooltips.listView,data:"list"},{iconList:["msi-close"],tooltip:b.common.tooltips.close}]}]},clk:function(a,b,d){if(zmail.trialUsers&&"msi-add"===b)zmStreamsApp.GroupApp.addMember(c);else if("msi-add"===b||"addnewgroup"===d)zmGroupSubscription.showPage({onPreviewClose:zmStreamsApp.util.closePreview});else if("msi-gototop"===b)$(zmsuite.getCenter()[0].$el.find(".SCS_rgt")).animate({scrollTop:0},500);else if("msi-listview"===b||"msi-gridview"===b)e(b);else if("msi-close"===b)$.publish(zmStreamsApp.constants.removeNotificationPreview,{element:zmsuite.getCenter()[0].$el[0]}),zmsuite.closeWorkspace("zmStreamsApp");else if("msi-status"===b){$(zmsuite.getCenter()[0].$el.find(".SCS_rgt")).animate({scrollTop:0},500);var f=zmsuite.getCenter()[0].$el.find("#s_sbox textArea");f.click(),f.focus()}}};g&&h.list.right[1].actionArr.unshift(g);var i=c&&zmCont.getGroup(c)?zmCont.getGroup(c).name:b.common.labels.appName;if(zmail.trialUsers)if(c&&c!==zmail.zuid){var j=zmCont.getGroup(c),k=j.members.length,l=k+(1===k?" "+b.common.labels.person:" "+b.common.labels.members),m=j.eid?"<span id='geid' class='SC_lnk'>"+j.eid+"</span>":"";i="<div class='SCmb'><ul><li class='SCtxt'><b class='gdrop'><div class='SC_hd'></div><span>"+i+"<i class='msi-barrow'></i></span></b></li></ul></div>"+m+"<span id='viewmembers' class='SC_lnk'>"+l+"</span><span><i class='msi-chat' id='createChat'></i></span>"}else i="<div class='SCmb'><ul><li class='SCtxt'><b class='gdrop'><div class='SC_hd'></div><span>"+b.common.labels.home+"<i class='msi-barrow'></i></span></b></li></ul></div>";var n={list:{left:{leftHTML:i,centerAlign:!0}}};return f[0].push(h.list),f[0].setListener("click",h.clk),f[1].push(n.list),f[1].setListener("click",n.clk),f},a.currentListingView=function(){var a,b,d,e;return c.setElements(),a=c.elements.zm_stHdr,d=$(a).find(".SC_sel i").attr("class"),b={"msi-gridview":"grid","msi-listview":"list"},e=b[d]||"grid"},a.init=function(a,b,d){if(a&&(zmCont.isGroup(a)||zmail.zuid===a)||(a=zmail.zuid),b||zmail.trialUsers){var e="grid"===zmAdHocSettings.getStreamsListType();a=a?a:zmail.zuid;var f={view:"all",gridview:e,addTitleHeader:!0};zmail.trialUsers||zmHash.setHash("stream"),zmStreamsApp.PostApp.init("",a,f,!0,!0,!1,d)}else{"restore"!==d&&zmNCenter.icon.defaultStreamIcon();var g=c.workspaceId;zmail.trialUsers||(zmsuite.isWorkspaceAvailable(g)&&"restore"!==d?(zmsuite.showWorkSpace(g),a&&zmStreamsApp.GroupApp.init(zmStreamsApp.constants.elements.leftHolder,a)):(zmStreamsApp.constructWorkSpace(void 0,d),zmStreamsApp.GroupApp.init(zmStreamsApp.constants.elements.leftHolder,a)))}};var f=function(){$.subscribe(c.removeNotificationPreview,zmStreamsApp.util.removeViews),$.subscribe(c.closeDialog,zmStreamsApp.util.removeViews),$.subscribe(c.reconnect,zmStreamsApp.util.reconnectActions),$.subscribe(c.mailPreviewUnload,function(a,b){zmStreamsApp.util.detachAndRemove(b.prevElem)}),$.subscribe(c.taskCloseTab,function(a,b){zmStreamsApp.util.detachAndRemove(b.prevElem)}),zmail.trialUsers&&$.subscribe(c.appSwitch,zmStreamsApp.util.setStreamsAppSelection)};return f(),a}(window.zmStreamsApp||{}),zmStreamsApp.template=function(){"use strict";var a=zmText.get("streams"),b={},c=function(a,b){var c;return c=a.from>b.from?1:a.from===b.from?0:-1,"QUOTE"===b.type&&a.from>b.from&&(c=1),c},d=function(a,b,c,d,e){var f=zmCont.getOrgContacts(a.text)[a.text],g={},h="zms_mention",i=f.fn;i=!i&&b&&b.id===a.text?b.name:c.substring(a.from,a.to);var j=[];d&&d.length&&(j=_.pluck(d,"id")),h=zmCont.isGroup(a.text)||j.indexOf(a.text)!==-1?"cursorDefault":"zms_mention";var k="";return"string"==typeof b&&b.indexOf("#")!==-1?k=b.substring(0,b.indexOf("#")):"object"==typeof b&&(k=b.id),k&&h.indexOf("cursorDefault")===-1&&(zmCont.isGroup(k)||_.size(e)&&e.indexOf(a.text)!==-1)&&!zmCont.isGroupMember(a.text,k)&&(h+=" inviteeColor"),g=f.zid?{"data-zid":a.text}:{},g["class"]=h,["B",{attrs:g,child:[["text",String(i)]]}]},e=function(a,b,c,e,f){var g=[],h=a.type;if("MENTION"===h)g=d(a,c,b,e,f);else if("HASHTAG"===h){var i=b.substring(a.from,a.to),j=i.indexOf("#"),k=i.substring(0,j);g=["SPAN",{attrs:{"class":"zm_HTag"},child:[["text",k+"#"],["SPAN",{child:[["text",String(a.text.substring(1))]]}]]}]}else if("LINK"===h)g=["A",{attrs:{href:a.text,target:"_blank"},child:[["text",a.text]]}];else if("SMILEY"===h){var l=a.text;g=["EM",{attrs:{"class":l,style:"vertical-align:middle;",title:a.title||""}}]}else"BOLD"===h?g=["STRONG",{child:[["text",a.text]]}]:"ITALIC"===h?g=["I",{child:[["text",a.text]]}]:"STRIKE"===h&&(g=["STRIKE",{child:[["text",a.text]]}]);return g},f=function(a){var b=zmUtil.parseURLS(a,{httpOnly:!0}),c=[];if(b.length){var d=0,e=b.length;for(d=0;d<e;d++)c.push({from:b[d].startIndex,to:b[d].endIndex,text:b[d].url,type:"LINK"})}return c},g=function(a,c,d,e){var f,g,h=0,i=c.length,j=[];for(h=0;h<i;h++)f=c[h],"LINK"!==f.type&&"SMILEY"!==f.type&&j.push({from:f.from-d,to:f.to-d,type:f.type,text:f.text});var k={text:a,offset:j,group:e},l=b.setOffsetValues(k);return g=["SPAN",{attrs:{"class":"SC_quote"},child:[l]}]};return b={RenderAttachment:function(a){var b=a.attArr,c=zmAttach.build(b),d='<div class = "zmPAtt">'+c+"</div>";return d=$(d)[0],zmStreamsApp.events.attachmentEvent(a,d),d},setOffsetValues:function(a){var b=a.text,d=a.offset,h=a.span?"DIV":"SPAN",i=0,j=-1,k=[h,{attrs:{},child:[]}],l=f(b),m=zmSmiley.replaceText(b);if(a.listView?(k[1].attrs["class"]="sum",d=m):(d=l.length?d.concat(l):d,d=m.length?d.concat(m):d),d&&d.length){d.sort(c);var n,o,p,q=0,r=d.length;for(q=0;q<r;q++){if(n=d[q].from,0!==n&&(o=0===q?b.substring(0,n):b.substring(d[q-1].to,n),k[1].child.push(["text"," "+o+" "])),"QUOTE"===d[q].type){j=q,0!==q&&k[1].child.push(["BR"]),i=d[q].from,p=d.slice(q+1,d.length),k[1].child.push(g(d[q].text,p,i,a.group));break}0===i&&j===-1&&k[1].child.push(e(d[q],b,a.group,a.shGroup,a.inviteeList))}0===i&&q>0&&d[q-1].to<b.length&&(o=b.substring(d[q-1].to,b.length),k[1].child.push(["text"," "+o+" "]))}else j===-1&&k[1].child.push(["text",b]);return k},listMembers:function(a){a=_.isArray(a)?a:a.split(",");var b,c,d,e,f,g=[],h=a.length;for(f=0;f<h;f++)d=String(a[f]),c=zmCont.isGroup(d)?zmCont.getGroup(d):zmCont.getOrgContacts(d)[d],e=c.fn||c.name,e&&(b=["LI",{child:[["DIV",{child:[["text",e],["SPAN",{child:[["text",c.eid||""]]}]]}],["IMG",{attrs:{src:c.photo}}]]}],g.push(b));var i=["UL",{attrs:{"class":"SC_P2r",id:"zms_memView"},child:g}];return _zm.getDOM(i)},addAttachment:function(a){return _zm.getDOM(["DIV",{attrs:{"class":"zmCA zms_aAtt"},child:[["DIV",{attrs:{id:a,"class":"zmCAt"}}]]}])},invitee_input:function(){var b=["DIV",{attrs:{"class":"addInv"},child:[["INPUT",{attrs:{type:"text","class":"zm_sgst",placeholder:a.common.labels.addInvitee}}]]}];return _zm.getDOM(b)},popup:{oneLine:function(a){var b,c,d,e=[],f=a.length;for(c=0;c<f;c++)d=a[c].fn||a[c].name,b=d?["LI",{attrs:{"data-id":String(a[c].id)},child:[["DIV",{child:[["text",d]]}],["IMG",{attrs:{src:a[c].photo}}]]}]:["LI",{attrs:{"data-item":a[c].data},child:[["text",a[c].txt]]}],e.push(_zm.getDOM(b));return e},comment:function(a){var b,c=[];return b=["LI",{attrs:{style:"white-space:pre-wrap;max-height:200px;overflow:auto"},child:[["B",{child:[["text",a.name+": "]]}],["text",a.text]]}],c.push(_zm.getDOM(b)),c},invitee_popup:function(a,b,c,d){var e,f,g,h,i,j="",k="",l="",m=_zm.getDOM(["UL",{attrs:{"class":"invList"}}]);if(a&&void 0===a.input)for(var n=0;n<a.length;n++){var o=a[n];for(var p in o)if(e=c[p]){var q=_zm.getDOM(["LI"]);k=e.isGroupid?zmail.defaultGroupPhoto:e.photo||zmail.defaultPhoto,f=e.fn||e.name,_zm.preloadimg(k),h=zmCont.getOrgContacts(o[p])[o[p]];var r=h.zid===zmail.zuid;i=e.id||e.zid,g={name:f,attr:{"data-uid":i,"data-iid":h.zid},ph:k,ret:"dom",img:!0},r||d?(g.iclass="msi-close",g.cls="SC_cs myInv"):g.cls="SC_cs othrInv",l=zmConUtil.bubbleUtil(g),q.appendChild(l),r||(j=h.fn||h.name,q.appendChild(_zm.getDOM(["SPAN",{child:[["text",j]]}]))),m.appendChild(q)}}return m},trendingtags:function(b,c){var d,e,f=[];_.each(b,function(a){e=a.id||a.name,d=c?[["FONT",{attrs:{"class":"SClbl",style:"background-color:"+a.color}}],["text",a.dispName]]:[["text",a.name]],f.push(["SPAN",{attrs:{"data-text":e},child:d}])});var g=c?a.streams.tooltip.tag:zmText.applyArgs(a.common.labels.trendingtags,{tag:"#"}),h=["LI",{child:[["DIV",{child:[["STRONG",{child:[["text",g]]}],["DIV",{attrs:{"class":"SCS_tTags"},child:f}]]}]]}];return[_zm.getDOM(h)]}}}}(),window.zmStreamsApp=window.zmStreamsApp||{},zmStreamsApp.events=function(){"use strict";var a=function(a){var b,c=a.attArr,d=c.length,e=[],f=a.pid;f=f.indexOf("#")!==-1?f.substring(f.indexOf("#")+1,f.length):f;for(var g,h=a.actionType,i=a.groupId,j=a.elm,k="",l=0;l<d;l++)g=c[l],b={Id:g.id,e:f,et:a.type,fs:g.size,ft:g.ft,l:[],fn:g.name,p:g.part,thn:g.thn,tn:!0,type:h,u:g.u,gId:i},k&&(b.dn=k),e.push(b);var m;$(j).find(".zmImg").click(function(){m=$(this).parents(".zmL").data("detail"),zmUtil.initAttSlideShow(e,m)}),$(j).find(".zmAch").click(function(b){m=$(this).data("detail"),zmAttach.util.bindoptions(b,{attList:e,from:"streams",pid:f,type:a.type,index:m})})},b={mentionsInput:function(a){var b=a.elm,c=a.resize,d=a.mention||[],e=a.gid,f=a.keyCallback,g="org";if(d.length&&"org"!==d){var h=zmCont.getGroupOrder(),i=[],j=[];_.each(d,function(a){a=String(a),h.indexOf(a)!==-1?j.push(a):i.push(a)}),d=_.without(i,zmail.zuid),g=zmCont.getOrgContacts(d.join(","),"Array"),a.gid&&zmCont.isGroupMember(zmail.zuid,a.gid)&&h.push(a.gid),j.length&&_.each(j,function(a){var b=zmCont.getGroup(a),c={fn:b.name,nn:"",eid:b.eid,photo:b.photo,zid:a};g.push(c)})}var k={contentArray:g,compare:["fn","ln","nn","eid"],LType:"3",OType:"3"};e&&e!==zmail.zuid&&(k.groupId=e,k.addtolist=!0,$(b).data("gid",e)),a.addGroups&&(k.groupId=!0,k.addtolist=!0),f&&(k.keyCallback=f,k.keyParam=a.keyParam),"undefined"!=typeof zmStreamsApp.GroupApp&&(k.hashTag=!0,k.hashArray=zmStreamsApp.GroupApp.fetchHashTags),k.aliasPlusForAt=!0,k.resize=c||!1,a.isShareFolder&&(k={contentArray:[],LType:"2",OType:"3",compare:[]}),zmAutoFill.setAutofill(k,$(b))},attachmentEvent:function(b,c){b.elm=c,a(b)},getActionType:function(a){return a.isGroup?"viewGroupEntity":"viewSelfData"},getCurrentGroupId:function(){var a="zmStreamsApp"===zmTab.currentTab?zmStreamsApp.GroupApp.getCurrentGroup():zmail.mailLeft.selId;return a},getCurrentView:function(a){zmStreamsApp.constants.setElements(),a=a||zmStreamsApp.constants.elements.postHolder;var b=a.find("#stabHol").children(".stSel"),c=$(b).data("type"),d=a.find("#s_postview #s_"+c);return c="userPost"===c||"hashTag"===c||"label"===c?"other":c,{elm:d,view:c,tab:b}},publishKeyEvent:function(a){$.publish("zmstreamsapp/keyevent",{data:a})},getListHolders:function(a){var b,c,d=[];return"zmStreamTree"===zmail.mailLeft.selLayerId&&(a&&zmail.mailLeft.selId===a||!a)&&(c="zm_Container"),zmsuite.isWorkspaceAvailable("zmStreamsApp")&&(a&&zmStreamsApp.GroupApp.getCurrentGroup()===a||!a)&&(c="zmStreamsApp"),c&&(b=zmsuite.getWorkSpace(c)[0].$el.find("#s_postview")),b&&b.length&&d.push(b),d},openPost:function(a){var b=a.ntype;if("43"===b)return a.sharedMail=!0,void zmList.showNotificationPopup(a);if(a.commentuuid){var c=a.commentuuid;c instanceof Array&&(c=c[0]),a.commentId=c}zmStreamsApp.PostApp.singlePost(a)},setMaxHeight:function(a,b,c,d,e){var f=parseInt($(a).css("maxHeight")),g=$(a).find(".SC_ptit",a)[0],h=0;g&&(h=g.getBoundingClientRect().height);var i=["transition","-webkit-transition","-moz-transition"];i.forEach(function(a){c.style[a]="height ease 0.5s, max-height ease 0.5s"}),c.style.maxHeight=f-(b.getBoundingClientRect().height+50+h)+"px";var j=_zm("<","textArea",b)[0];if(e&&_zm.bind(j,"keyup",function(){var e=b.getBoundingClientRect().height,g=$(b).find(".zms_rep")[0],i=0,k=!1;g&&(i=g.getBoundingClientRect().height,k=$(g).data("setHeight"),$(g).data("setHeight",!1)),c.style.maxHeight=f-(e+10+h+i)+"px";var l=j.getBoundingClientRect().height,m=_zm(".","SC_PUbtm",b)[0].getBoundingClientRect().height+20;if(l+m>=e&&("auto"!==j.style.overflowY||k)&&(j.style.maxHeight=e-m-i-20+"px",j.style.overflowY="auto"),d){var n=b.getBoundingClientRect().height+20;$(a).find(".SC_Twpr").css("bottom",n+"px")}},[]),d){var k=b.getBoundingClientRect().height+20;$(a).find(".SC_Twpr").css("bottom",k+"px")}},createWorkSpace:function(a){var b=a.msgId||a.pid,c="Streams_"+b;if(zmsuite.isWorkspaceAvailable(c)&&"restore"!==a.src)return zmsuite.showWorkSpace(c),!1;var d=function(){var c=zmsuite.createAppRouter();return c._hashKey="stream",c.initialize({hashKey:"stream",handler:function(){return{updateParams:!1,handled:!1,daultAction:!1}}}),c.setParams(["tab",a.gid,b,a.etype,a.actionType]),c},e=d(),f={appname:"Streams single post",appId:c,appIcon:"msi-post",data:{CNodes:"3"},router:e,onDelete:function(){return $.publish(zmStreamsApp.constants.removeNotificationPreview,{element:zmsuite.getCenter(c)[0].$el[0]}),!0}},g=function(a,d){var e=d.id;b.indexOf("#")===-1&&(e=d.id.split("#")[1]),e===b&&zmsuite.isWorkspaceAvailable(c)&&zmsuite.closeWorkspace(c)};$.subscribe("zmstreamsapp/deletePost",g);var h={list:{left:[],right:[{actionArr:[{iconList:["msi-close"],tooltip:"Close"}]}]},clk:function(a,b){"msi-close"===b&&($.publish(zmStreamsApp.constants.removeNotificationPreview,{element:zmsuite.getCenter(c)[0].$el[0]}),zmsuite.closeWorkspace(c),$.unsubscribe("zmstreamsapp/deletePost",g))}};"restore"===a.src&&zmsuite.isWorkspaceAvailable(c)?zmsuite.resetWorkspace(c,f):zmsuite.setWorkSpace(f);var i=zmsuite.getCenter(),j=i[0].getNodes();j[0].push(h.list),j[0].setListener("click",h.clk),zmsuite.renderWorkSpace();var k=zmComponent.loadingBand({container:j[2].$el[0],type:"pagination"});zmsuite.showWorkSpace(c),a.elm=j[2].$el[0],a.allComments=!0,a.callback=function(b,c){if(!a.opentype){k();var d={list:{left:{leftHTML:c,centerAlign:!0}}};j[1].push(d.list),f.appname=c,zmTab.updateTabLst(f),zmsuite.renderCenter()}};var l={actionType:a.actionType,etype:a.etype,gid:a.gid,pid:a.pid};return $.publish("zmail/SaveTabState",[{appId:c,app:"stream",appObj:{appId:c,appname:"Streams single post",data:{},appIcon:"msi-post"},category:"stream_post",data:l}]),a},openPostInTab:function(a){var b=zmStreamsApp.PostApp.constants,c=a.msgId||a.pid;if(a.markRead=!0,a.isMail||a.etype===b.streamTypeName.mail){c.indexOf("t")!==-1&&(c=c.substring(1,c.length)),a.opentype=2;var d=zmail.mailObj[c];if(d&&d.groupId){a.gid=d.groupId,a.pid=c,a.etype=b.streamTypeName.mail,a.cachedData=!0;var e="zm_tab"+(d.T?"t":"")+c;if(zmsuite.isWorkspaceAvailable(e))return void zmsuite.showWorkSpace(e)}a.allComments=!0,a.isTab=!0,zmStreamsApp.events.openPost(a)}else if("group"===a.gid)zmStreamsApp.init(c);else if(a.etype===b.streamTypeName.task){var f={groupId:a.gid,entityId:c};zmtCom.openTask(f,f,zmTask.openTaskInTab)}else a=zmStreamsApp.events.createWorkSpace(a),a&&zmStreamsApp.events.openPost(a)},clearList:function(a){var b=zmStreamsApp.events.getCurrentView();if(b){var c=$(b.elm).data("groupId");c===a&&"unread"===b.view&&($(b.elm).data("postlist",[]),zmStreamsApp.util.detachAndRemove(b.elm[0]),$(b.elm).empty().append(zmStreamsApp.PostApp.template.noPost()))}},loadPostsOfUsers:function(a){var b=a.zid,c=a.gid,d=a.dialog;if("zmStreamsApp"===zmTab.currentTab){var e=zmStreamsApp.events.getCurrentView(),f=zmCont.getOrgContacts([b].join(","))[b];zmStreamsApp.util.closePreview(),zmail.zuid===String(b)&&zmStreamsApp.events.getCurrentGroupId()!==zmail.zuid?e.tab.siblings("li[data-type='byme']").trigger("click"):(zmStreamsApp.PostApp.showOtherTab(f.fn,"userPost",b,c),zmStreamsApp.PostApp.fetchPosts({
type:"other",ele:e.elm,previous:e.tab})),d.remove()}},groupAction:function(a){zmUtil.hideMenu();var b=a.action,c=a.gid;if(c&&b)switch(b){case"viewMembers":var d={gid:c,callback:zmStreamsApp.events.loadPostsOfUsers};zmStreamsApp.GroupApp.showMemberDialog(d);break;case"createChat":zmStreamsApp.GroupApp.createGroupChat(c);break;case"email":zmStreamsApp.GroupApp.emailGroup(c);break;case"markRead":zmStreamsApp.GroupApp.markAllRead(c)}}};return b}(),zmStreamsApp.linkPreview=function(a){"use strict";a=a||{};var b=zmText.get("streams"),c=function(a){var b={};return a=a||{},b.linktitle=a.title||"",b.linkdesc=a.description||"",b.linkurl=a.url||"",b.videourl=a.videoURL||"",a.thumbnailURL&&(b.imageurls=[a.thumbnailURL]),a.tags&&a.tags.length&&(b.linktags=a.tags),b},d=function(a){var b={};return b.url=a.linkUrl,b.title=a.title,b.description=a.desc,b.tags=a.tags,b.thumbnails=a.imageUrls,b.videoURL=a.videoUrl||"",b.title&&b.title.length>100&&(b.title=b.title.substr(0,97)+"..."),b.description&&b.description.length>200&&(b.description=b.description.substr(0,197)+"..."),b.tags&&b.tags.length>10&&(b.tags=b.tags.slice(0,10)),b.thumbnails&&b.thumbnails.lenth>20&&(b.thumbnails=b.thumbnails.slice(0,20)),b},e=function(a){return function(c){var d=zmStreamsApp.PostApp.models.posts.get(a)||{},e=("function"==typeof d.get?d.get("myact"):{})||{};if(e.showinvite){var f=zmStreamsApp.events.getCurrentView();zmStreamsApp.PostApp.showOtherTab("#"+c,"hashTag",c,d.getGroupInfo().id),zmStreamsApp.PostApp.fetchPosts({type:"other",ele:f.elm,previous:f.tab})}else _zm.succErrMsg("e",b.common.messages.noHashTagSearch)}},f=function(a,b,c){if(a.link&&a.link.linkUrl){var f={},g={},h=a.link;g=d(h),f.editMode=!1,f.data=g,f.playVideoInline=!0;var i=zmLinks.createComponent(f);g.tags&&g.tags.length&&i.setConfig("onHashTagClick",e(c,b,!1));var j=(_zm(".","SCS_postAct",b)||[])[0],k=(_zm(".","SCS_postWra",b)||[])[0];k.insertBefore(i.getDOM(),j)}},g=function(a,b,c){if(a.link&&a.link.linkUrl){var f={},g={},h=a.link;g=d(h),f.editMode=!1,f.data=g,f.playVideoInline=!0;var i=zmLinks.createComponent(f);g.tags&&g.tags.length&&i.setConfig("onHashTagClick",e(c,b,!0)),b.appendChild(i.getDOM())}},h=function(a,b){for(var c in a)b[c]=a[c];b.imageurls&&(b.imageurls=b.imageurls.join("\n")),b.tags&&(b.tags=b.tags.join("\n"))},i=function(a){var b=a.getData();b.title&&b.title.length>100&&(b.title=b.title.substr(0,97)+"..."),b.description&&b.description.length>200&&(b.description=b.description.substr(0,197)+"..."),b.tags&&b.tags.length>10&&(b.tags=b.tags.slice(0,10)),b.thumbnails&&b.thumbnails.lenth>20&&(b.thumbnails=b.thumbnails.slice(0,20)),a.setConfig("data",b)};return a.getLinkInfoFromComponentData=c,a.addLinkPreviewToPost=f,a.addLinkPreviewToComment=g,a.addDataToParams=h,a.getComponentDataFromLinkInfo=d,a.sanitizeComponent=i,a}(),window.zmLinks=function(a){"use strict";a=a||{};var b,c=zmText.get("streams","linkPreview"),d="click",e="mouseup",f="mousedown",g=function(a,b,c,d,e){b=b||"GET",c=c||{},zmAjq.XHR({u:a,t:b,p:c,fn:d,efn:e})},h=function(a,b,c,d){return g(a,"POST",b,c,d)},i=function(a){this.url=a,this.title="",this.description="",this.images=[],this.tags=[],this.hasData=!1,this.videoURL="",this.isZohoDocsURL=!1},j=function(a){var b,c=function(a){a&&a.st?b(!0,a):b(!1)},d=function(){b(!1)},e=function(){h(zmail.conPath+"/link.do",{link:a,mode:"link",actionType:"getLinkDetails"},c,d)};return{done:function(a){b=a,e()}}};i.prototype={loadData:function(){var a,b=this,c=function(){b.hasData?a(b):j(b.url).done(function(c,d){c&&d.st?(b.hasData=d.st,b.url=d.linkUrl||"",b.title=d.title||"",b.description=d.desc||"","string"==typeof d.imageUrls&&(d.imageUrls=[d.imageUrls]),b.images=d.imageUrls||[],b.tags=d.tags||[],b.videoURL=d.videoUrl||"",$(b).trigger("changed",b),a(b)):a()})};return{then:function(b){a="function"==typeof b?b:function(){},c()}}},subscribeChanges:function(a){var b=this;$(b).on("changed",a)},unsubscribeChanges:function(a){var b=this;$(b).off("changed",a)}};var k=['<div data-marker="tag" class="SC_cs zmfc">','<span data-marker="tagname" title=""></span>','<i data-marker="removetag" title="'+c.tooltips.removeTag+'" class="msi-close"></i>',"</div>"].join("\n"),l=['<div data-marker="preview" class="SC_linkpreview">','<div class="zmL SC_vpv SC_sq" data-marker="previewboxholder">','<div class="zmLst" data-marker="previewbox">','<div class="zmDtl">','<div data-marker="imageholder" class="zmImg">','<img src="" data-marker="thumbnail">','<i data-marker="playvideo" class="msi-play"></i>','<i data-marker="previmage" class="msi-larrow"></i>','<i data-marker="nextimage" class="msi-rarrow"></i>',"</div>",'<div class="zmFrm">','<span data-marker="title"></span>',"</div>",'<div class="zmSub">','<span class="" data-marker="description"></span>','<span class="sum" data-marker="domain"></span>',"</div>",'<div class="SC_icn">','<i data-marker="removepreview" class="msi-close"></i>',"</div>","</div>","</div>","</div>",'<div data-marker="taglist" class="SC_input">',"</div>","</div>"].join("\n"),m=function(a,b){var c,d,e,f=$("[data-marker]",a),g={};for(f=f||[],$(a).attr("data-marker")&&f.push($(a)[0]),c=0,d=f.length;c<d;c++)e=f[c],g[$(e).attr("data-marker")]=$(e),b&&$(e).removeAttr("data-marker");return g},n=function(a,b){return a=a||"",b=b||[],b.indexOf(a)},o=function(a){a=a||{},a.data=a.data||{};var b={},c=a.data,d=$(k),e=m(d,!0),f=function(){$(e.tag).off().on("click",function(c){"function"==typeof a.onTagClick&&a.onTagClick(b),_zm.stopEvents(c)}),"function"==typeof a.onRemoveTag&&$(e.removetag).off().on("click",function(c){a.onRemoveTag(b),_zm.stopEvents(c)})},g=function(){$(e.tagname).text(c.name||""),$(e.tagname).attr("title",c.name||""),a.editMode||$(e.removetag).remove()},h=function(){g(),f()};return b.setData=function(a,b){c[a]=b,h()},b.setConfig=function(b,c){a[b]=c,h()},b.getData=function(a){return a?c[a]:c},b.getDOM=function(){return d},h(),b},p=function(g){g=g||{},g.data=g.data||{},g.data.tags=g.data.tags||[],g.data.thumbnails=g.data.thumbnails||[];var h={},i=g.data,j={},k=0;i.thumbnails.length&&(i.thumbnailURL=i.thumbnails[k]);var p=$(l),q=m(p,!0),r=function(){if(i.videoURL&&!g.playerLoading){var b=a.getVideoIframe(i.videoURL);b&&($(q.previewboxholder).before(b).hide(),g.playerLoading=!0)}},s=function(){window.open(i.url)},t=function(){var a="",b="SC_sq SC_po SC_ls SC_sls SC_spo";if($(q.title).text(i.title||""),$(q.description).text(i.description||""),$(q.domain).text(zmUtil.getHostName(i.url)),i.thumbnails&&i.thumbnails.length?($(q.imageholder).css("display",""),a=i.thumbnails[k]||"",$(q.thumbnail).attr("src",a),a&&zmUtil.loadImage(a).then(function(c){if(c&&a===$(q.thumbnail).attr("src")){var d=c.width/c.height,e="SC_sq";d<=.8?e="SC_po":d>=2?e="SC_sls":d>=1.3&&(e="SC_ls"),q.previewboxholder.removeClass(b).addClass(e)}}),$(q.previewboxholder).removeClass("noimg")):($(q.imageholder).remove(),$(q.previewboxholder).addClass("noimg")),i.videoURL&&!g.editMode||$(q.playvideo).remove(),g.editMode?$(q.previewboxholder).addClass("SC_edit"):($(q.removepreview).remove(),$(q.previewboxholder).removeClass("SC_edit")),(!g.editMode||!i.thumbnails||i.thumbnails.length<2)&&($(q.previmage).remove(),$(q.nextimage).remove()),$(q.taglist).html(""),i.tags&&i.tags.length){$(q.taglist).show();for(var c in i.tags)j[c]&&$(q.taglist).append(j[c].getDOM())}else $(q.taglist).hide()},u=function(a){var b=o({editMode:g.editMode,data:{name:a},onRemoveTag:function(){h.removeTag(a)},onTagClick:function(a){if("function"==typeof g.onHashTagClick){var b=a.getData();g.onHashTagClick(b.name)}}});return b},v=function(){if(i.tags&&i.tags.length){j={};for(var a in i.tags)j[a]=u(i.tags[a])}},w=function(){v(),t(),b()},x=function(){var a=k;k=-1,w(),k=a},y=function(a){var b=i.thumbnails.length?i.thumbnails.length-1:0;a>=0&&a<=b?(k=a,i.thumbnailURL=i.thumbnails[k]):_zm.succErrMsg("e",c.messages.noMoreThumbnails),x(),w()},z=function(){y(k-1)},A=function(){y(k+1)};b=function(){var a,b;$(q.previewbox).off(f).on(f,function(){window.getSelection&&(a=window.getSelection()||"",a=a.toString())}),$(q.previewbox).off(e).on(e,function(){window.getSelection&&(b=window.getSelection()||"",b=b.toString())}),$(q.previewbox).off(d).on(d,function(c){a===b&&s(),_zm.stopEvents(c)}),$(q.previmage).off().on(d,function(a){z(),_zm.stopEvents(a)}),$(q.nextimage).off().on(d,function(a){A(),_zm.stopEvents(a)}),$(q.thumbnail).off().on(d,function(a){i.videoURL&&(g.playVideoInline===!0?r():"function"==typeof g.onPlayVideo&&g.onPlayVideo(),_zm.stopEvents(a))}),$(q.playvideo).off().on(d,function(a){i.videoURL&&(g.playVideoInline===!0?r():"function"==typeof g.onPlayVideo&&g.onPlayVideo(),_zm.stopEvents(a))}),"function"==typeof g.onRemovePreview&&$(q.removepreview).off().on(d,function(a){g.onRemovePreview(a.ctrlKey),_zm.stopEvents(a)})};var B=function(b){b instanceof a.LinkData&&(i.url=b.url||"",i.title=b.title||"",i.description=b.description||"",i.thumbnails=b.images,i.thumbnails&&i.thumbnails.length&&(i.thumbnailURL=i.thumbnails[0]),i.tags=b.tags,i.videoURL=b.videoURL||"")};return h.setConfig=function(a,b){g[a]=b,"data"===a&&(i=g.data,k=0,i.thumbnails.length&&(i.thumbnailURL=i.thumbnails[k])),w()},h.setData=function(a,b){i[a]=b,w()},h.setTags=function(a){a=a||[];for(var b in a)h.addTag(b,!0);w()},h.addTag=function(a,b){a=a||"",a&&n(a,i.tags)===-1&&(i.tags.push(a),b||w())},h.removeTag=function(a){a=a||"";var b=n(a,i.tags);a&&b!==-1&&(i.tags.splice(b,1),w())},h.getDOM=function(){return p[0]},h.getData=function(a){return a?i[a]:i},h.initFromLink=function(b){var c=new a.LinkData(b);c.loadData().then(function(){c.hasData&&(B(c),w())})},g.linkData instanceof a.LinkData&&B(g.linkData),w(),h},q=function(b,c){var d,e=function(){var e=new a.LinkData(b);e.loadData().then(function(){if(e.hasData){c.linkData=e;var b=a.createComponent(c);d(b)}else d()})};return{then:function(a){d=a,e()}}},r='<iframe src="" class="SC_ve" style="min-width: 400px; height: 300px; width: 100%;" frameborder="0" webkitallowfullscreen mozallowfullscreen allowfullscreen></iframe>',s={YOUTUBE:{urlPatterns:[/(?:https?:\/\/)?[^.\s]+\.youtube\.[^.\/]+\/[^\s]*watch\?[^\s]*v=([^\s&#\/]+)(?:&t=([^\s&#]+))*[^\s]*/g,/(?:https?:\/\/)?[^.\s]+\.youtube\.[^.\/]+\/v\/([^\s&#\/]+)(?:&t=([^\s&#]+))*[^\s]*/g,/(?:https?:\/\/)?youtu\.be\/([^\s&#\/]+)(?:&t=([^\s&#]+))*[^\s]*/g],iframeURL:"//www.youtube.com/embed/{{videoID}}{{extraParams}}",timeParseRegex:/(?:([0-9]*)h)*(?:([0-9]*)m)*(?:([0-9]*)s)*/gi},VIMEO:{urlPatterns:[/(?:https?:\/\/)?vimeo\.[^.\/]+\/([^\s&#\/]+)[^\s]*/g],iframeURL:"//player.vimeo.com/video/{{videoID}}"},DAILYMOTION:{urlPatterns:[/(?:https?:\/\/)?[^.\s]+\.dailymotion\.[^.\/]+\/video\/([^\s&#\/_]+)[^\s]*/g,/(?:https?:\/\/)?dai.ly\/([^\s&#\/_]+)[^\s]*/g],iframeURL:"//www.dailymotion.com/embed/video/{{videoID}}"}},t=function(a){var b,c,d,e,f,g,h,i,j,k,l,m,n,o=Object.keys(s);for(b=0,c=o.length;b<c;b++){for(d=s[o[b]],f=0,g=d.urlPatterns.length;f<g;f++)if(e=d.urlPatterns[f],e.lastIndex=0,j=void 0,null!==(j=e.exec(a))&&(e.lastIndex=0,j[1])){h=j[1],i=j[2]||"";break}if(h)return k=d.iframeURL.replace(/\{\{videoID\}\}/,h),i?(l=d.timeParseRegex,l.lastIndex=0,m=l.exec(i),m[1]=parseInt(m[1])||0,m[2]=parseInt(m[2])||0,m[3]=parseInt(m[3])||0,n=3600*m[1]+60*m[2]+m[3],k=k.replace(/\{\{extraParams\}\}/,"?start="+n)):k=k.replace(/\{\{extraParams\}\}/,""),k}},u=function(a){return Boolean(t(a))},v=function(a,b){var c=t(a);if(c+=(c.indexOf("?")!==-1?"&":"?")+"autoplay=true"){var d=$(r).attr("src",c)[0];return"function"==typeof b&&$(d).on("load",function(){b()}),d}},w="zmlinks_"+Math.round(1e3*Math.random())+"_",x=1,y=function(){return w+Date.now()+"_"+x++},z={},A={},B=function(b){var d,e,f,g={},h=!1,i={},j="",k=function(){},l=function(){},m=function(){},n=function(a,b){i[a]=!0,b&&zmsDialog.confirm(zmText.applyArgs(c.messages.confirmPreviewDisable,{url:a}),{onOk:function(){A[a]=!0}})},o=function(a){var b=Boolean(i[a]||A[a]);b=b||a.indexOf(".zoho.com")!==-1;var c="http";return b=b||a.indexOf(c+":")===-1&&a.indexOf("www")===-1},p=function(){i={}},q=function(a){k="function"==typeof a?function(){h||a.apply(this,arguments)}:function(){}},r=function(a){l="function"==typeof a?function(){h||a.apply(this,arguments)}:function(){}},s=function(a){m="function"==typeof a?function(){h||a.apply(this,arguments)}:function(){}},t=function(){var a=$("<div>").addClass("SC_lpload");zmComponent.loadingBand({type:"pagination",container:a[0]});var b=function(){e&&e.append(a)},c=function(){e&&a.remove()};return{show:b,hide:c}}(),u=function(){var a=d;d=void 0,a&&$(a.getDOM()).remove(),m(a)},v=function(b){d||o(b)||j===b||(j=b,k(b),a.createComponentFromLink(b,{editMode:!0,onRemovePreview:function(a){n(b,a),u()}}).then(function(a){t.hide(),j&&(j="",a?(u(),d=a,l(a)):n(b))}),t.show())},w=function(){var a,c=b.tagName;a="TEXTAREA"===c||"INPUT"===c?b.value:$(b).text();var d=zmUtil.parseURLS(a);if(d.length)for(var e in d){var f=d[e].url;if(!i[f]&&!A[f])return void v(f)}},x=function(){return d&&d.getData()},y=function(){f&&f.unbind()},B=function(){y(),f=zmUtil.bindInputTextChange({input:b,callback:w})},C=function(){return h=!0,j="",p(),u(),B(),h=!1,g},D=function(){return C()};return g.setLinkFoundCallback=function(a){return q(a),g},g.setComponentReadyCallback=function(a){return r(a),g},g.setPreviewRemovedCallback=function(a){return s(a),g},g.setProgressDisplayDOM=function(a){return e=a?$(a):void 0,g},g.reset=function(){return D()},g.getPreview=function(){return d},g.getPreviewData=function(){return x()},g.destroy=function(){D(),y(),z[b]=void 0,delete z[b]},C(),g};return a.PreviewManager=function(a){var b=$(a).attr("data-zmlinks");return b||(b=y(),$(a).attr("data-zmlinks",b)),z[b]||(z[b]=B(a)),z[b]},a.PreviewManager.destroy=function(){for(var a in z)z[a].destroy()},a.getVideoIframe=v,a.isURLEmbeddable=u,a.createComponentFromLink=q,a.createComponent=function(a){return p(a)},a.requestLinkData=j,a.LinkData=i,a}();