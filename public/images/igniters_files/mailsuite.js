"use strict";function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}!function(){var a,b,c,d,e,f,g,h={},i=!0,j=null,k={},l=function(a,b,c){return zmText.get("mailsuite",a,b,c)},m=function(){zmAppLoader.load("supportWidget").done(function(){var a=zmail.aInfo[zmUtil.getZohoAccId()];if(zmail.supportWidget)zmail.supportWidget.toggleSideBar();else{var b={type:"single",text:l("supportWidget"),menubar:{details:{ticket:{uploadObj:{desktop:{uploadAPI:"/zm/attach.do?mode=temp",uploadAPIParam:{entityType:1,type:"f",zmrcsr:zmAjq.getCookie("zmcsr"),accId:a.accId,tSize:0},autoLaunch:!0},onAttachmentRemove:function(b){var c={mode:"d",aId:a.accId,zmrcsr:zmAjq.getCookie("zmcsr"),sN:b.sN,fP:b.fP};zmAjq.XHR({u:zmail.conPath+"/attach.do",t:"POST",p:c})},iconClasses:{closeIcon:"msi-close",dragIcon:"msi-drag"},annotateObj:{iconClasses:{undoClass:"msi-undo",redoClass:"msi-redo",squareClass:"msi-box",circleClass:"msi-ellipse",maskClass:"msi-mask",lineClass:"msi-line",penClass:"msi-pen",cropClass:"msi-crop",textClass:"msi-text",colorClass:"msi-nclr"},afterInit:function(a){a.removeClass("ZC_annotatebox")}},slideshowObj:{iconClasses:{closeClass:"msi-close",prevClass:"msi-atprev",nextClass:"msi-atnext",moreClass:"msi-action",zoominClass:"msi-zoomin",zoomoutClass:"msi-zoomout",printClass:"msi-print",addToCloudClass:"msi-addcloud",downloadClass:"msi-download"},afterInit:function(a){a.removeClass("ZC_lightbox")}},imagePath:zmail.imgPath},supportId:"zm-feedback@zohocorp.com",postURL:zmail.conPath+"/sendfeedback.do",type:"POST",params:{zmrcsr:zmAjq.getCookie("zmcsr"),accId:a.accId,zemailId:a.disName+"<"+a.mailId+">"},headerTitle:l("helpcenter")}},hideTab:!0},faqDefaultParam:{departmentId:"4000000097799"},faqDomain:zmail.urls.supportURL};(zmail.isFuji||zmail.isBaihui)&&(b.type="ticket",b.menubar.details.ticket.headerTitle=l("contactus"),zmail.isFuji&&(b.menubar.details.ticket.supportId="skydesk-support@fujixerox.co.jp")),zmail.supportWidget=ZMate.init(b),zmUtil.updateFaqKey(zmUtil.getfaqDetails("searchKey")),zmail.supportWidget.toggleSideBar()}})},n=function(a){var b=$(document.head).find("link[href*=theme]"),c=!1;if(b.each(function(b,d){d=$(d);var e=d.attr("href").split("/"),f=e[e.length-1];f===a+"-min.css"?c=!0:d.remove()}),!c){var d=document.createElement("link");d.setAttribute("rel","stylesheet"),d.setAttribute("href",zmail.cssPath+a+"-min.css");var e=$(document.head).find("link[href*=nightmode]");e.length?$(d).insertBefore(e):document.head.appendChild(d)}},o=function(){var a=zmail.adhocUserSettings||{};if("string"==typeof a)try{a=$.parseJSON(zmail.adhocUserSettings)}catch(b){}a=a||{},n(a.theme||"theme1"),zmAdHocSettings.subscribeThemeChange(function(){n(zmAdHocSettings.getTheme())})},p=function(a){var b=a.id||k[a.name];$("body").removeClass("font"+f).addClass("font"+b),f=b},q=function(){zmAdHocSettings.getFontValidValues().forEach(function(a,b){b+=1,k[b]=a,k[a]=b}),zmAdHocSettings.getFont()in k||zmAdHocSettings.setFont(zmAdHocSettings.getFontDefault()),p({name:zmAdHocSettings.getFont()}),zmAdHocSettings.subscribeFontChange(function(){p({name:zmAdHocSettings.getFont()})})},r=["height: 100%","display: table","vertical-align: middle","margin-left: 5px"].join("; "),s=["display: table-cell","vertical-align: middle","padding: 0px 10px 0px 10px","border-left: solid 1px rgb(221,221,221)"].join("; "),t=["cursor: pointer","display: block","padding: 0","font-size: 13px","margin-top: 2px"].join("; "),u=["color: #D50000","font-weight: bold"].join("; "),v=function(){var a=zmail.bizLinks||[];delete zmail.bizLinks;var b={top:[],inner:[]},c=1,d=function(a){return"/"!==a.charAt(0)&&a.indexOf("http")===-1?["http","://",a].join(""):a},e=function(a){var b=['<li class="ztb-extraitem zm_biztoplink" style="'+s+'">',"<a ",'href="'+d(a.link)+'" ','target="_blank" ','style="'+t+"; "+u+'" ','title="'+a.label+'">',a.label,"</a>","</li>"].join("");return b},f=function(a){var b={},d="zm_bizlink_"+c++;return b.menuConfig={id:d,label:a.label,action:function(){a.link&&window.open(a.link)}},b};return a.forEach(function(a){"top"===a.type?b.top.push(e(a)):"inner"===a.type&&b.inner.push(f(a))}),b},w=function(){o(),zmAdHocSettings.subscribe("settingsloaded",q)},x=function(a,b,c){zmsuite.isMaxLimitReached()||zmAppLoader.load("streamsApp").done(function(){zmCont.isGroupLoaded(zmStreamsApp.init,[a,b,c])}).fail(function(){zmUtil.debugLog("Streams module not loaded")})},y=function(){zmail.accId===zmUtil.getZohoAccId()?zmsuite.isMaxLimitReached()||zmAppLoader.load("attachmentView").done(function(){zmCont.isGroupLoaded(zmsAtt.attView)}):zmUtil.succErrMsg("e",l("attViewNotSupported"))},z=function(){var a=[],b=2,c=0,d=function(){c=0;for(var d=0;d<b;d++)a[d]=!1};return function(){var b,e;b=$("#ztb-search-field"),e=$("#ztb-search"),$.when(zmail.postJsDeffered).then(function(){var a;a={contentArray:"",compare:["fn","ln","nn","eid"],LType:"1",OType:"1",selection:"onDemand",supressBlur:!0,callback:function(a){var c;a?(c=a.eid,b.val(c)):c=b.val(),zmSearch.contextualSearch(c)}},zmSearch.currentAutoFillId=zmAutoFill.setAutofill(a,b)}),b.keypress(function(b){var e;e=$.trim(this.value);var f=b.keyCode||b.charCode;if(e||d(),a[0]){if(!a[1]&&c&&e.substring(c).length>3)return a[1]=!0,void zmSearch.sendWarmUpRequest(e)}else e.length>3&&(a[0]=!0,zmSearch.sendWarmUpRequest(e));switch(f){case 32:case 44:case 45:case 46:case 47:case 95:a[0]?a[1]||(c?(zmSearch.sendWarmUpRequest(e),a[1]=!0):c=e.length+1):(zmSearch.sendWarmUpRequest(e),c=e.length+1,a[0]=!0)}}),b.blur(function(){d(),$.trim(this.value)||e.removeClass("SC_srcmore")}),b.focus(function(){e.addClass("SC_srcmore")}),$("#ztb-search-filter").click(function(a){zmSearch.showSearchDrop(a)})}}(),A=function(){var a=['<form action="/biz/index.do" method="post" target="_self">','<input type="hidden" name="setDefaultContext" value="true"/>',"</form>"],b=$(a.join(""));$(document.body).append(b),b[0].submit()},B=function(){var a,b;b=["DIV",{attrs:{"class":"SC_top"},child:[["DIV",{attrs:{"class":"ztb-topband"}}]]}],a=_zm.getDOM(b),$(document.body).append(a);var c=v(),d=zmail.isInternalOrgUser||"zm_only"===zmail.lastUsedUI||zmail.isCustomDomain,e=zmail.urls.zohoWebsiteLink+"new/help/",f="en";zmail.isFuji&&("ja"===zmail.user.lang&&(f=zmail.user.lang),e="//www.skydesk.jp/"+f+"/apps/mail/new/help"),zmail.urls.helpURL=e;var g=[];g=g.concat(c.top);var h=['<ul id="ztb-extraitems" class="ztb-extraitems" style="'+r+'">',g.join(""),"</ul>"].join(""),i=[{type:"general",action:function(){zmail._newSettings?zmail.Settings.MailSuite.App.openApp():zmAppLoader.load("settings").then(function(){zmailSettings.init()})}}];c.inner.forEach(function(a){i.push(a.menuConfig)}),d||i.push({id:"zm_settings",label:l("olderVersion"),action:A});var j={};1===i.length&&"general"===i[0].type?(j.uitype="button",j.action=i[0].action):(j.uitype="menu",j.menu=i);var k,n={},o=zmail.Utils.FeatureUtil;o.isHidden("FeedbackForm")||(n.feedback=m),k=!zmail.isCustomDomain&&zmail.hideZohoApps!==!0;var p=!1,q={};!zmail.isInternalOrgUser&&k&&zmail.showNewRefProg&&zmail.zoid!==-1&&(p=!0),k&&(n.helpLinks={tour:function(){zmUtil.loadMailTour("allApp")},helpLink:zmail.urls.helpURL},n.otherInfo=[],o.isHidden("SiteTour")||n.otherInfo.push({id:"sitetour",label:l("featureTour"),action:function(){zmAppLoader.load("settings").then(function(){zmailSettings.init("mail","zmailSettings.SiteTour")})}}),n.forumLink=zmail.urls.forumURL,n.blogLink=zmail.urls.blogURL),q.zohoAppsMenu=k,q.displayUserID=k,q.websiteAccess=k,q.blogAccess=k,q.forumAccess=k&&!o.isHidden("ForumAccess"),q.myAccountAccess=k,q.hasUserReferrals=p,q.logo=zmail.logoSrc;var s=[{uitype:"button",iconClass:"msi-attachment",title:l("attachViewer"),action:function(){y()}}];zmail.trialUsers||s.unshift({uitype:"button",iconClass:"msi-streams",title:l("streams"),action:function(){x()}});var t=zmText.get("mailsuite","global.companyName"),u=ztopbar.i18nKeys;if(Object.keys(u).forEach(function(a){var b=u[a];b=b.replace(/zoho/gim,t),u[a]=b}),ztopbar({product:"MAIL",rebranding:q,homePageLink:zmail.conPath+"/#mail",helpMenu:n,search:{hasFilter:!0,placeholder:l("searchMail")},settings:j,others:s,subscription:{},serviceInfo:h,notifications:{},userInfo:{userId:zmail.zuid,name:zmail.IAMFullName,emailAddress:zmail.user.loginName,photo:"//"+zmail.urls.contactsURL+"/file?fs=thumb&nocache="+Date.now(),signOutURL:function(){document.location.href=zmail.logoutURL},appsInUse:zmail.conPath+"/home/api/allapps"},myAccountLink:zmail.urls.accURL,websiteHomePageLink:zmail.urls.zohoWebsiteLink}),ztopbar.i18nKeys["fcomponents.ztopbar.support"]=zmText.get("mailsuite","deskDispName"),$("#ztb-switch-menu").attr({ztooltip:ztopbar.i18nKeys["fcomponents.ztopbar.zohoApps"]}),$(".ztb-icons.msi-attachment").removeClass("ztb-icons").addClass("ztb-icons"),$(".ztb-icons.msi-streams").removeClass("ztb-icons").addClass("ztb-icons"),$("#ztb-managePortals").remove(),$("#ztb-portalsep1").remove(),c.inner.length){var w="ztb-seperator",B="#"+c.inner[0].menuConfig.id,C="#"+c.inner[c.inner.length-1].menuConfig.id,D='<li class="'+w+'"></li>';$(B).prev("li").not("."+w).length&&$(B).before($(D).attr("id","zm_bizlinks_begin")),$(C).next("li").not("."+w).length&&$(C).after($(D).attr("id","zm_bizlinks_end"))}$("#ztb-extraitems > li").last().css("padding-right","0"),z()},C=function(a){var b=a.handler;a.searchPlaceHolder&&!zmail.fromOtherService&&ztopbar.search.placeholder(a.searchPlaceHolder),$(c).find(".msi-barrow").off("click").click(function(){zmDrop.show("zm_createLst",$(c).find(".zm_comp"))}),b&&b.create&&$(c).find("span").eq(0).off("click").click(_.debounce(b.create,250,!0))},D=function(a){return!!h[a]},E=function(a){a||(a=$(".zm_togglerpane")),$("body").toggleClass("SC_nrp"),a.toggleClass("msi-collapse"),$("body").hasClass("SC_nrp")?_zm.setCookie("ZM-rpane","1"):_zm.setCookie("ZM-rpane","0"),D("zm_notes")&&znNote.hideRgt()},F=function(){var a;return a=["DIV",{attrs:{"class":"zm_compose"},child:[["DIV",{attrs:{"class":"zm_comp"},child:[["SPAN",{child:[["text",l("compose")]]}],["SPAN",{child:[["I",{attrs:{"class":"msi-barrow"}}]]}]]}]]}],c=_zm.getDOM(a)},G=function(){var a,b,c=Object.keys(zmail.aInfo);for(var d in zmail.aInfo)if("1"===zmail.aInfo[d].accountType){zmail.defAccId=d;break}c.splice(c.indexOf(zmail.defAccId),1);var e=zmail.adhocUserSettings.accountsLhsOrder||zmAdHocSettings.getAccountsLhsOrder();return"-no_acc-"!==e&&(b=e.split(","),c&&c.length&&(c=_.sortBy(c,function(c){return a=b.indexOf(c),a>-1?a:100}))),c.length&&(a=c.indexOf(zmail.accId))>0&&(c.splice(a,1),c.unshift(zmail.accId),zmAdHocSettings.setAccountsLhsOrder(_.first(c,3).join(","))),$.subscribe("/acc/unreadCountChange",function(a,b){if(b.mode&&b.accId&&zmail.aInfo[b.accId]){var c=parseInt(zmail.aInfo[b.accId].c);switch(b.mode){case"inc":zmail.aInfo[b.accId].c=[c+1].join("");break;case"dec":c>1&&(zmail.aInfo[b.accId].c=[c-1].join(""));break;case"update":c="undefined"!=typeof b.count?b.count:0,zmail.aInfo[b.accId].c=[c].join("");break;case"bulkInc":var d=parseInt([b.count].join(""));zmail.aInfo[b.accId].c=[c+d].join("");break;case"bulkDec":var e=c-parseInt([b.count].join(""));e<-1||0===e?zmail.aInfo[b.accId].c="0":zmail.aInfo[b.accId].c=[e].join("")}zmail.appList.accListObj[b.accId]&&zmail.appList.accListObj[b.accId].updateCount(zmail.aInfo[b.accId].c,b.mode)}}),c},H=function(){var a,b;return a=[{icon:"msi-mail",id:"mail",tooltip:l("tooltips.mail"),clk:function(){zmail.accId!==zmail.defAccId?(zmUtil.switchAccount(zmail.defAccId),$.publish("/mail/accountSwitch",{status:"started",accountID:zmail.defAccId})):zmApp.showApp("m")}},{icon:"msi-calendar",id:"cal",tooltip:l("tooltips.calendar"),clk:function(){zmApp.showApp("c")}},{icon:"msi-task",id:"task",tooltip:l("tooltips.tasks"),clk:function(){zmApp.showApp("t")}},{icon:"msi-notes",id:"notes",tooltip:l("tooltips.notes"),clk:function(){zmApp.showApp("n")}},{icon:"msi-contacts",id:"contacts",tooltip:l("tooltips.contacts"),clk:function(){zmApp.showApp("cn")}},{icon:"msi-links",id:"links",tooltip:l("tooltips.links"),clk:function(){zmApp.showApp("l")}}],b=G(),zmail.isInternalOrgUser&&$("body").addClass("tempAppBar"),zmail.appList=new zmAppList(a,b),zmail.appList.constructDOM(),zmail.appList.constructAccountsDOM(),zmail.accId===zmail.defAccId?zmail.appList.appObj.mail.selectApp():zmail.appList.accListObj[zmail.accId]&&zmail.appList.accListObj[zmail.accId].selectAccount(),zmail.appList.getDOM()},I=function(){var a,b;return a=["DIV",{attrs:{id:"zm_mailLeft","class":"SCl SC_show"}}],b=_zm.getDOM(a)},J=function(){var a,b,c=[],d=$("<ul>"),e=zmText.get("mailsuite","viewModes");if(!zmail.fromOtherService){zmail.isInternalOrgUser&&c.push({tooltip:e.nightMode,className:"msi-nightMode",data:"nightMode"});var f=!1;f=zmail.Utils.FeatureUtil.isHidden("FeedbackForm"),f||c.push({tooltip:l("tooltips.feedback"),className:"msi-feedback",data:"feedback"})}return c.forEach(function(c){a=$("<li>"),b=$("<i>"),c.tooltip&&b.attr("title",c.tooltip),c.className&&b.attr("class",c.className),c.data&&b.data("icon",c.data),a.append(b),d.append(a)}),d.on("click","i",function(a){var b=a.target||a.srcElement,c=$(b).data("icon");switch(c){case"referral":window.open("/cpanel/referral.do","_blank");break;case"feedback":zmsuite.loadFeedback();break;case"nightMode":zmAppLoader.loadFiles("css","nightmode.css").done(function(){var a=document.body;$(a).hasClass("zmNightMode")?($(a).removeClass("zmNightMode"),$(a).addClass("zmDefaultMode"),$(b).attr("class","msi-nightMode"),$(b).attr("title",e.nightMode)):($(a).removeClass("zmDefaultMode"),$(a).addClass("zmNightMode"),$(b).attr("class","msi-dayMode"),$(b).attr("title",e.dayMode))})}}),d},K=function(){var a,b;return a=["DIV",{attrs:{"class":"zm_tabs"},child:[["DIV",{attrs:{"class":"SC_exp",id:"exp"}}],["DIV",{attrs:{"class":"SC_tab"},child:[["UL",{child:[["LI",{}]]}]]}]]}],b=_zm.getDOM(a),$(b).find(".SC_exp").append(J()),$(b).find(".zm_togglerpane").click(function(){E()}),b},L=function(a){var b,c=["DIV",{attrs:{"class":"SCr_parent"}}],d=_zm.getDOM(c),e="1";return"1"===e&&(b=$(a).find(".zm_togglerpane"),E(b)),d},M=function(){return $("<div id='zm_centerHolder' class='SCm_parent'></div>")},N=function(){var a,b,c=document.body;a=$("<div></div>"),b=K(),g=b,zmail.fromOtherService||B(),w(),a.append(F()),a.append(I()),zmail.fromOtherService||a.append(H()),a.append(M()),a.append(b),a.append(L(b)),$(c).append(a),zmail.fromOtherService&&$(c).addClass("SC_ntb SC_ncb SC_nlab")},O=function(c){var d,e,f;d=c.appId,h[d]={},h[d].obj=c,C(c),e=c.data.CNodes||"3",h[d].left=new zmLeft(c),h[d].centerObj=new zmCenterWrapper(e,c),h[d].rightObj=new zmRight,b=a&&a.obj.appId,a=h[c.appId],i=!1,c.shortcuts&&zmComponent.keybindings.registerAll({scope:c.appId,shortcuts:c.shortcuts,allowDefaultScope:void 0===c.allowDefaultShortcutScope||c.allowDefaultShortcutScope}),zmComponent.keybindings.setScope(d),c.titleProvider&&zmWinTitle.registerTitleProvider(c.appId,c.titleProvider),h[d].router=c.router,f=h[d].router,f instanceof zmail.Suite.RouteHelper||(h[d].router=void 0),c.hashKey&&"function"==typeof c.hashChangeHandler&&(f=zmail.Suite.RouteHelper.create(),h[d].router=f,f.initialize({hashKey:c.hashKey,handler:c.hashChangeHandler})),c.faqKey&&(h[d].faqKey=c.faqKey),c.appBodyClassName&&(h[d].appBodyClassName=c.appBodyClassName),$.publish("mailsuite/appCreated",d)},P=function(a){var b,c,d;b=a.appId,h[b]={},h[b].obj=a,c=a.data.CNodes||"3",h[b].left=new zmLeft(a),h[b].centerObj=new zmCenterWrapper(c,a),h[b].rightObj=new zmRight,i=!1,a.shortcuts&&zmComponent.keybindings.registerAll({scope:a.appId,shortcuts:a.shortcuts,allowDefaultScope:void 0===a.allowDefaultShortcutScope||a.allowDefaultShortcutScope}),a.titleProvider&&zmWinTitle.registerTitleProvider(a.appId,a.titleProvider),h[b].router=a.router,d=h[b].router,d instanceof zmail.Suite.RouteHelper||(h[b].router=void 0),a.hashKey&&"function"==typeof a.hashChangeHandler&&(d=zmail.Suite.RouteHelper.create(),h[b].router=d,d.initialize({hashKey:a.hashKey,handler:a.hashChangeHandler})),a.faqKey&&(h[b].faqKey=a.faqKey),a.appBodyClassName&&(h[b].appBodyClassName=a.appBodyClassName),$.publish("mailsuite/appCreated",b)},Q=function(a){e=a.appId,O(a),zmTab.setTabForApp(a),a.stateData&&(zmState.appInfo.addNew(a.appId,a.stateData.data,!0),zmState.sendRequestToSaveState())},R=function(a){return a?h[a]:h},S=function(a){var b=h[a];return delete h[a],b},T=function(a){return"object"==typeof a&&!zmTab.isMaxLimitReached()&&!D(a.appId)&&(O(a),zmTab.addTabLst(a),!0)},U=function(a){return"object"==typeof a&&!zmTab.isMaxLimitReached()&&!D(a.appId)&&(P(a),zmTab.addTabLst(a),!0)},V=function(a){zmComponent.keybindings.dropScope(a),zmCenterListing.mailObjectAPI.dropViewObjectStore(a),h[a].centerObj.$el.remove(),S(a)},W=function(a,b){V(a),O(b),zmTab.updateTabLst(b,{appId:a})},X=function(a){var b;if(b=zmTab.remTabLst(a)){zmComponent.keybindings.dropScope(a),zmCenterListing.mailObjectAPI.dropViewObjectStore(a);var c=S(a);$.publish("mailsuite/appClosed",{appID:a,app:c})}return b},Y=function(b){a=R(b),zmTab.showTab(b),C(a.obj),h[b].left&&h[b].left.updateRowSelection(),zmComponent.keybindings.setScope(b),$.publish("mailsuite/appOpened",b)},Z=function(c){i&&(b=a.obj.appId),a=R(c);try{a.obj.appId!==b&&(C(a.obj),h[c].left&&h[c].left.render())}catch(d){}a.obj.appClass&&a.centerObj.$el.addClass(a.obj.appClass),i=!0,zmTab.showTab(c),zmComponent.keybindings.setScope(c),$.publish("mailsuite/appOpened",c)},aa=function(a){e=a,Z(a)},ba=function(a){a.paint(),zmsTemplates.appendToCenter(a.$el)},ca=function(b){b?ba(b):a.centerObj.paint()},da=function(a){a.paint(),zmsTemplates.appendToRight(a.$el)},ea=function(b){b?da(b):a.rightObj.paint()},fa=function(){return $("#ms_topband")[0]},ga=function(b){return b?h[b].centerObj.centerArr:a.centerObj.centerArr},ha=function(b){return b?h[b].centerObj:a.centerObj},ia=function(b){return b?h[b].rightObj:a.rightObj},ja=function(b){return b?h[b].left:a.left},ka=function(a){return T(a)},la=function(a){return h[a].centerObj.centerArr},ma=function(a,b){var c;c=new zmContextMenu,c.setMenuObj(b),c.paint(a)},na=function(a){var b;return b=new zmDropDownMenu,b.setDropObj(a),b.paint(),zmail.debug&&(window._lastDropMenu=b),b},oa=function(a){a=a||{};var b=a.app;b&&b.router&&b.router.activate()},pa=function(a,b){b=b||{};var c=b.app;c&&c.router&&c.router.deactivate()},qa=function(a){var b=R(a);b&&(b.router?(b.router.activate(),b.router.update()):zmHash.clearHash(),b.faqKey&&zmUtil.updateFaqKey(b.faqKey),b.appBodyClassName&&(j&&$(document.body).removeClass(j),$(document.body).addClass(b.appBodyClassName),j=b.appBodyClassName),$(b).triggerHandler("tabFocused"))},ra=function(a){var b=R(a);b&&(b.router&&b.router.deactivate(),$(b).triggerHandler("tabBlurred"))},sa=function(a,b,c){ra(c),qa(b)},ta=function(){qa(zmTab.currentTab)},ua=function(a,b){var c,d="",e="",f=function(a){var c=this;zmUtil.debugLog("External app hash url changed",a,d,b,c)};"zm_Contacts"===b?(d="contacts",e="contacts"):"zcal_Container"===b&&(e="calendar"),d&&(c=zmail.Suite.RouteHelper.create(),zmsuite.setAppRouter(b,c),c.initialize({hashKey:d,handler:f})),e&&(zmsuite.setFaqKey(b,e),zmUtil.updateFaqKey(e))},va=function(){$("#zm_centerHolder").scrollTop(0).scrollLeft(0)},wa=function(){zmCont.initGroups(),zmail.trialUsers=zmail.trialUsers||zmCont.isGroupMember(zmail.zuid,"36902612"),N(),$.subscribe("mailsuite/appOpened",oa),$.subscribe("mailsuite/appClosed",pa),$.subscribe("/apps/tabSwitched",sa),$.subscribe("zm/framework/dialogClosed",ta),$.subscribe("mailsuite/appCreated",ua),$.subscribe("mailsuite/center/fixScroll",va)},xa=function(a){var b="";b+="<div class='SC_dg'>",a.count&&(b+="<span>"+a.count+"</span>"),b+="<font>"+a.text+"</font></div>",d=$(b),$(document.body).append(d)},ya=function(a,b,c){var e,f;e=a.pageX,f=a.pageY,d||xa(c),d.css({left:e+20+"px",top:f+20+"px"})},za=function(){d&&(d.remove(),d=null)},Aa=function(){return zmTab.isMaxLimitReached()},Ba=function(){return e},Ca=function(){return R(Ba()).left};window.zmsuite={setAppInfo:Q,showApp:aa,showExistingApp:Y,setWorkSpace:ka,createWorkspace:U,showWorkSpace:Z,isWorkspaceAvailable:D,closeWorkspace:X,getAppObj:R,getTopNodes:fa,getLeft:ja,getCenter:ga,getCenterOuter:ha,getRight:ia,renderCenter:ca,renderRight:ea,renderWorkSpace:ca,getWorkSpace:la,isMaxLimitReached:Aa,deleteAppInfo:S,getCurrentAppObjId:Ba,setFaqKey:function(a,b){var c=R(a);c&&(c.faqKey=b)},getAppLeft:Ca,getTabDOM:function(){return $(g)},getAppRouter:function(a){var b=R(a);return b?b.router||null:null},setAppRouter:function(a,b,c){if(c=c||{},null===zmsuite.getAppRouter(a)||c.replace===!0){var d=R(a);d&&(d.router=b)}},createAppRouter:function(a){var b=zmail.Suite.RouteHelper.create();return a&&zmsuite.setAppRouter(a,b),b},addLoadingBand:function(a,b,c){var d,e,f,g,h;if(c=c||"listing",D(a)){if(d=R(a),h=d.centerObj,f=h.node,"header"===b){if("2"===f)return!1;g=1}else"action"===b?g=0:"list"===b&&("2"===f&&(g=1),g=2);if(e=h.centerArr[0].getNodes()[g].$el,e.length)return zmComponent.loadingBand({container:e[0],type:c,notToSetInnerHTML:!0,addAtFirst:!0})}},showContextMenu:ma,showMenu:na,showDragHandler:ya,removeDragHandler:za,loadStreams:x,loadAttachView:y,loadFeedback:m,resetWorkspace:W,init:wa}}(),window.zmCenterWrapper=function(){var a=function(a){this.listData=a&&a.listData,this.listType=a&&a.listType,this.$el=$("<div class='SC_mclst'></div>"),this.prevObj=a&&a.prevObj,this.data=a&&a.data,this.layerCount=a&&a.count,this.dragEventObj=void 0,this.handlerElem=void 0,this.dragHelper=void 0};a.prototype={getDOMNode:function(){return this.$el},setListData:function(a){this.listData=a},setListType:function(a){this.listType=a},setListElem:function(a){this.$el=a},getListElem:function(){return this.$el},setPrevObj:function(a){this.prevObj=a},setListener:function(a,b){this.$el.off(a).on(a,b)},setData:function(a){this.data=a},selectRow:function(a){this.unselectRow(),$("#"+a).addClass("zmSLst")},unselectRow:function(a){a?$("#"+a).removeClass(a):this.$el.find(".zmL").removeClass("zmSLst")},onMouseMove:function(a,b){var c,d;return c=a.target||a.srcElement,c=$(c),d=c.closest(b.allowedParents),d.length?void zmsuite.showDragHandler(a,!0,b.helperText):void zmsuite.showDragHandler(a,!1,b.helperText)},setDragDrop:function(a){var b=this;this.dragEventObj=a,this.$el.mousedown(function(c){var d,e,f,g,h,i=!1,j=!0;3!==c.which&&(f=c.pageY,e=c.target||c.srcElement,e=$(e).closest(".zmL"),e.length&&(a.allowDrag&&!a.allowDrag(d)||(e.hasClass("SC_check")&&(e=b.$el.find(".zmL.SC_check")),a.fromData=e,$(document).on("mousemove.ZMCenter",function(b){var c,d,e;i=!0,c=b.target||b.srcElement,c=$(c),d=c.parents(".SC_lbx"),e=zmsuite.getLeft().getNodes()[0],e||(e=zmsuite.getAppObj(zmsuite.getCurrentAppObjId()).left.getNodes()[0]),j&&(a.helperText=a.dragStart(b,a.fromData)),j=!1,d.length?(h=e.getLayer(d[0].id),g=h.onMouseMove(b,a,f)):(zmsuite.showDragHandler(b,!1,a.helperText),e.removeDragHelperFromLayers()),f=b.pageY}),b.$el.on("mouseleave.ZMCenter",function(){zmsuite.showDragHandler(c,!1,a.helperText)}),$(document).on("mouseup.ZMCenter",function(c){var d,e,f,j,k,l=[];if(d=c.target||c.srcElement,d=$(d),e=d.parents(".SC_lbx"),$(document).off("mousemove.ZMCenter"),$(document).off("mouseup.ZMCenter"),b.$el.off("mouseleave.ZMCenter"),zmsuite.removeDragHandler(),i&&e.length){if(h.removeDragHelper(),h.showHoverOnRow(),d=c.target||c.srcElement,d=$(d),l=d.parents(a.allowedParents),!l.length)return;g&&g.toDrop&&(d=g.curElem,"inside"===g.pos&&(j=d.data("zmsData").rowObject,f=a.fromData,delete a.fromData,a.onDrop(c,f,j,k)))}i=!1}))))})},paint:function(){var a=this;this.id||(this.id="zm_Container"),this.lftClkFn&&this.$el.undelegate("click").delegate("div.zmL","click",function(b){a.callback?a.callback(b,this):a.lftClkFn&&a.lftClkFn(b,this)}),this.rgtClkFn&&this.$el.undelegate("contextmenu").delegate("div.zmL","contextmenu",function(b){a.callback?a.callback(b,this):a.lftClkFn&&a.rgtClkFn(b,this)})}};var b=function(a){this.actionArr=a&&a.actionArr,this.elemHolder=void 0,this.groupId=a&&a.groupId};b.prototype={setActionArr:function(a){this.actionArr=a},setGroupId:function(a){this.groupId=a},paint:function(){var a;return a=zmsTemplates.constructActionListIcons(this.actionArr),this.elemHolder=a,a},show:function(){$(this.elemHolder).show()},hide:function(){$(this.elemHolder).hide()},unSelect:function(){$(this.elemHolder).find("b").removeClass("Sel")}};var c=function(){this.iconArr=void 0,this.iconObjArr=void 0,this.iconRightArr=void 0,this.iconClick=void 0,this.$el=$("<div class='SCmb'></div>")},d=function(a,c){function d(a){var c,d,e=[];for(c=a.length,d=0;d<c;d++)e.push(new b(a[d]));return e}var e=[],f=[];c=c||{},$.isArray(a.iconArr)?e=d(a.iconArr):(e=d(a.iconArr.left),f=d(a.iconArr.right)),a.iconRightArr=f,a.iconObjArr=e,c.leftElemCustomClass&&(a.leftElemCustomClass=c.leftElemCustomClass),c.rightElemCustomClass&&(a.rightElemCustomClass=c.rightElemCustomClass)};c.prototype={push:function(a,b){this.iconArr=a,d(this,b)},clear:function(){this.iconArr=[]},getDOMNode:function(){return this.$el},setinnerHTML:function(a){this.$el.html(a)},appendChild:function(a){this.$el.html(""),this.$el.append(a)},setListener:function(a,b){this.$el.off(a).on(a,function(a){var c,d,e,f,g=a.target||a.srcElement;c=$(g),c.hasClass("SCmb")||(d="I"===g.tagName?c:c.find("i").last(),f=c.parents("li").data("event"),d.length||(d=c),d.length?e=d.attr("class")||d.html():c.is("i")&&(e=c.attr("class")),e||(e=c.find("span").text()),e&&b(a,e,f))})},getIconArrForGroup:function(){var a=[];return this.iconArr&&(a=$.isArray(this.iconArr)?this.iconArr:this.iconArr.left.concat(this.iconArr.right)),a},hideGroup:function(a){var b,c,d,e;for(d=this.getIconArrForGroup(),this.iconObjArr=this.iconObjArr||[],e=this.iconObjArr.concat(this.iconRightArr),c=d.length,b=0;b<c;b++)d[b].groupId===a&&e[b].hide()},showGroup:function(a){var b,c,d,e;for(d=this.getIconArrForGroup(),this.iconObjArr=this.iconObjArr||[],e=this.iconObjArr.concat(this.iconRightArr||[]),c=d.length,b=0;b<c;b++)if(d[b].groupId===a){e[b].show();break}},unSelectGroup:function(a){var b,c,d;for(d=this.getIconArrForGroup(),c=d.length,b=0;b<c;b++)if(d[b].groupId===a){this.iconObjArr[b].unSelect();break}},paint:function(){var a,b,c,d,e,f;if(c=this.iconObjArr,f=this.iconRightArr,d=$("<div class='SC_flt'></div>"),e=$("<div class='SC_frt'></div>"),this.$el.html(""),c)for(b=c.length,a=0;a<b;a++)d.append(c[a].paint());if(f)for(b=f.length,a=0;a<b;a++)e.append(f[a].paint());this.leftElemCustomClass&&d.addClass(this.leftElemCustomClass),this.rightElemCustomClass&&e.addClass(this.rightElemCustomClass),this.$el.append(e),this.$el.append(d)}};var e=function(a){this.headerArr=a&&a.list,this.iconClick=a&&a.clk,this.$el=$("<div class='SC_mhd'></div>")};e.prototype={push:function(a){this.headerArr=a},clear:function(){this.headerArr=[]},getDOMNode:function(){return this.$el},setinnerHTML:function(a){this.$el.html(a)},appendChild:function(a){this.$el.html(""),this.$el.append(a)},setListener:function(a,b){this.$el.off(a).on(a,function(a){var c,d,e=a.target||a.srcElement;c=$(e).closest("span"),d=c.data("data-event"),d&&b(d)})},paint:function(){if(this.headerArr)return this.$el.html(zmsTemplates.constructHeader(this.headerArr)),this.$el}};var f=function(a){a=a||{},this.id=a.id,this.count=a.count,this.customHeader=a.customHeader,this.centerArr=[],this.$el=$("<div class='SCmc'></div>"),a.customCenterClass&&this.$el.addClass(a.customCenterClass),this.init()};f.prototype={getNodes:function(){return this.centerArr},init:function(){this.centerArr.push(new c),"2"!==this.count&&this.centerArr.push(new e),this.centerArr.push(new a({count:this.count}))},setId:function(a){this.id=a,this.$el[0].id=a},paint:function(){for(var a=0;a<this.centerArr.length;a++)this.centerArr[a].paint();this.customHeader||this.$el.append(this.centerArr[1].$el),this.centerArr[2]&&this.$el.append(this.centerArr[2].$el)}};var g=function(){this.$el=$("<div class='SC_Twpr'></div>")};g.prototype={push:function(a){this.$el.html(""),this.append(a)},getDOMNode:function(){return this.$el},append:function(a){this.$el.append(a)}};var h=function(){this.$el=$("<div class='SC_ptit'></div>"),this.headerArr=[],this.headerElemObj={}};h.prototype={push:function(a){this.headerArr=a},getDOMNode:function(){return this.$el},setListener:function(a,b){this.$el.off(a).on(a,function(a){var c,d;d=a.target||a.srcElement,c=$(d).closest("li").data("data-event"),c=c||$(d).attr("data-event"),c&&b(c,d)})},render:function(){var a,b,c,d,e,f,g,h,i,j=this.headerArr,k=0,l=0,m=0,n=[],o=[],p="";for(j.rIcons&&(l=j.rIcons.length),k=0;k<l;k++){for(a=j.rIcons[k],$.isArray(a)||(a=a.actionArr),b=a.length,m=0;m<b;m++)p="","right"===a[m].tooltipDir&&(p="ttr"),o.push(["LI",{child:[["B",{child:[["DIV",{attrs:{"class":"SC_hd"}}],["SPAN",{attrs:{"class":"SC_ttip "+p,"data-tooltip":a[m].tooltip},child:[["I",{attrs:{"class":a[m].iconClass}}]]}]]}]]}]);n.push(["UL",{child:o}]),o=[]}d=["DIV",{attrs:{"class":"SCmb"},child:[["DIV",{attrs:{"class":"SC_frt"},child:n}]]}],c=["DIV"],e=_zm.getDOM(c);var q=j.text,r=typeof q;e.appendChild("object"===r?_zm.getDOM(q):document.createTextNode("string"===r?q:"")),this.$el.html(""),f=_zm.getDOM(d);var s=$(f).find("[data-tooltip]");for(_(s).each(function(a){a=$(a),i=a.data("tooltip"),i&&zmComponent.tooltip({elm:a[0],text:i,arrow:"top"}),a.data("tooltip","")}),this.$el.append(f),this.$el.append(e),this.headerElemObj={},k=0;k<l;k++)for(a=j.rIcons[k],$.isArray(a)||(h=a.groupId,a=a.actionArr),b=a.length,m=0;m<b;m++)g=this.$el.find(".SCmb ul").eq(k),h&&(this.headerElemObj[h]=g,h=""),g.find("li").eq(m).data("data-event",a[m].data)},hideGroup:function(a){a&&this.headerElemObj[a]&&this.headerElemObj[a].hide()},showGroup:function(a){a&&this.headerElemObj[a]&&this.headerElemObj[a].show()}};var i=function(){this.$el=$('<div class="SC_pv"></div>'),this.headerObj=new h,this.contentObj=new g};i.prototype={getNodes:function(){return[this.headerObj,this.contentObj]},show:function(){this.headerObj.render(),this.$el.attr("class","SC_pv"),this.$el.append(this.headerObj.$el),this.$el.append(this.contentObj.$el),this.$el.parent().addClass("SC_sw"),this.$el.addClass("shw")},close:function(){this.$el.removeClass("shw"),this.$el.parent().removeClass("SC_sw"),this.headerObj.$el.html(""),this.contentObj.$el.html("")}};var j=function(a,b){this.node=a,this.obj=b,this.noPreview=b.noPreview,this.customHeader=b.customHeader,this.centerArr=[],this.$el=$("<div class='SCm'></div>"),this.init()};return j.prototype={init:function(){this.centerArr.push(new f($.extend(this.obj,{count:this.node}))),this.noPreview||this.centerArr.push(new i)},paint:function(){var a,b;a=this.centerArr[0],b=a.getNodes(),a.paint(),this.customHeader||(a.$el.find(".SC_mhd").length?a.$el.find(".SC_mhd").after(b[0].$el):a.$el.find(".SC_mclst").length&&a.$el.find(".SC_mclst").append(b[0].$el)),this.$el.append(a.$el),this.noPreview||a.$el.append(this.centerArr[1].$el),this.$el.parent().length||zmsTemplates.appendToCenter(this.$el)}},j}(),window.zmRight=function(){function a(){this.$el=$("<div class='SCr SC_show'></div>")}return a.prototype={paint:function(){this.$el.parent().length||zmsTemplates.appendToRight(this.$el)}},a}(),function(){function a(){this.showList=!0,this.mapObject=void 0,this.classObject=void 0,this.entityClass=void 0,this.headerType=void 0,this.headerObject=void 0,this.listType=void 0,this.hasChild=void 0,this.listId=void 0,this.isListArr=void 0,this.listObject=void 0,this.id=void 0,this.fn=void 0,this.el=void 0,this.trashId=void 0,this.hasCount=void 0,this.childToggleFn=void 0,this.dragHelper=void 0,this.dragEventObj=void 0,this.disableSelection=!1}var b,c=zmail.Core.Namespaces,d=c.get("zmState.leftStateInfo"),e=function(a,b,c,d){var e={};return e.name=a[b.name]||a.name||"",e.name=e.name,e.count=a[b.count]||a.count||"",e.seq=a[b.seq]||a.seq||"",e.id=a[b.id]||a.id||"",e.parentId=a[b.parentId]||a.parentId||"",e.color=a[b.color]||a.color||"",e.hasChild=a[b.hasChild]||a.hasChild||"",e.check=a[b.check]||a.check||"",e.expChild=a[b.expChild]||a.expChild||"",e.dropdown=a[b.dropdown]||a.dropdown||"",e.licon=a[b.licon]||a.licon||"",e.ricon=a[b.ricon]||a.ricon||"",
e.isSel=a[b.isSel]||a.isSel||"",e.showList=a[b.showList]||a.showList||"",e.shared=a[b.shared]||a.shared||"",e.OZUID=a[b.OZUID]||a.OZUID||"",e.hideNode=a[b.hideNode]||a.hideNode||!1,e.notBold=b.notBold||!1,e.addNewType=a[b.addNewType]||a.addNewType||!1,e.txtNodeClass=a.txtNodeClass,e.rowTitle=a.rowTitle,c&&(e.accessText=zmCenterListing.getMappedClass(b,c,a,"accessText")),d&&(e.entityClass=zmCenterListing.getMappedClass(b,d,a,"entityClass")),e},f=function(a,b){var c,e,f=b.getAppKey();return e=d.utils.checkForPresence(a,f),e||(c=_zm.getCookie("ZM-left-"+a),c&&(_zm.removeCookie("ZM-left-"+a),e="s"!==c&&d.addEntry(f,a))),e};a.prototype={constructor:a,setChildToggle:function(a){var b=this,c=b.el;this.childToggleFn=a,c.off("click").on("click","i.msi-rarrow","i.msi-arrow45",function(){return function(a){a.preventDefault(),a.stopPropagation();var c,d,e=a.type,f=a.target||a.srcElement;f=d=$(f);var g=2,h=["msi-rarrow","msi-arrow45","SClbl"];for(c in h)if(f.hasClass(h[c])){g=1;break}f.hasClass("SC_tre")||(f=f.parents(".SC_tre")),f.find("span:first").removeClass("SC_new"),f.length||(f=d,f.hasClass("SC_ltl")||(f=f.parents(".SC_ltl")));var i={};i.zmsData=f.data("zmsData"),i.zmsData.type=e,i.zmsData.colInfo={column:g},i.zmsData.eventInfo=a;var j=this;b.childToggle(i,f,j,b)}}())},push:function(a){a=a||{},this.disableSelection=Boolean(a.disableSelection),this.avoidStateSave=Boolean(a.avoidStateSave),this.showList=Boolean(a.showList),this.isHeaderSel=a.isHeaderSel,this.mapObject=a.mapObject,this.classObject=a.classObject,this.entityClass=a.entityClass,this.headerObject=a.dataObject&&a.dataObject.headerObject,this.listType=a.type,this.hasChild=Boolean(a.hasChild),this.hasCountObject=Boolean(a.hasCountObject),this.listId=a.listId,this.trashId=a.trashId,this.listObject=a.dataObject&&a.dataObject.listObject,this.hasCountObject&&(this.countObject=a.dataObject&&a.dataObject.countObject),this.hasChild&&(this.childObject=a.dataObject&&a.dataObject.childObject),this.id=a.id,this.clearEl(),this.isListArr=Boolean(a.isListArr),this.listObject&&this.listObject instanceof Array&&(this.isListArr=!0),this.listObject||(this.listObject=this.isListArr?[]:{})},setListener:function(a,b){this.el.off(a).on(a,b)},setLayerId:function(a){this.id=a},setHeaderObject:function(a){this.headerObject=a},setMapObject:function(a){this.mapObject=a},setCountObject:function(a){this.countObject=a},setChildObject:function(a){this.childObject=a},setListId:function(a){this.listId=a},setType:function(a){this.listType=a},setListObject:function(a){this.listObject=a},getListObject:function(){return this.listObject},getHeaderObject:function(){return this.headerObject},getChildObject:function(){return this.childObject},editHeader:function(a){this.headerObject=a;var b=this.getHeaderDOM();$("#"+this.id).children().first().remove(),$("#"+this.id).prepend(b)},hasUnreadChild:function(a){var b,c;if(!this.isListArr&&this.childObject&&this.childObject[a]){c=this.childObject[a].CH;for(b in c)if(c.hasOwnProperty(b)){if(this.countObject[b].c>"0")return!0;this.childObject[b]&&this.childObject.CH&&this.hasUnreadChild(b)}}},getRowDom:function(b,c,d){var f,g=this.listType,h=e(b,c,this.classObject,this.entityClass);if(!this.isListArr&&(h.id=d,this.countObject)){f=this.countObject||"";var i=f[d]||"";i&&(h.count=i[c.count]||i.count||0,h.parentId=i[c.parentId]||i.parentId||-1)}var j=a.views.listDom(h,g);this.hasUnreadChild(d)&&!h.notBold&&j.find(".zm_txt").addClass("SC_bld");var k={layerId:this.id,type:"list"};c.infoObject&&(k.info=c.infoObject);var l={};if(l.rowInfo=k,this.isListArr)l.rowObject=b;else{var m=d,n=b;f=this.countObject||"";var o=f[m],p={};if(p[m]=n,l.rowObject=p,o){var q={};q[m]=o,l.countObject=q}}return j.data("zmsData",l),j},getUserObjRow:function(a){var b,c={};if(this.isListArr){var d=this.mapObject,e=a[d.id]||a.id||"";c.id=e,c.data=a}else for(b in a)a.hasOwnProperty(b)&&(c.id=b,c.data=a[b]);return c},getNodeIndex:function(a){var b,c=-1,d=this.mapObject,e=this.listObject.length;for(b=0;b<e;b+=1){var f=this.listObject[b][d.id]||this.listObject[b].id||"";if(f===a){c=b;break}}return c},getFirstObj:function(a){var b;for(b in a)if(a.hasOwnProperty(b))return a[b]},editNode:function(a,b,c){if(a){var d,e,f,g,h,i,j,k;if(d=$.extend({},a),e=this.id,f=$("#"+e),b=b||this.mapObject,g=this.getUserObjRow(d),h={mode:"edit",nObj:d},i=f.find("#"+g.id),this.hasCountObject&&(h.pId=this.countObject[g.id].p),this.updateListObject(h),i.length&&(j=this.getRowDom(g.data,b,g.id))){if(i.hasClass("Stre")&&j.addClass("Stre"),i.find("span").eq(0).hasClass("SC_new")&&j.find("span").eq(0).addClass("SC_new"),i.find(".SC_ct").hasClass("SC_new")&&j.find(".SC_ct").addClass("SC_new"),k=i.css("padding-left"),k=parseInt(k.replace("px","")),i.replaceWith(j),c&&this.hasChild){$("#"+g.id+"cld").remove();var l,m,n,o=g.data;for(l in o)o.hasOwnProperty(l)&&(m=o.HC,n=o.E);m&&n&&this.consChild(g.id,j,k,!0)}j.css("padding-left",k)}}},moveNode:function(a,b,c,d,e){if(a){var f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w=0,x=0,y=!0;for(v in a)a.hasOwnProperty(v)&&(l=v);if(!l||!c||l!==c){if(o=$.extend({},a),u=$.extend(!0,{},a),this.countObject&&(p=this.countObject[l].p),s={mode:"delete",nObj:o,pId:p,NoRecursiveDelete:!0},this.updateListObject(s),o=u,!this.isListArr){d&&"-1"!==d?this.childObject[d]&&(t=this.childObject[d].CH):t=this.listObject;var z=this.mapObject.sequence||"SE";c&&(x=t[c][z]),this.getFirstObj(o)[z]=x+1}s={mode:"add",nObj:o,pId:d},this.updateListObject(s),g=this.el.find("#"+l).eq(0),r=parseInt(g.css("padding-left")),i=g.clone(!0),g.remove(),m=this.el.find("#"+l+"cld").eq(0),m.length&&(n=m.clone(!0)),p&&(q=this.el.find("#"+p+"cld").eq(0),q.children(".SC_tre").length||(q.remove(),this.el.find("#"+p+" i.msi-rarrow").remove())),f=this.createNodeDetails(d,e),c?(j=this.el.find("#"+c).eq(0),k=this.el.find("#"+c+"cld"),k.length&&(j=k.eq(0))):j=this.el.find(".SC_ldt"),d&&(h=this.el.find("#"+d),h.length&&(w=parseInt(h.css("padding-left"))),this.el.find("#"+d+"cld").length&&(h=this.el.find("#"+d+"cld"))),f.padLeft?i.css("padding-left",f.padLeft):i.removeAttr("style"),m.remove(),d?c?j.after(i):(h=this.el.find("#"+d+"cld"),h.length?h.prepend(i):(this.consChild(d,$("#"+d),w,!0),y=!1)):c?j.after(i):j.prepend(i),n&&n.length&&(n.find(".SC_tre").each(function(){var a,b;a=parseInt($(this).css("padding-left"))-r,b=a+(f.padLeft||21),$(this).css("padding-left",b+"px")}),y&&this.el.find("#"+l).after(n)),p&&"-1"!==p&&this.removeHighlightFromParent(p),this.hasUnreadChild(d)&&this.highlightParent(d,this.el)}}},deleteNode:function(a,b){if(a){var c=$.extend({},a),d=this.createNodeDetails(),e=d.domEl,f=this.getUserObjRow(c);if(e.find("#"+f.id).remove(),e.find("#"+f.id+"cld").remove(),this.hasChild){var g=f.id,h=this.countObject[g];if(h&&"-1"!==h.p){var i=h.p,j=e.find("#"+i+"cld");if(j.length&&0===j.children().length){j.remove();var k=e.find("#"+i);k.find("i.msi-rarrow").remove()}}}var l={mode:"delete",nObj:c,pId:b};this.updateListObject(l)}},createNodeDetails:function(a,b){var c,d,e={},f=0,g=this.el.find(".SC_ldt");if(a){d=this.el.find("#"+a);var h=d,i={zmsData:h.data("zmsData")};if(h.find(".msi-rarrow").length&&!h.find(".msi-arrow45").length){var j,k,l=i.zmsData.rowObject;for(k in l)l.hasOwnProperty(k)&&(j=k);b?(c=parseInt(h.css("padding-left")),this.consChild(j,h,c,!0),this.hideChild(h.find(".msi-rarrow"),j)):this.showChild(h.find(".msi-rarrow"),j,h),g=this.el.find("#"+a+"cld")}g.length||(g=$("<div class = 'SC_parcnt' id='"+a+"cld'></div>"),this.el.find("#"+a).after(g)),d.find(".msi-rarrow").length||(b?d.children("span:first").append("<i class='msi-rarrow'></i>"):d.children("span:first").append("<i class='msi-rarrow msi-arrow45'></i>")),f=parseInt(d.css("padding-left"))+12}return e.domEl=g,e.padLeft=f,e},addClassAtStart:function(a,b){if("1"===String(this.listType)){var c=this.el.find("#"+a+" span").eq(0),d=c.find("i");if(d.length)d.hasClass(b)||d.addClass(b);else{var e=$("<i></i>");e.addClass(b),c.append(e)}}},removeClassAtStart:function(a,b){if("1"===String(this.listType)){var c=this.el.find("#"+a+" span").eq(0),d=c.find("i");d.length&&d.hasClass(b)&&d.removeClass(b)}},addClass:function(a,b){var c=this.el.find("#"+a).eq(0);c.length&&c.addClass(b)},removeClass:function(a,b){var c=this.el.find("#"+a).eq(0);c.length&&c.removeClass(b)},hideNode:function(a){var b,c;"1"===String(this.listType)&&(b=this.mapObject.hideNode||"hideNode",c=this.el.find("#"+a).eq(0),c.length&&(this.listObject[a][b]=!0,c.hide()))},showNode:function(a){var b,c;"1"===String(this.listType)&&(b=this.mapObject.hideNode||"hideNode",c=this.el.find("#"+a).eq(0),c.length&&(this.listObject[a][b]=!1,c.show()))},appendNode:function(a,b,c){if(a){var d,e=$.extend({},a),f=this.createNodeDetails(c),g=f.domEl;b=b||this.mapObject;var h=this.getUserObjRow(e),i=this.getRowDom(h.data,b,h.id);if(c&&f.padLeft&&i.css("padding-left",f.padLeft),!this.isListArr){var j=this.childObject&&this.childObject[c]&&this.childObject[c].CH;j||(j=this.listObject);var k,l=0;if(j)for(k in j)j.hasOwnProperty(k)&&l<j[k].SE&&(l=j[k].SE);this.getFirstObj(e).SE=l+1}var m={mode:"add",nObj:e,pId:c};this.updateListObject(m),c?(this.consChild(c,i,f.padLeft,!0),d=$("#"+c),this.showChild(d.find("i.msi-rarrow"),c,d)):g.append(i)}},prependNode:function(a,b,c){if(a){var d=$.extend({},a),e=this.createNodeDetails(c),f=e.domEl;b=b||this.mapObject;var g=this.getUserObjRow(d),h=this.getRowDom(g.data,b,g.id);c&&e.padLeft&&h.css("padding-left",e.padLeft),f.prepend(h),this.isListArr||(this.getFirstObj(d).SE=1);var i={mode:"add",nObj:d,pId:c};this.updateListObject(i)}},insertNodeBefore:function(a,b,c,d){if(a){var e=$.extend({},a),f=this.createNodeDetails(d),g=f.domEl;b=b||this.mapObject;var h=this.getUserObjRow(e),i=this.getRowDom(h.data,b,h.id);if(d&&f.padLeft&&i.css("padding-left",f.padLeft),c){if(g.find("#"+c).before(i),!this.isListArr){var j=this.getRowObj(c),k=this.mapObject.sequence||"SE",l=this.getFirstObj(j)[k];this.getFirstObj(e)[k]=l}var m={mode:"add",nObj:e,rel:{id:c,mode:"before"},pId:d};this.updateListObject(m)}}},insertNodeAfter:function(a,b,c,d){if(a){var e=$.extend({},a),f=this.createNodeDetails(d),g=f.domEl,h=g;b=b||this.mapObject;var i=this.getUserObjRow(e),j=this.getRowDom(i.data,b,i.id);if(d&&f.padLeft&&j.css("padding-left",f.padLeft),c){if(h=g.find("#"+c),this.hasChild&&g.find("#"+c+"cld").length&&(h=g.find("#"+c+"cld")),!this.isListArr){var k=this.getRowObj(c),l=this.mapObject.sequence||"SE",m=this.getFirstObj(k)[l];this.getFirstObj(e)[l]=m+1}var n={mode:"add",nObj:e,rel:{id:c,mode:"after"},pId:d};this.updateListObject(n)}h.after(j)}},insertNodeAt:function(a,b,c,d){if(a){var e=$.extend({},a),f=this.createNodeDetails(d);b=b||this.mapObject;var g=this.getUserObjRow(e),h=this.getRowDom(g.data,b,g.id);if(d&&f.padLeft&&h.css("padding-left",f.padLeft),!this.isListArr){var i=this.mapObject.sequence||"SE";this.getFirstObj(e)[i]=parseInt(c)}var j={mode:"add",nObj:e,pId:d};this.updateListObject(j)}},getRowObj:function(a){return this.getRowObjfromId(a)},clearNew:function(a){this.el.find("#"+a+" .SC_new").removeClass("SC_new")},getRowObjfromId:function(a){if(a){var b,c={};if(this.isListArr){var d=this.getNodeIndex(a);c=this.listObject[d]}else if(this.hasCountObject&&this.countObject){var e=this.countObject[a],f=e.p;if("-1"!==f&&f){if(this.hasChild&&this.childObject&&this.childObject[f]&&this.childObject[f].CH){var g=this.childObject[f].CH[a];c[a]=g}}else b=this.listObject[a],c[a]=b}else b=this.listObject[a],c[a]=b;return c}},highlightNode:function(a,b,c){var d;a&&(d=b.find("#"+a),c&&d.find(".SC_ct").addClass("SC_new"),d.find(".zm_txt").hasClass("SC_bld")||d.find(".zm_txt").addClass("SC_bld"))},removeHighlightFromNode:function(a){var b;b=this.el.find("#"+a).eq(0),b.length&&(b.find(".SC_ct").removeClass("SC_new"),b.find(".zm_txt").removeClass("SC_bld"))},highlightParent:function(a,b,c,d,e){var f;if(a)f=b.find("#"+a),c&&f.find(".SC_ct").addClass("SC_new"),d&&e&&!f.find(".msi-arrow45").length&&f.find("span:first").addClass("SC_new"),f.find(".zm_txt").hasClass("SC_bld")||f.find(".zm_txt").addClass("SC_bld"),"-1"!==String(a)&&"-1"!==this.countObject[a].p&&this.highlightParent(this.countObject[a].p,b,!1,!0,e);else{var g,h,i=this.childObject;for(g in i){var j=i[g].CH;for(h in j)parseInt(this.countObject[h].c)>0&&(c&&b.find("#"+a).addClass("SC_new"),b.find("#"+g+" .zm_txt").addClass("SC_bld"),this.countObject[g].p!==-1&&this.highlightParent(this.countObject[g].p,b,!1,!0))}}},removeHighlightFromParent:function(a,b){var c,d,e;c=$("#"+a),d=$("#"+a+"cld"),e=this.countObject[a].c,c.find(".SC_ct").removeClass("SC_new"),b||e<="0"&&!d.find("span.SC_bld").length&&c.find(".zm_txt").removeClass("SC_bld"),d.find(".SC_ct.SC_new").length||c.find("span.SC_new").removeClass("SC_new"),"-1"!==String(this.countObject[a].p)&&(e=this.countObject[this.countObject[a].p].c,this.removeHighlightFromParent(this.countObject[a].p))},updateCount:function(a,b,c,d,e){var f,g,h,i,j=this.mapObject&&this.mapObject.notBold;switch(f=this.getRowObjfromId(a),this.countObject?(i=this.countObject[a],g="c"):(i=f[a]||f,g=this.mapObject.count),h=parseInt(i[g]),b){case"dec":h>0&&(i[g]=h-1);break;case"inc":i[g]=h+1;break;case"bdec":h>0&&(i[g]=h-c);break;case"binc":i[g]=h+c;break;case"upd":i[g]=c}i[g]<0&&(i[g]=0),this.editNode(f,this.mapObject),j||(this.hasChild?("inc"!==b&&"binc"!==b&&"upd"!==b||parseInt(i[g])&&this.highlightParent(a,this.el,d,!1,e),"dec"!==b&&"bdec"!==b&&"upd"!==b||parseInt(i[g])||this.removeHighlightFromParent(a)):("inc"!==b&&"binc"!==b&&"upd"!==b||parseInt(i[g])&&this.highlightNode(a,this.el,d),"dec"!==b&&"bdec"!==b&&"upd"!==b||parseInt(i[g])||this.removeHighlightFromNode(a)))},getHeaderDOM:function(){var a,b;if(this.headerObject){var c,d=this.mapObject||"",g=this.headerObject,h=e(g,d),i=$("<div class='SC_ct'><b></b></div>"),j=!1;this.avoidStateSave||(a=f(this.id,zmsuite.getLeft()),this.showList=!a);var k=h.isSel?"SC_tre":"";if(b=$('<div class="SC_ltl '+k+'">'),(g.onAdd||g.settingsOption)&&(b.append('<span class="SC_frt"></span>'),b.append(i),i=i.find("b").eq(0),j=!0),h.count<0&&(h.count=0),g.settingsOption){var l=$("<i class='"+g.settingsObject.className+"'></i>");l.data("action","settings"),i.append(l)}if(h.count&&j){var m=$(h.count);m.data("action","add"),i.append(m)}c=$("<span>"),c.text(h.name),b.append(c),h.id&&b.attr("id",h.id);var n={type:"header",layerId:this.id};d.infoObject&&(n.info=d.infoObject),b.data({zmsData:{rowObject:g,rowInfo:n}})}return b},consChild:function(a,b,c,d){var e,f,g,h,i=this.mapObject,j=[],k=this.childObject[a].CH;if(!k)return b;if(0===$("#"+a+"cld").length&&(b=b.add("<div class='SC_parcnt' id='"+a+"cld'></div>")),c+=12,!this.isListArr){for(g in k)if(k.hasOwnProperty(g)){var l=this.getRowDom(k[g],i,g);l=$(l).css("padding-left",c);var m=k[g][i.expChild]||k[g].expChild||"",n=k[g][i.hasChild]||k[g].hasChild||"";m&&n&&(l=this.consChild(g,l,c,!0)),j[k[g].SE-1]=l}for(h=$(b[1]),f=j.length,e=0;e<f;e+=1)h.append(j[e])}if(d){var o=b.find("msi-arrow");o.hasClass("msi-arrow45")?o.removeClass("msi-arrow45"):o.addClass("msi-arrow45"),b.eq(0).after(h)}return b},getListDOM:function(){if(this.listObject){var b,c,d=this.listObject,e=this.mapObject||"",f=this.showList?"":"display:none",g=this.listId||"",h=a.views.getLeftRowsContainerDom({id:g,style:f});if(this.isListArr){var i,j=d.length;for(i=0;i<j;i+=1)b=d[i],c=this.getRowDom(b,e),h.append(c)}else{var k,l,m=[];for(k in d)if(d.hasOwnProperty(k)){b=d[k],c=this.getRowDom(b,e,k);var n=b[e.expChild]||b.expChild||"",o=b[e.hasChild]||b.hasChild||"";b[e.sequence]?b[e.sequence]=parseInt(b[e.sequence]):b.sequence&&(b.sequence=parseInt(b[e.sequence]));var p=b[e.sequence]||b.sequence||"";if(o&&n&&"1"===String(this.listType)&&this.childObject){var q=21;c=this.consChild(k,c,q)}p?m[p-1]=c:m.push(c)}for(l=0;l<m.length;l+=1)m[l]&&h.append(m[l])}return this.hasChild&&!e.notBold&&this.highlightParent(void 0,h),h}},showChild:function(a,b,c){var d,e=this.el;a.addClass("msi-rarrow msi-arrow45"),e.find("#"+b+"cld").length?e.find("#"+b+"cld").show():(d=parseInt(c.css("padding-left")),this.consChild(b,c,d,!0)),this.updateExpCollapseState(e.find("#"+b).eq(0),!0)},hideChild:function(a,b){a.removeClass("msi-arrow45");var c=this.el;c.find("#"+b+"cld").eq(0).hide(),this.updateExpCollapseState(c.find("#"+b).eq(0),!1)},childToggle:function(a,b,c,d){var e,f,g=a.zmsData.rowObject;c=$(c);for(f in g)g.hasOwnProperty(f)&&(e=f);c.hasClass("msi-arrow45")?d.hideChild(c,e):d.showChild(c,e,b)},updateExpCollapseState:function(a,b){var c={};this.childToggleFn&&(c.zmsData=a.data("zmsData"),this.childToggleFn(c,a,b))},recursiveChildDelete:function(a){if(this.childObject&&this.childObject[a]){var b=this.getRowObjfromId(a)[a];b.HC=0,b.E=0;var c,d=this.childObject[a].CH;for(c in d)d.hasOwnProperty(c)&&this.recursiveChildDelete(c);delete this.childObject[a]}},clearChild:function(a){var b=this.getRowObjfromId(a);this.clearChildObj(a),this.editNode(b,this.mapObject,!0)},clearChildObj:function(a){var b,c=this.getRowObjfromId(a);this.childObject[a]&&this.recursiveChildDelete(a);for(b in c)c.hasOwnProperty(b)&&(c[b].HC=0,c[b].E=0)},updateListObject:function(a){var b,c,d,e,f,g,h,i,j,k=a.mode,l=a.nObj;if(this.isListArr)if("add"===k){f=a.rel&&a.rel.id?a.rel.id:"";var m=a.rel&&a.rel.pos?a.rel.pos:"";f&&m?"before"===m?(e=this.getNodeIndex(f),e!==-1&&this.listObject.splice(e,0,l)):"after"===m&&(e=this.getNodeIndex(f),e!==-1&&this.listObject.splice(e+1,0,l)):this.listObject.push(l)}else"edit"===k?(g=this.mapObject,h=l[g.id]||l.id||"",e=this.getNodeIndex(h),this.listObject[e]=l):"delete"===k&&(g=this.mapObject,h=l[g.id]||l.id||"",e=this.getNodeIndex(h),this.listObject.splice(e,1));else{var n=a.pId||"-1";if(f=a.rel||"","add"===k||"edit"===k)for(c in l)if(this.hasCountObject&&(this.countObject[c]?"-1"!==n?this.countObject[c].p=n:this.countObject[c].p="-1":this.countObject[c]={p:n,c:0}),n&&"-1"!==n)if(this.childObject[n]&&this.childObject[n].CH){for(d in this.childObject[n].CH)this.childObject[n].CH[d].SE>=l[c].SE&&this.childObject[n].CH[d].SE++;this.childObject[n].CH[c]=l[c]}else{this.childObject[n]={CH:{}},this.childObject[n].CH[c]=l[c],b=this.getRowObjfromId(n);for(c in b)b.hasOwnProperty(c)&&(b[c].HC=1)}else{i=this.mapObject.sequence||"SE",j=l[c][i];for(d in this.listObject){var o=this.listObject[d][i];o>=j&&(this.listObject[d][i]=o+1)}this.listObject[c]=l[c]}else if("delete"===k){var p;for(c in l){p=n&&"-1"!==String(n)?this.childObject[n].CH:this.listObject,i=this.mapObject.sequence||"SE",j=p[c][i];for(d in p){var q=p[d][i];q&&q>j&&(p[d][i]=q-1)}n&&"-1"!==String(n)&&(a.NoRecursiveDelete||this.clearChildObj(c),$.isEmptyObject(this.childObject[n].CH)&&(delete this.childObject[n],this.clearChildObj(n))),delete p[c]}}}},clearEl:function(){this.el=a.views.getLeftLayerContainerDom({id:this.id}),"2"===String(this.listType)&&this.el.addClass("SC_lblpad")},constructLayer:function(){if(this.headerObject||this.listObject){this.clearEl();var a=this.el,b=this.getHeaderDOM(),c=this.getListDOM();return a.append(b),a.append(c),this.dragEventObj&&this.attachDragDropEvents(),a}},onMouseMove:function(a,c,d){var e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y="",z=!0,A=this;if(x=a.target||a.srcElement,x=$(x),s=x,t=c.fromData,o=x.parents(c.allowedParents),s=x.closest(".SC_tre"),s.length||(s=x.closest(".SC_ltl")),zmUtil.removeDocSelection(),j=$("#zm_mailLeft"),u=$("#zm_lftree"),k=j.offset(),h=a.pageY,q=a.pageX,d-h>0?r="top":d-h<=0&&(r="bottom"),q<k.left+j.width()&&(h-k.top<50&&h-k.top>0&&"top"===r?(u[0].scrollTop-=20,this.removeDragHelper()):k.top+j.height()-h<50&&"bottom"===r&&(u[0].scrollTop+=20,this.removeDragHelper())),!o.length)return this.removeDragHelper(),void zmsuite.showDragHandler(a,!1,c.helperText);if(!s.length){if(x=x.closest(".SC_fdrag"),!x.length)return this.removeDragHelper(),void zmsuite.showDragHandler(a,!1,c.helperText);if(x.prev().hasClass("SC_tre"))s=x.prev(),y="next";else if(x.next().hasClass("SC_tre"))s=x.next(),y="prev";else if(x.parent().hasClass("SC_parcnt"))s=x.parent().prev(),y="next";else{if(!x.prev().prev().hasClass("SC_tre"))return this.removeDragHelper(),void zmsuite.showDragHandler(a,!1,c.helperText);s=x.prev().prev(),y="next"}}if(s.length&&(l=s.data("zmsData").rowObject),e=s.find(".zm_txt"),g=s.offset().top,f=e.offset()&&e.offset().top,this.stopHoverOnRow(),s.hasClass("SC_ltl"))y="header",z=c.allowDrop&&c.allowDrop(t,l,y),zmsuite.showDragHandler(a,!1,c.helperText);else if(g<h&&f>h){if(y="prev",b&&(clearTimeout(b),b=0,i=null),z=c.allowDrop&&c.allowDrop(t,l,"prev"),!z)return this.removeDragHelper(),zmsuite.showDragHandler(a,!1,c.helperText),!1;this.showDragHelper(s,y),zmsuite.showDragHandler(a,!0,c.helperText)}else if(g+s.outerHeight()>h&&f+e.height()<h){y="next",b&&(clearTimeout(b),b=0,i=null),v=s,s.next().hasClass("SC_fdrag")&&(v=s.next()),v=v.next(),v.hasClass("SC_parcnt")&&(s=v.children(".SC_tre").eq(0),y="prev"),v.length||(p=s.parents(".SC_parcnt"),p.length&&(v=p.next().eq(0),v.length?v.hasClass("SC_fdrag")?v.next().length?(s=v.next(),y="prev"):(s=p.prev(),w=!0):(s=v,y="prev"):(s=p.prev(),w=!0)));try{l=s.data("zmsData").rowObject}catch(B){window.console.log("ex thrown")}if(z=c.allowDrop&&c.allowDrop(t,l,y),!z)return this.removeDragHelper(),zmsuite.showDragHandler(a,!1,c.helperText),!1;w?this.showDragHelper(p,y):this.showDragHelper(s,y),zmsuite.showDragHandler(a,!0,c.helperText)}else if(g<h&&f+e.height()>=h){if(y="inside",z=c.allowDrop&&c.allowDrop(t,l,y),!z)return this.removeDragHelper(),zmsuite.showDragHandler(a,!1,c.helperText),!1;if(s.find("i.msi-rarrow").length&&!s.find("i.msi-arrow45").length){for(n in l)l.hasOwnProperty(n)&&(m=n);i!==m&&(i=m,b&&(clearTimeout(b),b=0),b=setTimeout(function(){A.showChild(s.find("i.msi-rarrow"),i,s)},500))}this.showDragHelper(e,y),zmsuite.showDragHandler(a,!0,c.helperText)}return{toDrop:z,curElem:s,pos:y}},onDrop:function(a,b,c){var d,e,f,g,h,i;c&&c.toDrop&&(h=c.curElem,i=c.pos,"prev"===i?(f=h.prev(),f.length?h=f.hasClass("SC_tre")?f:f.prev():(h=h.parent().prev(),i="inside")):"inside"===i&&b.getDescendant&&(g=h.next(),g.length&&!g.hasClass("SC_tre")&&(i="next",h=g.children(".SC_tre:last"))),e=h.data("zmsData").rowObject,d=b.fromData,delete b.fromData,b.onDrop(a,d,e,i))},setDragDrop:function(a){this.dragEventObj=a},attachDragDropEvents:function(){var a,b,c=this;b=this.dragEventObj,c.el.find(".SC_ldt").off("mousedown").mousedown(function(d){var e,f,g,h,i=!1;3!==d.which&&(h=d.pageY,f=d.target||d.srcElement,f=$(f).closest(".SC_tre"),a=$("#zm_mailLeft"),f.length&&(e=f.data("zmsData").rowObject,b.fromData=e),b.allowDrag&&!b.allowDrag(e)||($(document).off("mousemove.ZMLeft").on("mousemove.ZMLeft",function(a){var d,f;a.preventDefault(),d=a.target||a.srcElement,d=$(d),f=d.parents(".SC_lbx"),f.length||(f=d.closest(".SC_ltl")),i=!0,i&&(b.helperText=b.dragStart(a,e)),f.length?g=c.onMouseMove(a,b,h):(c.removeDragHelper(),zmsuite.getCenter()[0].getNodes()[2].onMouseMove(a,b)),h=a.pageY}),a.off("mouseleave.ZMLeft").on("mouseleave.ZMLeft",function(){}),$(document).off("mouseup.ZMLeft").on("mouseup.ZMLeft",function(a){var d,e,f,h,j;j=a.target||a.srcElement,j=$(j),d=j,e=j.closest(".SC_tre"),e.length||(e=j.closest(".SC_ltl")),h=d.parents(b.allowedParents),zmsuite.removeDragHandler(),c.removeDragHelper(),c.showHoverOnRow(),f=$("#zm_mailLeft"),$(document).off("mousemove.ZMLeft"),$(document).off("mouseup.ZMLeft"),f.off("mouseleave.ZMLeft"),h.length&&(i&&(e.length||j.closest(".SC_fdrag").length?c.onDrop(a,b,g):d.closest(".zmL").length&&(d=d.closest(".zmL"),d.hasClass("SC_check")&&(d=d.parents(".SC_mclst").find(".zmL.SC_check")),b.onDrop(a,b.fromData,d,"center"))),i=!1)})))})},showDragHelper:function(b,c){var d,e;d=a.views.getDragHelperDom(),e=b,"next"===c&&(e=b.next()),e.hasClass("SC_fdrag")||(this.dragHelper&&this.dragHelper.remove(),e&&e.length?e.before(d):b.after(d),this.dragHelper=d)},removeDragHelper:function(){this.dragHelper&&(this.dragHelper.remove(),delete this.dragHelper)},showHoverOnRow:function(){this.el.removeClass("SC_nohvr")},stopHoverOnRow:function(){this.el.addClass("SC_nohvr")}},window.ZMLayer=a}(),window.ZMLayer=function(a){var b=a.views={};return b.getDragHelperDom=function(){var a=$('<div class="SC_fdrag"><span></span></div>');return a},b.getLeftRowsContainerDom=function(a){var b=$('<div class="SC_ldt">');return a&&a.id&&b.attr("id",a.id),a&&a.style&&b.attr("style",a.style),b},b.getLeftLayerContainerDom=function(a){var b=$('<div class="SC_lbx">');return a&&a.id&&b.attr("id",a.id),b},b.getTopLayerDom=function(a){var b=$('<div class="SC_tre"><div>');return a&&a.id&&b.attr("id",a.id),a&&a.title&&b.attr("title",a.title),b},b.getCountDom=function(a){var b=$('<span class="zm_txt"></span>');return a&&a.title&&b.attr("title",a.title),a.txtNodeClass&&b.addClass(a.txtNodeClass),b},b.listDom=function(a,c){var d,e,f,g,h="",i="",j="",k="",l=a.txtNodeClass,m="SC_thm";if("1"===c){a.count&&a.count>0&&(a.notBold||(h="SC_bld")),j=a.count,g=a.hideNode,k=a.rowTitle||_zm.escapeTags(a.name),j<0&&(j=0),j&&"0"!==j&&(k+=" ("+j+")"),d=b.getTopLayerDom({id:a.id,title:k});var n=$("<span>");a.hasChild&&(a.expChild?n.append('<i class="msi-rarrow msi-arrow45"></i>'):n.append('<i class="msi-rarrow"></i>')),e=b.getCountDom({txtNodeClass:l}),e.addClass(h),e.text(a.name),a.shared&&"-1"!==a.shared?n.append('<i class="msi-share"></i>'):a.addNewType&&(n.append('<i class="msi-plus '+m+'"></i>'),e.addClass(m)),d.append(n),d.append(e),j>99&&(j="99+"),j&&0!==parseInt(j)&&d.append('<div class="SC_ct"><b>'+j+"</b></div>"),g&&d.hide()}else if("2"===c)d=b.getTopLayerDom({id:a.id}),f=$('<div class="SClbl">'),f.css("background-color",a.color),e=b.getCountDom({title:a.name}),e.text(a.name),d.append(f),a.shared&&"-1"!==a.shared&&d.append('<i class="msi-share"></i>'),d.append(e);else if("3"===c){if(d=b.getTopLayerDom({id:a.id}),a.accessText){var o=$('<span class = "SperR">');o.text(a.accessText),d.append(o)}a.entityClass&&d.append("<i class='"+a.entityClass+"'/>");var p=$('<div class="SC_ct">');e=b.getCountDom({title:a.name}),p.append('<img src="https://contacts.zoho.com/file?t=user&ID='+a.OZUID+'&fs=stamp">'),e.text(a.name),d.append(p),d.append(e)}else"4"===c?(d=b.getTopLayerDom({id:a.id}),d.append('<i class="msi-workspace"></i>'),e=b.getCountDom({title:a.name}),e.text(a.name),d.append(e)):"5"===c&&(d=b.getTopLayerDom({id:a.id}),d.addClass("SC_cal"),"1"===a.check&&(i="msi-tick"),f=$('<div class="SClbl"><i class="'+i+'"></i></div>'),f.css("background-color",a.color),e=b.getCountDom({title:a.name}),e.text(a.name),d.append(f),d.append(e));return d},a}(window.ZMLayer),function(){function a(a){this.id=void 0,this.sortLayer=a&&a.sortLeft,this.layerArr=void 0,this.push()}function b(){this.id=void 0,this.el=void 0}var c=zmail.Core.Namespaces,d=c.get("zmState.leftStateInfo"),e={SELECTION:"Stre"};a.prototype={push:function(a){this.id="zm_lftree",this.sortLayer?this.layerArr=this.getSortedLayer(a):this.layerArr=a&&a.layerArr,this.el=window.zmLeft.views.getLeftTreeContainer({id:this.id})},getSortedLayer:function(a){var b=zmAdHocSettings.getLeftOrder();if(zmail.leftOrder=b.split(","),a&&a.layerArr)return _.sortBy(a.layerArr,function(a){var b=zmail.leftOrder.indexOf(a.id);return b>-1?b:100})},setListener:function(a,b){this.el.off(a).on(a,b)},resetDefaultSelection:function(){var a,b,c=this,d=zmsuite.getCurrentAppObjId(),f=zmsuite.getLeft(d),g=f.selLayerId,h=f.selId,i=c.el.find("."+e.SELECTION);i.length&&i.removeClass(e.SELECTION),a=this.getLayer(g),b=a.el.find("#"+h),b.addClass(e.SELECTION)},setTempSelection:function(a,b){var c,d=this,f=d.el.find("."+e.SELECTION),g=this.getLayer(a);g&&(c=g.el.find("#"+b),f.length&&c.length&&(f.removeClass(e.SELECTION),c.addClass(e.SELECTION)))},getLayer:function(a){var b,c;for(c=0;c<this.layerArr.length;c+=1)if(this.layerArr[c].id===a){b=this.layerArr[c];break}return b},getNextLayer:function(a){var b,c;for(c=0;c<this.layerArr.length;c+=1)if(this.layerArr[c].id===a&&c<this.layerArr.length-1){b=this.layerArr[c+1];break}return b},getPreviousLayer:function(a){var b,c;for(c=0;c<this.layerArr.length;c+=1)if(this.layerArr[c].id===a&&c>0){b=this.layerArr[c-1];break}return b},getLayerSeq:function(a){var b,c;for(c=0;c<this.layerArr.length;c+=1)if(this.layerArr[c].id===a){b=c;break}return b},getLayerClone:function(a){var b,c;for(c=0;c<this.layerArr.length;c+=1)if(this.layerArr[c].id===a){b=this.layerArr[c];break}var d=$.extend(!0,{},b);return d},setLayerArr:function(a){this.layerArr=a},replaceLayer:function(a,b){var c=b.constructLayer(),d=this.getLayerSeq(a);this.layerArr.splice(d,1,b),$("#"+a).replaceWith(c)},deleteLayer:function(a){var b=this.getLayerSeq(a);this.layerArr.splice(b,1),$("#"+a).remove()},appendLayer:function(a,b){var c=b.constructLayer();this.layerArr.push(b),$("#"+this.id).append(c)},prependLayer:function(a){var b=a.constructLayer();this.layerArr.splice(0,0,a),$("#"+this.id).prepend(b)},insertLayerBefore:function(a,b){var c=b.constructLayer();if(this.sortLayer)return void this.insertLayerAtSortedPosition(b);var d=this.getLayerSeq(a);this.layerArr.splice(d,0,b),$("#"+a).before(c)},insertLayerAfter:function(a,b){if(this.sortLayer)return void this.insertLayerAtSortedPosition(b);var c=b.constructLayer(),d=this.getLayerSeq(a);this.layerArr.splice(d+1,0,b),$("#"+a).after(c)},insertLayerAtSortedPosition:function(a){var b=a.constructLayer(),c=this.getLayerIdToInsert(a.id);if(c===-1)this.appendLayer(c,a);else if(0===c)this.prependLayer(a);else{var d=this.getLayerSeq(c);this.layerArr.splice(d+1,0,a),$("#"+c).after(b)}},insertLayerAt:function(a,b){},removeDragHelperFromLayers:function(){var a,b;for(b=this.layerArr.length,a=0;a<b;a+=1)this.layerArr[a].removeDragHelper()},getLayerIdToInsert:function(a){var b,c,d=zmail.leftOrder.indexOf(a);if(b=d,d>-1)for(c=0;c<d;c+=1)this.getLayer(zmail.leftOrder[c])&&(b=zmail.leftOrder[c]);return b}},b.prototype={init:function(){},setListener:function(a,b){this.el.off(a).on(a,b)},setId:function(a){this.id=a}};var f=function(a,b,c){var e=$(a).next(),f=c.getAppKey(),g=c.getNodes()[0].getLayer(b),h=g.avoidStateSave;e.is(":visible")?(e.slideUp("slow"),h||d.addEntry(f,b)):(e.slideDown("slow"),h||d.removeEntry(f,b))},g=function(a){return window===this?new g(a):(this.id="zm_mailLeft",this.leftAppKey=a.appKey||a.appId,this.top=void 0,this.center=void 0,this.bottom=void 0,this.sortLeftCenter=a&&a.sortLeftLayers,this.nodeArr=[],a.data.LNodes&&this.push(a.data.LNodes),this.selId=void 0,void(this.noSelClass=a.noLeftSel))};g.prototype={constructor:g,push:function(){this.nodeArr[0]=this.center=new a({sortLeft:this.sortLeftCenter}),this.nodeArr[1]=this.bottom=new b},getNodes:function(){return this.nodeArr},getAppKey:function(){return this.leftAppKey},setAppKey:function(a){this.leftAppKey=a},renderTop:function(){if($(".SClt").remove(),this.top){var a=this.top.construct();a&&$("#"+this.id).prepend(a)}},renderLayers:function(){var a=this.center.el;a.html("");var b,c=this.center,d=c.layerArr;for(b=0;b<d.length;b+=1){var e=d[b].constructLayer();a.append(e)}a.length&&$("#"+this.id).append(this.center.el)},updateRowSelection:function(){var a;a=$("#"+this.id),this.noSelClass?a.addClass("SC_nosel"):a.removeClass("SC_nosel")},render:function(){this.nodeArr.length&&($("#"+this.id).html(""),this.renderTop(),this.renderLayers(),zmail.isInternalOrgUser&&zmail.showFeature&&this.renderStaticHeader(),this.selId&&$("#"+this.selId).addClass("Stre")),this.updateRowSelection()},renderStaticHeader:function(){var a,b,c,d=document.getElementById("zmLeft-upstatic-header"),e=document.getElementById("zmLeft-btstatic-header"),f=document.getElementById(this.center.id),g=f.children;if(0!==g.length){var h=this;d?$(d).html(""):(d=_zm.getDOM(["DIV",{attrs:{id:"zmLeft-upstatic-header","class":"SClDup"}}]),document.body.appendChild(d)),e?$(e).html(""):(e=_zm.getDOM(["DIV",{attrs:{id:"zmLeft-btstatic-header","class":"SClDup",style:"bottom: 27px; top: auto;"}}]),document.body.appendChild(e));var i=function(){for($(d).html(""),$(e).html(""),a=0;a<g.length;++a)b=$(g[a].firstElementChild).clone(!0,!0),c=$(g[a].firstElementChild).clone(!0,!0),$(b).addClass("SC_dyn"),$(c).addClass("SC_dyn"),$(d).append(b),$(e).append(c)},j=function(c){c=c||f;var e=c.scrollTop,h=0,i=0;
for(a=0;a<g.length;++a){if(h=0,a>0){i=0;for(var j=0;j<a;++j)h+=g[j].offsetHeight,i+=g[j].firstElementChild.offsetHeight;h+=parseInt($(g[a]).css("padding-top"))-i}else h+=1;e>=h?(b=d.querySelector("#"+g[a].firstElementChild.id),b&&$(b).removeClass("SC_dyn")):e<=h&&(b=d.querySelector("#"+g[a].firstElementChild.id),b&&$(b).addClass("SC_dyn"))}},k=function(c){c=c||f;var d=c.scrollTop,h=0,i=0;for(a=0;a<g.length;++a){h=i=0;for(var j=0;j<a;++j)h+=g[j].offsetHeight;for(var k=a;k<g.length;++k)i+=g[k].firstElementChild.offsetHeight;var l=parseInt($(g[a]).css("padding-top"));h+l>=$(f).height()+d-i?(b=e.querySelector("#"+g[a].firstElementChild.id),b&&$(b).removeClass("SC_dyn")):h+l<=$(f).height()+d-i&&(b=e.querySelector("#"+g[a].firstElementChild.id),b&&$(b).addClass("SC_dyn"))}},l=function(a){var b=f;a&&(a.stopPropagation(),b=a.target),i(),j(b),k(b)},m=function(b){b.preventDefault(),b.stopPropagation();var c,d=b.type,e=b.target||b.srcElement;e=c=$(e);var i,j=2,k=["msi-rarrow","msi-arrow45"];for(i in k)if(k.hasOwnProperty(i)&&e.hasClass(k[i])){e.parent().removeClass("SC_bld"),j=1;break}e=e.closest(".SC_tre"),e.length||(e=c,e.closest(".SC_ct").length&&(j=3),e.hasClass("SC_ltl")||(e=e.parents(".SC_ltl")));var l={};l.zmsData=e.data("zmsData"),l.zmsData.type=d,l.zmsData.colInfo={column:j},l.zmsData.eventInfo=b,l.zmsData.prevSelectLayer=zmsuite.getAppLeft().selLayerId;var m,n,o,p=l.zmsData.rowInfo.layerId;if("click"===d&&1!==j){m=zmsuite&&zmsuite.getAppLeft(),n=m&&m.getNodes()&&m.getNodes()[0].getLayer(p),n||(m=zmsuite.getAppObj(zmsuite.getCurrentAppObjId()).left,n=m.getNodes()[0].getLayer(p));var q,r=n&&n.isHeaderSel||!1;if(q=$("#zm_mailLeft"),e.hasClass("SC_ltl"))if(r)n.disableSelection||(2===j&&(q.find(".SC_tre").removeClass("Stre"),q.find(".SC_ltl").removeClass("Stre"),e.addClass("Stre")),h.selId=e.attr("id"),h.selLayerId=p);else if(2===j){var s,t=0;for(a=0;a<g.length;++a)if(p===g[a].firstElementChild.id){for(s=0;s<a;++s)t+=g[s].offsetHeight;break}t-=15,$(f).animate({scrollTop:t+"px"},"slow"),$(f).find("#"+g[a].id).find(":nth-child(2)").css("display","")}else if(3===j){var u=$(b.target).closest("i").data("action");o=n.headerObject,"add"===u?o.onAdd&&o.onAdd(l):"settings"===u&&o.settingsObject&&o.settingsObject.onClick&&o.settingsObject.onClick(l)}}};l(),f.onscroll=l,d.onclick=m,e.onclick=m}},clear:function(){$("#"+this.id).html(""),this.top=void 0,this.center=void 0,this.bottom=void 0,this.nodeArr=[]},selRow:function(a,b,c){if(a&&($("#"+this.id).find("div.SC_tre").removeClass("Stre"),this.selId=a,$("#"+this.id).find("#"+a).addClass("Stre")),b&&(this.selLayerId=b),c){var d=$("#"+(a||b))[0];d&&d.scrollIntoView()}},getSelectedRowObj:function(){var a,b;return a=this.center.getLayer(this.selLayerId),a&&(b=a.getRowObj(this.selId)),b},setListener:function(a,b){var c=b,d=this;a&&("click"===a||"contextmenu"===a?$("#"+d.id).off(a).on(a,"div.SC_tre,div.SC_ltl",function(){return function(a){a.preventDefault(),a.stopPropagation();var b,e=a.type,g=a.target||a.srcElement;g=b=$(g);var h,i=2,j=["msi-rarrow","msi-arrow45"];for(h in j)if(j.hasOwnProperty(h)&&g.hasClass(j[h])){g.parent().removeClass("SC_bld"),i=1;break}g=g.closest(".SC_tre"),g.length||(g=b,g.closest(".SC_ct").length&&(i=3),g.hasClass("SC_ltl")||(g=g.parents(".SC_ltl")));var k={};k.zmsData=g.data("zmsData"),k.zmsData.type=e,k.zmsData.colInfo={column:i},k.zmsData.eventInfo=a,k.zmsData.prevSelectLayer=zmsuite.getAppLeft().selLayerId;var l,m,n,o=k.zmsData.rowInfo.layerId;if("click"===e&&1!==i){l=zmsuite&&zmsuite.getAppLeft(),m=l&&l.getNodes()&&l.getNodes()[0].getLayer(o),m||(l=zmsuite.getAppObj(zmsuite.getCurrentAppObjId()).left,m=l.getNodes()[0].getLayer(o));var p,q=m&&m.isHeaderSel||!1;if(p=$("#zm_mailLeft"),g.hasClass("SC_tre")&&!g.hasClass("SC_cal"))m.disableSelection||(p.find(".SC_tre").removeClass("Stre"),p.find(".SC_ltl").removeClass("Stre"),g.addClass("Stre"),g.find(".SC_ct.SC_new").removeClass("SC_new"),d.selId=g.attr("id"),d.selLayerId=o);else if(g.hasClass("SC_ltl")){if(q)m.disableSelection||(2===i&&(p.find(".SC_tre").removeClass("Stre"),p.find(".SC_ltl").removeClass("Stre"),g.addClass("Stre")),d.selId=g.attr("id"),d.selLayerId=o);else if(3===i){var r=$(a.target).closest("i").data("action");return n=m.headerObject,"add"===r?n.onAdd&&n.onAdd(k):"settings"===r&&n.settingsObject&&n.settingsObject.onClick&&n.settingsObject.onClick(k),!0}f(g,o,l)}}c(k)}}(c)):"mouseover"!==a&&"mouseout"!==a||this.getNodes()[0].el.on(a,c))}},window.zmLeft=g}(),window.zmLeft=function(a){var b=a.views={};return b.getLeftTreeContainer=function(a){this.el=$("<div class='SClm' id='"+this.id+"'></div>");var b=$('<div class="SClm">');return a&&a.id&&b.attr("id",a.id),b},a}(window.zmLeft),window.zmCenterListing=function(a){function b(a){a=a||{},this.listType=a.type,this.propertyMap=a.mapObj,this.classMap=a.classObj,this.data=a.dataObj}var c={};b.prototype={setDataObj:function(a){this.data=a},getHTML:function(a){a=a||"html";var b,d=c[this.listType];if("function"!=typeof d)throw new Error("HTMLGenerator not available for ListItem.Type="+this.listType);return b=d({returnType:a,propertyMap:this.propertyMap,classMap:this.classMap,data:this.data})}};var d=function(a){a=a||{};var b=a.type,d=a.generator;b&&"function"==typeof d&&(c[b]=d)},e=function(a,b,c,d){var e="";return b[d]&&("object"==typeof b[d]?b[d][c[a[d]]]&&(e=b[d][c[a[d]]]):e=b[d]),e},f=function(a){return new b(a)};return a=a||{},a.create=f,a.getMappedClass=e,a.registerListItemTemplate=d,a}(),window.zmTab=function(){var a,b,c=["zm_Container"],d=10,e=20,f=32,g=function(a){var b,c,d,e,f;f=zmsuite.getAppObj();for(e in f)e===a?c=f[e].centerObj.$el:(b=b?b.add(f[e].centerObj.$el):f[e].centerObj.$el,d=d?d.add(f[e].rightObj.$el):f[e].rightObj.$el);c.addClass("SC_show"),b&&b.removeClass("SC_show")},h=function(a,b){var c,d="";return b&&(d='<div class="zm_tbcls"><i class="msi-close"></i></div>'),c=$("<li><i class='"+a.appIcon+"'></i>"+d+"</li>"),zmComponent.tooltip({elm:c[0],text:a.appname,title:a.title,arrow:"right"}),c.click(a.clk),c},i=function(){var a;b||(b=$("<div class='SC_tab'><ul><li><i class='msi-rarrow'></i></li></ul></div>"),b.click(function(){var c,e,f=[],g={};for(e=zmTab.tabArr.length,c=d;c<e;c++)f.push({htm:"<i class='"+zmTab.tabArr[c].appIcon+"'></i><i class='msi-close'></i>",data:zmTab.tabArr[c]});a=f.length<2?"cright":"mright",g={par:b,list:f,align:a,clk:function(a,b,c){zmUtil.hideMenu(),a.clk(c)}},zmsuite.showMenu(g)}),$(".zm_tabs").append(b))},j=function(a){a.$el&&(a.$el.remove(),a.$el=null)},k=function(b){var c,e;e=zmTab.tabArr.length,e>d&&(i(),j(zmTab.tabArr[d])),c=h(b,!0),b.$el=c,a.append(c)},l=function(b){var c;c=h(b,!1),b.$el=c,a.children(":first").replaceWith(c)},m=function(b){var c,d;for(d=zmTab.tabArr.length,c=0;c<d;c++)if(zmTab.tabArr[c].appId===b){a.find("li").removeClass("sel"),zmTab.tabArr[c].$el&&zmTab.tabArr[c].$el.addClass("sel");break}},n=function(){zmTab.tabArr.length<=d+1&&b&&(b.remove(),b=null)},o=function(b){var c;c=zmTab.tabArr[b],c.$el&&(j(c),a.children().length<d&&zmTab.tabArr[a.children().length+1]&&k(zmTab.tabArr[a.children().length+1])),n()},p=function(a,b){return a.clk=function(a){return function(b){var c=b.target||b.srcElement;return $(c).closest(".zm_tbcls").length||$(c).closest(".msi-close").length?void zmsuite.closeWorkspace(a):(zmUtil.hideMenu(),void(zmTab.currentTab!==a&&zmsuite.showExistingApp(a)))}}(a.appId),a.appname=a.appname||"",a},q=function(a){c=_zm.pluck(c,a),c.push(a)},r=function(a){var b,c,e;for(c=zmTab.tabArr.length,b=0;b<c;b++)zmTab.tabArr[b].appId===a&&b>=d&&(e=zmTab.tabArr.splice(b,1)[0],zmTab.addTabLst(e))},s=function(){var b;return b=$(document).height()-a.offset().top,Math.floor(.7*b/f)},t=function(){d=s()},u=function(){var b=$(".zm_tabs").find(".SC_tab").eq(0);a=b.find("ul").eq(0)},v=function(){u(),t()},w={tabArr:[{id:"zm_Container",icon:"msi-mail"}],currentTab:"zm_Container",addTabLst:function(a){var b;return a=p(a),b=zmTab.tabArr.length,b<d?zmTab.tabArr.push(a):zmTab.tabArr.splice(d-1,0,a),k(a),!0},remTabLst:function(a,b){var d,e,f=zmTab.tabArr.length,g=!0;for(e=zmsuite.getAppObj(),d=0;d<f;d++)if(zmTab.tabArr[d].appId===a){if(0===d)return!1;zmTab.tabArr[d].onDelete&&(g=zmTab.tabArr[d].onDelete(a));break}if(g){o(d),zmTab.tabArr.splice(d,1),c=_zm.pluck(c,a),f=zmTab.tabArr.length,1===f&&($("#zm_tabAct").addClass("SC_vhide"),zmUtil.hideMenu()),b?zmsuite.showExistingApp(b):zmTab.currentTab===a&&zmsuite.showExistingApp(c[c.length-1]);for(d in e)d===a&&e[d].centerObj.$el.remove()}return g},showTab:function(a){var b=zmTab.currentTab;$.publish("/apps/tabSwitching",[b,a]),zmTab.currentTab=a,r(a),m(a),q(a),g(a),$.publish("/apps/tabSwitched",[a,b])},updateTabLst:function(a,b){b=b||{};var c,d,e,f,g=b.appId||a.appId;for(d=zmTab.tabArr.length,c=0;c<d;c++)zmTab.tabArr[c].appId===g&&(a=p(a),e=h(a,!0),f=zmTab.tabArr[c].$el,f&&(f.hasClass("sel")&&e.addClass("sel"),zmTab.tabArr[c].$el.replaceWith(e)),zmTab.tabArr[c]=a,zmTab.tabArr[c].$el=e)},isTabOpened:function(a){var b,c=zmTab.tabArr.length;for(b=0;b<c;b++)if(a===zmTab.tabArr[b].appId)return!0;return!1},getTabIndex:function(a){var b,c=zmTab.tabArr.length;for(b=0;b<c;b++)if(a===zmTab.tabArr[b].appId)return b;return-1},setTabForApp:function(a){a=p(a),c=_zm.pluck(c,zmTab.tabArr[0].appId),zmTab.tabArr[0]=a,l(a),q(zmTab.tabArr[0].appId)},getTabViewOrder:function(){return c},isMaxLimitReached:function(){return zmTab.tabArr.length>=e&&(Dialog.alert("Maximum tab limit reached"),!0)},getPreviousTabId:function(a){var b,c,d,e=zmTab.tabArr,f=e.length;if(a)for(d=0;d<f&&(c=e[d].appId,c!==a);d++)b=c;return b},getNextTabId:function(a){var b,c,d=zmTab.tabArr,e=d.length-1;if(a)for(;e>-1&&(c=d[e].appId,c!==a);e--)b=c;return b},getTabObject:function(a){return a=a||zmTab.currentTab,_.find(zmTab.tabArr,function(b){return b.appId===a})},getLowerExtraTabDOM:function(){return zmsuite.getTabDOM().find(".SC_exp")},init:v};return w}();var _createClass=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}();!function(){var a=zmail.Core.Namespaces,b=a.create("zmail.Suite"),c=function(){function a(b){_classCallCheck(this,a);var c=this;b=b||{},c._initialized=!1,c._hashKey=null,c._hashParams=null,c._handler=null,c._active=!1,c.initialize(b)}return _createClass(a,[{key:"initialize",value:function(a){var b=this;a=a||{},b._initialized||(a.hashKey=(a.hashKey||"").trim(),a.hashKey&&"function"==typeof a.handler&&(b._hashKey=a.hashKey,b._hashParams=[],b._handler=function(c,d){var e=a.handler.call(b,d);e=e||{};var f="updateParams";e[f]=!e.hasOwnProperty(f)||e[f];var g="handled";e[g]=!e.hasOwnProperty(g)||e[g];var h=e[f],i=e[g];return i&&h&&b.setParams(d),e},zmHash.register(b._hashKey,b._handler),b._initialized=!0,b.handleInitialHash()))}},{key:"uninitialize",value:function(){var a=this;a._initialized&&(a.deactivate(),zmHash.unregister(a._hashKey,a._handler),a._initialized=!1,a._hashKey=null,a._hashParams=null,a._handler=null)}},{key:"handleInitialHash",value:function(){var a=this,b=zmHash.decode();b.key===a._hashKey&&a._handler(b.key,b.params)}},{key:"activate",value:function(){var a=this;a._initialized&&(a._active=!0)}},{key:"deactivate",value:function(){var a=this;a._initialized&&(a._active=!1)}},{key:"update",value:function(a,b){var c=this;if(b=b||{},c._initialized){a=a||c._hashParams;var d=c.setParams(a);if(d){var e=a.join("/");b.appendSlash&&(e+="/"),c._active&&zmHash.setHash(c._hashKey,e,{trigger:!1})}}}},{key:"getParams",value:function(){var a=this;return a._initialized?a._hashParams:null}},{key:"setParams",value:function(a){var b=this;return!!b._initialized&&(!(!a||a.constructor!==Array)&&(b._hashParams=a,!0))}}]),a}();c.create=function(a){return new c(a)},b.RouteHelper=c}(),function(){var a=!1,b=!0,c={},d=$.Deferred();window.zmail.contactsLoadProcess=d.promise();var e=null,f=function(a){if(a&&a.v&&a.app&&"zm"===a.app){if(a.all)return!0;if(a.notzoid&&_.isArray(a.notzoid))return!(a.notzoid.indexOf([zmail.zoid].join(""))>-1);if(a.zuid&&_.isArray(a.zuid)&&a.zuid.indexOf(zmail.zuid)>-1)return!0;if(a.zoid&&_.isArray(a.zoid)&&a.zoid.indexOf([zmail.zoid].join(""))>-1)return!0;if(a.zgid&&_.isArray(a.zgid))for(var b=zmCont.getGroupOrder(),c=0;c<a.zgid.length;c++)if(b.indexOf(a.zgid[c])>-1)return!0}return!1},g=function(){if(zmail.mailOpt.dtNotify){var a=zmUtil.getDesktopNotificationPermission();1===a&&Notification.requestPermission()}},h=function(){zmail.windowVisibility=-1;var a,b;"undefined"!=typeof document.hidden?(a="hidden",b="visibilitychange"):"undefined"!=typeof document.mozHidden?(a="mozHidden",b="mozvisibilitychange"):"undefined"!=typeof document.msHidden?(a="msHidden",b="msvisibilitychange"):"undefined"!=typeof document.webkitHidden&&(a="webkitHidden",b="webkitvisibilitychange"),"undefined"==typeof document.addEventListener||"undefined"==typeof document[a]?window.console.log("Visibilty API not supported"):(zmail.windowVisibility=1,$(document).on(b,function(){document[a]?zmail.windowVisibility=0:zmail.windowVisibility=1}))},i=function(){$.subscribe("group/unread",function(a,b){zmUtil.streamUpdate(b)}),$.subscribe("zmail/SaveTabState",function(a,b){zmUtil.saveTabState(b)}),$.subscribe("SETTINGS_MAIL_VIEW",function(a,b){zmail.mailOpt.isPopup=b}),$.subscribe("SETTINGS_ASK_RECEIPT_ON_READ",function(a,b){zmail.mailOpt.askReceipt=b}),$.subscribe("SETTINGS_TIME_FORMAT",function(a,b){zmail.mailOpt.isRTime=b}),$.subscribe("CS_EDITOR_TYPE_CHANGED",function(a,b){zmail.mailOpt.compTab=b,1===b?zmail.allowInline=!1:zmail.allowInline=!0}),$.subscribe("CS_ENCODING_CHANGED",function(a,b){zmail.cmpdata.CHAR_SET=b}),$.subscribe("ncenter/watchReminder",function(a,b){var c=b.mailID;c&&zmList.getMailData({msgId:c,tId:c,opentype:2,type:"lt",src:"external"})}),$.subscribe("CS_FONT_FAMILY_CHANGED",function(a,b){zmail.mailOpt.ff=b}),$.subscribe("CS_FONT_SIZE_CHANGED",function(a,b){zmail.mailOpt.fs=b}),$.subscribe("CS_SENDING_DELAY_CHANGED",function(a,b){zmail.cmpdata.OUT_INTERVAL=b}),$.subscribe("CS_ASK_RECEIPT_CHANGED",function(a,b){zmail.cmpdata.ASKRECEIPT=b?1:0}),$.subscribe("SIGNATURE_ADDED",function(a,b){zmail.cmpdata.SIGN_INFO[b.id]={},zmail.cmpdata.SIGN_INFO[b.id].SIG_CONT=b.content,zmail.cmpdata.SIGN_INFO[b.id].SIG_TIT=b.name,zmail.cmpdata.SIGN_INFO[b.id].SIG_POS=b.position}),$.subscribe("SIGNATURE_UPDATED",function(a,b){zmail.cmpdata.SIGN_INFO&&zmail.cmpdata.SIGN_INFO[b.id]&&(zmail.cmpdata.SIGN_INFO[b.id].SIG_CONT=b.content,zmail.cmpdata.SIGN_INFO[b.id].SIG_TIT=b.name,zmail.cmpdata.SIGN_INFO[b.id].SIG_POS=b.position)}),$.subscribe("SIGNATURE_DELETED",function(a,b){b.id&&delete zmail.cmpdata.SIGN_INFO[b.id]}),$.subscribe("SIGNATURE_ASSOCIATED",function(a,b){var c;b.mailIds&&b.mailIds.length&&(c=b.mailIds[0],c&&zmail.cmpdata.FROM_LIST[c]&&(zmail.cmpdata.FROM_LIST[c].FRM_SIGID=b.id)),b.mailIdsWithNoSignature&&b.mailIdsWithNoSignature.length&&(c=b.mailIdsWithNoSignature[0],c&&zmail.cmpdata.FROM_LIST[c]&&(zmail.cmpdata.FROM_LIST[c].FRM_SIGID=null))})},j=function(){var a=$.Deferred(),b=window.zmAppLoader;if(!zmail._newSettings)return a.resolve().promise();var c=b.load("zm-settings-core"),d=b.load("zm-settings-mailsuite-appshell");return c.done(function(){var b=zmail.Settings.Platform.External;b.loadSettingsCore().always(function(){zmail.Settings.initializeSystem().done(a.resolve).fail(a.reject)})}).fail(function(){window.console.log("Settings Core Module - failed to load")}),d.fail(function(){window.console.log("Settings App Shell Module - failed to load")}),a.promise()},k=function(){"string"==typeof zmail.adhocUserSettings&&(zmail.adhocUserSettings=$.parseJSON(zmail.adhocUserSettings)),"string"==typeof zmail.adhocAccountSettings&&(zmail.adhocAccountSettings=$.parseJSON(zmail.adhocAccountSettings)),zmAdHocSettings.fetchFromObject(zmail.adhocUserSettings,zmail.adhocAccountSettings),delete zmail.adhocUserSettings,delete zmail.adhocAccountSettings},l=function(){zmail.postJsDeffered.done(function(){zmAppLoader.load("featureCard",{avoidCache:!0,forceLoad:!0}).done(function(){zmail.FeatureCard.init()})})},m=function(){zmState.init()},n=function(){zmail.staticUrls.docsJS="//"+zmail.jstatic+"/personal/"+zmail.docsStaticVersion+"/docscomponents/js/docscomponent_mail.js",zmail.staticUrls.docsCSS="//"+zmail.jstatic+"/personal/"+zmail.docsStaticVersion+"/docscomponents/css/lightgrey/docscomponent_mail.css"},o=function(){b=!0},p=function(){zmail.featVer=zmail.featVer||{};var a=zmail.featVer;a.mailCollab=a.mailCollab||"1",zmail.collabVersion=a.mailCollab},q=function(){var a=["(","ht","tp","s://",")|(","ht","tp","://",")"].join(""),b=new RegExp("^(/|"+a+").+$");$(zmail.win).resize(function(){zmInit.setHeight()}).click(function(a){var c=1===a.which||0===a.button;if(!c)return!0;var d,e,f,g,h,i=!1,j=a.target||a.srcElement,k=_zm.getLeftClickHandlers();for(f in k)d=k[f].attrName,e=zmUtil.regExpEscape(k[f].attrVal),g=new RegExp("^"+e+"$"),h=$(j).closest(k[f].tagName.toLowerCase()),h.length&&h[0].hasAttribute(d)&&g.test(h.attr(d))&&(i=!0,k[f].callback&&k[f].callback(h[0]));if(h){var l=h.length&&h[0].hasAttribute("href")&&b.test(h.attr("href"));i?a.preventDefault():(h=$(j).closest("a"),l&&h.attr("rel","noreferrer"))}}).mousedown(function(a){$.publish("ZMAIL_MOUSE_DOWN_EVENT",a),zmUtil.hideMenu(!0)})},r=function(){var a=function(a){if(a=a||{},a.trigger===!0)switch(a.hashKey){case"mail":break;case"task":zmApp.showApp("t");break;case"notes":zmApp.showApp("n");break;case"calendar":zmApp.showApp("c");break;case"contacts":zmApp.showApp("cn");break;case"links":zmApp.showApp("l");break;case"compose":zmUtil.requireComposeModule().done(function(){zmUtil.compose()});break;case"stream":zmAppLoader.load("streamsApp");break;case"attachview":zmsuite.loadAttachView();break;case"notifications":zmNCenter.tab();break;case"settings":zmail._newSettings?zmail.Settings.MailSuite.App.openApp():zmAppLoader.load("settings").then(function(){zmailSettings.init()});break;case"search":a.hashParams.length&&(zmSearch.updateSearchValues("m"),zmSearch.contextualSearch(a.hashParams[0]))}};$.subscribe("mailsuite/hashurl/changed",function(b,c){a(c)}),$.subscribe("mailsuite/hashurl/handleinitial",function(){var b=zmHash.decode();a({hashKey:b.key,hashParams:b.params,trigger:!0})})},s=function(){var a;e&&(e.key||zmail.fromOtherService?$.publish("mailsuite/hashurl/handleinitial"):(a=zmAdHocSettings.getLPageType(),"restore"!==a&&"specific"!==a||zmState.setStoredLandingPageData()),e=null)},t=function(){zmail._newSettings&&zmAppLoader.load("postLoadFilter")},u=function(){r(),s(),g(),t()},v=function(a,b,c,d){if("string"==typeof a)a=b+a;else{var e,f=a.length;for(e=0;e<f;e++)a[e]=b+a[e]}LazyLoad[c](a,d)},w=function(a,b,d,e){var f=zmail["post"+a][b]||[],g=[];_.isArray(f)||(f=[f]),_(f).each(function(a){!e&&a in c||g.push(a),c[a]=!0}),g.length?LazyLoad[a](g,d):d&&d()},x=function(a,b,c){zmInit.lzload("css",a,b,c)},y=function(a,b,c){zmInit.lzload("js",a,b,c)},z=function(){zmInit.cliHgt=$(zmail.win).height(),zmInit.cliWid=$(zmail.win).width()},A=function(a,b){return a.indexOf(b)!==-1&&(a=a.substring(b.length,a.length)),a},B={display:function(a,b){(_zm?_zm.succErrMsg:window.console.log)(a,b.msg)},success:function(a){zmInit.notificationBand.display("s",a)},failure:function(a){zmInit.notificationBand.display("e",a)}},C=function(){a=!0},D=function(c){a||b?(window.console.log('zmInit.serverUp, Going to publish "zmailReconnect" -'+new Date),a=!1,b=!1,setTimeout(o,5e3),$.publish("zmailReconnect",[c])):window.console.log("zmInit.serverUp, Ignoring serverUp --"+new Date)},E=function(a){var b;try{b=$.parseJSON(a.msg)}catch(c){window.console.error("Improper wms message")}f(b)&&zmAppLoader.load("updater",{forceLoad:!0,avoidCache:!0,staticVersion:b.v}).done(function(){b.type&&_updater.init([b.type].join(""),b.latVer)})},F=function(){var a=zmail.groupObj||zmCont.getGroup()||{},b=a.groups||a||{},c=["53821291","639791436"];c=c.filter(function(a){return!!b[a]}),c.length&&(zmail._newSettings=!0);var d=[],e=[zmail.zuid,""].join("");d.indexOf(e)!==-1&&(zmail._newSettings=!0);var f=[],g=[zmail.zoid,""].join("");f.indexOf(g)!==-1&&(zmail._newSettings=!0),zmail.isInternalOrgUser&&(zmail._newSettings=!0)},G=function(){zmail.devMode&&(zmail.debug=!0),$("body").addClass("zmDefaultMode"),zmsuite.init(),zmTab.init(),F(),zmail.logoutURL=zmail.logoutURL||"/biz/logout",zmWinTitle.init(),zmWinTitle.updateTitle(),k();var a=j();l(),m(),q(),n(),i(),h(),e=zmHash.decode(),zmail.showFeature&&"editor"===e.key&&(e.params.length&&(zmail.editorStatic=e.params[0]),e=null,zmHash.clearHash());var b=zmAppLoader.load("mail"),c=zmAppLoader.load("postLoad");a.done(function(){zmComponent.soundNotifier.initialize()}),$.when(a,b).done(function(){zmInit.initMailSuite()}),$.when(a,b,c).done(function(){zmail.postJsDeffered.resolve(),zmCont.loadContacts().done(function(){d.resolve()}),u()}),zmail.trialUsers&&zmail.showFeature&&zmAppLoader.load("search-impl").then(function(){zmail.Search.init()})};!function(){p(),zmail.postJsDeffered.done(function(){zmUtil.requireMailCollab().fail(function(){zmUtil.debugLog("Mail Collab - module load error")})})}();var H=window.zmInit||{},I={};window.zmInit=H,H.core=I,I.initMailSuite=G,H.nn6=document.getElementById&&!document.all,H.topelement=document.getElementById&&!document.all?"HTML":"BODY",H.cliHgt=0,H.cliWid=0,H.isIE=$.browser.msie===!0,H.uagent=navigator.userAgent,H.hashObj={},H.bindWindowEvents=q,H._constJS=v,H._lzload=w,H._loadcss=x,H._loadjs=y,H.setHeight=z,H.zmsubStr=A,H.notificationBand=B,H.serverDown=C,H.serverUp=D,H.handleServiceMessage=E}();