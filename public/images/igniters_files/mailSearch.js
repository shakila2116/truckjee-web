!function(){"use strict";var a=zmail.Core.Namespaces,b=a.create("zmailSearch.Core");b.i18n=zmText.get("search"),b.queryParam="";var c=function(){var a;return{get:{frameworkConfig:function(){return{appId:"zm_srch1",tooltip:"Search",tabInfo:{onDelete:function(){return zmailSearch.Model.beforeSearchTabClose(),!0},appname:"Search",appId:"zm_srch1",data:{CNodes:"3"},appIcon:"msi-search",noLeftSel:!1,shortcuts:zmshCut.mail,titleProvider:b.i18n.resultsHeader},overRideDefaultConfig:function(a){return zmailSearch.Core.overRideDefaultConfig(a)},onWorkSpaceConstruction:function(){zmailSearch.Core.onWorkspaceCreation(this)},workspace:function(){return a}}}},set:{workspace:function(b){a=b}}}}();b.cookSearchQuery=function(a){var b=zmailSearch.Utils.QueryBuilder.buildQuery(a);return b&&(zmailSearch.Core.setQueryParams(b),a.paginate||zmailSearch.Model.initSearchData(a,this.getFrameworkConfig())),b},b.generateView=function(a,b){zmailSearch.Core.initSearchResponse(a,b)},b.getFrameworkConfig=function(){return c.get.frameworkConfig.call(this)},b.onWorkspaceCreation=function(a){b.setWorkspace(a)},b.setWorkspace=function(a){c.set.workspace(a)},b.getWorkspace=function(){return c.get.workspace()},b.setQueryParams=function(a){zmailSearch.Core.queryParam=a},b.getQueryParams=function(){return zmailSearch.Core.queryParam},b.initSearchResponse=function(a,b){zmailSearch.Model.populateSearchData(a,b),a.paginate||(zmInit.setDisplayDensity(),zmUtil.sTopMenu({type:"l",iconsDiv:b.listingAction,listingType:zmailSearch.Utils.CommonUtils.getConversationViewType(),tabId:zmSearchUtil.getSearchTabId()}),zmailSearch.View.bindEvents(b))},b.hasPagination=function(){return!!zmailSearch.Model.hasPagination()},b.getPageSize=function(){return zmail.Search.Models.Contexts.mailSearchContext.pageSize},b.isWorkspaceAvailable=function(){return!!zmailSearch.Model.getSearchData()},b.setCenterListingListener=function(a){a.listingCenter.eventListeners=[{event:"click",callback:function(a,b){zmList.bindEventsMailRow(a,b)}},{event:"contextmenu",callback:function(a,b){zmList.mailUtility(a,b)}}]},b.setListingActionListener=function(a){a.listingAction.eventListeners=[{event:"click",callback:function(a,b){"msi-close"===b?zmsuite.closeWorkspace(zmailSearch.Model.getSearchData().tabInfo.appId):zmInit.bindActionHeaderIcons(a,b)}}]},b.setListingHeaderListener=function(a){a.listingHeader.eventListeners=[{event:"click",callback:function(a,b){zmailSearch.Core.saveSearch(a,b)}}]},b.setPreviewHeaderListner=function(a){a.previewHeader.eventListeners=[{event:"click",callback:function(a,b){zmList.bindAction(a,b)}}]},b.setEventListeners=function(a){zmailSearch.Core.setListingHeaderListener(a),zmailSearch.Core.setListingActionListener(a),zmailSearch.Core.setCenterListingListener(a),zmailSearch.Core.setPreviewHeaderListner(a)},b.overRideDefaultConfig=function(a){return zmailSearch.View.setHeaderActionObj(a),zmailSearch.Core.setEventListeners(a),a},b.saveSearch=function(a,b){"savesearch"===b&&(b="save search")},b.isMailListedInSearch=function(a){var b,c=zmSearchUtil.getSearchList();return b=c.indexOf(a),b!==-1}}(),function(){"use strict";var a=zmail.Core.Namespaces,b=a.create("zmailSearch.Actions");b.markAsRead=function(a,b){b.rowElem.length&&(b.rowElem.removeClass("zm_urd"),b.previewContentElem.find("#zmHdrS"+a+" .zmPT").removeClass("zm_urd"))},b.markAsUnread=function(a,b){b.rowElem.length&&(b.rowElem.addClass("zm_urd"),b.previewContentElem.find("#zmHdrS"+a+" .zmPT").addClass("zm_urd"))},b.applyFlag=function(a,b,c){if(b.rowElem.length){var d=c.flagVal,e=zmInit.flgClass(d);b.rowElem.find(".zmflg").removeClass().addClass(e),b.previewContentElem.find("#zmHdrS"+a+" .zmflg").removeClass().addClass(e)}},b.applyTag=function(){},b.markAsSpam=function(a){zmailSearch.View.removeRowElem(a),zmailSearch.Model.deleteMessageFromList(a),zmailSearch.Model.deleteMessageContent(a),zmailSearch.View.closePreview(a)},b.markAsNotSpam=function(a){zmailSearch.View.removeRowElem(a),zmailSearch.Model.deleteMessageFromList(a),zmailSearch.View.closePreview(a)},b.archiveMail=function(a,b){if(b.rowElem.length){b.rowElem.addClass("zmarch");var c=zmailSearch.Utils.CommonUtils.getFolderNameOfMsg(a);zmailSearch.View.updateFolderName(a,b,c)}},b.unarchiveMail=function(a,b){if(b.rowElem.length){b.rowElem.removeClass("zmarch");var c=zmailSearch.Utils.CommonUtils.getFolderNameOfMsg(a);zmailSearch.View.updateFolderName(a,b,c)}},b.deleteMail=function(a){zmailSearch.View.removeRowElem(a),zmailSearch.Model.deleteMessageFromList(a),zmailSearch.View.closePreview(a)},b.moveMail=function(a,b,c){if(b.rowElem.length){var d=zmailSearch.Utils.CommonUtils.getFolderName(c);zmailSearch.View.updateFolderName(a,b,d)}}}(),function(){"use strict";var a=zmail.Core.Namespaces,b=a.create("zmailSearch.Utils.QueryBuilder"),c="folder",d="tag",e={Subject:{lhs:"Subject"},Sender:{lhs:"Sender"},"To/Cc":{lhs:"to/cc"},To:{lhs:"to"},Cc:{lhs:"cc"},"Email Content":{lhs:"Content"},"Attachment Name":{lhs:"Attachment Name"},"Attachment Content":{lhs:"Attachment Content"},"Entire Message":{lhs:"entire message"},Has:{lhs:"entire message"}},f={"Has Attachment":{flagName:"hasAtt",value:"1/0"},"Has Flag":{flagName:"hasFlg",value:"1/0"},unread:{flagName:"unread",value:"1/0"},"Has Reply":{flagName:"resp",value:"1/0"},Conversations:{flagName:"thd",value:"1/0"}},g=function(a){var b,c,d,e,f="",g="",h="";for(c=a.length,b=0;b<c;b++)d=a[b],g=zmailSearch.Utils.CommonUtils.escapeSpecialChars(d.value),e=d.lhs,h=d.contains?" = ":" != ","to/cc"===e.toLowerCase()?" = "===h?f+="( To"+h+g+" ||Cc"+h+g+" )":" != "===h&&(f+="To"+h+g+" && Cc"+h+g):f+="entire message"===e.toLowerCase()?"Entire"+h+g:e+h+g,b!==c-1&&(f+=" && ");return f},h=function(a){var b={0:"-Jan-",1:"-Feb-",2:"-Mar-",3:"-Apr-",4:"-May-",5:"-Jun-",6:"-Jul-",7:"-Aug-",8:"-Sep-",9:"-Oct-",10:"-Nov-",11:"-Dec-"},c=a.getDate()+b[a.getMonth()]+a.getFullYear();return c},i=function(a){var b={},c=["from-date","to-date","date"];return _(a).each(function(a){if(c.indexOf(a.name)!==-1)switch(a.name){case"from-date":b.fDate=h(a.actualValue);break;case"to-date":b.eDate=h(a.actualValue);break;case"date":b.fDate=h(a.actualValue),b.eDate=b.fDate}}),b.fDate&&b.eDate?b:{}},j=function(a){var b=[];if(_(a).each(function(a){a.name===c&&b.push(a.actualValue.id)}),b.length)return{folId:b}},k=function(a){var b=[];if(_(a).each(function(a){a.name===d&&b.push(a.actualValue.id)}),b.length)return{labId:b}},l=function(a){var b={};return _(a).each(function(a){a.name in f&&(b[f[a.name].flagName]=a.actualValue.value)}),b},m=function(a){var b=[];return _(a).each(function(a){a.name in e&&b.push({lhs:e[a.name].lhs,value:a.value,contains:!0})}),{SearchStr:encodeURIComponent(g(b))}};b.buildQuery=function(a){var b=a.data,c={accId:zmail.accId,thdView:!1,from:1};return c.to=zmail.Search.Models.Contexts.mailSearchContext.pageSize,a.paginate&&(c.from=zmailSearch.Model.getStartIndexforNextPage(),c.lastRT=zmailSearch.Model.getLastRetrievalTime(),c.lastM=zmailSearch.Model.getLastMessageId()),c=_.extend(c,l(b),m(b),j(b),k(b),i(b)),c.SearchStr?c:""}}(),function(){"use strict";var a=zmail.Core.Namespaces,b=a.create("zmailSearch.View");b.i18n=zmText.get("search");var c=function(a){var b,c;return c=zmInit.constructMailRow("",[a]),b=$(c)};b.setHeaderActionObj=function(a){a.listingHeader.obj.left={leftHTML:b.i18n.mail.resultsHeader},a.listingAction.obj.left=[{groupId:"view",actionArr:[{iconList:["msi-uncheck","msi-barrow"],dropAction:!0}]},{groupId:"MoveLabel",actionArr:[{iconList:["msi-folder"],dropAction:!0,tooltip:"tooltipText.moveTo"},{iconList:["msi-label"],dropAction:!0,tooltip:"tooltipText.label"}]},{groupId:"spamTrash",actionArr:[{iconList:["msi-trash"],tooltip:"tooltipText.delete"},{iconList:["msi-spam"],tooltip:"tooltipText.spam"},{iconList:["msi-notspam"],tooltip:"tooltipText.notSpam"}]},{groupId:"Archive",actionArr:[{iconList:["msi-archive"],tooltip:"tooltipText.archive"}]},{groupId:"action",actionArr:[{iconList:["msi-action"],dropAction:!0}]}],a.listingAction.obj.right=[{actionArr:[{iconList:["msi-classic"],dropAction:!0,tooltip:"tooltipText.changeView"},{iconList:["msi-close"],tooltip:"tooltipText.closeTab"}]}],a.listingCenter={eventListeners:[]}},b.generateListView=function(a,b){void 0===a&&(a=0);var d=zmailSearch.Model.getSearchData().searchList,e=0,f=zmailSearch.Model.getSearchData().elemObj.listingContentElem;b=b||d.length;var g=document.createDocumentFragment();for(e=a;e<b;e++)g.appendChild(c(d[e])[0]);0===a&&(f.html(""),f.scrollTop(0),0===b&&this.setEmptyListing()),f.append(g)},b.setEmptyListing=function(){var a=zmailSearch.Model.getSearchData().elemObj.listingContentElem,b=zmailSearch.Model.getSearchData().searchList;0===b.length&&a.html(zmInit.emptyRow(this.i18n.mail.emptyResults))},b.removeListingContent=function(){if(zmailSearch.Model.getSearchData()&&zmailSearch.Model.getSearchData().elemObj){var a=zmailSearch.Model.getSearchData().elemObj.listingContentElem;a.html("")}},b.bindEvents=function(a){this.subcribeEvents(a)},b.subcribeEvents=function(){$.subscribe("mail/read",b.updateRowRead),$.subscribe("mail/unread",b.updateRowUnread),$.subscribe("mail/flag",b.updateFlagRow),$.subscribe("mail/delete",b.updateRowDelete),$.subscribe("mail/label",b.updateLabelRow),$.subscribe("mail/move",b.updateRowMove),$.subscribe("mail/archive",b.updateRowArchive),$.subscribe("mail/unarchive",b.updateRowUnarchive),$.subscribe("mail/spam",b.updateRowSpam),$.subscribe("mail/notspam",b.updateRowNotspam)},b.unsubscribeEvents=function(){$.unsubscribe("mail/read",b.updateRowRead),$.unsubscribe("mail/unread",b.updateRowUnread),$.unsubscribe("mail/flag",b.updateFlagRow),$.unsubscribe("mail/delete",b.updateRowDelete),$.unsubscribe("mail/label",b.updateLabelRow),$.unsubscribe("mail/move",b.updateRowMove),$.unsubscribe("mail/archive",b.updateRowArchive),$.unsubscribe("mail/unarchive",b.updateRowUnarchive),$.unsubscribe("mail/spam",b.updateRowSpam),$.unsubscribe("mail/notspam",b.updateRowNotspam)},b.updateRowRead=function(a,b){if(zmList.isMailListedInSearch(b)){var c=zmailSearch.Utils.CommonUtils.getMsgRowElemObj(b);zmailSearch.Actions.markAsRead(b,c)}},b.updateRowUnread=function(a,b){if(zmList.isMailListedInSearch(b)){var c=zmailSearch.Utils.CommonUtils.getMsgRowElemObj(b);zmailSearch.Actions.markAsUnread(b,c)}},b.updateFlagRow=function(a,b,c,d){if(zmList.isMailListedInSearch(b)){var e=zmailSearch.Utils.CommonUtils.getMsgRowElemObj(b);zmailSearch.Actions.applyFlag(b,e,{flagVal:d})}},b.updateRowDelete=function(a,b){zmList.isMailListedInSearch(b)&&zmailSearch.Actions.deleteMail(b)},b.updateLabelRow=function(a,b,c,d){if(zmList.isMailListedInSearch(b)){var e=zmailSearch.Utils.CommonUtils.getMsgRowElemObj(b);zmailSearch.Actions.applyTag(b,e,d)}},b.updateRowMove=function(a,b,c,d){if(zmList.isMailListedInSearch(b)){var e=zmailSearch.Utils.CommonUtils.getMsgRowElemObj(b);zmailSearch.Actions.moveMail(b,e,d.folId)}},b.updateRowArchive=function(a,b){if(zmList.isMailListedInSearch(b)){var c=zmailSearch.Utils.CommonUtils.getMsgRowElemObj(b);zmailSearch.Actions.archiveMail(b,c)}},b.updateRowUnarchive=function(a,b){if(zmList.isMailListedInSearch(b)){var c=zmailSearch.Utils.CommonUtils.getMsgRowElemObj(b);zmailSearch.Actions.unarchiveMail(b,c)}},b.updateRowSpam=function(a,b){zmList.isMailListedInSearch(b)&&zmailSearch.Actions.markAsSpam(b)},b.updateRowNotspam=function(a,b){zmList.isMailListedInSearch(b)&&zmailSearch.Actions.markAsNotSpam(b)},b.removeRowElem=function(a){if(zmList.isMailListedInSearch(a)){var b=zmailSearch.Utils.CommonUtils.getMsgRowElemObj(a);b.rowElem.remove()}},b.updateFolderName=function(a,b,c){if(b.rowElem.length&&b.rowElem.find(".zmFdr span").html(c),b.previewContentElem.length){var d=b.previewContentElem.find("[data-mid="+a+"]");d.find(".zm_folname").html(c)}},b.closePreview=function(a){if(zmailSearch.Core.isWorkspaceAvailable()){var b=zmailSearch.Utils.CommonUtils.getSearchTabId();if(a){var c=zmPrev.prevDetails(b);c.msgId===a&&zmPrev.clsPreview(b)}else zmPrev.clsPreview(b)}}}(),function(){"use strict";var a,b=zmail.Core.Namespaces,c=b.create("zmailSearch.Model");c.i18n=zmText.get("search");var d=function(a,b){this.initSearchTabInfo(b),this.initSearchReqData(),this.initSearchResult(a.response)};d.prototype={initSearchTabInfo:function(a){this.tabInfo=a.tabInfo},initSearchReqData:function(){this.requestParams=zmailSearch.Core.getQueryParams()},initSearchResult:function(a){a=a||[],a.length?this.addSearchList(a[1]):(this.searchList=[],this.from=1,this.to=zmailSearch.Core.getPageSize(),this.hasNextPage="",this.lastRT="",this.lastMsgId="")},initSearchElemObj:function(a){this.elemObj={centerContainerElem:a.listing.$el,listingHeaderElem:a.listingHeader.$el,listingActionElem:a.listingAction.$el,listingContentElem:a.listingCenter.$el,prevContainerElem:a.preview.$el,previewHeaderElem:a.previewHeader.$el,previewContentElem:a.previewContent.$el,viewDetails:{fId:"",view:"search",flag:"",label:"",attach:""}}},initSearchResponse:function(a){this.initSearchResult(a.response)},addSearchList:function(a){var b,c,d,e,f,g=a.length;e=zmCache.dolistObj(null,a),d=e.MO,f=a[g-1].stateinfo,this.setHasPagination(parseInt(f[13])),this.hasNextPage&&a[g-1].lastRT&&(this.setLastRetrievalTime(a[g-1].lastRT),this.setLastMessageId(a[g-2].M)),this.searchList.length?(b=this.searchList.length,this.searchList=this.searchList.concat(d)):(b=0,this.searchList=d),c=this.searchList.length,this.from=c+1,zmailSearch.View.generateListView(b,c)},setHasPagination:function(a){this.hasNextPage=a},setLastRetrievalTime:function(a){this.lastRT=a},setLastMessageId:function(a){this.lastMsgId=a}},c.initSearchData=function(b,c){a&&this.resetSearchData(c),a=new d(b,c)},c.populateSearchData=function(a,b){0===this.getSearchData().searchList.length&&this.getSearchData().initSearchElemObj(b),this.getSearchData().initSearchResponse(a)},c.getSearchData=function(){return a},c.getStartIndexforNextPage=function(){return this.getSearchData().from||1},c.getLastRetrievalTime=function(){return this.getSearchData().lastRT},c.getLastMessageId=function(){return this.getSearchData().lastMsgId},c.hasPagination=function(){return this.getSearchData().hasNextPage||!1},c.resetSearchData=function(){zmailSearch.View.closePreview(),zmailSearch.View.removeListingContent(),zmCache.clearSearchList(),zmCenterListing.mailObjectAPI.dropViewObjectStore(this.getSearchData().tabInfo.appId),a=void 0},c.deleteMessageFromList=function(a){var b=this.getSearchList(),c=b.indexOf(a);c!==-1&&b.splice(c,1)},c.deleteMessageContent=function(a){zmail.mailContainer.removeObject(a)},c.beforeSearchTabClose=function(){this.resetSearchData(),zmailSearch.View.unsubscribeEvents()},c.getSearchList=function(){return this.getSearchData().searchList}}(),function(){"use strict";var a=zmail.Core.Namespaces,b=a.create("zmailSearch.Utils.CommonUtils"),c=zmText.get("mail").preview;b.escapeSpecialChars=function(a){return a.indexOf("=")!==-1&&a.indexOf("\\=")===-1&&(a=a.replace(/[=]/gi,"\\=")),a.indexOf("!")!==-1&&a.indexOf("\\!")===-1&&(a=a.replace(/!/gi,"\\!")),a.indexOf("&")!==-1&&a.indexOf("\\&")===-1&&(a=a.replace(/&/gi,"\\&")),a.indexOf("|")!==-1&&a.indexOf("\\|")===-1&&(a=a.replace(/\|/gi,"\\|")),a.indexOf('"')!==-1&&a.indexOf('\\"')===-1&&(a=a.replace(/"/gi,'\\"')),a.indexOf("(")!==-1&&a.indexOf("\\(")===-1&&(a=a.replace(/\(/gi,"\\(")),a.indexOf(")")!==-1&&a.indexOf("\\)")===-1&&(a=a.replace(/\)/gi,"\\)")),a.indexOf("<")!==-1&&a.indexOf("\\<)")===-1&&(a=a.replace(/[<]/gi,"\\<")),a.indexOf(">")!==-1&&a.indexOf("\\>)")===-1&&(a=a.replace(/[>]/gi,"\\>")),a.indexOf("'")!==-1&&a.indexOf("\\')")===-1&&(a=a.replace(/'/gi,"\\'")),a.indexOf(" ")===-1&&a.indexOf(",")===-1||(a="( "+a+" )"),a},b.getMsgRowElemObj=function(a){var b=$.extend({},zmailSearch.Model.getSearchData().elemObj),c=zmCenterListing.mailObjectAPI.getViewObject(a,b.viewDetails.view),d=c&&c.$el||[];return d.length||(d=b.listingContentElem.find("#"+a)),b.rowElem=d||[],b},b.getSearchTabId=function(){return zmailSearch.Model.getSearchData().tabInfo.appId},b.getSearchViewDetails=function(){return zmailSearch.Model.getSearchData().elemObj?zmailSearch.Model.getSearchData().elemObj.viewDetails:{}},b.getFolderNameOfMsg=function(a){var b=zmailSearch.Utils.CommonUtils.getFolderIdOfMsg(a),d=zmInit.findFolName(b);return zmail.mailObj[a]&&zmail.mailObj[a].AR&&(d=d+" ("+c.contentOptions.archived+")"),d},b.getFolderName=function(a){return zmInit.findFolName(a)},b.getFolderIdOfMsg=function(a){if(a&&zmail.mailObj[a])return zmail.mailObj[a].FD||""},b.getConversationViewType=function(){return 0}}(),window.zmSearchUtil=function(){"use strict";var a={isNewSearch:function(){return!(!zmail.showFeature||!zmail.trialUsers)},getSearchString:function(){var a;return zmSearchUtil.isWorkspaceAvailable()&&(a=zmSearchUtil.isNewSearch()?zmailSearch.Model.getSearchData().requestParams.SearchStr:zmail.searchObj[1].collection.searchContArr[0]||zmail.searchObj[1].collection.advSearchStr),a||""},getRequestParams:function(){var a;return zmSearchUtil.isWorkspaceAvailable()&&(a=zmSearchUtil.isNewSearch()?zmailSearch.Model.getSearchData().requestParams:zmail.searchObj[1].collection.getCurrentParams()),a||{}},isWorkspaceAvailable:function(){if(zmSearchUtil.isNewSearch()){if(zmailSearch.Core.isWorkspaceAvailable())return!0}else if(zmsuite.isWorkspaceAvailable("zm_srch1")&&zmail.searchObj[1]&&"m"===_zm.getProperty(zmail.searchObj[1],"elemObj.appType"))return!0;return!1},getSearchList:function(){var a=[];return zmSearchUtil.isWorkspaceAvailable()&&(a=zmSearchUtil.isNewSearch()?zmailSearch.Model.getSearchList():zmail.searchObj[1].collection.searchList),a||[]},getSearchElemObj:function(){},getSearchedFolders:function(){var a=[];return zmSearchUtil.isWorkspaceAvailable()&&(a=zmSearchUtil.isNewSearch()?zmailSearch.Model.getSearchData().requestParams.folId:zmail.searchObj[1].collection.folderArr),a||[]},getSearchViewDetails:function(){var a;return zmSearchUtil.isWorkspaceAvailable()&&(a=zmSearchUtil.isNewSearch()?zmailSearch.Utils.CommonUtils.getSearchViewDetails():zmsuite.getCenterOuter().$el.data("data-detail")),a||{view:"search"}},getSearchTabId:function(){var a="";return zmSearchUtil.isWorkspaceAvailable()&&(a=zmSearchUtil.isNewSearch()?zmailSearch.Utils.CommonUtils.getSearchTabId():"zm_srch1"),a},hasNextPage:function(){var a=!1;return zmSearchUtil.isWorkspaceAvailable()&&(a=zmSearchUtil.isNewSearch()?zmailSearch.Model.hasPagination():zmail.searchObj[1].collection.hasNext),a},getPageSize:function(){var a="";return zmSearchUtil.isWorkspaceAvailable()&&(a=zmSearchUtil.isNewSearch()?zmailSearch.Core.getPageSize():zmail.searchObj[1].collection.limit),a},getSearchAppType:function(){var a="";return zmSearchUtil.isWorkspaceAvailable()&&(a=zmSearchUtil.isNewSearch()?"m":zmSearch.getSearchAppType()),a}};return a}();