!function(){"use strict";var a,b,c=!1,d=function(){if(zmsuite.isWorkspaceAvailable("zm_Container")){var a=zmsuite.getAppObj("zm_Container");zmTab.setTabForApp(a.obj),zmsuite.showApp("zm_Container"),zmsuite.getLeft().setListener("click",function(a){zmInit.bindLeftActions(a)}),zmsuite.getLeft().setListener("contextmenu",function(a){zmInit.bindLeftActions(a)}),_zm.is_typesafari&&(zmsuite.getLeft().setListener("mouseover",function(){$(this).addClass("SC_oya")}),zmsuite.getLeft().setListener("mouseout",function(){$(this).removeClass("SC_oya")})),zmsuite.getLeft().getNodes()[0].getLayer("zmlTreeH").setChildToggle(zmInit.viewChild)}else zmInit.initMailSuite()},e=function(){if(zmsuite.isWorkspaceAvailable("zm_notes")){var a=zmsuite.getAppObj("zm_notes");zmTab.setTabForApp(a.obj),zmsuite.showApp("zm_notes"),znNote.hideRgt(),zmsuite.getLeft().setListener("click",znNote.znLeftClbk),zmsuite.getLeft().setListener("contextmenu",znNote.znLeftClbk),zmsuite.getLeft().getNodes()[0].getLayer("ngroups").setChildToggle(function(a,b,c){var d;if(a&&a.zmsData)for(var e in a.zmsData.rowObject)d=a.zmsData.rowObject[e];else d=a;d.E=c?1:0}),zmsuite.getLeft().getNodes()[0].getLayer("nviews").setChildToggle(function(a,b,c){var d;if(a&&a.zmsData)for(var e in a.zmsData.rowObject)d=a.zmsData.rowObject[e];else d=a;d.E=c?1:0})}else zmAppLoader.load("notes").done(function(){zmCont.isGroupLoaded(znNote.notesLoad)})},f=function(){zmsuite.isWorkspaceAvailable("zm_task")?zmTask.init():zmAppLoader.load("task").done(function(){zmTask.init()})},g=function(){zmsuite.isWorkspaceAvailable("zm_links")?zmLink.init():zmAppLoader.load("links").done(function(){zmCont.isGroupLoaded(zmLink.init)})},h=function(){var b;if(b=$.Deferred(),a)b.resolve(a);else{var c=function(){_zm.succErrMsg("e",zmText.get("appsframework","calendarError")),b.reject()};zmAjq.XHR({u:"/mail/ncal/loadjs.do",t:"GET",fn:function(a){b.resolve(a)},onerror:c})}return b},i=function(){var b;return b=$.Deferred(),$.when(h()).then(function(c){a=c,b.resolve()}),b},j=function(b){if(zmail.extAppsDeferred.calendar[b])return zmail.extAppsDeferred.calendar[b].promise();var c=$.Deferred();return $.when(i()).then(function(){var d,e;d=a.jsPath||zmail.urls.calURL,e=a.cssPath||zmail.urls.calURL,a[b].css&&zmAppLoader.constJS(a[b].css,"//"+e,"css"),zmAppLoader.constJS(a[b].js,"//"+d,"js").done(function(){c.resolve()})}),zmail.extAppsDeferred.calendar[b]=c,c.promise()},k=function(){$.when(h()).then(function(a){var b=a.cssPath||zmail.urls.calURL;a.calendar.css&&zmAppLoader.constJS(a.calendar.css,"//"+b,"css")})},l=function(){var a;if(a=$.Deferred(),b)a.resolve(b);else{var c="/zm/zc/new/jsp/loaded.jsp";zmAjq.XHR({u:c,t:"GET",fn:function(b){a.resolve(b)},xhr:!1})}return a},m=function(){var a;return a=$.Deferred(),$.when(l()).then(function(c){b=c,a.resolve()}),a},n=function(a){if(zmail.extAppsDeferred.contacts[a])return zmail.extAppsDeferred.contacts[a].promise();var c=$.Deferred();return $.when(m()).then(function(){var d,e;d=b.jsPath,e=b.cssPath,b[a].css&&zmAppLoader.constJS(b[a].css,e,"css"),zmAppLoader.constJS(b[a].js,d,"js").done(function(){$.publish("contacts/metaDataLoaded",{data:b.metaJson}),c.resolve()})}),zmail.extAppsDeferred.contacts[a]=c,c.promise()},o=function(a){j("streamEvent").done(function(){"function"==typeof a&&a()})},p=function(a,b){j("calendar").done(function(){$.publish(a,[b])})},q=function(a){c?a&&$.publish(a):n("contacts").done(function(){c=!0,a&&$.publish(a)})},r=function(){j("picker"),q()},s=function(){$.when(zmail.postJsDeffered).then(function(){zmail.extAppsDeferred={},zmail.extAppsDeferred.contacts={},zmail.extAppsDeferred.calendar={},zmApp.loadPicker()})},t={selectionClass:"SC_mailApp",currentApp:"m",selectApp:function(a){if(a&&!zmail.fromOtherService)switch(a){case"m":zmail.accId===zmail.defAccId?zmail.appList.appObj.mail.selectApp():zmail.appList.accListObj[zmail.accId]&&zmail.appList.accListObj[zmail.accId].selectAccount();break;case"n":zmail.appList.appObj.notes.selectApp();break;case"t":zmail.appList.appObj.task.selectApp();break;case"c":zmail.appList.appObj.cal.selectApp();break;case"cn":zmail.appList.appObj.contacts.selectApp();break;case"l":zmail.appList.appObj.links.selectApp()}},showApp:function(a){zmUtil.hideMenu();var b=zmText.get("appsframework","createText"),c="SC_mailApp";zmApp.selectedApp=a,"m"===a?(b=zmText.get("appsframework","composeText"),d()):"n"===a?(b=zmText.get("appsframework","createNote"),e(),c="SC_noteApp"):"t"===a?(b=zmText.get("appsframework","createTask"),f(),c="SC_taskApp"):"c"===a?(b=zmText.get("appsframework","createEvent"),p("/calendar/load"),c="SC_calApp"):"cn"===a?(b=zmText.get("appsframework","createContact"),q("/contacts/load"),c="SC_contApp"):"l"===a&&(b=zmText.get("appsframework","createLink"),g(),c="SC_linkApp"),zmApp.selectApp(a),$(".zm_comp span").eq(0).text(b),$("body").removeClass(t.selectionClass).addClass(c),t.selectionClass=c,zmApp.currentApp=a},loadCalendar:p,loadCalendarJS:i,loadPicker:r,loadStreamEvent:o,loadCalendarCSS:k};s(),window.zmApp=window.zmApp||{},$.extend(window.zmApp,t)}();