!function(a){"use strict";var b=zmText.get("attachmentUtility");return a.templates=a.templates||{},$.extend(a.templates,{leftHeader:function(a,b){return"<b id='"+a+"'>"+b+"</b>"},cloudAttachTemplate:['<div class="SC_Pop SC_cent SC_add wht" id="zmAddToCloudPopup">','<div class="SC_pe">','<div class="SC_PU" style="max-width:1000px;">','<div class="SC_PUcen">','<div class="SCmc SC_attachviewer">','<div class="SC_mhd">','<div class="SC_flt">','<span class="SC_mtb"><b id="zmAddToZDocs" class="sel">'+b.cloudServiceName.zDocs+'</b><b id="addToOtherCloud">'+b.cloudServiceName.otherCloud+"</b></span>","</div>","</div>",'<div class="SCmb">','<div class="SC_frt">',"<ul>","<li>",'<b><span><i class="msi-close"></i></span></b>',"</li>","</ul>","</div>",'<div class="SC_flt"></div>',"</div>",'<div class="SC_mclst" id="zmAddZDocs" style="overflow:hidden"></div>','<div class="SC_mclst" id="zmAddCloud" style="display:none;overflow:hidden"></div>',"</div>","</div>",'<div class="SC_PUbtm">','<span id="zmattViewAttach" class="sel">'+b.dialogText.add+"</span>",'<span id="zmattViewCancel" data-val="Cancel">'+b.dialogText.cancel+"</span>","</div>","</div>","</div>","</div>"].join(""),filterDropDwon:function(){var a=b.filterMenu;return['<div class="SC_srch">',"<table>","<tbody>","<tr>","<td>","<table>","<tbody>",'<tr class="sml">',"<td>"+a.group+"</td>","<td>"+a.attFrom+"</td>","<td>"+a.attType+"</td>","<td>"+a.tags+"</td>","</tr>","<tr>",'<td id="zmAttGrp"><span><input type="text" disabled=""></span></td>','<td id="zmAttEntity"><span><input type="text" disabled=""></span></td>','<td id="zmAttFilTyp"><span><input type="text" disabled=""></span></td>','<td id="zmAttLbl"><span><input type="text" disabled=""></span></td>',"<td></td>","</tr>","</tbody>","</table>","</td>","</tr>","<tr>","<td>",'<div class="SC_PUbtm SC_tranbdr">','<span id="attFilter" class="sel">'+a.filter+"</span>",'<span id="filterCncl" data-val="Cancel">'+a.cancel+"</span>","</div>","</td>","</tr>","</tbody>","</table>","</div>"].join("")},cloudFrame:'<iframe frameborder="0" id="cloudIframe" style="height:100%;width:100%"></iframe>',noAttachInfo:['<div id="noattachs" class="SC_nmsg"></div>'].join(""),thumbnailTypeCont:['<div class="zmAmht zmAv"></div>'].join(""),showAll:['<span class="SC_lnk"></span>'].join(""),divTemplate:["<div></div>"].join(""),thumbViewParentEle:['<div class="SC_tbdr SC_Aview"></div>'].join(""),favIcon:['<i class="msi-fav SC_fav" title="'+b.UserMsg.remFav+'"></i>'].join(""),unfavIcon:['<i class="msi-fav" title="'+b.UserMsg.fav+'"></i>'].join(""),tickIcon:['<i class="msi-tick"></i>'].join(""),uncheckIcon:['<i class="msi-uncheck"></i>'].join(""),zmFdrBox:function(a,c){var d=b.UserMsg;return'<div class="zmFdr"><span><i class="'+a+'" title="'+c+'"></i><i class="msi-send" title="'+d.attachToNewMail+'"></i><i class="msi-download" title="'+d.download+'"></i><i class="msi-action" title="'+d.more+'"></i></span></div>'},zmFltBox:['<div class="zmFlt"></div>'].join(""),SCIcnBox:['<div class="SC_icn"></div>'].join(""),divOuterZmL:function(a){return'<div data-atid="'+a+'" class="zmL zmAch"><div class="zmLst"></div></div>'},divOuterZmDtl:['<div class="zmDtl"></div>'].join(""),divZmDate:['<div class="zmDate"><span></span></div>'].join(""),divZmSze:['<div class="zmSze"><span class="sum"></span></div>'].join(""),divZmFrm:function(a){return a=_zm.escapeTags(a),'<div class="zmFrm"><span id="thumbView" title="'+a+'"></span><span id="listView" title="'+a+'"></span></div>'},divZmSub:['<div class="zmSub"><span class="sum"></span></div>'].join(""),divZmImg:['<div class="zmImg"></div>'].join(""),divZmLbl:['<div class="zm_lbl"></div>'].join(""),divZmFrt:['<div class="zmFrt"></div>'].join(""),labelDisplayBox:function(a,b,c){return b=_zm.escapeTags(b),"<p data-mid="+a+" title="+b+' class="zmAttLbl"><font style=background-color:'+c+"></font></p>"},filterByMsg:["<b><i>"+b.filterMenu.filterBy+"</i></b>"].join(""),attListingTemplate:['<div class="zmL SC_Pbar">','<div class="zmLst">','<div class="zmDtl">','<div class="zmSze">','<span class="sum"></span>',"</div>",'<div class="zmSub">','<span data-name="rename">'+b.UserMsg.rename+"</span>",'<span data-name="download">'+b.UserMsg.download+"</span>","</div>",'<div class="zmFrm">','<span data-name="filename"></span>',"</div>",'<div class="zmImg"></div>','<div class="SC_icn">','<i class="msi-close"></i>',"</div>","</div>","</div>","</div>"].join(""),downloadText:['<span class="SC_ldot sum">'+b.UserMsg.download+"</span>"].join(""),prevTopDom:function(a){return['<div id="zmPhdAtt" class="SC_ptit">','<div class="SCmb SC_frt">',"<ul>","<li>",'<b class="SC_nrr">','<i class="msi-prev"></i>',"</b>","</li>","<li>",'<b class="SC_nlr">','<div class="SC_hd"></div>','<i class="msi-next"></i>',"</b>","</li>","</ul>","<ul>","<li>","<b>",'<i class="msi-close"></i>',"</b>","</li>","</ul>","</div>",'<div class="SC_phd">'+a+"</div>","</div>"].join("")},prevMainDom:function(a,b){return['<div class="SC_Twpr">','<div class="SC_pct zmAvi">','<div id="zmHdrAtt" class="zmPHdr">','<div class="zmPT">','<div class="zmpr">','<div class="SCmb SC_frt">',"<ul>","<li>","<b>",'<i class="msi-action"></i>','<div class="SC_hd"></div>',"</b>","</li>","</ul>","</div>",'<ul class="SC_pvul">',"<li>"+a,"<div>",'<span class="sum" >'+b+"</span>","</div>","</li>","</ul>","</div>",'<div class="zmpr zmpsrt">',"<span></span>",'<div class="zm_lbl"></div>',"</div>","</div>",'<div class="zmmre"></div>',"</div>","<div>",'<div id="zmPCAtt" class="zmPCon">','<div class="zmPCnt">',"<div>",'<div id="msprevAttSrc"  class="zmAsrc"></div>',"</div>","</div>","</div>","</div>",'<div class="zmAtg"></div>',"</div>","</div>"].join("")},loadingTemplate:function(){var a=[["DIV",{attrs:{"class":"At_load"},child:[["DIV",{attrs:{"class":"AT_lcntr Atlcr1"},child:[["DIV",{attrs:{"class":"Atcle1"}}],["DIV",{attrs:{"class":"Atcle2"}}],["DIV",{attrs:{"class":"Atcle3"}}],["DIV",{attrs:{"class":"Atcle4"}}]]}],["DIV",{attrs:{"class":"AT_lcntr Atlcr2"},child:[["DIV",{attrs:{"class":"Atcle1"}}],["DIV",{attrs:{"class":"Atcle2"}}],["DIV",{attrs:{"class":"Atcle3"}}],["DIV",{attrs:{"class":"Atcle4"}}]]}],["DIV",{attrs:{"class":"AT_lcntr Atlcr3"},child:[["DIV",{attrs:{"class":"Atcle1"}}],["DIV",{attrs:{"class":"Atcle2"}}],["DIV",{attrs:{"class":"Atcle3"}}],["DIV",{attrs:{"class":"Atcle4"}}]]}]]}]];return $(_zm.getDOM(a))},imgTemp:['<img style="display:none">'].join(""),tempLabelBox:['<div class="znNewTag SC_cs zn_cgy" onmousedown="zmUtil.stopEvents(event,true);"contentEditable="true" style="min-width:120px"></div>'].join(""),iconTemplate:function(a){return'<i class="'+a+'"></i>'},imageTemplate:function(a){return'<img src="'+a+'" >'},centerAlignBox:['<div class = "SC_Ialn">'].join(""),printTempDiv:['<div id="zmTempDiv"></div>'].join(""),printTempIframe:["<iframe>"].join(""),attachmentFrame:function(a,b,c){return'<iframe id="zmIframe" style="background:white; visibility:hidden;"frameborder="0" width='+a+" height="+b+' scrolling="auto" src="'+c+'"></iframe>'},labelEnclosure:['<div id="znAtt_lbl"><div id="attPrevTag"><i title="Tags" class="msi-label"></i></div></div>'].join(""),addTagIcon:['<i title="Add Tags" class="msi-plus"></i>'].join(""),labelNameBox:['<div class="SC_cs"></div>'].join(""),closeIcon:['<i class="msi-close">'].join(""),downloadLinkMsg:['<font style="z-index:999; position:relative" class="SC_lnk">'+b.common.downloadMsg+"</font>"].join(""),attachemntFileTypeIcon:function(a){return'<i class="'+a+' SC_vbig"></i>'},attPreviewMsg:function(a){return'<div class="txt">'+a+"</div>"}},!0),a}(window.zmAttachment=window.zmAttachment||{}),function(){"use strict";function a(a){this.appName=a.appName,this.$topEl=a.headerElem,this.$el=a.listElem,this.widthConst=a.thumbWidth,this.onFilterAction=a.onFilterAction,this.dType=a.dType||"t",this.viewType=a.viewType,this.groupId=a.groupId||zmail.zuid,this.entity=a.entity||"all",this.onScroll=a.onScroll,this.requireParams=a.requireParams,this.start=1,this.fileType=0,this.showNxt=void 0,this.showNxt101=0,this.showNxt102=0,this.showNxt103=0,this.showNxt104=0,this.showNxt105=0,this.isnew="y",this.attDet={},this.attArrObj={},this.selectedAttachment=[];for(var b=0,c=g.length;b<c;b++)this.attArrObj[g[b]]={showNxt:0,list:[]};this.prvFltr={lblId:" ",mthd:" "},this.fileTypeShowAll={101:{isHidden:!1,stoppedIndex:0,insertSingleAttachment:!1},102:{isHidden:!1,stoppedIndex:0,insertSingleAttachment:!1},103:{isHidden:!1,stoppedIndex:0,insertSingleAttachment:!1},104:{isHidden:!1,stoppedIndex:0,insertSingleAttachment:!1},105:{isHidden:!1,stoppedIndex:0,insertSingleAttachment:!1}},this.isDone=!0,this.initView=!1,this.thumbCount=0,this.presentView="t"+zmail.zuid+"EntAllTypAllLblAll"}var b=zmail.Core.Namespaces.create("zmAttachUtility"),c=zmText.get("attachmentUtility"),d=c.openEntity,e=[d.email,d.note,d.task,d.event,"",d.status,"","","",d.link],f=["msi-mail","msi-notes","msi-task","msi-calendar","","msi-status","","","","msi-links"],g=["0","101","102","103","104","105"],h={all:0,m:1,n:2,t:3,c:4,p:6,l:10},i=[{htm:c.fType[101],data:{type:"attList",action:101}},{htm:c.fType[102],data:{type:"attList",action:102}},{htm:c.fType[103],data:{type:"attList",action:103}},{htm:c.fType[104],data:{type:"attList",action:104}},{htm:c.fType[105],data:{type:"attList",action:105}},{htm:c.fType[0],data:{type:"attList",action:""}}],j=[{htm:c.entityType.m,data:{type:"entList",action:"m"}},{htm:c.entityType.p,data:{type:"entList",action:"p"}},{htm:c.entityType.n,data:{type:"entList",action:"n"}},{htm:c.entityType.t,data:{type:"entList",action:"t"}},{htm:c.entityType.c,data:{type:"entList",action:"c"}},{htm:c.entityType.l,data:{type:"entList",action:"l"}},{htm:c.entityType[0],data:{type:"entList",action:"all"}}],k=[],l=[{htm:c.prevMenu.lstAttSender,data:{type:"attList",action:1}},{htm:c.prevMenu.lstAttType,data:{type:"attList",action:2}}],m={txt:!0,js:!0,java:!0,css:!0,jsp:!0,jspf:!0,c:!0,cpp:!0,html:!0,htm:!0,xml:!0,go:!0,eml:!0,sh:!0,bat:!0,log:!0},n={xml:!0,js:!0,css:!0},o={},p={};p.getPopupTemplate=function(){return zmAttachment.templates.cloudAttachTemplate},p.getFilterDropTemplate=function(){return zmAttachment.templates.filterDropDwon},o.isRestrictedIE=function(){return zmUtil.isIE()&&"Microsoft Internet Explorer"===window.navigator.appName},o.isDocsCompAllowed=function(){return!(zmail.isCustomDomain||o.isRestrictedIE())},o.showSuccErrMsg=function(a,b){"error"===a?_zm.succErrMsg("e",b[a]):_zm.succErrMsg("s",b[a])},o.addEventsToCal=function(a){var b={groupId:a.gId,entityId:a.e,attachId:a.Id,entityType:a.et},d=c.SuccErrMsg;1===a.et&&(b.partId=a.p),a.shId&&(b.shId=a.shId),a.type?(2===a.et?b.streamsView="Notes":b.streamsView="true",b.actionType=a.type):b.accId=zmail.accId,zmAjq.XHR({u:zmail.conPath+"/OpenDocument/"+zmUtil.encodeFileName(a.fn),t:"POST",fn:function(a){o.showSuccErrMsg(a.msg,{added:d.Event_Added,exist:d.Event_Updated,error:d.Event_Error})},p:b,ep:{}})},o.parseToNumber=function(a){return window.Number(a)},o.parseToInteger=function(a,b){return b=b||10,window.parseInt(a,b)},o.uploadToCloud=function(){function a(a,b){var c,d,e=a.$el.find("#zmAddCloud"),f=zmComponent.loadingBand({container:e[0],type:"pagination"}),g=escape(b.fn),h=b.e+"_"+b.Id,i=location.protocol+"//"+window.location.hostname+zmail.conPath+"/jsp/cloudUploader.jsp?m="+h;i=encodeURIComponent(i),c=zmail.urls.gadURL+"/CloudUploader?sources=gdrive,dropbox,skydrive,box&fileName="+g+"&purpose=mailView&zservice=zmail",c+="&serURL="+i,d=$(zmAttachment.templates.cloudFrame),k=b,d.attr("src",c),d.on("load",function(){f()}),e.append(d)}function b(a,b){var d=c.SuccErrMsg;a.result="dropbox"===b.source?"success":a.result,o.showSuccErrMsg(a.result,{success:d.Docs_Uploaded,error:d.Docs_Error})}function d(a,b){var c,d,e=a.$el.find("#zmAddZDocs");"undefined"!=typeof G_ADDDOCS_OBJ&&(G_ADDDOCS_OBJ.folderid=-1,G_ADDDOCS_OBJ.workspaceid=-1),c=zmComponent.loadingBand({container:e[0],type:"pagination"}),d={servicename:"zmail",filename:b.fn,docsURL:"//"+zmail.urls.docsURL,containerDiv:"zmAddZDocs",isNewUI:!0,handbckobj:{attObj:b},callback:c},ADDDOCDIALOG.showAddDocDialog(d)}function e(a){var b=a.handbckobj&&a.handbckobj.attObj||{},d=b.sid||b.gId||zmail.zuid,e={method:"addtoZohoDocs",groupId:d,entityId:b.e,attachId:b.Id,entityType:b.et},f=c.SuccErrMsg;1===b.et&&(e.partId=b.p),b.shId&&(e.shId=b.shId),b.type?(2===b.et?e.streamsView="Notes":e.streamsView="true",e.actionType=b.type):e.accId=zmail.accId,a.issharedws&&(e.issharedws=a.issharedws),a.workspaceid&&o.parseToNumber(a.workspaceid)!==-1&&(e.wsId=a.workspaceid),e.fileName=a.fname,e.foldId=a.folderid,zmAjq.XHR({u:zmail.conPath+"/postAttach.do",t:"POST",fn:function(a){o.showSuccErrMsg(a[0].response,{success:f.Docs_Uploaded,error:f.Docs_Error})},p:e,ep:{}})}function f(a,b){return{id:"zDocs",text:c.cloudServiceName.zDocs,tabName:"zDocs",selected:a,onClk:function(a){d(a,b)},listingArea:{id:"zmAddZDocs",classes:"SC_mclst",styles:{overflow:"hidden"},parEle:$('<div class="SCmc SC_attachviewer"></div>')},buttons:[{text:c.dialogText.add,onClk:function(){o.uploadToCloud.addToCloudClose(),e(ADDDOCDIALOG.addToZDocsNewUI())}}]}}function g(b,d){var e=o.isDocsCompAllowed()?c.cloudServiceName.otherCloud:c.cloudServiceName.cloud;return{id:"oCloud",text:e,tabName:"oCloud",selected:b,onClk:function(b){a(b,d)},listingArea:{id:"zmAddCloud",classes:"SC_mclst",styles:{overflow:"hidden"},parEle:$('<div class="SCmc SC_attachviewer"></div>')},hideButtons:!0}}function h(a,b,c){return"zDocs"===a?f.call(this,b,c):"oCloud"===a?g.call(this,b,c):void 0}function i(a){var b={},c=[],d=!1;if(b.id="zmAddToCloudPopup",b.tabs=[],zmUtil.isAddToCloudAllowed()){o.isDocsCompAllowed()&&c.push("zDocs"),zmail.isBaihui||"false"===zmail.isCloudServiceEnabled||c.push("oCloud");for(var e=0,f=c.length;e<f;e++)d=0===e,b.tabs.push(h.call(this,c[e],d,a));b.onClose=function(){l=!1},b.dialogDidMount=function(a){var b=a.$el.find("."+a.contentClass);a.$el.find("."+a.contentClass).css({overflow:"hidden",width:""}),a.$el.find(".SCmc.SC_attachviewer").css({"max-height":b.css("max-height"),"max-width":b.css("max-width")})},b.classes="SC_add",j=zmsDialog.createTabPopupDialog(b)}else l=!1}var j,k,l=!1;return{initAddToCloud:function(a){l||(l=!0,i(a))},addToCloudClose:function(){j.close(),l=!1},cloudUpload:function(a,c,d){o.uploadToCloud.addToCloudClose();var e,f=k,g=f.sid||f.gId||zmail.zuid,h={groupId:g,entityId:f.e,entityType:f.et,attachId:f.Id};1===f.et&&(h.partId=f.p),f.shId&&(h.shId=f.shId),f.type?(2===f.et?h.streamsView="Notes":h.streamsView="true",h.actionType=f.type):h.accId=zmail.accId,h.folderPath=a,h.source=d,h.fileName=c,e={source:d},zmAjq.XHR({u:zmail.conPath+"/UploadToCloud/"+escape(f.fn),t:"POST",fn:b,p:h,ep:e})}}}(),o.openResult=function(a,b){zmUtil.prevCache(b.id,{mdata:a}),zmList.getMailData({msgId:b.id,type:"lt",opentype:2,src:"external"})},o.openMail=function(a){if(void 0===a.sid&&a.gId===zmail.zuid){var b={entityId:a.e,entityType:a.et,method:"openEntity"},c={id:a.e,F:a.dn};b.groupId=a.gId,zmAjq.XHR({u:zmail.conPath+"/postAttach.do",t:"POST",fn:o.openResult,p:b,ep:c})}else{var d=a.sid||a.gId,e=a.sid?"viewSelfData":"viewGroupEntity";zmUtil.loadStreamsInTab({pid:a.e,gid:d,etype:a.et,actionType:e})}},o.sendMail=function(a){zmUtil.openComposeWithAtt([a])},o.openPost=function(a){var b=a.sid?a.sid:a.gId,c=a.gId!==zmail.zuid||a.sid?"viewGroupEntity":"viewSelfData";zmUtil.openPost({pid:a.e,gid:b,etype:a.et,actionType:c,fixedComment:!0})},o.printImageAtt=function(a){var b,c,d,e,f;if(!$("#zmlightboxplugin").length){var g=window.open(zmUtil.getTheSrc("FileDownload",a),"_blank");return g.opener=null,void(g.onload=function(){g.focus(),g.print()})}if(b=o.loadingIndicatorTemplate(),c=zmAttachment.templates,d=$(c.printTempDiv),f=$(c.printTempIframe),101===a.ft)e=$("#zmlightboxplugin").find(".At_opt"),e.find("#attMsi-print").addClass("SC_vh"),d.css({left:"96.4%",top:"1px"}).append(b),e.append(d);else if(101!==a.ft){var h=$("#zmlightboxplugin").find("iframe")[0];return void h.contentWindow.print()}zmail.prevAttachment={},a.src=zmUtil.getTheSrc("FileDownload",a),(window.ActiveXObject||"ActiveXObject"in window)&&(a.src+="&t="+Date.now()),zmail.prevAttachment.attObj=a,f.attr("src",zmail.conPath+"/print.do?isImg="+!0),$("body").append(f),f.on("load",function(){window.setTimeout(function(){f.remove()},2e3)})},o.showLabelPopup=function(a,b,c,d){var e,f=b.l,g={};f&&"$6"===f[0]&&f.splice(0,1),g.parentDOM=a,g.displayAs="popup",g.accType="default",g.labelState={labelList:f},g.onCreate=function(a){zmlab.isValidName(a,"","default")&&zmlab.labelCreate(a,"default",{reqDoneClbk:function(a,b){a&&(g.onStateChange(b,!0,function(){}),e.hide())}})},d&&(g.onHide=d),c&&(g.direction=c),g.onStateChange=function(c,d){o.lblPopupAction(d?"addLabel":"deleteLabel",b,a,c)},e=zmUtil.createFLComp("label",g),e.show()},o.lblPopupAction=function(a,b,c,d){"addLabel"===a?o.addLabelApi(c,b,d):o.removeLabelApi({el:c,id:b,lblId:d},o.removeLabelApiResult)},o.addLabelApi=function(a,b,c){var d,e=$(a).data().uid||c;if(e){var f=o.addLabelApiResult,g={method:"applyLabel",groupId:b.gId,entityId:b.e,attachId:b.Id,entityType:b.et,labelId:e,m:"a",fileType:b.ft,uuid:b.u};1===b.et&&(g.partId=b.p,g.accountId=zmail.accId),b.sid&&(g.sid=b.sid),d={attObj:b,labId:e},zmAjq.XHR({u:zmail.conPath+"/postAttach.do",t:"POST",fn:f,p:g,ep:d})}else o.removeLabelEnclosure()},o.addLabelApiResult=function(a,b){var c,d=zmUtil.getTagList("default")[b.labId],e=b.attObj.Id+b.attObj.e,f=b.labId;if($.publish("attachment/addLabel",[e,f]),d&&d.id){if($("#zmlightboxplugin").length){var g=$("#zmlightboxplugin").find(".At_opt"),h=g.find("#znAtt_lbl").find("#attPrevTag"),i=o.constLabelDiv(d,b.attObj);i.css("color","white"),i.css("background-color","black"),i.insertBefore(h.find(".msi-plus"))}c=$("div[data-atid='"+e+"']"),c.find(".zm_lbl").append(zmAttachment.templates.labelDisplayBox(f,d.dispName,d.color)),c.addClass("SC_hlbl"),o.removeLabelEnclosure()}},o.constLabelDiv=function(a,b){var c=zmAttachment.templates,d=$(c.labelNameBox),e=$(c.closeIcon);return d.text(a.dispName).attr("id",a.id),b&&e.click(function(a){zmUtil.stopEvents(a,!0),o.removeLabelApi({el:this,id:b},o.removeLabelApiResult)}),d.append(e),d},o.labelEnclosure=function(){return $(zmAttachment.templates.labelEnclosure)},o.removeLabelEnclosure=function(){if($("#zmlightboxplugin").length)o.removeLabelEnclosureSShow();else{var a=zmsuite.getCenter()[1].$el,b=a.find("#znAtt_lbl").find("#attPrevTag");b.find(".znNewTag").remove(),o.isLabelAssignedForAttach()||b.parent().remove()}},o.removeLabelEnclosureSShow=function(){var a=$("#zmlightboxplugin").find("#znAtt_lbl").find("#attPrevTag");a.find(".znNewTag").remove()},o.isLabelAssignedForAttach=function(){var a=zmsuite.getCenter()[1].$el,b=a.find("#znAtt_lbl").find("#attPrevTag");return b.find("div.SC_cs").length>0},o.removeLabelApi=function(a,b){var c,d=a.el.parentNode,e=d?d.id:a.lblId;if(e){var f=a.id,g={method:"applyLabel",groupId:f.gId,entityId:f.e,attachId:f.Id,entityType:f.et,labelId:e,m:"d",uuid:f.u,fileType:f.ft};1===f.et&&(g.partId=f.p,g.accountId=zmail.accId),f.sid&&(g.sid=f.sid),c={attObj:f,ele:d,labId:e},zmAjq.XHR({u:zmail.conPath+"/postAttach.do",t:"POST",fn:b,p:g,ep:c})}},o.removeLabelApiResult=function(a,b){$(b.ele).remove();var c=b.attObj.Id+b.attObj.e,d=b.labId;$.publish("attachment/removeLabel",[c,d]);var e=$("div[data-atid='"+c+"']"),f=e.find(".zm_lbl");f.find("p[data-mid='"+d+"']").remove(),f.find("p").length||e.removeClass("SC_hlbl"),o.removeLabelEnclosure()},o.labelAutoFill=function(a,b){var c,d,e=zmUtil.getTagList("default"),f=[],g=o.getLabelArr(b.l);for(var h in e)g.indexOf(h)===-1&&f.push({id:h,name:e[h].dispName});c=function(){$("#zm_afill").remove(),o.addLabelApi(a,b)},$(a).attr("contentEditable",!0).focus(),d={contentArray:f,compare:["name"],LType:"2",OType:"2",callback:c,text:!0},zmAutoFill.setAutofill(d,a),$(a).on("keydown",function(a){27===a.keyCode&&(o.removeLabelEnclosure(),$("#zm_afill").remove())})},o.newLabelDiv=function(){return $(zmAttachment.templates.tempLabelBox)},o.addLabel=function(a,b){var c,d,e=b?$("#zmlightboxplugin").find(".At_opt"):zmsuite.getCenter()[1].$el,f=e.find("#znAtt_lbl").find(".znNewTag");if(f.length)return void f.focus();if(c=e.find("#znAtt_lbl").find("#attPrevTag"),d=o.newLabelDiv(),c.length)b?d.insertBefore(c.find(".msi-plus")):c.append(d);else{var g=e.find(".zmPCnt").children(),h=o.labelEnclosure();h.find("#attPrevTag").append(d),b?e.prepend(h):g.append(h)}o.labelAutoFill(d,a)},o.searchAttachment=function(a,b,c){zmAppLoader.load("attachmentSearch").done(function(){zmAttachmentSearch.core.searchAttachment(a,b,c)})},o.menuItemClick=function(a){var b=a.attObj,c=a.action,d=!1;switch(c){case"download":zmUtil.downloadAttachment(b);break;case"lstSender":o.searchAttachment("sender",b,3);break;case"lstType":o.searchAttachment("filetype",b,4);break;case"sMail":o.sendMail(b);break;case"attachToPost":zmUtil.loadNewPostDialog("",[b]);break;case"Open linked email":o.openMail(b);break;case"Open linked note":zmUtil.isNoteReactUser()?zmUtil.loadNotes("openNote",b):o.openPost(b);break;case"Open linked status":o.openPost(b);break;case"Open linked task":o.openPost(b);break;case"Open linked event":o.openPost(b);break;case"Open linked link":o.openPost(b);break;case"remFav":o.attFav(b,!1);break;case"fav":o.attFav(b,!0);break;case"hideAtt":o.hideAtt(b,o.hideResult);break;case"unhideAtt":o.restoreToAttachmentView(b);break;case"addLab":o.addLabel(b);break;case"addToDocs":zmUtil.cloudUploader(b);break;case"addEvent":zmUtil.addEventsToCal(b);break;case"dwn":zmUtil.downloadAttachment(b);break;case"addTag":d=!0;break;case"printImg":o.printImageAtt(b)}if(zmUtil.hideMenu(),d){var e=a.ele,f=e.parents(".zmL.zmAch");f.addClass("sel"),o.showLabelPopup(e,b,"",function(){f.removeClass("sel")})}},o.attFav=function(a,b){if(a){var c={attObj:a,flag:b},d=o.favResult;o.favAttach(c,d)}},o.favAttach=function(a,b){var c=a.attObj,d={method:"markFavourite",groupId:c.gId,entityId:c.e,attachId:c.Id,entityType:c.et,flag:a.flag,fileType:c.ft,uuid:c.u},e={flag:a.flag,attObj:c};1===c.et&&(d.accountId=zmail.accId),c.sid&&(d.sid=c.sid),zmAjq.XHR({u:zmail.conPath+"/postAttach.do",t:"POST",fn:b,p:d,ep:e})},o.favResult=function(a,b){if(a&&"success"===a[0].response){var d,e,f=b.attObj,g=b.flag,h=f.Id+f.e,i=$("div[data-atid='"+h+"'].zmAch"),j=$(".At_opt").find(".msi-fav"),k=i.length,l=c.prevMenu;if(g){for(d=0;d<k;d++)e=$(i[d]),e.find("i.msi-fav").addClass("SC_fav"),e.find("i.msi-fav").attr("title",l.remFav);j.addClass("SC_fav"),j.attr("title",l.remFav)}else{for(d=0;d<k;d++)e=$(i[d]),e.find("i.msi-fav").removeClass("SC_fav"),e.find("i.msi-fav").attr("title",l.fav);j.removeClass("SC_fav"),j.attr("title",l.fav)}$.publish("attachment/modifyFavLbl",[h,g])}},o.hideAtt=function(a,b){Dialog["new"]({title:c.common.confirmHideAtt,buttons:[{name:zmText.get("dialog","ok"),callback:function(c){var d={method:"deleteFromAttachmentView",entityId:a.e,attachId:a.Id,filename:a.fn,entityType:a.et,uuid:a.u,fileType:a.ft};c.remove(),1===a.et&&(d.partId=a.p),a.sid?(d.groupId=a.sid,d.streamsView=!0):d.groupId=zmail.zuid,zmAjq.XHR({u:zmail.conPath+"/postAttach.do",t:"POST",fn:b,p:d,ep:{attObj:a}})}},{name:zmText.get("dialog","cancel"),isCancel:!0,callback:function(a){a.remove()}}],defaultCloseIcon:!1})},o.hideResult=function(a,b){if(a&&a[0]&&"success"===a[0].response){for(var c=b.attObj.Id+b.attObj.e,d=zmsuite.getCenter()[0].$el,e=$("div[data-atid='"+c+"'].zmAch"),f=$("dl[data-atid='"+c+"'].zmAch"),g=e.length,h=d.find("div[data-atid='"+c+"'].zmAch").parent(),i=0;i<g;i++)$(e[i]).remove();f.remove(),o.listview.previewCard.closePrevCard.call(this),$.publish("attachment/hideAttachment",[d,c,h])}},o.restoreToAttachmentView=function(a){var b={method:"restoreToAttachmentView",entityId:a.e,attachId:a.Id,entityType:a.et};a.sid&&(b.streamsView=!0),b.groupId=a.sid||zmail.zuid,zmAjq.XHR({u:zmail.conPath+"/postAttach.do",t:"POST",fn:function(a,b){Array.isArray(a)&&a[0]&&"success"===a[0].response?b&&b.attObj&&b.attObj.l&&(b.attObj.l.splice(b.attObj.l.indexOf("$HIDDEN"),1),zmUtil.succErrMsg("s",c.SuccErrMsg.unhide_success||"success")):zmUtil.succErrMsg("e",c.SuccErrMsg.unhide_failure||"failed")},p:b,ep:{attObj:a}})},o.getGroups=function(){var a,b=zmCont.getGroupOrder(),d=zmCont.getGroup(),e=[],f=c.menuText.me;if(e.push({id:zmail.zuid,name:f,display_text:f,tooltip:f}),b)for(var g=0,h=b.length;g<h;g++)a=_zm.escapeTags(d[b[g]].name),e.push({id:b[g],name:a,display_text:a,tooltip:a});return e},o.getLabels=function(){var a,b=zmUtil.getTagList("default"),d=[],e=c.menuText.favourites,f=c.menuText.none;d.push({id:"f",name:e,display_text:e,tooltip:e});for(var g in b)a=_zm.escapeTags(b[g].dispName),d.push({id:g,name:a,display_text:a,tooltip:a});return d.push({id:"all",name:f,display_text:f,tooltip:f}),d},o.noAttach=function(a,b){var c;a.removeClass("SC_tmbvw"),c=$(zmAttachment.templates.noAttachInfo),c.text(b),a.html(c[0])},o.previewNotAvlbl=function(a,b,d,e,f){var g=zmAttachment.templates,h=(f?f:c.common.previewNotAvlbl)+" - "+g.downloadLinkMsg,i=$(g.attachemntFileTypeIcon(a)+g.attPreviewMsg(h)).data({aIndex:b});d.find(".At_load").remove(),i.find("font").on("click",function(){zmUtil.downloadAttachment(e)}),d.prepend(i)},o.attDropDown=function(a,b,c){var d,e,f=$(b),g={};switch(a&&(a=a.replace(/[0-9]/g,"")),d={id:a,par:f,align:"pright",parWidth:!0},d.divId="zm_dropDown",a){case"tfil":f.find("b").addClass("SC_ddn"),d.list=i,d.divId="zmAtt_dropDown",d.align="pleft",d.clk=function(a){c?c(a,f):o.dropDownClick(a,f)};break;case"ent":d.list=j,d.divId="zmAtt_dropDown",d.align="pleft",d.clk=function(a){c?c(a,f):o.dropDownClick(a,f)};break;case"grp":g={},g.parentDOM=b,g.displayAs="dropdown",g.dataCallback=function(){return zmAttachUtility.getGroups()},g.onSelect=function(a){e.hide(),c?c(a,f):o.showGroupAtt(a,f)},e=zmUtil.createFLComp("",g),e.show();break;case"lbl":g={},g.parentDOM=b,g.displayAs="dropdown",g.accType="default",g.dataCallback=function(){return zmAttachUtility.getLabels()},g.onSelect=function(a){e.hide(),c?c(a,f):o.showLabelAtt(a,f)},e=zmUtil.createFLComp("",g),e.show();break;case"zm_AttView":f.find("b").addClass("SC_ddn"),d.list=k,d.clk=function(a){o.menuItemClick(a)}}zmDrop.consDropDown(d)},o.dropDownClick=function(a,b){var c=a.type;switch(c){case"attList":o.showByType(a.action,b);break;case"entList":o.showEntLst(a.action,b);break;case"attGroup":o.showGroupAtt(a.action,b);break;case"lblList":o.showLabelAtt(a.action,b)}o.hideMenu()},o.hideMenu=function(){$("#zmAtt_dropDown").remove()},o.showEntLst=function(a,b){b.val(o.entDrpTxtChange(a)),b.data({dataIndex:a})},o.showByType=function(a,b){""===a&&(a=0),b.val(c.fType[a]),b.data({dataIndex:a})},o.showGroupAtt=function(a,b){b.val(a===zmail.zuid?c.menuText.me:_zm.escapeTags(zmCont.getGroup()[a].name)),b.data({dataIndex:a})},o.showLabelAtt=function(a,b){"f"===a?b.val(c.menuText.favourites):"all"===a?b.val(c.menuText.none):b.val(_zm.escapeTags(zmUtil.getTagList("default")[a].dispName)),b.data({dataIndex:a})},o.entDrpTxtChange=function(a){var b=c.entityType,d=a?b[a]||b[0]:b[0];return d},o.emailSplit=function(a){if("string"!=typeof a)return[];var b=[],c=a.indexOf("<"),d=a.indexOf(">"),e="",f=a;return c!==-1&&d!==-1&&(e=a.substring(0,c),f=a.substring(c+1,d)),b.push(e),b.push(f),b},o.getLabelArr=function(a){var b=a.slice(0);return b&&"$6"===b[0]&&b.splice(0,1),b},o.getAttachObject=function(a,b,c){var d=c.attArrObj[b].list,e=d.slice(0);return e.splice(0,a),o.createAttObjectArr(e,c)},o.createAttObjectArr=function(a,b){for(var c,d=[],e=a.length,f=0;f<e;f++)c=b.attDet[a[f]],d.push(c);return d},o.thumbNailContainer=function(a,b,d){var e=zmAttachment.templates,f=$(e.thumbnailTypeCont),g=$(e.showAll);return f.attr("id",b+a),g.text(" - "+c.menuText.showAll),f.append($(e.divTemplate).text(c.fType[a]).append(g)),0!==d&&f.find(".SC_lnk").hide(),f},o.chkAttResp=function(a){var b=!1;if(a)for(var c=g.length,d=0;d<c;d++)if(a[g[d]]){b=!0;break}return b},o.consList=function(a,b,c,d){var g,h,i,j,k,l,m,n,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E=a.Id+a.e,F=a.fn,G=!1,H=zmAttachment.templates;if((!d&&"l"===b||"list"===d)&&(G=!0),a.tnsize="37",g=zmPreviewTemplate.attPrevInr(a,G),h=a.fs>0?zmUtil.sizeConv(a.fs):"&nbsp;",i=parseInt(a.et)-1,j=i?f[i]:f[0],k=i?e[i]:e[0],l=a.l,s=o.emailSplit(a.dn),m=l&&"$6"===l[0]?H.favIcon:H.unfavIcon,u=$(H.zmFdrBox(j,k)),p=$(H.zmFltBox),q=$(H.SCIcnBox),"attComp"===c?(m=H.tickIcon,q.append(m)):"attView"===c||"attSrcView"===c?(p.append(H.uncheckIcon),p.append(m)):p.append(m),n=$(H.divOuterZmL(E)),r=$(H.divOuterZmDtl),t=$(H.divZmDate),t.find("span").text(a.rt),v=$(H.divZmSze),v.find("span").text(h),w=$(H.divZmFrm(a.fn)),F=zmUtil.getSubString(17,F),x=w.find("#thumbView"),x.text(F),y=w.find("#listView"),y.text(zmUtil.getSubString(40,a.fn)),z=$(H.divZmSub),z.find("span").text(s[1]),A=$(H.divZmImg).append(g),"t"===b?y.hide():(x.hide(),n.addClass("SC_mlst")),B=$(H.divZmLbl),C=o.getLabelArr(a.l),C.length&&"attComp"!==c){n.addClass("SC_hlbl");for(var I=C.length,J=0;J<I;J++){var K=C[J],L=zmUtil.getTagList("default")[K];L&&B.append(H.labelDisplayBox(K,L.dispName,L.color))}}return r.append(t,A,v,u,w,z,q,B),D=$(H.divZmFrt),n.find(".zmLst").append(p,r,D),zmail.isBlurThumb&&a.thn&&o.replaceBlurImage(n,a),n},o.replaceBlurImage=function(a,b){var c=a.find(".zmImg"),d=$("<img style='display:none;'>"),e=c.find("img").css("min-width","100%");d.attr("src",zmUtil.getTheSrc("FileDownload",b,"thb")),d.on("load",function(){d.show(),e.remove()}),d.on("error",function(){d.remove()}),c.append(d)},o.onSelectAttachment=function(a,b,c){a.attr("class","msi-check"),b.addClass("SC_check"),this.selectedAttachment.push(c),$.publish("attachmentView/attachmentSelected",this.appName)},o.onUnselectAttachment=function(a,b,c){var d;a.attr("class","msi-uncheck"),b.removeClass("SC_check"),d=this.selectedAttachment.indexOf(_.findWhere(this.selectedAttachment,{uniqueId:c})),d>=0&&(this.selectedAttachment.splice(d,1),$.publish("attachmentView/attachmentUnselected",this.appName))},o.bindAttachListEvents=function(a,b){var d,e,f,g,h,i=$(a.target||a.srcElement);if(d=i.attr("class")||i.parent().attr("class")||"",e=zmList.getParent(i[0],"SC_mclst"),f=$(b).attr("data-atId"),g=this.attDet[f],d.indexOf("msi-mail")!==-1)o.openMail(g);else if(d.indexOf("msi-fav")!==-1)h=!i.hasClass("SC_fav"),o.attFav(g,h);else if(d.indexOf("msi-download")!==-1)zmUtil.downloadAttachment(g);else if(d.indexOf("msi-send")!==-1)o.sendMail(g);else if(d.indexOf("msi-addcloud")!==-1)zmUtil.cloudUploader(g);else if(d.indexOf("msi-notes")!==-1)zmUtil.isNoteReactUser()?zmUtil.loadNotes("openNote",g):o.openPost(g);else if(d.indexOf("msi-status")!==-1||d.indexOf("msi-task")!==-1)o.openPost(g);else if(d.indexOf("msi-links")!==-1||d.indexOf("msi-calendar")!==-1)o.openPost(g);else if(d.indexOf("msi-hideattach")!==-1)o.hideAtt(g,o.hideResult);else if(d.indexOf("msi-check")!==-1)o.onUnselectAttachment.call(this,i,$(b),f);else if(d.indexOf("msi-uncheck")!==-1)o.onSelectAttachment.call(this,i,$(b),g);else if(d.indexOf("zmAttLbl")!==-1)o.showLabelPopup(i.parent(),g);else if(d.indexOf("msi-action")!==-1){zmUtil.hideMenu();var j,k=c.prevMenu,l=[],m=95;l.push({htm:k.attachToPost,data:{action:"attachToPost",attObj:g,ele:i}}),zmUtil.isAddToCloudAllowed()&&l.push({htm:k.addToDocs,data:{action:"addToDocs",attObj:g,ele:i}}),"ics"===zmUtil.fileTyp(g.fn)[2]&&l.push({htm:k.addEvent,data:{action:"addEvent",attObj:g,ele:i}}),l.push({htm:k.addLabel,data:{action:"addTag",attObj:g,ele:i}}),Array.isArray(g.l)&&g.l.indexOf("$HIDDEN")>=0&&zmail.showFeature?l.push({htm:k.unhideAtt||"Unhide Attachment",data:{action:"unhideAtt",attObj:g,ele:i}}):g.gId===zmail.zuid&&l.push({htm:k.hideAtt,data:{action:"hideAtt",attObj:g,ele:i}}),g.ft&&103!==g.ft&&"FileDownload"===zmUtil.isPreviewAvailable(g.fn).apiName&&l.push({htm:k.printImg,data:{action:"printImg",attObj:g,ele:i}}),i.parents(".zmL.zmAch").addClass("sel"),j=$("body").height()-i.offset().top>=m?"up":"bottom";var n={par:i,showArrow:!0,list:l,direction:j,onHide:function(){i.parents(".zmL.zmAch").removeClass("sel")},clk:function(a,b){o.menuItemClick(a,b)}};zmsuite.showMenu(n)}else if(e){var p;if("attSrcView"===this.appName||"attView"===this.appName&&"l"===this.dType)o.listview.previewCard.openPreviewCard.call(this,b),
o.listview.previewCard.keyBindingForPreviwCard.call(this);else{var q,r,s={},t="l"===this.dType?0:g.ft;for(p=this.attArrObj[t].list,q=p.length,s.startIndex=p.indexOf(f),s.attObjList=[],r=0;r<q;r++)s.attObjList.push(this.attDet[p[r]]);s.targetEle=i.parents(".zmL.zmAch").find(".zmImg"),zmAttachUtility.initSlideshow(s)}}},o.listOptions=function(a){var b,d,f,g,h,i=a.target||a.srcElement,j=$(i).closest(".zmL").attr("data-atid"),k=c.prevMenu,l=[];b=this.attachUtil?this.attachUtil.attDet[j]:this.attDet[j],l.push({htm:k.downLoad,data:{action:"dwn",attObj:b}}),l.push({sep:!0}),1===b.et&&(l.push({htm:k.lstAttSender,data:{action:"lstSender",attObj:b}}),l.push({htm:k.lstAttType,data:{action:"lstType",attObj:b}}),l.push({sep:!0})),f=b.et-1,g=f?e[f]:e[0],h=b.l,l.push({htm:g,data:{action:g,attObj:b}}),l.push({sep:!0}),l.push({htm:k.sMail,data:{action:"sMail",attObj:b}}),l.push({htm:k.attachToPost,data:{action:"attachToPost",attObj:b}}),l.push({sep:!0}),"$6"===h[0]?l.push({htm:k.remFav,data:{action:"remFav",attObj:b}}):l.push({htm:k.fav,data:{action:"fav",attObj:b}}),zmUtil.isAddToCloudAllowed()&&(l.push({sep:!0}),l.push({htm:k.addToDocs,data:{action:"addToDocs",attObj:b}})),"ics"===zmUtil.fileTyp(b.fn)[2]&&(l.push({sep:!0}),l.push({htm:k.addEvent,data:{action:"addEvent",attObj:b}})),h.indexOf("$HIDDEN")>=0&&zmail.showFeature?(l.push({sep:!0}),l.push({htm:k.unhideAtt||"Unhide Attachment",data:{action:"unhideAtt",attObj:b}})):b.gId===zmail.zuid&&(l.push({sep:!0}),l.push({htm:k.hideAtt,data:{action:"hideAtt",attObj:b}})),d={clk:function(a,b){o.menuItemClick(b,a)},conArr:l},zmsuite.showContextMenu(a,d),zmUtil.stopEvents(a)},o.loadingIndicator=function(a,b){var c=zmsuite.getCenter()[1].$el.find("#msprevAttSrc");c.find(".At_load").remove(),c.prepend(b),c.prepend(a)},o.loadingIndicatorTemplate=function(){return zmAttachment.templates.loadingTemplate()},o.removeLabelRef=function(a,b,c){if(this.attDet&&this.attDet[b]){var d=this.attDet[b].l;d.splice(d.indexOf(c),1)}},o.addLabelRef=function(a,b,c){this.attDet&&this.attDet[b]&&this.attDet[b].l.push(c)},o.modifyFavLblRef=function(a,b,c){var d,e,f;this.attDet&&this.attDet[b]&&(e=this.attDet[b],f=e.l,c?f.unshift("$6"):(d=f.indexOf("$6"),f.splice(d,1)))},o.ajaxReq={ajaxCallHelper:function(a,b){var c=zmComponent.loadingBand({container:b.loadingContainer,type:b.loadingType}),d=a.ep;return d.removeLoadingBand=c,{extraParam:d}},getGroupAttachments:function(a,b,c){var d=o.ajaxReq.ajaxCallHelper(a,c),e=a.paramInfo;e.mode=e.mode||"lst",zmAjq.XHR({u:zmail.conPath+"/attach.do",t:"POST",fn:b,p:e,ep:d.extraParam})},getGroupLblAttachments:function(a,b,c){var d=o.ajaxReq.ajaxCallHelper(a,c),e=a.paramInfo;zmAjq.XHR({u:zmail.conPath+"/postAttach.do",t:"POST",fn:b,p:e,ep:d.extraParam})}},o.listview={},o.listview.previewCard=function(){var a=function(a,b,c){return zmAttachment.templates.attachmentFrame(c,b,a)},b=function(a){a.load(function(){var b=zmsuite.getCenter()[1].$el;b.find("#msprevAttSrc").find(".At_load").remove(),a.css("visibility","visible")})},d=function(){var a,b=zmsuite.getCenter()[1].$el,c=b.height()-117+"px";return a=b.hasClass("shw")?b.width()-65+"px":b.width()+40+"px",{height:c,width:a}},f=function(a){var b=zmUtil.getTheSrc("FileDownload",a),c=$(zmAttachment.templates.imgTemp),d=zmsuite.getCenter()[1].$el.find("#msprevAttSrc");c.attr({src:b}).on("load",function(){d.find(".At_load").remove(),c.css({display:"block","max-width":"100%","max-height":"100%"})}).on("error",function(){var b=$(zmAttachment.templates.centerAlignBox);d.append(b),d.find(".At_load").remove(),c.remove(),o.previewNotAvlbl("msi-attothers",!1,b,a)}),o.loadingIndicator(o.loadingIndicatorTemplate(),c),d.append(c)},g=function(c){var e=zmUtil.getTheSrc("OpenDocument",c),f=d(),g=$(a(e,f.height,f.width));o.loadingIndicator(o.loadingIndicatorTemplate(),g),b(g)},h=function(c,e){var f,g,h,i=!1,j=!0,k=d();(window.ActiveXObject||"ActiveXObject"in window)&&(i=!0,n[e[2]]&&(g=$(zmAttachment.templates.centerAlignBox),j=!1,o.previewNotAvlbl(e[1],!1,g,c))),j&&(h=zmUtil.getTheSrc("FileDownload",c),f=$(a(h,k.height,k.width)),o.loadingIndicator(o.loadingIndicatorTemplate(),f),i&&"msi-attpdf"===e[1]?window.setTimeout(function(){var a=zmsuite.getCenter()[1].$el;a.find("#msprevAttSrc").find(".At_load").remove(),f.css("visibility","visible")},2e3):b(f))},i=function(a){var b=zmUtil.getTheSrc("FileDownload",a),c=zmsuite.getCenter()[1].$el.find("#msprevAttSrc"),d={filename:a.fn,source:b,$parent:c,height:c.height(),width:c.width(),swfPath:zmail.swfPath};zmailSlideShow.player.create(d)},j=function(a,b){var c=$(zmAttachment.templates.centerAlignBox);zmsuite.getCenter()[1].$el.find("#msprevAttSrc").append(c),o.previewNotAvlbl(a[1],!1,c,b)},l=function(a){var b=zmUtil.fileTyp(a.fn);101===a.ft?f(a):"msi-attdoc"!==b[1]&&"msi-attppt"!==b[1]&&"msi-attsheet"!==b[1]||m[b[2]]?"msi-attpdf"===b[1]||"msi-attdoc"===b[1]&&m[b[2]]||"msi-attothers"===b[1]&&m[b[2]]?h(a,b):"msi-attaudio"===b[1]||"msi-attvideo"===b[1]?i(a):j(b,a):g(a)},p=function(a){function b(){var a=this;c.length&&void 0!==c.attr("data-atid")?e.find("b.SC_nrr:first").unbind("click").bind("click",function(){o.listview.previewCard.openPreviewCard.call(a,c,"prev")}):e.find("b.SC_nrr:first").unbind("click").addClass("SC_opy3"),d.length&&void 0!==d.attr("data-atid")?e.find("b.SC_nlr:first").unbind("click").bind("click",function(){o.listview.previewCard.openPreviewCard.call(a,d,"next")}):e.find("b.SC_nlr:first").unbind("click").addClass("SC_opy3")}var c=a.prev(),d=a.next(),e=zmsuite.getCenter()[1].$el;b.call(this)},q=function(a){var b,d,f,g,h=zmsuite.getCenter()[1].$el.attr("data-atId"),i=c.prevMenu;k=[],b=this.attDet[h],k.push({htm:i.downLoad,data:{action:"download",attObj:b}}),k.push({sep:!0}),1===b.et&&(k.push({htm:i.lstAttSender,data:{action:"lstSender",attObj:b}}),k.push({htm:i.lstAttType,data:{action:"lstType",attObj:b}}),k.push({sep:!0})),d=b.et-1,f=d?e[d]:e[0],k.push({htm:f,data:{action:f,attObj:b}}),k.push({sep:!0}),k.push({htm:i.sMail,data:{action:"sMail",attObj:b}}),k.push({htm:i.attachToPost,data:{action:"attachToPost",attObj:b}}),k.push({sep:!0}),g=b.l,"$6"===g[0]?k.push({htm:i.remFav,data:{action:"remFav",attObj:b}}):k.push({htm:i.fav,data:{action:"fav",attObj:b}}),zmUtil.isAddToCloudAllowed()&&(k.push({sep:!0}),k.push({htm:i.addToDocs,data:{action:"addToDocs",attObj:b}})),"ics"===zmUtil.fileTyp(b.fn)[2]&&(k.push({sep:!0}),k.push({htm:i.addEvent,data:{action:"addEvent",attObj:b}})),101===b.ft&&(k.push({sep:!0}),k.push({htm:i.printImg,data:{action:"printImg",attObj:b}})),g.indexOf("$HIDDEN")>=0&&zmail.showFeature?(k.push({sep:!0}),k.push({htm:i.unhideAtt||"Unhide Attachment",data:{action:"unhideAtt",attObj:b}})):b.gId===zmail.zuid&&(k.push({sep:!0}),k.push({htm:i.hideAtt,data:{action:"hidAtt",attObj:b}})),o.attDropDown("zm_AttView",a)},r=function(a){var b,c,d,e,f,g=this.attDet[a],h=g.dn&&""!==g.dn?g.dn:zmail.aInfo[zmail.accId].mailId,i=o.emailSplit(h),j=""!==i[1]?i[1]:"&nbsp;",k=""!==i[0]?i[0]:j,l=zmConUtil.bubbleUtil({attr:{"data-eid":j},name:k}),m=g.fs,n=g.fn,p=zmAttachment.templates,r=this;m=m>0?"("+zmUtil.sizeConv(m)+")":"&nbsp;",n=_zm.escapeTags(zmUtil.getSubString(40,n)),b=document.createDocumentFragment(),c=$(p.prevTopDom(n)),c.find(".msi-close").closest("b").off("click").on("click",function(){o.listview.previewCard.closePrevCard.call(r)}),b.appendChild(c[0]),d=$(p.prevMainDom(l,g.rt)),e=o.getLabelArr(g.l),f=e.length;for(var s=0;s<f;s++){var t=e[s],u=zmUtil.getTagList("default")[t];u&&d.find(".zm_lbl").append(p.labelDisplayBox(t,u.dispName,u.color))}return d.find(".SCmb.SC_frt ul li").off("click").on("click",function(){q.call(r,this)}),d.off("click").on(".zmAttLbl","click",function(){o.showLabelPopup($(this),g)}),b.appendChild(d[0]),b};return{keyBindingForPreviwCard:function(){this.prev_shortcut_scope=zmComponent.keybindings.getScope();var a={allowDefaultScope:!1,shortcuts:[{uid:"next",keyStr:"downArrow",actions:[function(){zmsuite.getCenter()[1].$el.find("b.SC_nlr:first").trigger("click")}]},{uid:"previous",keyStr:"upArrow",actions:[function(){zmsuite.getCenter()[1].$el.find("b.SC_nrr:first").trigger("click")}]}],scope:this.appName+"attPreviewCard"};zmComponent.keybindings.registerAll(a),zmComponent.keybindings.setScope(this.appName+"attPreviewCard")},openPreviewCard:function(a,b){var d,e,f=$(a),g=f.attr("data-atId"),h=zmsuite.getCenter()[1].$el,i=zmsuite.getCenter()[0].getNodes()[2].$el,j=h.attr("data-atId"),k=c.contactCard,m=[{htm:k.addToContact,id:"zms_add",clk:zmConUtil.handleAddToContact},{htm:k.sendMail,clk:zmConUtil.loadCompose},{htm:k.chatWith,clk:zmConUtil.createChat,show:"chat",value:!0},{htm:k.listEmails,clk:zmConUtil.listMails}];if(g!==j&&(h.attr("data-atId",g).html(r.call(this,g)),d=this.attDet[g],i.find("div.zmAch").removeClass("zmSLst"),h.removeClass("SC_w100").show(),f.addClass("zmSLst"),p.call(this,f),e=d.dn&&""!==d.dn?d.dn:zmail.aInfo[zmail.accId].mailId,zmail.avatar.get({email:o.emailSplit(e)[1],type:"dom",validateEmail:!0}).done(function(a){h.find("#zmHdrAtt").find(".SC_pvul li").prepend(a),zmail.wmsAPI.showPresence(o.emailSplit(e)[1],$(a))}),h.find("#zmHdrAtt").find(".SC_cs").click(function(a){zmConUtil.showContactCard({dom:this,items:m,event:a,source:"slideshow"})}),l(d),h.addClass("shw SC_scroll"),zmsuite.getCenter()[0].$el.addClass("SC_sw"),b)){var n=i.find("[data-atId='"+j+"']");zmUtil.initScroll(i,f,n,b,!0)}},closePrevCard:function(){var a=zmsuite.getCenter()[1].$el,b=zmsuite.getCenter()[0].getNodes()[2].$el;a.attr("data-atId",""),b.find("div.zmAch").removeClass("zmSLst"),zmsuite.getCenter()[1].close(),a.find("#msprevAttSrc").empty(),zmComponent.keybindings.dropScope(this.appName+"attPreviewCard"),this.prev_shortcut_scope&&zmComponent.keybindings.setScope(this.prev_shortcut_scope)}}}(),a.prototype={initAttachViewComp:function(){var a=this;this.onScroll||this.$el.bind("scroll",function(){a.fillAttsOnScroll()}),this.getGroupAttachments()},fillAttsOnScroll:function(){var a=this.$el,b=a[0];Math.floor(b.scrollHeight-a.scrollTop())<=Math.floor(a.height())&&("t"!==this.dType||this.fileType)&&this.getAttachemntOnScroll()},getAttachemntOnScroll:function(){this.isDone||(this.isnew="n","l"===this.dType?this.start=this.showNxt:"t"===this.dType&&(this.start=this["showNxt"+this.fileType]),this.start&&(" "===this.prvFltr.lblId?this.getGroupAttachments("pagination","scrollEv"):this.getLblAttachments("pagination",this.prvFltr,"scrollEv")))},onListingClick:function(a,b){o.bindAttachListEvents.call(this,a,b)},restoreOptions:function(a){var b=this.prvFltr,d=a.find("#zmAttGrp input"),e=a.find("#zmAttLbl input"),f=a.find("#zmAttEntity input"),g=a.find("#zmAttFilTyp input");"f"===b.lblId?e.val(c.menuText.favourites).data({dataIndex:b.lblId}):" "===b.lblId?e.val(c.menuText.none).data({dataIndex:b.lblId}):e.val(zmUtil.getTagList("default")[b.lblId].dispName).data({dataIndex:b.lblId}),d.val(this.groupId===zmail.zuid?c.menuText.me:zmCont.getGroup()[this.groupId].name).data({dataIndex:this.groupId}),f.val(o.entDrpTxtChange(this.entity)).data({dataIndex:this.entity}),g.val(c.fType[this.fileType]).data({dataIndex:this.fileType})},attLView:function(a,b){this.attachCache(a,b);var c,d,e=document.createDocumentFragment();for(var f in a){c=a[f];for(var g in c)d=c[g],d.Id?e.appendChild(o.consList(d,this.dType,this.appName,this.viewType)[0]):void 0!==d.showNextPage&&(this.showNxt=d.showNextPage);return e}},attachCache:function(a,b){if(b){var c,d=g.length;for(c=0;c<d;c++)this.attArrObj[g[c]]={showNxt:0,list:[]}}for(var e in a){var f=e,h=a[e];for(var i in h){var j=h[i],k=j.Id+j.e;k&&(j.gId=this.groupId,j.uniqueId=k,j.sid?this.groupId!==zmail.zuid?j.type="viewGroupEntity":j.type="viewSelfData":this.groupId!==zmail.zuid&&(j.type="viewGroupData"),void 0===j.fn&&(j.fn=" "),this.attDet[k]=j,this.attArrObj[f].list.push(k))}}},attTView:function(a,b,c){var d,e,f,g,h=this.$el,i="msAttHdr";c&&"boolean"!=typeof c&&h.find("#msAttHdr"+this.fileType).find(".SC_lnk").trigger("click"),b?(e=$(zmAttachment.templates.thumbViewParentEle),h.html(e)):e=h.find(".SC_tbdr"),this.attachCache(a,b);for(var j in a)f=void 0,b&&o.parseToNumber(j)&&a[j]&&(f=o.thumbNailContainer(j,i,this.fileType),e.append(f)),o.parseToNumber(j)&&a[j]&&(d=a[j],f||(f=h.find("#msAttHdr"+j)),f.length&&(g=this.fileTypeShowAll,g[j].insertSingleAttachment&&f.find("#tempLoadContainer").remove(),this.constThumbList(d,f,j)));this.fileType&&1===o.parseToNumber(this.start)&&(h.find("#msAttHdr"+this.fileType).find(".SC_nobdr").remove(),h.find("#msAttHdr"+this.fileType).removeClass("zmAmht")),this.findScroll()},constThumbList:function(a,b,c,d){var e,f,g,h,i,j=a.length,k=!1,l=!1,m=0,n=1,p=this;d=d||!1,h=this.fileTypeShowAll,f=this.$el,g=this.widthConst,h[c].isHidden=!1,i=f[0].scrollWidth,f.is(":hidden")&&("attComp"===this.appName?i=f.closest(".SC_PUcen")[0].scrollWidth:(f=zmsuite.getCenter()[0].getNodes()[2].$el,i=f[0].scrollWidth));for(var q=0;q<j;q++){var r,s=a[q];if(s.Id)if(r=o.consList(s,this.dType,this.appName,this.viewType)[0],b.append(r),1!==o.parseToNumber(this.start)||d||0!==this.fileType){if(!d&&q===j-2&&a[j-1].showNextPage){var t,u,v=b.children().length;t=this.thumbCount,u=(v-1)%t,e=v-u+1,k=!0,l=!0;for(var w=0;w<u;w++)b.children(":last").remove()}}else{if(m+=g,(m>i||h[c].insertSingleAttachment)&&2===n){b.children(":last").remove(),e=q,k=!0,this["showNxt"+c]=a[a.length-1].showNextPage,void 0!==h[c].insertSingleAttachment&&(h[c].insertSingleAttachment=!1),this.thumbCount=q/2;break}(m>i||h[c].insertSingleAttachment)&&(n=2,m=g)}else this["showNxt"+c]=s.showNextPage,s.showNextPage&&!k&&(k=!0)}k?("y"===this.isnew||l?h[c].stoppedIndex=0:h[c].stoppedIndex-=1,h[c].isHidden=!0,h[c].stoppedIndex+=e,b.find(".SC_lnk").off("click").on("click",function(){p.showAllThb(h[c].stoppedIndex,"t",a[a.length-1].showNextPage,this.entity,c,"n",l,b)})):b.find(".SC_lnk").hide()},showAllThb:function(a,b,c,d,e,f,g,h){var i,j,k,l;if(g)j=o.getAttachObject(a,e,this),this.constThumbList(j,h,e,!0);else{i=this.$el.find("#msAttHdr"+e),i.find(".SC_nobdr").remove(),i.find(".SC_lnk").hide();for(var m=101;m<=105;m++)m!==o.parseToNumber(e)&&this.$el.find("#msAttHdr"+m).remove();i.removeClass("zmAmht"),j=o.getAttachObject(a,e,this),this.constThumbList(j,h,e,!0),c&&1!==o.parseToNumber(c)?(k=this.prvFltr," "===k.lblId?this.getAttLst(this.groupId,b,c,d,e,k,f,!1,!0):(l=k,this.getAttLst(this.groupId,b,c,d,e,k,f,l,!0))):(this.fileType=e,this.showHideDefaultview())}},attLst:function(a,b){var d,e,f,g=b.thisRef,h=g.$el,i=g.presentView,j=g.dType;if(b.removeLoadingBand(),b.pView!==i)return void h.children().show();if(d=o.chkAttResp(a))e="y"===g.isnew,"l"===j?("attView"===g.appName||"attComp"===g.appName||"list"===g.viewType?h.removeClass("SC_tmbvw"):h.addClass("SC_tmbvw"),f=g.attLView(a,e),1===g.start?(h.html(f),h.scrollTop(0)):h.find(".zmAch:last").after(f),g.findScroll(h)):(h.addClass("SC_tmbvw"),g.initView=!0,g.attTView(a,e,b.evT));else{if(1===g.start){var k=g.initView||"attView"!==g.appName?c.common.noAttFound:c.common.noAttFoundAll;o.noAttach(h,k)}"t"===g.dType?g["showNxt"+this.fileType]=0:"l"===g.dType&&(g.showNxt=0)}h.children().show(),g.isDone=!1,g.showHideDefaultview(),"attComp"===g.appName&&zmAttachComponent.markSelectedAttachmentInUI()},findScroll:function(){if(!this.onScroll){var a,b,c=this.$el;a="t"===this.dType?this["showNxt"+this.fileType]:this.showNxt,a&&c[0].scrollHeight<=c[0].clientHeight&&(this.start=a,this.isnew="n",b=this.prvFltr," "===b.lblId?this.getGroupAttachments("pagination","scrollEv"):this.getLblAttachments("pagination",b,"scrollEv"))}},getAttLst:function(a,b,c,d,e,f,g,h,i){if(this.groupId!==a||this.dType!==b||this.fileType!==e||this.entity!==d||h&&f.lblId!==h.lblId){var j=b+a+d+e+f.lblId;this.groupId=a,this.dType=b,c?this.start=c:this.start=1,d&&""!==d?this.entity=d:this.entity="all",e?this.fileType=e:this.fileType=0,g?this.isnew=g:this.isnew="n","attView"===this.appName&&(o.listview.previewCard.closePrevCard.call(this),zmsAtt.resetSelectionViewAndData()),this.presentView=j,h&&"boolean"!=typeof h?(f.lblId=h.lblId,f.mthd=h.mthd,this.getLblAttachments("loading",h,i)):(f.lblId=" ",f.mthd=" ",this.getGroupAttachments("loading",i))}},getLblAttachments:function(a,b,c,d,e,f){var g,i,j=this.$el,k=f||j[0],l=d||this.start,m={method:b.mthd,dType:this.dType,from:l,range:25,groupId:this.groupId};this.isDone=!0,g=this.attLst,"all"!==this.entity&&(m.entityType=h[this.entity]),i=e||this.fileType,0!==i&&(m.fileType=i),"labelListing"===b.mthd&&(m.label=b.lblId),1===o.parseToNumber(l)&&(this.attDet=[],j.children().hide()),"streams"!==this.appName&&"attComp"!==this.appName||(a="pagination"),o.ajaxReq.getGroupLblAttachments({paramInfo:m,ep:{evT:c,pView:this.presentView,thisRef:this}},g,{loadingContainer:k,loadingType:a})},getGroupAttachments:function(a,b){var c,d,e=this.$el,f={};this.isDone=!0,c=this.presentView,d=this.attLst,this.requireParams&&this.requireParams.constructor===Object?$.extend(!0,f,this.requireParams):(f.type=this.dType,f.frm=this.start,f.entity=this.entity,f.ftype=this.fileType,f.groupId=this.groupId),f.frm=this.start,1===o.parseToNumber(this.start)&&(this.attDet=[],e.children().hide()),"streams"!==this.appName&&"attComp"!==this.appName||(a="pagination"),o.ajaxReq.getGroupAttachments({paramInfo:f,ep:{evT:b,pView:c,thisRef:this}},d,{loadingContainer:e[0],loadingType:a})},showHideDefaultview:function(){if(this.onFilterAction)return void this.onFilterAction();var a=this.$topEl,b=a.find("#zmMyAttachments"),d=this.prvFltr.lblId;if(this.groupId===zmail.zuid&&"all"===this.entity&&0===this.fileType&&" "===d)a.find("#zmDfltAttView").hide(),b.html(c.common.me),a.find(".SC_frt").find("li").find("b").eq(0).removeClass("SC_sel");else{a.find("#zmDfltAttView").show();var e,f=c.menuText.notags,g=zmail.zuid===this.groupId?c.menuText.me:zmCont.getGroup()[this.groupId].name;e="f"===d?c.menuText.favourites:" "===d?f:zmUtil.getTagList("default")[d].dispName,b.html(zmAttachment.templates.filterByMsg+": "+_zm.escapeTags(g)+" - "+zmAttachUtility.entDrpTxtChange(this.entity)+" - "+c.fType[this.fileType]+" - "+_zm.escapeTags(e)+"  "),a.find(".SC_frt").find("li").find("b").eq(0).addClass("SC_sel")}}};var q=function(){var a,b=0,d=[],g=0,h={},i={},j=function(a){zmailSlideShow.closeSlideshow(),a&&$.publish("zm/closeAllOpenDialog")},k=function(a){return"number"!=typeof a&&(a=o.parseToNumber(a)),1===a?"msi-mail":2===a?"msi-notes":3===a?"msi-task":4===a?"msi-calendar":6===a?"msi-status":void 0},p=function(a){return"msi-attimg"===a[1]||"msi-attpdf"===a[1]||"msi-attdoc"===a[1]&&m[a[2]]||"msi-attothers"===a[1]&&m[a[2]]},q=function(a,b,c){switch(a){case"msi-mail":j(!0),o.openMail(b);break;case"msi-notes":j(),zmUtil.isNoteReactUser()?zmUtil.loadNotes("openNote",b):o.openPost(b);break;case"msi-task":j(),o.openPost(b);break;case"msi-calendar":j(),o.openPost(b);break;case"msi-status":j(),o.openPost(b);break;case"msi-search":var d=c,e={id:"zm_lstSrc",par:d,align:"pright"};e.divId="zm_dropDown",d.find("b").addClass("SC_ddn"),e.list=l,e.align="mright",e.showArrow=!0,e.direction="bottom",e.clk=function(a){var c=a.action;1===c?o.searchAttachment("sender",b):2===c&&o.searchAttachment("filetype",b),zmUtil.hideMenu(),j(!0)},zmDrop.consDropDown(e),$("#zm_dropDown").css("zIndex",1e6);break;case"msi-send":j(!0),o.sendMail(b);break;case"msi-share":j(),zmUtil.loadNewPostDialog("",[b]);break;case"msi-fav":o.attFav(b,c);break;case"addLabel":o.addLabel(b,"slideShow");break;case"removeLabel":o.removeLabelApi(b,o.removeLabelApiResult);break;case"msi-print":o.printImageAtt(b);break;case"msi-unhide":o.restoreToAttachmentView(b)}},r=function(a){var b=k(a.et),d="."+b,g="msi-fav",i=zmUtil.fileTyp(a.fn),j={};if((!h.hideIcons||h.hideIcons.indexOf(b)<0)&&(j.entity={"class":b,title:e[f.indexOf(b)],events:[{name:"click",listener:function(a,c){q(b,c)}}],before:".msi-send"}),(!h.hideIcons||h.hideIcons.indexOf("msi-print")<0)&&p(i)&&(j.print={"class":"msi-print",id:"attMsi-print",title:c.prevMenu.printImg,events:[{name:"click",listener:function(a,b){q("msi-print",b)}}],after:".msi-download"},d=".msi-search"),"msi-mail"===b&&(!h.hideIcons||h.hideIcons.indexOf("msi-search")<0)&&(j.search={"class":"msi-search",title:c.prevMenu.search,events:[{name:"click",listener:function(a,b){var c=$(a.target||a.srcElem);q("msi-search",b,c)}}],before:".msi-mail"},d=".msi-search"),!h.hideIcons||h.hideIcons.indexOf(g)<0){var l;a.l&&a.l.length&&"$6"===a.l[0]&&(g+=" SC_fav"),l="msi-fav"===g?c.UserMsg.fav:c.UserMsg.remFav,j.fav={"class":g,title:l,events:[{name:"click",listener:function(a,b){var c=!0,d=$(a.target||a.srcElement);d.hasClass("SC_fav")?(c=!1,b.l&&b.l.length&&"$6"===b.l[0]&&b.l.splice(0,1)):b.l&&b.l.unshift("$6"),q("msi-fav",b,c)}}],before:d}}return j},s=function(a){return $.extend(!0,{},a,h.addIcons)},t=function(){return{text:c.UserMsg.download,listener:function(a,b){zmUtil.downloadAttachment(b)}}},u=function(){var a={},b=".msi-download";return zmUtil.isAddToCloudAllowed()&&(a.addToCloud={"class":"msi-addcloud",title:c.UserMsg.addToCloud,events:[{name:"click",listener:function(a,b){j(!0),zmUtil.cloudUploader(b)}}]},b=".msi-addcloud"),a.download={"class":"msi-download",title:c.UserMsg.download,events:[{name:"click",listener:function(a,b){zmUtil.downloadAttachment(b)}}]},a.send={"class":"msi-send",title:c.UserMsg.attachToNewMail,events:[{name:"click",listener:function(a,b){q("msi-send",b)}}],before:b},a.share={"class":"msi-share",title:c.UserMsg.attachToPost,events:[{name:"click",listener:function(a,b){q("msi-share",b)}}],before:".msi-send"},a},v=function(a){var b,c=zmUtil.fileTyp(a.fn);if(!("msi-attdoc"!==c[1]&&"msi-attppt"!==c[1]&&"msi-attsheet"!==c[1]||m[c[2]]))return zmUtil.getTheSrc("OpenDocument",a);if("msi-attpdf"===c[1]||"msi-attdoc"===c[1]&&m[c[2]]||"msi-attothers"===c[1]&&m[c[2]]){if(b=!0,(window.ActiveXObject||"ActiveXObject"in window)&&n[c[2]]&&(b=!1),b)return zmUtil.getTheSrc("FileDownload",a)}else{if("msi-attaudio"===c[1]||"msi-attvideo"===c[1])return zmUtil.getTheSrc("FileDownload",a);if("msi-attimg"===c[1])return zmUtil.getTheSrc("FileDownload",a)}return""},w=function(a,b){if(b.l){var c,d=o.getLabelArr(b.l);if(d.length){var e,f=d.length;c=o.labelEnclosure(),e=c.find("#attPrevTag");for(var g=0;g<f;g++){var h,j=d[g],k=zmUtil.getTagList("default")[j];k&&(h=o.constLabelDiv(k,b),h.css("color","white"),h.css("background-color","black"),e.append(h))}e.append($(zmAttachment.templates.addTagIcon)),a.find("#znAtt_lbl").remove(),a.find(".At_opt").prepend(c)}else c=a.find("#znAtt_lbl"),c.length&&c.remove(),c=o.labelEnclosure(),a.find(".At_opt").prepend(c),c.find("#attPrevTag").append($(zmAttachment.templates.addTagIcon));c.find("#attPrevTag").find(".msi-label,.msi-plus").off("click").on("click",function(){q("addLabel",i[b.Id+b.e])})}},x=function(){a=zmComponent.keybindings.getScope();var b={allowDefaultScope:!1,shortcuts:[{uid:"close",keyStr:"esc",actions:[function(){}]}],scope:"slideshowwrapper"};zmComponent.keybindings.registerAll(b),zmComponent.keybindings.setScope("slideshowwrapper")},y=function(a,b,c){i[b]&&i[b].l.indexOf(c)<0&&i[b].l.push(c)},z=function(a,b,c){if(i[b]){var d=i[b].l,e=d.indexOf(c);e>=0&&d.splice(e,1)}},A=function(a,b,c){if(i[b]){var d=i[b],e=d.l,f=e.indexOf("$6");c?f<0&&e.unshift("$6"):f>=0&&e.splice(f,1)}},B=function(){$.unsubscribe("attachment/addLabel",y),$.unsubscribe("attachment/removeLabel",z),$.unsubscribe("attachment/modifyFavLbl",A),$.unsubscribe("attachment/closeSlideshow",j)},C=function(){zmComponent.keybindings.dropScope("slideshowwrapper"),zmComponent.keybindings.setScope(a),B(),"function"==typeof h.onCancel&&h.onCancel()},D=function(){$.subscribe("attachment/addLabel",y),$.subscribe("attachment/removeLabel",z),$.subscribe("attachment/modifyFavLbl",A),$.subscribe("attachment/closeSlideshow",j)},E=function(a){return!!a&&!!a.attObjList},F=function(a){b=a.startIndex||0,d=a.attObjList,g=d.length,h=a,i={}},G=function(){var a,e={},f={},j=!1;x(),e.attachmentObjectList=[],e.swfPath=zmail.swfPath,e.setIndex=b,e._i18NText={common:c.common,prevMenu:c.prevMenu},e.onCancel=C,h.hideAllOptions||(e.rightIconList=u()),h.targetEle&&(e.targetEle=h.targetEle,e.onCloseAnimation=!0);for(var k=0;k<g;k++)f={},a=d[k],f.isImage=101===a.ft,f.filename=a.fn||"",f.source=a.src||v(a),f.thumbnail=a.thn,f.handBackObj=a,i[a.Id+a.e]=a,h.hideAllOptions||(f.iconList=r(a),f.action=t(a)),(a.callee_type||a.showInFrame)&&(e.ignoreThumb=!0,f.showInFrame=a.showInFrame),h.ignoreThumb&&(e.ignoreThumb=h.ignoreThumb),a.hideFileName&&(j=!0),a.hideShareOption&&(f.hideShareOption=a.hideShareOption),a.tweetText&&(f.tweetText=a.tweetText,f.featureURL=window.location.protocol+"//zoho.to/newzmail"),h.addIcons instanceof Object&&(f.iconList=s(f.iconList)),e.attachmentObjectList.push(f);e.afterPreviewInit=function(a,b){if(b.l=i[b.Id+b.e].l,(window.ActiveXObject||"ActiveXObject"in window)&&"msi-attpdf"===zmUtil.fileTyp(b.fn)[1]&&window.setTimeout(function(){a.find(".At_load").remove(),a.find("iframe").css("visibility","visible")},2e3),zmUtil.isZohoAccount(zmail.accId)&&!h.hideAllOptions&&(!h.hideIcons||h.hideIcons.indexOf("msi-fav")<0)){var c=a.find(".msi-fav"),d=b.l;d&&d.length&&"$6"===d[0]?c.addClass("SC_fav"):c.removeClass("SC_fav"),w(a,b)}},(h.hideFileName||j)&&(e.hideFileName=!0),h.onLoad&&(e.onLoad=h.onLoad),e.iconClasses={closeClass:"msi-close",prevClass:"msi-atprev",nextClass:"msi-atnext",moreClass:"msi-action",zoominClass:"msi-zoomin",zoomoutClass:"msi-zoomout",printClass:"msi-print",addToCloudClass:"msi-addcloud",downloadClass:"msi-download"},zmail.showFeature&&(e.loupe=!0,e.iconClasses.loupeClass="msi-spam"),e.afterInit=function(a){a.removeClass("ZC_lightbox SC_lightbox")},e.shortCuts=[{keyStr:"ctrl+p",action:function(a){if(a&&a.fn&&a.e){var b=zmUtil.fileTyp(a.fn);p(b)&&q("msi-print",a)}},preventDefault:!0},{keyStr:"cmd+p",action:function(a){if(a&&a.fn&&a.e){var b=zmUtil.fileTyp(a.fn);p(b)&&q("msi-print",a)}},preventDefault:!0}],zmAppLoader.load("slideshowComp").done(function(){zmailSlideShow.initSlideShow(e)})},H=function(a){E(a)?(F(a),G(),D()):zmUtil.debugLog("Slideshow: Invalid config")};return{init:H,action:q}}(),r=function(){function a(a){this.attachUtil=null,this.config=a}var b=function(a,b){this.attachUtil.$el.off(a).on(a,b.bind(this))};a.prototype.initComponent=function(){var a=this;this.attachUtil=new zmAttachUtility.AttachmentListing(this.config),this.config.listElem.undelegate("click").delegate(".zmAch","click",function(b){a.attachUtil.onListingClick(b,this)}),b.call(this,"contextmenu",function(a){o.listOptions.call(this,a)}),this.attachUtil.dType="l",this.attachUtil.initAttachViewComp()},a.prototype.init=function(a){this.reset(a),this.attachUtil.getGroupAttachments()},a.prototype.onScroll=function(){this.attachUtil.onScroll&&this.attachUtil.getAttachemntOnScroll()},a.prototype.reset=function(a){a&&(a.headerElem&&(a.headerElem.append('<div class="SC_tmbvw"></div>'),a.listElem=a.headerElem.find(".SC_tmbvw"),this.attachUtil.$topEl=a.headerElem,this.attachUtil.$el=a.listElem,b.call(this,"contextmenu",function(a){o.listOptions.call(this,a)})),a.groupId&&(this.attachUtil.groupId=a.groupId),a.onScroll&&(this.attachUtil.onScroll=a.onScroll),a.viewType&&(this.attachUtil.viewType=a.viewType),a.entity&&(this.attachUtil.entity=a.entity),a.fileType&&(this.attachUtil.fileType=a.fileType),this.attachUtil.start=1)},a.prototype.isNewRequest=function(){return 1===this.attachUtil.start},a.prototype.toggleView=function(){"list"===this.attachUtil.viewType?(this.attachUtil.viewType="thumb",this.attachUtil.$el.addClass("SC_tmbvw")):(this.attachUtil.viewType="list",this.attachUtil.$el.removeClass("SC_tmbvw"))};var c=function(b){var c;return b.headerElem.append('<div class="SC_tmbvw"></div>'),b.listElem=b.headerElem.find(".SC_tmbvw"),b.thumbWidth||(b.thumbWidth=191),b.viewType||(b.viewType="thumb"),c=new a(b),c.initComponent(),c};return{init:c}}();b.enTypeTitle=e,b.enTypeClsArr=f,b.attType=g,b.AttachmentListing=a,b.AttLstArr=i,b.AttEntLst=j,b.getGroups=o.getGroups,b.getLabels=o.getLabels,b.attDropDown=o.attDropDown,b.entDrpTxtChange=o.entDrpTxtChange,b.noAttach=o.noAttach,b.consList=o.consList,b.thumbNailContainer=o.thumbNailContainer,b.getGroupAttachments=o.ajaxReq.getGroupAttachments,b.getGroupLblAttachments=o.ajaxReq.getGroupLblAttachments,b.addEventsToCal=o.addEventsToCal,b.addToCloud=o.uploadToCloud.initAddToCloud,b.addToCloudClose=o.uploadToCloud.addToCloudClose,b.cloudUpload=o.uploadToCloud.cloudUpload,b.getFilterDropTemplate=p.getFilterDropTemplate,b.initSlideshow=q.init,b.initAttachListing=r.init,b.bindAttachListEvents=o.bindAttachListEvents,b.closePrevCard=o.listview.previewCard.closePrevCard,b.createAttContextMenu=o.listOptions,b.removeLabelRef=o.removeLabelRef,b.addLabelRef=o.addLabelRef,b.modifyFavLblRef=o.modifyFavLblRef,b.isRestrictedIE=o.isRestrictedIE,b.isDocsCompAllowed=o.isDocsCompAllowed,b.parseToNumber=o.parseToNumber,b.parseToInteger=o.parseToInteger}();