window.zmAppList=function(){"use strict";var a=function(b,c){this.appList=a.util.getSortedAppList(b),this.popAccList=c,this.appObj={},this.accListObj={},this.$el=$("<div class='zm_apps'>")};return a.prototype={set:function(a){this.appList=a},setPopAccArr:function(a){this.popAccList=a},constructDOM:function(b){var c,d,e,f;for(f=$("<ul>"),d=this.appList.length,c=0;c<d;c+=1)e=new a.appIcon(this.appList[c]),this.appObj[this.appList[c].id]=e,f.append(e.getDOM());return b||this.$el.append(f),f},constructAccountsDOM:function(b){var c,d,e,f,g,h,i,j=3,k=zmail.aInfo,l=this.popAccList;if(d=this.popAccList.length){for(f=$("<ul>"),h=function(a){return function(){String(zmail.accId)!==String(a)?(zmUtil.switchAccount(a),$.publish("/mail/accountSwitch",{status:"started",accountID:a})):"m"!==zmApp.currentApp&&zmApp.showApp("m")}},c=0;c<j&&c<d;c+=1){var m=l[c],n={};n.id=m,n.mailId=k[m].mailId,n.count=k[m].c,n.clk=h(m),e=new a.accountsIcon(n),this.accListObj[m]=e,f.append(e.getDOM())}if(c===j&&c!==d){var o={};o.clk=function(a){var b,e={},f=[];for(b=c;b<d;b+=1)g=k[l[b]].mailId,i=k[l[b]].c,i&&(i=parseInt(i),isFinite(i)&&i>0&&(g+="<span class='zm_mct'>"+i+"</span>")),f.push({htm:g,data:{id:l[b]}});e.list=f,e.clk=function(a,b,c){if(a&&a.id){zmUtil.switchAccount(a.id),$.publish("/mail/accountSwitch",{status:"started",accountID:a.id}),zmUtil.hideMenu();var d=zmail.appList.popAccList.indexOf(a.id);if(d>0){var e=zmail.appList.popAccList.splice(d,1);zmail.appList.popAccList.unshift(e[0]),zmAdHocSettings.setAccountsLhsOrder(_.first(zmail.appList.popAccList,3).join(",")),zmail.appList.reRenderAccArea(),zmail.appList.accListObj[a.id]&&zmail.appList.accListObj[a.id].selectAccount()}}},e.par=a,e.onHide=function(){zmail.isInternalOrgUser&&zmail.appList.$el.removeClass("lAppExpand")},e.align="cleft",zmsuite.showMenu(e),zmail.isInternalOrgUser&&zmail.appList.$el.addClass("lAppExpand")},o.type="more",e=new a.accountsIcon(o),f.append(e.getDOM())}return b||this.$el.append(f),f}},getDOM:function(){return this.$el},removeAndInsertBefore:function(a,b){if(this.appObj[a]&&this.appObj[a].$el){this.appObj[a].$el.remove();var c=this.appObj[a].getDOM();this.appObj[b]&&this.appObj[b].$el?this.appObj[b].$el.before(c):this.$el.append(c)}},removeAndInsertAfter:function(a,b){if(this.appObj[a]&&this.appObj[a].$el){this.appObj[a].$el.remove();var c=this.appObj[a].getDOM();this.appObj[b]&&this.appObj[b].$el?this.appObj[b].$el.after(c):this.$el.append(c)}},reRender:function(){this.$el.empty(),zmail.leftAppOrder=zmAdHocSettings.getAppOrder(),this.appList=a.util.getSortedAppList(this.appList),this.constructDOM(),this.constructAccountsDOM(),zmApp.selectApp(zmApp.currentApp)},reRenderAppArea:function(){this.$el.find("ul").eq(0).remove(),zmail.leftAppOrder=zmAdHocSettings.getAppOrder(),this.appList=a.util.getSortedAppList(this.appList);var b=this.constructDOM(!0);this.$el.prepend(b)},reRenderAccArea:function(){this.$el.find("ul").eq(1).remove();var a=this.constructAccountsDOM(!0);a&&this.$el.append(a)},removeAppSelection:function(){var a=this.$el.find("ul").eq(0);a.find("li").removeClass("sel")},removeAccountSelection:function(){var a=this.$el.find("ul").eq(1);a.find("li").removeClass("sel")}},a}(),window.zmAppList=function(a){"use strict";var b=zmText.get("appsListframework"),c=function(a){this.accInfo=a,this.$el=$("<li>")};return c.prototype={set:function(a){this.accInfo=a},validateCountVal:function(a){var b=window.parseInt(a);return(!isFinite(b)||b<1)&&(b=0),b},getCountValue:function(a){var b="";return a=window.parseInt(a),b=isFinite(a)&&a>0?a>99?"99+":String(a):""},setToolTip:function(){var a=this.accInfo.mailId;this.accInfo.count&&"0"!==this.accInfo.count&&(a+=" ("+this.accInfo.count+")"),zmComponent.tooltip({elm:this.$el[0],text:a,arrow:"left"})},updateCount:function(a,b){a=this.validateCountVal(a);var c=this.getCountValue(a),d=this.$el.find(".zm_mct");this.accInfo.count=a,a?(d.length?d.text(c):(d=$("<span class='zm_mct'>"+c+"</span>"),this.$el.append(d)),"inc"!==b&&"bulkInc"!==b||d.addClass("newPopMail")):d&&d.remove(),this.setToolTip()},getIconDom:function(a){var b="msi-otherac";return a.indexOf("@gmail")>0?b="msi-gmail":a.indexOf("@yahoo")>0||a.indexOf("@ymail")>0?b="msi-yahoo":a.indexOf("@outlook")>0&&(b="msi-outlook"),b},getCountDom:function(a){return a=this.getCountValue(a),a?"<span class='zm_mct'>"+a+"</span>":""},constructDOM:function(){var a,c=this;if(c.accInfo.type&&"more"===c.accInfo.type)this.$el.html("<i class='msi-moreac'></i><span class='lAppLbl'></span>"),zmComponent.tooltip({elm:this.$el[0],text:b.more,arrow:"left"}),this.$el.off("click").click(function(){c.accInfo.clk(c.$el)});else{var d=c.accInfo.mailId;a="<i class='"+c.getIconDom(d)+"'></i>",this.$el.html(a+"<span class='lAppLbl'></span>"+c.getCountDom(c.accInfo.count)),zmail.isInternalOrgUser&&this.$el.find(".lAppLbl").text(this.accInfo.mailId),this.setToolTip(),this.$el.off("click").click(function(){c.selectAccount(),c.accInfo.clk()})}},selectAccount:function(){this.$el.parent().find("li").removeClass("sel"),zmail.appList.removeAppSelection(),this.$el.find(".zm_mct").removeClass("newPopMail"),this.$el.addClass("sel")},getDOM:function(){return this.constructDOM(),this.$el}},a.accountsIcon=c,a}(window.zmAppList),window.zmAppList=function(a){"use strict";var b=function(a){this.appData=a,this.$el=$("<li>")};return b.prototype={set:function(a){this.appData=a},constructDOM:function(){var a=this;this.$el.html("<i class='"+this.appData.icon+"'><i class='path1'></i><i class='path2'></i></i>"),zmail.isInternalOrgUser?this.$el.append("<span class='lAppLbl'>"+this.appData.tooltip+"</span>"):zmComponent.tooltip({elm:this.$el[0],text:this.appData.tooltip,arrow:"left"}),this.$el.off("click").click(function(){a.selectApp(),a.appData.clk()})},selectApp:function(){this.$el.parent().find("li").removeClass("sel"),zmail.appList.removeAccountSelection(),this.$el.addClass("sel")},getDOM:function(){return this.constructDOM(),this.$el}},a.appIcon=b,a}(window.zmAppList),window.zmAppList=function(a){"use strict";var b=a.util={};return b.getSortedAppList=function(a){if(zmail.leftAppOrder instanceof Array||(zmail.leftAppOrder=zmail.leftAppOrder?zmail.leftAppOrder.split(","):[]),a&&a.length)return _.sortBy(a,function(a){var b=zmail.leftAppOrder.indexOf(a.id);return b>-1?b:100})},a}(window.zmAppList);