"use strict";function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!=typeof b&&"function"!=typeof b?a:b}function _inherits(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!=typeof b&&"function"!=typeof b?a:b}function _inherits(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!=typeof b&&"function"!=typeof b?a:b}function _inherits(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!=typeof b&&"function"!=typeof b?a:b}function _inherits(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!=typeof b&&"function"!=typeof b?a:b}function _inherits(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}!function(){var a=zmail.Core.Namespaces,b=a.create("zmail.Components.AutoComplete.Constants"),c={ESC:27,ENTER:13,SPACE:32,LEFT:37,UP:38,RIGHT:39,DOWN:40,DELETE:46,BACKSPACE:8,TAB:9,COMMA:188,SHIFT:16,CTRL:17,ALT:18,META:91,RIGHT_META:93},d={DOM_MOUNTED:"domMounted"};b.KEYS=c,b.EVENTS=d}(),function(){var a=zmail.Core.Namespaces,b=a.create("zmail.Components.AutoComplete.Utils"),c=zmail.Components.AutoComplete,d=c.Constants,e=function(a,b){return"function"==typeof a?_.debounce(a,b):null},f=function(a,b){return"function"==typeof a?_.throttle(a,b):null},g=function(){return $.Deferred()},h=function(a){var b=$("<div />");return b.html(a),b=$(b.children(0))[0]},i=function(a,b,c){c=c||"ref",a=$(a);var d,e,f,g=$("["+c+"]",a),h={};for(g=g||[],$(a).attr(c)&&g.push($(a)[0]),d=0,e=g.length;d<e;d++)f=g[d],h[$(f).attr(c)]=$(f)[0],b&&$(f).removeAttr(c);return h},j=function(a){return a===document.body||document.body.contains(a)},k=function(a,b,c){c=c||{};var e=c.parentComponent||null,f=!1,g=!1;f=j(b),g=f,e&&(g=j(e.dom)),(f||e)&&(a._mounted!==!0&&(b.appendChild(a.dom),a._mounted=!0),g&&$(a).triggerHandler(d.EVENTS.DOM_MOUNTED,{dom:a.dom}))},l=function(a){a&&($(a.dom).remove(),a._mounted=!1)},m=function(a,b){a=a||"",b=b||a.length;var c=a.substring(0,b),d=/(?:(?=\s*)([\S]+[^\S\n]*)$)/i,e=d.exec(c),f=e?e[1]:"";return f},n=function(){var a=$("#ztb-topband")[0],b=$("#wmstoolbar")[0],c=$(".zsw-enclosure.shw")[0],d=document.body.getBoundingClientRect(),e={top:d.top,right:d.right,bottom:d.bottom,left:d.left};return a&&(e.top=a.getBoundingClientRect().bottom),b&&(e.bottom=b.getBoundingClientRect().top),c&&(e.right=c.getBoundingClientRect().left),e},o=function(a){var b=null,c=null,d=null,e=null,f=null,g=0,h=0,i=0,j=0,k=!0,l=!1;a=a||{},c={left:0,top:0},b=a.dom,e=a.viewPortBounds,d=a.anchorBounds,$(b).css({height:"auto"}),f=b.getBoundingClientRect(),c.left=d.left,c.top=d.bottom,g=Math.abs(d.top-e.top),h=Math.abs(d.bottom-e.bottom),i=Math.abs(d.left-e.left),j=Math.abs(d.left-e.right),h<f.height&&g>h&&(c.top=d.top-f.height,c.top<e.top&&(c.top=e.top),k=!1),j<f.width&&i>j&&(c.left-=Math.abs(f.width-d.width)),k&&h<f.height&&($(b).css({height:h+"px"}),l=!0),!k&&g<f.height&&($(b).css({height:g+"px"}),l=!0),$(b).css({top:c.top+"px",left:c.left+"px"});var m={overflow:l};return l&&(m.height=k?h:g),m},p=function(a,b){return{top:a.top+b.top,right:a.left+b.left+b.width,left:a.left+b.left,bottom:a.top+b.top+b.height,width:b.width,height:b.height}};b.constructDOM=h,b.getDOMReferenceMap=i,b.debounce=e,b.throttle=f,b.deferred=g,b.mountComponent=k,b.unmountComponent=l,b.findWordAtIndex=m,b.getListComponentViewPort=n,b.positionDOM=o,b.getAbsoluteBounds=p}();var _createClass=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}();!function(){var a=zmail.Core.Namespaces,b=a.create("zmail.Components.AutoComplete.System"),c=function(){function a(){_classCallCheck(this,a);var b=this;b._element=null}return _createClass(a,[{key:"init",value:function(a){var b=this;b._element=a,b.bindEvents()}},{key:"destroy",value:function(){var a=this;a.unbindEvents(),a._element=null}},{key:"bindEvents",value:function(){throw new Error("Yet to be implemented")}},{key:"unbindEvents",value:function(){throw new Error("Yet to be implemented")}},{key:"getText",value:function(){throw new Error("Yet to be implemented")}},{key:"setText",value:function(){throw new Error("Yet to be implemented")}},{key:"getCursorPosition",value:function(){throw new Error("Yet to be implemented")}},{key:"setCursorPosition",value:function(){throw new Error("Yet to be implemented")}},{key:"getListAnchorBounds",value:function(){throw new Error("Yet to be implemented")}},{key:"saveCursorPosition",value:function(){throw new Error("Yet to be implemented")}},{key:"restoreCursorPosition",value:function(){throw new Error("Yet to be implemented")}},{key:"focus",value:function(){throw new Error("Yet to be implemented")}}]),a}();b.AbstractInput=c}();var _createClass=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}();!function(){var a=zmail.Core.Namespaces,b=a.create("zmail.Components.AutoComplete.System"),c=zmail.Components.AutoComplete,d=c.System.AbstractInput,e=function(){function a(){_classCallCheck(this,a);var b=this;b._input=null}return _createClass(a,[{key:"init",value:function(a){var b=this;if(!(a instanceof d))throw new Error("<input> argument should be instance of <AbstractInput>");b._input=a}},{key:"destroy",value:function(){var a=this;a._input=null}},{key:"getSearchToken",value:function(){var a=this,b=a._input;return b.getText()}}]),a}();b.AbstractSearchTokenGetter=e}();var _createClass=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}();!function(){var a=zmail.Core.Namespaces,b=a.create("zmail.Components.AutoComplete.System"),c=zmail.Components.AutoComplete,d=c.System.AbstractInput,e=c.Utils,f={TRIGGER:"trigger",TRIGGER_NEGATIVE:"triggerNegative"},g=function(){function a(){_classCallCheck(this,a);var b=this;b._input=null,b.active=!1}return _createClass(a,[{key:"init",value:function(a){var b=this;if(!(a instanceof d))throw new Error("<input> argument should be instance of <AbstractInput>");b._input=a,b.active=!1,b.bindEvents()}},{key:"destroy",value:function(){var a=this;a.unbindEvents(),a._input=null,a.active=!1}},{key:"textChangeAction",value:function(){}},{key:"_textChangeEventHandler",value:function(){var a=this;a.textChangeAction()}},{key:"publishTriggerEvent",value:function(a){var b=this;a=a||{},a.triggerInstance=b,b.active=!0,$(b).triggerHandler(f.TRIGGER,a)}},{key:"publishNegativeTriggerEvent",value:function(a){var b=this;a=a||{},a.triggerInstance=b,(a.force||b.active)&&(b.active=!1,$(b).triggerHandler(f.TRIGGER_NEGATIVE,a))}},{key:"bindEvents",value:function(){var a=this,b=a._input,c=null;a._textChangeEventHandler=a._textChangeEventHandler.bind(a),a._textChangeEventHandler=e.debounce(a._textChangeEventHandler,200),c=a._textChangeEventHandler,$(b).on("textchange",c)}},{key:"unbindEvents",value:function(){var a=this,b=a._input,c=a._textChangeEventHandler;$(b).off("textchange",c)}}]),a}();g.EVENTS=f,b.AbstractTrigger=g}(),function(){var a=zmail.Core.Namespaces,b=a.create("zmail.Components.AutoComplete.System"),c=Backbone.Model.extend({defaults:{id:"",text:"",selected:!1}});b.AbstractListItemModel=c}(),function(){var a=zmail.Core.Namespaces,b=a.create("zmail.Components.AutoComplete.System"),c=zmail.Components.AutoComplete,d=c.System.AbstractListItemModel,e=Backbone.Collection.extend({model:d}),f={LIST_ITEM_CHANGE:"listItemChange"},g=Backbone.Model.extend({defaults:{listItems:null,currentSearchKey:""},createListItemCollection:function(){return new e},initialize:function(){var a=this,b=null;a.set({listItems:a.createListItemCollection()}),b=a.getListItemCollection(),b.on("change",function(b){a.trigger(f.LIST_ITEM_CHANGE,b)})},getListItemCollection:function(){var a=this;return a.attributes.listItems},getListItems:function(){var a=this,b=a.getListItemCollection();return b.models},getSelectedItem:function(){var a=this;return a.getListItems().filter(function(a){return a.attributes.selected===!0})[0]},selectItem:function(a){var b=this,c=b.getListItemCollection(),d=c.get(a),e=b.getSelectedItem();d.attributes.selected||(e&&e.set({selected:!1}),d.set({selected:!0}))},selectNextItem:function(){var a=this,b=a.getListItems();if(b.length){for(var c=0,d=null,e=0,f=b.length;e<f;e++)if(d=b[e],d.attributes.selected){c=e+1;break}c>=b.length&&(c=b.length-1),a.selectItem(b[c].attributes.id)}},selectPreviousItem:function(){var a=this,b=a.getListItems();if(b.length){for(var c=0,d=null,e=0,f=b.length;e<f;e++)if(d=b[e],d.attributes.selected){c=e-1;break}c<0&&(c=0),a.selectItem(b[c].attributes.id)}},resetData:function(){var a=this;a.set({currentSearchKey:""},{silent:!0}),a.get("listItems").reset(null,{silent:!0})}},{EVENTS:f});b.AbstractListItemCollection=e,b.AbstractListModel=g}();var _createClass=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}();!function(){var a=zmail.Core.Namespaces,b=a.create("zmail.Components.AutoComplete.System"),c=zmail.Components.AutoComplete,d=c.System.AbstractListItemCollection,e=c.Utils,f={LIST_UPDATE:"listUpdate",SEARCH_COMPLETE:"searchComplete"},g=function(){function a(){_classCallCheck(this,a);var b=this;b.dataCollection=null,b.searchComplete=!1,b.searchRequest=null,b.enabled=!1}return _createClass(a,[{key:"createListItemCollection",value:function(){return new d}},{key:"init",value:function(){var a=this;a.dataCollection=a.createListItemCollection(),a.enabled=!0}},{key:"destroy",value:function(){var a=this;a.dataCollection=null,a.searchComplete=!1,a.searchRequest=null,a.enabled=!1}},{key:"triggerListUpdate",value:function(){var a=this;$(a).triggerHandler(f.LIST_UPDATE,{provider:a})}},{key:"triggerSearchComplete",value:function(){var a=this;a.searchComplete=!0,$(a).triggerHandler(f.SEARCH_COMPLETE,{provider:a})}},{key:"searchData",value:function(a){a=a||{};var b=a.deferred,c=a.collection;b.resolve(c)}},{key:"getData",value:function(a){var b=this;if(b.enabled){b.abortPendingSearch(),b.searchComplete=!1,b.dataCollection.reset(null,{silent:!0});var c=e.deferred(),d=b.createListItemCollection();b.searchRequest=c,c.done(function(){c===b.searchRequest&&(b.dataCollection.reset(d.models,{silent:!0}),b.triggerSearchComplete())}).fail(function(a){c===b.searchRequest&&(a=a||{},a.cancel||b.triggerSearchComplete())}).always(function(){c===b.searchRequest&&(b.searchRequest=null)}),c.progress(function(){c===b.searchRequest&&(b.dataCollection.reset(d.models,{silent:!0}),b.triggerListUpdate())}),a.collection=d,a.deferred=c,b.searchData(a)}}},{key:"abortPendingSearch",value:function(){var a=this;a.searchRequest&&(a.searchRequest.reject({cancel:!0}),a.searchRequest=null)}}]),a}();g.EVENTS=f,b.AbstractDataProvider=g}();var _createClass=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}();!function(){var a=zmail.Core.Namespaces,b=a.create("zmail.Components.AutoComplete.System"),c=zmail.Components.AutoComplete,d=c.System.AbstractListItemCollection,e=c.Utils,f={ACCUMULATE_COMPLETE:"accumulateComplete"},g=function(){function a(){_classCallCheck(this,a);var b=this;b.dataCollection=null,b.accumulateRequest=null}return _createClass(a,[{key:"createListItemCollection",value:function(){return new d}},{key:"init",value:function(){var a=this;a.dataCollection=a.createListItemCollection(),a.accumulateRequest=null}},{key:"destroy",value:function(){var a=this;a.dataCollection=null,a.accumulateRequest=null}},{key:"triggerAccumulationComplete",value:function(){var a=this;$(a).triggerHandler(f.ACCUMULATE_COMPLETE,{accumulator:a})}},{key:"accumulateData",value:function(a){var b=a.deferred,c=a.collection;b.resolve(c)}},{key:"abortPendingAccumulation",value:function(){var a=this;a.accumulateRequest&&(a.accumulateRequest.reject({cancel:!0}),a.accumulateRequest=null)}},{key:"getAccumulatedData",value:function(a){var b=this;b.abortPendingAccumulation(),b.dataCollection.reset(null,{silent:!0});var c=b.createListItemCollection(),d=e.deferred();a.collection=c,a.deferred=d,b.accumulateRequest=d,d.done(function(){d===b.accumulateRequest&&(b.dataCollection.reset(c.models,{silent:!0}),b.triggerAccumulationComplete())}).always(function(){b.accumulateRequest=null}),b.accumulateData(a)}}]),a}();g.EVENTS=f,b.AbstractDataAccumulator=g}();var _createClass=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}();!function(){var a=zmail.Core.Namespaces,b=a.create("zmail.Components.AutoComplete.System"),c=zmail.Components.AutoComplete,d=c.Utils,e=c.Constants,f=e.KEYS,g=e.EVENTS,h={ITEM:['<div ref="wrapper" class="list-item">','<span ref="label" class="label"></span>',"</div>"].join("")},i={SELECT:"select",FOCUSGAINED:"focusGained",FOCUSLOST:"focusLost"},j=d.constructDOM,k=d.getDOMReferenceMap,l=function(){function a(){_classCallCheck(this,a);var b=this;b.dom=null,b.refs=null,b.state={},b.model=null}return _createClass(a,[{key:"destructor",value:function(){var a=this;$(a).off(),a.uninitializeDOM(),d.unmountComponent(a),a.dom=null,a.refs=null,a.state=null,a.model=null}},{key:"getTemplate",value:function(){return h.ITEM}},{key:"focus",value:function(){var a=this;a.focusTimeoutID=setTimeout(function(){a._mounted&&($(a.refs.wrapper).focus(),a.refs.wrapper.scrollIntoView({behaviour:"smooth",block:"end"}))},0)}},{key:"getSelectionClassName",value:function(){return"selected"}},{key:"createDOM",value:function(){var a=this;return a.dom=j(a.getTemplate()),a.dom}},{key:"createDOMRefs",value:function(){var a=this;return a.refs=k(a.dom,!0),a.refs}},{key:"_preRender",value:function(a){var b=this,c=a.attributes;b.model=a,b.state.selected=c.selected||!1,b.dom?b.uninitializeDOM():(b.createDOM(),b.createDOMRefs())}},{key:"_postRender",value:function(){var a=this;a.initializeDOM()}},{key:"render",value:function(a){var b=this,c=a.attributes;b._preRender(a);var d=b.getSelectionClassName();$(b.refs.label).text(c.text),b.state.selected?$(b.refs.wrapper).addClass(d):$(b.refs.wrapper).removeClass(d),b._postRender()}},{key:"_domMountHandler",value:function(){var a=this;a.state.selected&&a.focus()}},{key:"_handleSelectAction",value:function(a){var b=this;$(b).triggerHandler(i.SELECT,{instance:b,event:a,isClickEvent:"click"===a.type})}},{key:"_clickHandler",value:function(a){var b=this;b._handleSelectAction(a),a.stopPropagation()}},{key:"_keyDownHandler",value:function(a){var b=this,c=a.which||a.keyCode,d=!0;switch(c){case f.ENTER:b._handleSelectAction(a);break;default:d=!1}d&&(a.stopPropagation(),a.preventDefault())}},{key:"initializeDOM",value:function(){var a=this;a._clickHandler=a._clickHandler.bind(a),$(a.refs.wrapper).on("click",a._clickHandler),a._keyDownHandler=a._keyDownHandler.bind(a),$(a.refs.wrapper).on("keydown",a._keyDownHandler),a._domMountHandler=a._domMountHandler.bind(a),$(a).on(g.DOM_MOUNTED,a._domMountHandler)}},{key:"uninitializeDOM",value:function(){var a=this;clearTimeout(a.focusTimeoutID),$(a.refs.wrapper).off("click",a._clickHandler),$(a.refs.wrapper).off("keydown",a._keyDownHandler),$(a).off(g.DOM_MOUNTED,a._domMountHandler)}}]),a}();l.EVENTS=i,b.AbstractListItemComponent=l}();var _createClass=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}();!function(){var a=zmail.Core.Namespaces,b=a.create("zmail.Components.AutoComplete.System"),c=zmail.Components.AutoComplete,d=c.Utils,e=c.Constants,f=c.System.AbstractListItemComponent,g=e.KEYS,h=e.EVENTS,i={LIST:['<div ref="wrapper" class="auto-complete wrapper">','<div ref="listWrapper" class="inner-wrapper">',"</div>","</div>"].join("")},j={SELECT_NEXT:"selectNext",SELECT_PREVIOUS:"selectPrevious",ITEM_SELECTION:"itemSelection",ITEM_SELECTION_CURRENT:"itemSelectionCurrent"},k=d.constructDOM,l=d.getDOMReferenceMap,m=function(){function a(){_classCallCheck(this,a);var b=this;b.dom=null,b.refs=null,b.state={},b.listItemComponents=[],b.model=null,b.listItemComponentFactory=null,b.visible=!1,b.mouseDown=!1}return _createClass(a,[{key:"init",value:function(a){var b=this;a=a||{},b.listItemComponentFactory=a.listItemComponentFactory}},{key:"destroy",value:function(){var a=this;$(a).off(),a.dom&&(a.uninitializeDOM(),d.unmountComponent(a)),a.dom=null,a.refs=null,a.state=null,a.listItemComponents=null,a.model=null,a.listItemComponentFactory=null}},{key:"getTemplate",value:function(){return i.LIST}},{key:"updateScrollIndicators",value:function(){var a=this,b=a.getScrollWrapperDOM(),c=b.getBoundingClientRect(),d=b.scrollHeight-c.height,e=b.scrollTop>0,f=b.scrollTop<d;e?$(a.refs.wrapper).addClass("top-scroll"):$(a.refs.wrapper).removeClass("top-scroll"),f?$(a.refs.wrapper).addClass("bottom-scroll"):$(a.refs.wrapper).removeClass("bottom-scroll")}},{key:"handleSelectAction",value:function(a,b){var c=this;b=b||{},$(c).triggerHandler(j.ITEM_SELECTION,{listItemModel:a,isClickEvent:b.isClickEvent||!1})}},{key:"renderListItem",value:function(a,b){var c=this,e=null;return b=b||{},e=c.listItemComponents.filter(function(b){return a===b.model})[0],e||(e=c.listItemComponentFactory.createComponent(a),$(e).on(f.EVENTS.SELECT,function(b,d){c.handleSelectAction(a,d)})),e.render(a,b),d.mountComponent(e,c.refs.listWrapper,{parentComponent:c}),e}},{key:"createDOM",value:function(){var a=this;return a.dom=k(a.getTemplate()),a.dom}},{key:"createDOMRefs",value:function(){var a=this;return a.refs=l(a.dom,!0),a.refs}},{key:"_preRender",value:function(a){var b=this;b.model=a,b.dom?b.uninitializeDOM():(b.createDOM(),b.createDOMRefs())}},{key:"_postRender",value:function(){var a=this;a.initializeDOM()}},{key:"renderListItems",value:function(a,b){var c=this,d=a.attributes;b=b||{};var e=d.listItems.models;e.forEach(function(a){var d=c.renderListItem(a,b);c.listItemComponents.push(d)})}},{key:"render",value:function(a,b){var c=this;b=b||{},c._preRender(a),c.renderListItems(a,b),c._postRender()}},{key:"focus",value:function(){var a=this;a.focusTimeoutID=setTimeout(function(){a._mounted&&$(a.refs.wrapper).focus()},0)}},{key:"selectNextListItem",value:function(){var a=this;$(a).triggerHandler(j.SELECT_NEXT)}},{key:"selectPreviousListItem",value:function(){var a=this;$(a).triggerHandler(j.SELECT_PREVIOUS)}},{key:"choseCurrentSelectedItem",value:function(){var a=this,b={};return $(a).triggerHandler(j.ITEM_SELECTION_CURRENT,b),b.selection===!0}},{key:"_domMountHandler",value:function(){var a=this;a.listItemComponents.forEach(function(a){$(a).triggerHandler(h.DOM_MOUNTED)}),a.updateScrollIndicators()}},{key:"_keyDownHandler",value:function(a,b){var c=this;b=b||{};var d=a.which||a.keyCode,e=!0,f=!1;switch(d){case g.UP:c.selectPreviousListItem();break;case g.DOWN:c.selectNextListItem();break;case g.ENTER:f=c.choseCurrentSelectedItem(),a.ignoreKeyUp=!0,!f&&b.isProxyEvent&&(e=!1);break;default:e=!1}e&&(a.stopPropagation(),a.preventDefault())}},{key:"_listScrollHandler",value:function(){var a=this;a.dom&&a.updateScrollIndicators()}},{key:"_mouseDownHandler",value:function(){var a=this;a.mouseDown=!0}},{key:"checkMouseDownFlag",value:function(){var a=this,b=a.mouseDown;return a.mouseDown=!1,b}},{key:"proxyKeyDownEvent",value:function(a){var b=this;b._keyDownHandler(a,{isProxyEvent:!0})}},{key:"getScrollWrapperDOM",value:function(){var a=this;return a.refs.listWrapper}},{key:"getViewPortBounds",value:function(){return d.getListComponentViewPort()}},{key:"handleListSpaceOverflow",value:function(a){}},{key:"positionComponent",value:function(a){var b=this,c=null;a=a||{},c=a.anchorBounds,$(b.dom).css({visibility:"hidden"}),$(b.dom).css({height:"auto"}),b.show();var e=d.positionDOM({dom:b.dom,anchorBounds:c,viewPortBounds:b.getViewPortBounds()});return e.overflow&&b.handleListSpaceOverflow({height:e.height}),b.updateScrollIndicators(),b.hide(),$(b.dom).css({visibility:"visible"}),e}},{key:"initializeDOM",value:function(){var a=this;a._keyDownHandler=a._keyDownHandler.bind(a),$(a.refs.wrapper).on("keydown",a._keyDownHandler),a._mouseDownHandler=a._mouseDownHandler.bind(a),$(a.refs.wrapper).on("mousedown",a._mouseDownHandler),a._listScrollHandler=d.throttle(a._listScrollHandler,200),a._listScrollHandler=a._listScrollHandler.bind(a);var b=a.getScrollWrapperDOM();$(b).on("scroll",a._listScrollHandler),a._domMountHandler=a._domMountHandler.bind(a),$(a).on(h.DOM_MOUNTED,a._domMountHandler)}},{key:"uninitializeDOM",value:function(){var a=this;clearTimeout(a.focusTimeoutID),$(a.refs.wrapper).off("keydown",a._keyDownHandler),$(a.refs.wrapper).off("mousedown",a._mouseDownHandler);var b=a.getScrollWrapperDOM();$(b).off("scroll",a._listScrollHandler),$(a).off(h.DOM_MOUNTED,a._domMountHandler),a.listItemComponents.forEach(function(a){a.destructor()}),a.listItemComponents=[]}},{key:"show",value:function(){var a=this;$(a.dom).addClass("shown").removeClass("hidden"),a.visible=!0}},{key:"hide",value:function(){var a=this;$(a.dom).addClass("hidden").removeClass("shown"),a.visible=!1}}]),a}();m.EVENTS=j,b.AbstractListComponent=m}();var _createClass=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}();!function(){var a=zmail.Core.Namespaces,b=a.create("zmail.Components.AutoComplete.System"),c=zmail.Components.AutoComplete,d=c.System.AbstractListItemModel,e=c.System.AbstractListItemComponent,f=function(){function a(){_classCallCheck(this,a)}return _createClass(a,[{key:"init",value:function(){}},{key:"destroy",value:function(){}},{key:"createComponent",value:function(a){if(a instanceof d)return new e}}]),a}();b.AbstractListItemComponentFactory=f}();var _createClass=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),_get=function a(b,c,d){null===b&&(b=Function.prototype);var e=Object.getOwnPropertyDescriptor(b,c);if(void 0===e){var f=Object.getPrototypeOf(b);return null===f?void 0:a(f,c,d)}if("value"in e)return e.value;var g=e.get;if(void 0!==g)return g.call(d)};!function(){var a=zmail.Core.Namespaces,b=a.create("zmail.Components.AutoComplete.System"),c=zmail.Components.AutoComplete,d=c.Constants,e=c.System.AbstractInput,f=zmail.Utils.TextArea,g=d.KEYS,h=["input","keyup","cut","paste"],i=[g.UP,g.DOWN,g.LEFT,g.RIGHT],j=[g.UP,g.DOWN,g.LEFT,g.RIGHT,g.ESC,g.SHIFT,g.CTRL,g.ALT,g.META,g.RIGHT_META],k=function(a){var b=a;return i.indexOf(b)!==-1},l=function(a){var b=a;return j.indexOf(b)!==-1},m=function(a){function b(){_classCallCheck(this,b);var a=_possibleConstructorReturn(this,(b.__proto__||Object.getPrototypeOf(b)).call(this)),c=a;return c.savedCursorPostion=null,c.keyUpIgnoreMap=null,a}return _inherits(b,a),_createClass(b,[{key:"init",value:function(a){var c=this;_get(b.prototype.__proto__||Object.getPrototypeOf(b.prototype),"init",this).call(this,a),c.keyUpIgnoreMap={}}},{key:"destroy",value:function(){var a=this;_get(b.prototype.__proto__||Object.getPrototypeOf(b.prototype),"destroy",this).call(this),a.keyUpIgnoreMap=null}},{key:"_inputEventHandler",value:function(a){var b=this,c=b._element,d=a.keyCode||a.which;if("keyup"===a.type){if(l(d))return;if(b.keyUpIgnoreMap[d])return void(b.keyUpIgnoreMap[d]=!1)}$(b).triggerHandler("textchange",{element:c,source:b,event:a})}},{key:"_keyUpEventHandler",value:function(a){var b=this,c=b._element,d=a.keyCode||a.which,e=l(d);return b.keyUpIgnoreMap[d]?void(b.keyUpIgnoreMap[d]=!1):void $(b).triggerHandler("keyup",{element:c,source:b,event:a,isNonCharKey:e})}},{key:"_keyDownEventHandler",value:function(a){var b=this,c=b._element,d=a.keyCode||a.which,e=l(d),f=k(d);$(b).triggerHandler("keydown",{element:c,source:b,event:a,isNonCharKey:e,isArrowKey:f}),a.ignoreKeyUp&&(b.keyUpIgnoreMap[d]=!0)}},{key:"_keyPressEventHandler",value:function(a){var b=this,c=b._element,d=a.keyCode||a.which,e=a.charCode||null,f=l(d),g=k(d);b.keyUpIgnoreMap[d]||$(b).triggerHandler("keypress",{element:c,source:b,event:a,isNonCharKey:f,isArrowKey:g,charCode:e})}},{key:"_focusEventHandler",value:function(a){var b=this,c=b._element;$(b).triggerHandler("focus",{element:c,source:b,event:a})}},{key:"_blurEventHandler",value:function(a){var b=this,c=b._element;$(b).triggerHandler("blur",{element:c,source:b,event:a})}},{key:"bindEvents",value:function(){var a=this,b=a._element;a._inputEventHandler=a._inputEventHandler.bind(a),a._keyUpEventHandler=a._keyUpEventHandler.bind(a),a._keyDownEventHandler=a._keyDownEventHandler.bind(a),a._keyPressEventHandler=a._keyPressEventHandler.bind(a);var c=a._inputEventHandler,d=a._keyUpEventHandler,e=a._keyDownEventHandler;h.forEach(function(a){$(b).on(a,c)}),$(b).on("keyup",d),$(b).on("keydown",e),$(b).on("keypress",a._keyPressEventHandler),a._focusEventHandler=a._focusEventHandler.bind(a),a._blurEventHandler=a._blurEventHandler.bind(a),$(b).on("focus",a._focusEventHandler),$(b).on("blur",a._blurEventHandler)}},{key:"unbindEvents",value:function(){var a=this,b=a._element,c=a._inputEventHandler,d=a._keyUpEventHandler,e=a._keyDownEventHandler,f=a._keyPressEventHandler;h.forEach(function(a){$(b).off(a,c)}),$(b).off("keyup",d),$(b).off("keydown",e),$(b).off("keypress",f),$(b).off("focus",a._focusEventHandler),$(b).off("blur",a._blurEventHandler)}},{key:"getText",value:function(){var a=this,b=a._element;return b.value}},{key:"setText",value:function(a){var b=this,c=b._element;c.value=a}},{key:"getCursorPosition",value:function(){var a=this,b=a._element;return b.selectionStart!==b.selectionEnd?-1:b.selectionStart}},{key:"setCursorPosition",value:function(a){var b=this,c=b._element;c.selectionStart=a,c.selectionEnd=a}},{key:"saveCursorPosition",value:function(){var a=this;a.savedCursorPostion=a.getCursorPosition()}},{key:"restoreCursorPosition",value:function(){var a=this;null!==a.savedCursorPostion&&(a.setCursorPosition(a.savedCursorPostion),a.savedCursorPostion=null)}},{key:"focus",value:function(){var a=this,b=a._element;b.focus()}},{key:"getListAnchorBounds",value:function(){var a=this,b=a._element,c=b.getBoundingClientRect(),d=f.findCursorPosition(b);return{top:c.top+d.top,right:c.left+d.left+d.width,left:c.left+d.left,bottom:c.top+d.top+d.height,height:d.height,width:d.width}}},{key:"getCurrentTypingWord",value:function(){var a=this,b=a._element,c=f.findCurrentTypingWord(b,a.getCursorPosition());return c}},{key:"replaceContentBeforeCursor",value:function(a,b){var c=this,d=c._element;if(a){var e=c.getCursorPosition();if(e!==-1){var f=d.value,g=f.lastIndexOf(a,e);if(g!==-1){var h=f.substring(0,g),i=f.substring(g+a.length);f=h+b+i,d.value=f;var j=b.length-a.length;e+=j,d.selectionStart=e,d.selectionEnd=e}}}}}]),b}(e);b.AbstractHTMLEditable=m}(),function(){var a=zmail.Core.Namespaces,b=a.create("zmail.Components.AutoComplete.System"),c=zmail.Components.AutoComplete,d=c.System.AbstractHTMLEditable,e=function(a){function b(){return _classCallCheck(this,b),_possibleConstructorReturn(this,(b.__proto__||Object.getPrototypeOf(b)).apply(this,arguments))}return _inherits(b,a),b}(d);b.AbstractHTMLInput=e}(),function(){var a=zmail.Core.Namespaces,b=a.create("zmail.Components.AutoComplete.System"),c=zmail.Components.AutoComplete,d=c.System.AbstractHTMLInput,e=function(a){function b(){return _classCallCheck(this,b),_possibleConstructorReturn(this,(b.__proto__||Object.getPrototypeOf(b)).apply(this,arguments))}return _inherits(b,a),b}(d);b.AbstractHTMLTextArea=e}();var _createClass=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}();!function(){var a=zmail.Core.Namespaces,b=a.create("zmail.Components.AutoComplete.System"),c=zmail.Components.AutoComplete,d=c.System.AbstractHTMLTextArea,e=c.Utils,f=function(a){
function b(){return _classCallCheck(this,b),_possibleConstructorReturn(this,(b.__proto__||Object.getPrototypeOf(b)).apply(this,arguments))}return _inherits(b,a),_createClass(b,[{key:"getCurrentTypingWord",value:function(){var a=this,b=a._element;if(document.activeElement!==b)return null;var c=window.getSelection();if(!c||!c.rangeCount)return null;var d=c.getRangeAt(0);if(d.startContainer!==d.endContainer)return null;var f=d.startContainer,g=d.startOffset;if(3!==f.nodeType)return null;var h=f.nodeValue,i=e.findWordAtIndex(h,g);return i}},{key:"getListAnchorBounds",value:function(){var a=this,b=a._element;if(document.activeElement!==b)return null;var c=window.getSelection();if(!c||!c.rangeCount)return null;var d=c.getRangeAt(0);return d.getBoundingClientRect()}}]),b}(d);b.AbstractHTMLContentEditable=f}();var _createClass=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}();!function(){var a=zmail.Core.Namespaces,b=a.create("zmail.Components.AutoComplete.System"),c=zmail.Components.AutoComplete,d=c.System.AbstractInput,e=c.System.AbstractTrigger,f=c.System.AbstractDataProvider,g=c.System.AbstractDataAccumulator,h=c.System.AbstractListItemComponentFactory,i=c.System.AbstractListComponent,j=c.System.AbstractListModel,k=c.Utils,l={ITEM_SELECTED:"itemSelected",ITEM_FOCUS_SELECTED:"itemFocusSelected"},m=function(){function a(){_classCallCheck(this,a);var b=this;b._initialized=!1,b.userInput=null,b.trigger=null,b.searchTokenGetter=null,b.dataProviders=[],b.dataAccumulator=null,b.listItemComponentFactory=null,b.listModel=null,b.listComponent=null,b.parentDOM=null}return _createClass(a,[{key:"createUserInput",value:function(){return new d}},{key:"initUserInput",value:function(a){var b=this;b.userInput=b.createUserInput(),b.userInput.init(a.inputElement)}},{key:"createTrigger",value:function(){return[]}},{key:"initTrigger",value:function(){var a=this;a.trigger=a.createTrigger(),a.trigger.init(a.userInput)}},{key:"createSearchTokenGetter",value:function(){return null}},{key:"initSearchTokenGetter",value:function(){var a=this;a.searchTokenGetter=a.createSearchTokenGetter(),a.searchTokenGetter&&a.searchTokenGetter.init()}},{key:"createDataProviders",value:function(){return[]}},{key:"initDataProviders",value:function(){var a=this;a.dataProviders=a.createDataProviders(),a.dataProviders.forEach(function(a){a.init()})}},{key:"createDataAccumulator",value:function(){return new g}},{key:"initDataAccumulator",value:function(){var a=this;a.dataAccumulator=a.createDataAccumulator(),a.dataAccumulator.init()}},{key:"createListItemComponentFactory",value:function(){return new h}},{key:"initListItemComponentFactory",value:function(){var a=this;a.listItemComponentFactory=a.createListItemComponentFactory(),a.listItemComponentFactory.init()}},{key:"createListModel",value:function(){return new j}},{key:"initListModel",value:function(){var a=this;a.listModel=a.createListModel()}},{key:"createListComponent",value:function(){return new i}},{key:"initListComponent",value:function(){var a=this;a.listComponent=a.createListComponent(),a.listComponent.init({listItemComponentFactory:a.listItemComponentFactory})}},{key:"init",value:function(a){var b=this;b._initialized||(a=a||{},b.initUserInput(a),b.initTrigger(),b.initSearchTokenGetter(),b.initDataProviders(),b.initDataAccumulator(),b.initListItemComponentFactory(),b.initListModel(),b.initListComponent(),b.parentDOM=a.parentDOM,b.bindEvents(),b._initialized=!0)}},{key:"destroy",value:function(){var a=this;a._initialized&&(a.unbindEvents(),a.userInput.destroy(),a.trigger.destroy(),a.searchTokenGetter&&a.searchTokenGetter.destroy(),a.dataProviders.forEach(function(a){a.destroy()}),a.dataAccumulator.destroy(),a.listItemComponentFactory.destroy(),a.listComponent.destroy(),a.userInput=null,a.trigger=null,a.searchTokenGetter=null,a.dataProviders=null,a.dataAccumulator=null,a.listItemComponentFactory=null,a.listModel=null,a.listComponent=null,a.parentDOM=null)}},{key:"renderComponent",value:function(){var a=this;a.listComponent.render(a.listModel)}},{key:"renderListItemComponent",value:function(a){var b=this;b.listComponent.renderListItem(a)}},{key:"getSearchToken",value:function(a){var b=this,c=a.triggerInstance,d=b.searchTokenGetter;return d?d.getSearchToken({trigger:c}):null}},{key:"invokeDataProviderSearch",value:function(a){var b=this,c=b.dataProviders;b.dataAccumulator.dataCollection.reset(null),b.listModel.resetData(),b.listModel.set({currentSearchKey:a.searchToken}),c.forEach(function(b){b.getData({searchToken:a.searchToken,trigger:a.trigger})})}},{key:"handleTriggerAction",value:function(a){var b=this;a=a||{};var c=a.triggerInstance,d=a.searchToken;d||(d=b.getSearchToken(a)),b.invokeDataProviderSearch({searchToken:d,trigger:c})}},{key:"handleTriggerNegativeAction",value:function(a){var b=this;b.cancelAutoComplete()}},{key:"listUpdateAction",value:function(a){var b=this,c=b.dataProviders.map(function(a){return a.dataCollection});b.dataAccumulator.getAccumulatedData({collectionList:c})}},{key:"searchCompleteAction",value:function(a){var b=this;b.listUpdateAction(a)}},{key:"showComponent",value:function(){var a=this,b=a.dataAccumulator.dataCollection;b.length&&(a.listComponent.positionComponent({anchorBounds:a.userInput.getListAnchorBounds()}),a.listComponent.show())}},{key:"hideComponent",value:function(){var a=this;a.listComponent.hide()}},{key:"cancelAutoComplete",value:function(){var a=this;a.hideComponent(),a.dataAccumulator.abortPendingAccumulation(),a.dataProviders.forEach(function(a){a.abortPendingSearch()}),a.dataAccumulator.dataCollection.reset(null),a.listModel.resetData(),a.renderComponent()}},{key:"isComponentVisible",value:function(){var a=this;return a.listComponent.visible}},{key:"isSearchPending",value:function(){var a=this,b=a.dataProviders.filter(function(a){return a.searchComplete!==!0});return b.length>0}},{key:"accumulationCompleteAction",value:function(){var a=this,b=a.dataAccumulator.dataCollection;a.listModel.get("listItems").reset(b.models,{silent:!0}),a.renderComponent(),k.mountComponent(a.listComponent,a.parentDOM),b.length?a.showComponent():a.hideComponent()}},{key:"listItemSelectAction",value:function(a){var b=this;$(b).triggerHandler(l.ITEM_SELECTED,{item:a.listItemModel}),setTimeout(function(){b.cancelAutoComplete()},0)}},{key:"listItemFocusSelectAction",value:function(a){var b=this;$(b).triggerHandler(l.ITEM_FOCUS_SELECTED,{item:a.listItemModel})}},{key:"_triggerActionHandler",value:function(a,b){var c=this;b=b||{},c.handleTriggerAction(b)}},{key:"_triggerNegativeActionHandler",value:function(a,b){var c=this;b=b||{},c.handleTriggerNegativeAction(b)}},{key:"_dataProviderSearchCompleteHandler",value:function(a,b){var c=this;b=b||{},c.searchCompleteAction(b)}},{key:"_dataProviderListUpdateHandler",value:function(a,b){var c=this;b=b||{},c.listUpdateAction(b)}},{key:"_dataAccumulationCompleteHandler",value:function(a,b){var c=this;b=b||{},c.accumulationCompleteAction(b)}},{key:"_componentSelectNextHandler",value:function(a,b){var c=this;b=b||{},c.listModel.selectNextItem();var d=c.listModel.getSelectedItem();d&&c.listItemFocusSelectAction({listItemModel:d})}},{key:"_componentSelectPreviousHandler",value:function(a,b){var c=this;b=b||{},c.listModel.selectPreviousItem();var d=c.listModel.getSelectedItem();d&&c.listItemFocusSelectAction({listItemModel:d})}},{key:"_componentSelectItemHandler",value:function(a,b){var c=this;b=b||{};var d=b.listItemModel;d&&(c.listModel.selectItem(d.attributes.id),c.listItemSelectAction(b),b.isClickEvent&&c.userInput.focus())}},{key:"_componentSelectCurrentItemHandler",value:function(a,b){var c=this;b=b||{};var d=c.listModel,e=d.getSelectedItem();return e?(b.selection=!0,void c.listItemSelectAction({listItemModel:e})):void(b.selection=!1)}},{key:"_modelListItemChangeHandler",value:function(a){var b=this;b.renderListItemComponent(a)}},{key:"_modelChangeHandler",value:function(){var a=this;a.renderComponent()}},{key:"bindEvents",value:function(){var a=this;a._triggerActionHandler=a._triggerActionHandler.bind(a),a._triggerNegativeActionHandler=a._triggerNegativeActionHandler.bind(a),$(a.trigger).on(e.EVENTS.TRIGGER,a._triggerActionHandler),$(a.trigger).on(e.EVENTS.TRIGGER_NEGATIVE,a._triggerNegativeActionHandler),a._dataProviderSearchCompleteHandler=a._dataProviderSearchCompleteHandler.bind(a),a._dataProviderListUpdateHandler=a._dataProviderListUpdateHandler.bind(a),a.dataProviders.forEach(function(b){$(b).on(f.EVENTS.LIST_UPDATE,a._dataProviderListUpdateHandler),$(b).on(f.EVENTS.SEARCH_COMPLETE,a._dataProviderSearchCompleteHandler)}),a._dataAccumulationCompleteHandler=a._dataAccumulationCompleteHandler.bind(a),$(a.dataAccumulator).on(g.EVENTS.ACCUMULATE_COMPLETE,a._dataAccumulationCompleteHandler),a._componentSelectPreviousHandler=a._componentSelectPreviousHandler.bind(a),$(a.listComponent).on(i.EVENTS.SELECT_PREVIOUS,a._componentSelectPreviousHandler),a._componentSelectNextHandler=a._componentSelectNextHandler.bind(a),$(a.listComponent).on(i.EVENTS.SELECT_NEXT,a._componentSelectNextHandler),a._componentSelectItemHandler=a._componentSelectItemHandler.bind(a),$(a.listComponent).on(i.EVENTS.ITEM_SELECTION,a._componentSelectItemHandler),a._componentSelectCurrentItemHandler=a._componentSelectCurrentItemHandler.bind(a),$(a.listComponent).on(i.EVENTS.ITEM_SELECTION_CURRENT,a._componentSelectCurrentItemHandler),a._modelChangeHandler=a._modelChangeHandler.bind(a),a.listModel.on("change",a._modelChangeHandler),a._modelListItemChangeHandler=a._modelListItemChangeHandler.bind(a),a.listModel.on(j.EVENTS.LIST_ITEM_CHANGE,a._modelListItemChangeHandler)}},{key:"unbindEvents",value:function(){var a=this;$(a.trigger).off(e.EVENTS.TRIGGER,a._triggerActionHandler),$(a.trigger).off(e.EVENTS.TRIGGER_NEGATIVE,a._triggerNegativeActionHandler),a.dataProviders.forEach(function(b){$(b).off(f.EVENTS.LIST_UPDATE,a._dataProviderListUpdateHandler),$(b).off(f.EVENTS.SEARCH_COMPLETE,a._dataProviderSearchCompleteHandler)}),$(a.dataAccumulator).off(g.EVENTS.ACCUMULATE_COMPLETE,a._dataAccumulationCompleteHandler),$(a.listComponent).off(i.EVENTS.SELECT_PREVIOUS,a._componentSelectPreviousHandler),$(a.listComponent).off(i.EVENTS.SELECT_NEXT,a._componentSelectNextHandler),$(a.listComponent).off(i.EVENTS.ITEM_SELECTION,a._componentSelectItemHandler),$(a.listComponent).off(i.EVENTS.ITEM_SELECTION_CURRENT,a._componentSelectCurrentItemHandler),a.listModel.off("change",a._modelChangeHandler),a.listModel.off(j.EVENTS.LIST_ITEM_CHANGE,a._modelListItemChangeHandler)}}]),a}();m.EVENTS=l,b.AbstractAutoCompleteSystem=m}();var _createClass=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),_get=function b(a,c,d){null===a&&(a=Function.prototype);var e=Object.getOwnPropertyDescriptor(a,c);if(void 0===e){var f=Object.getPrototypeOf(a);return null===f?void 0:b(f,c,d)}if("value"in e)return e.value;var g=e.get;if(void 0!==g)return g.call(d)};!function(){var a=zmail.Core.Namespaces,b=a.create("zmail.Components.AutoComplete.System"),c=zmail.Components.AutoComplete,d=c.Constants,e=c.System.AbstractHtmlEditable,f=c.System.AbstractAutoCompleteSystem,g=d.KEYS,h=function(a){function b(){return _classCallCheck(this,b),_possibleConstructorReturn(this,(b.__proto__||Object.getPrototypeOf(b)).apply(this,arguments))}return _inherits(b,a),_createClass(b,[{key:"createUserInput",value:function(){return new e}},{key:"inputFocusAction",value:function(){var a=this;a.showComponent()}},{key:"inputBlurAction",value:function(a){var b=this,c=!1,d=a.event;b.listComponent.checkMouseDownFlag()||(b.cancelAutoComplete(),b.hideComponent(),c=!0),c||d.preventDefault()}},{key:"bodyMouseDownAction",value:function(a){var b=this;if(a=a||{},b.isComponentVisible()){var c=!0,d=a.event,e=d.target,f=b.listComponent.dom,g=b.userInput._element;(e===f||f.contains(e))&&(c=!1),(e===g||g.contains(e))&&(c=!1),c&&b.hideComponent()}}},{key:"_inputFocusHandler",value:function(){var a=this;a.inputFocusAction()}},{key:"_inputBlurHandler",value:function(a,b){var c=this;c.inputBlurAction(b)}},{key:"_inputKeyDownHandler",value:function(a,b){var c=this;b=b||{};var d=b.event,e=d.which||d.keyCode;return e===g.ESC?void c.cancelAutoComplete():void(c.isComponentVisible()&&c.listComponent.proxyKeyDownEvent(d))}},{key:"_bodyMouseDownHandler",value:function(a){var b=this;b.bodyMouseDownAction({event:a})}},{key:"bindEvents",value:function(){var a=this,c=a.userInput;_get(b.prototype.__proto__||Object.getPrototypeOf(b.prototype),"bindEvents",this).call(this),a._inputFocusHandler=a._inputFocusHandler.bind(a),$(c).on("focus",a._inputFocusHandler),a._inputBlurHandler=a._inputBlurHandler.bind(a),$(c).on("blur",a._inputBlurHandler),a._inputKeyDownHandler=a._inputKeyDownHandler.bind(a),$(c).on("keydown",a._inputKeyDownHandler),a._bodyMouseDownHandler=a._bodyMouseDownHandler.bind(a),$(document.body).on("mousedown",a._bodyMouseDownHandler)}},{key:"unbindEvents",value:function(){var a=this,c=a.userInput;_get(b.prototype.__proto__||Object.getPrototypeOf(b.prototype),"unbindEvents",this).call(this),$(c).off("focus",a._inputFocusHandler),$(c).off("blur",a._inputBlurHandler),$(c).off("keydown",a._inputKeyDownHandler),$(document.body).off("mousedown",a._bodyMouseDownHandler)}}]),b}(f);b.BaseHTMLEditableAutoCompleteSystem=h}();