window.zmSearch=function(){"use strict";var a,b,c=1,d="all",e=7,f=1,g=0,h=1,i={field:1,category:"all"},j=zmText.get("search");a=["Subject","Sender","To/Cc","Content","Attachment Name","Attachment Content","Entire Message"];var k=function(){var a;return a="zmStreamsApp"===zmTab.currentTab||"zm_Container"===zmTab.currentTab&&"zmStreamTree"===zmail.mailLeft.selLayerId?"zmStreamsApp":"attView"===zmTab.currentTab?zmTab.currentTab:"attSrcView"===zmTab.currentTab?"attView":zmTab.currentTab.indexOf("zm_srch")!==-1?b:"zm_Container"===zmTab.currentTab?"m":"zm_notes"===zmTab.currentTab?"n":"zm_task"===zmTab.currentTab?"t":"zm_Contacts"===zmTab.currentTab?"cn":"zm-settings"===zmTab.currentTab?"zm-settings":zmApp.currentApp},l=function(a,b){var c,d;for(c=a.length,!zmail.isBlurSearchEnabled&&"attView"===k()&&b[0]>=c&&(b[0]-=2),d=0;d<c;d+=1)b.indexOf(d)!==-1&&a[d]?a[d].htm='<i class="msi-tick"></i>'+a[d].htm:a[d].htm='<i class="msi-none"></i>'+a[d].htm},m=function(a,b){var c=$("#zm_dropDown").find("li"),d=c.eq(a),e=c.eq(b);d.length&&(d.find("i")[0].className="msi-none"),e.length&&(e.find("i")[0].className="msi-tick")},n=function(){var a,b,c,f={};return c='<table><tr><td data-apptype="m" class="sel"><i class="msi-mail"></i></td><td data-apptype="t"><i class="msi-task"></i></td><td data-apptype="zmStreamsApp"><i class="msi-streams"></i></td>',zmail.showFeature&&(c+='<td data-apptype="n"><i class="msi-notes"></i></td>'),c+='<td data-apptype="cn"><i class="msi-contacts"></td>',c+="</tr></table>",a=[{htm:c,data:{index:11},className:"nohr"},{sep:!0},{htm:j.dropdown.mail.subject,data:{index:1}},{htm:j.dropdown.mail.from,data:{index:2}},{htm:j.dropdown.mail.toOrcc,data:{index:3}},{htm:j.dropdown.mail.emailContent,data:{index:4}},{htm:j.dropdown.common.attachmentName,data:{index:5}},{htm:j.dropdown.common.attachmentContent,data:{index:6}},{htm:j.dropdown.mail.entireMessage,data:{index:7}},{sep:!0},{htm:j.dropdown.mail.searchAllFolders,data:{index:8}},{htm:j.dropdown.mail.searchInFolder,data:{index:9}},{sep:!0},{htm:j.dropdown.common.advancedSearch,data:{index:10}}],b="all"===d?8:9,l(a,[b+2,e+1]),f.list=a,f.clk=function(a,b,c){var f;if(f=a&&a.index){if(11===f){var g=$(b).closest("td").data("apptype");g&&(zmSearch.updateSearchValues(g),zmUtil.hideMenu(),zmSearch.showSearchDrop())}else{if(10===f)return zmUtil.hideMenu(),zmSearch.openRefineSearchView(zmSearch.getSearchFieldVal(),"m"),!0;8===f?"all"!==d&&(d="all",m(11,10)):9===f?""!==d&&(d="",m(10,11)):(m(e+1,f+1),e=f,zmSearch.updateSearchValues("m"))}zmSearch.searchField.focus(),zmSearch.searchField.select()}},f},o=function(){var a,b,c,d={};return c='<table><tr><td data-apptype="m"><i class="msi-mail"></i></td><td data-apptype="t"><i class="msi-task"></i></td><td data-apptype="zmStreamsApp"><i class="msi-streams"></i></td>',zmail.showFeature&&(c+='<td data-apptype="n"><i class="msi-notes"></i></td>'),c+='<td data-apptype="cn" class="sel"><i class="msi-contacts"></td>',c+="</tr></table>",a=[{htm:c,data:{index:10},className:"nohr"},{sep:!0},{htm:j.dropdown.contacts.allFields,data:{index:1}},{htm:j.dropdown.contacts.byName,data:{index:2}},{htm:j.dropdown.contacts.byEmail,data:{index:3}},{htm:j.dropdown.contacts.byPhone,data:{index:4}},{htm:j.dropdown.contacts.byAddress,data:{index:5}},{htm:j.dropdown.contacts.byNotes,data:{index:6}},{htm:j.dropdown.contacts.byCompany,data:{index:7}},{sep:!0},{htm:j.dropdown.contacts.searchAllContacts,data:{index:8}},{htm:j.dropdown.contacts.searchThisCategory,data:{index:9}}],b="all"===i.category?8:9,l(a,[b+2,i.field+1]),d.list=a,d.clk=function(a,b,c){var d;if(d=a&&a.index){if(10===d){var e=$(b).closest("td").data("apptype");e&&(zmSearch.updateSearchValues(e),zmUtil.hideMenu(),zmSearch.showSearchDrop())}else 8===d?"all"!==i.category&&(i.category="all",m(11,10)):9===d?""!==i.category&&(i.category="",m(10,11)):(m(i.field+1,d+1),i.field=d,zmSearch.updateSearchValues("cn"));zmSearch.searchField.focus(),zmSearch.searchField.select()}},d},p=function(){var a,b,c={};return b='<table><tr><td data-apptype="m"><i class="msi-mail"></i></td><td data-apptype="t"><i class="msi-task"></i></td><td data-apptype="zmStreamsApp" class="sel"><i class="msi-streams"></i></td>',zmail.showFeature&&(b+='<td data-apptype="n"><i class="msi-notes"></i></td>'),b+='<td data-apptype="cn"><i class="msi-contacts"></td>',b+="</tr></table>",a=[{htm:b,data:{index:11},className:"nohr"},{sep:!0},{htm:j.dropdown.common.all,data:{index:1}},{htm:j.dropdown.streams.summary,data:{index:2}},{htm:j.dropdown.common.attachmentName,data:{index:3}},{htm:j.dropdown.common.attachmentContent,data:{index:4}}],l(a,[f+1]),c.list=a,c.clk=function(a,b,c){var d;if(d=a&&a.index){if(11===d){var e=$(b).closest("td").data("apptype");e&&(zmSearch.updateSearchValues(e),zmUtil.hideMenu(),zmSearch.showSearchDrop())}else f=d,zmSearch.updateSearchValues("zmStreamsApp"),zmSearch.searchField.focus(),zmUtil.hideMenu();zmSearch.searchField.focus(),zmSearch.searchField.select()}},c},q=function(){var a,b={};return a=[{htm:'<table><tr><td data-apptype="m"><i class="msi-mail"></i></td><td data-apptype="t"><i class="msi-task"></i></td><td data-apptype="zmStreamsApp"><i class="msi-streams"></i></td><td class="sel" data-apptype="n"><i class="msi-notes"></i></td><td data-apptype="cn"><i class="msi-contacts"></td></tr></table>',data:{index:11},className:"nohr"},{sep:!0},{htm:j.dropdown.common.all,data:{index:1}}],l(a,[2]),b.list=a,b.clk=function(a,b,c){var d;if(d=a&&a.index,d&&11===d){var e=$(b).closest("td").data("apptype");e&&(zmSearch.updateSearchValues(e),zmUtil.hideMenu(),zmSearch.showSearchDrop())}},b},r=function(){var a,b,c={};return b='<table><tr><td data-apptype="m"><i class="msi-mail"></i></td><td data-apptype="t" class="sel"><i class="msi-task"></i></td><td data-apptype="zmStreamsApp"><i class="msi-streams"></i></td>',zmail.showFeature&&(b+='<td data-apptype="n"><i class="msi-notes"></i></td>'),b+='<td data-apptype="cn"><i class="msi-contacts"></td>',b+="</tr></table>",a=[{htm:b,data:{index:11},className:"nohr"},{sep:!0},{htm:j.dropdown.common.all,data:{index:1}}],l(a,[h+1]),c.list=a,c.clk=function(a,b,c){var d;if(d=a&&a.index){if(11===d){var e=$(b).closest("td").data("apptype");e&&(zmSearch.updateSearchValues(e),zmUtil.hideMenu(),zmSearch.showSearchDrop())}else h=d,zmSearch.searchField.focus(),zmUtil.hideMenu();zmSearch.searchField.focus(),zmSearch.searchField.select()}},c},s=function(){var a,b={};return a=zmail.isBlurSearchEnabled?[{htm:j.dropdown.common.attachmentName,data:{index:0}},{htm:j.dropdown.common.attachmentContent,data:{index:1}},{htm:j.dropdown.attachment.sender,data:{index:2}},{htm:j.dropdown.attachment.formatType,data:{index:3}}]:[{htm:j.dropdown.attachment.sender,data:{index:2}},{htm:j.dropdown.attachment.formatType,data:{index:3}}],zmail.showFeature&&zmail.isBlurSearchEnabled&&a.push({sep:!0},{htm:j.dropdown.common.advancedSearch,data:{index:4}}),l(a,[g]),b.list=a,b.clk=function(a){a&&"undefined"!=typeof a.index&&(4!==a.index?(g=a.index,zmSearch.searchField.focus()):zmAttachmentSearch.core.createSearchWorkSpaceWithAdvanceSearchDropdown(g+1),zmSearch.updateSearchValues("attView"),zmUtil.hideMenu())},b},t=function(a){var b,c;return c=a||k(),"zmStreamsApp"===c?b=p():"attView"===c?b=s():"t"===c?b=r():"cn"===c?b=o():"n"===c&&zmail.showFeature?b=q():"m"!==c&&"n"!==c&&"c"!==c&&"l"!==c||(b=n()),b},u=function(a,c){var f,g=[],h={},i={};switch(e){case 1:i.lhs="Subject";break;case 2:i.lhs="Sender";break;case 3:i.lhs="To/Cc";break;case 4:i.lhs="Content";break;case 5:i.lhs="Attachment Name";break;case 6:i.lhs="Attachment Content";break;case 7:i.lhs="Entire Message"}i.value=a,i.contains=!0,g.push(i),h.searchQueryArr=g,"all"!==d&&(f=zmInit.getCurrentLeftId(),zmUtil.isFolderId(f)&&(h.folderArr=[f])),c&&(h.refineSearchView=!0),b=h.app="m",zmSearch.addSearch(h)},v=function(a){var c,d=[],e={};switch(i.field){case 1:d.push({All:a});break;case 2:d.push({Name:a});break;case 3:d.push({Email:a});break;case 4:d.push({Phone:a});break;case 5:d.push({Address:a});break;case 6:d.push({Notes:a});break;case 7:d.push({Company:a})}"cn"===zmApp.currentApp&&"all"!==i.category&&(c=zmInit.getCurrentLeftId(),e.categoryArr=[c]),b=e.app="cn",e.searchQueryArr=d,zmSearch.addSearch(e)},w=function(a){var c=[],d={};c.push({taskStr:a}),b=d.app="t",d.searchQueryArr=c,zmSearch.addSearch(d)},x=function(a){var c=[],d={};c.push({notesStr:a}),b=d.app="n",d.searchQueryArr=c,zmSearch.addSearch(d)},y=function(a){var c=[],d={};switch(f){case 1:c.push({All:a});break;case 2:c.push({Summary:a}),d.entityType=6;break;case 3:c.push({"Attachment Name":a});break;case 4:c.push({"Attachment Content":a})}b=d.app="zmStreamsApp",d.searchQueryArr=c,zmSearch.addSearch(d)},z=function(a){var b={};switch(g){case 0:zmAttachmentSearch.core.searchAttachment("name",a,g+1);break;case 1:zmAttachmentSearch.core.searchAttachment("content",a,g+1);break;case 2:b={dn:a},zmAttachmentSearch.core.searchAttachment("sender",b,g+1);break;case 3:b={ff:a},zmAttachmentSearch.core.searchAttachment("filetype",b,g+1)}},A=function(a,b){var c;switch(a){case 0:case 1:c={contentArray:"",compare:["fn","ln","nn","eid"],LType:"1",OType:"1",selection:"onDemand",supressBlur:!0,callback:b};break;case 2:c={contentArray:[],compare:[""],LType:"2",OType:"2",callback:b,text:!0};break;case 3:var d=[];d.push({name:"jsp"}),d.push({name:"doc"}),d.push({name:"png"}),d.push({name:"js"}),d.push({name:"docx"}),d.push({name:"pdf"}),d.push({name:"jpeg"}),d.push({name:"jpg"}),d.push({name:"jspf"}),d.push({name:"css"}),d.push({name:"gif"}),d.push({name:"html"}),d.push({name:"java"}),d.push({name:"xml"}),d.push({name:"mp4"}),d.push({name:"mp3"}),d.push({name:"odt"}),c={contentArray:d,compare:["name"],LType:"2",OType:"2",selection:"onDemand",callback:b,text:!0}}return c},B=function(){var a=function(a){var b;a?(b=a.eid||a.EMAIL,zmSearch.searchField.val(b)):b=zmSearch.searchField.val(),zmSearch.contextualSearch(b)};return A(0,a)},C=function(){var a;switch(e){case 2:case 3:case 7:a=B();break;case 1:case 4:case 5:case 6:a=A(2,function(a){var b=$.trim(zmSearch.searchField.val());b&&zmSearch.contextualSearch(b)})}return a},D=function(){var a;switch(g){case 0:case 1:a=A(2,function(){var a=$.trim(zmSearch.searchField.val());a&&zmSearch.contextualSearch(a)});break;case 2:a=B();break;case 3:a=A(g,function(){var a=$.trim(zmSearch.searchField.val());a&&zmSearch.contextualSearch(a)})}return a},E=function(){var a;switch(f){case 1:a=B();break;case 2:case 3:case 4:a=A(2,function(a){var b=$.trim(zmSearch.searchField.val());b&&zmSearch.contextualSearch(b)})}return a},F=function(a){var b,c={};a?zmSearch.forceSearch=a:(a=k(),zmSearch.forceSearch=""),"zmStreamsApp"===a?(b=zmText.applyArgs(j.searchInApp,{appname:"Streams"}),c=E()):"attView"===a?(b=zmText.applyArgs(j.searchInApp,{appname:"Attachments"}),c=D()):"t"===a?(b=zmText.applyArgs(j.searchInApp,{appname:"Task"}),c=B()):"cn"===a?(b=zmText.applyArgs(j.searchInApp,{appname:"Contacts"}),c=B()):"n"===a&&zmail.showFeature?(b=zmText.applyArgs(j.searchInApp,{appname:"Notes"}),c=B()):"m"===a||"c"===a||"n"===a||"l"===a?(b=zmText.applyArgs(j.searchInApp,{appname:"Mail"}),c=C()):"zm-settings"===a&&(b=zmText.applyArgs(j.searchInApp,{appname:"Settings"}),c=zmail.Settings.SearchCommandIntegrator.getAutoFillObj()),zmSearch.updateSearchPlaceHolder(b),zmSearch.currentAutoFillId&&zmAutoFill.removeAutoFill(zmSearch.currentAutoFillId),zmSearch.currentAutoFillId=zmAutoFill.setAutofill(c,zmSearch.searchField)},G=function(a){b=a},H=function(a){return b},I=function(a,b){var c,d;c=zmSearch.forceSearch?zmSearch.forceSearch:k(),"zmStreamsApp"===c?d=zmSearch.addStreamSearch:"attView"===c?d=zmSearch.addAttachmentSearch:"t"===c?d=zmSearch.addTaskSearch:"cn"===c?d=zmSearch.addContactsSearch:"n"===c&&zmail.showFeature?d=zmSearch.addNotesSearch:"m"!==c&&"c"!==c&&"n"!==c&&"l"!==c||(d=zmSearch.addInitSearch),d&&(b?d(a,1):d(a))};$.subscribe("/apps/tabSwitched",function(){zmSearch.updateSearchValues()});var J={searchField:$("#ztb-search-field"),getSearchTabObj:function(a,b){var d=a.getSearchVal()||"Search",e={appname:d,appId:"zm_srch"+b,data:{CNodes:"3"},appIcon:"msi-search",noLeftSel:!1,titleProvider:function(){return zmText.get("search","resultsHeader")+" - "+(a.getSearchVal()||"")}};if(c>1){var f=zmail.searchObj[c-1];e.onDelete=f&&f.getOnClose&&_zm.bindFn(f.getOnClose,f)}return e},addSearch:function(a){var b,d,e,f;if(a&&a.searchQueryArr.length&&(this.hasSearchableText(a.searchQueryArr)||a.refineSearchView)){if(c>1)zmSearch.deleteSearch("zm_srch"+(c-1)),zmsuite.isWorkspaceAvailable("zm_srch"+(c-1))&&zmsuite.closeWorkspace("zm_srch"+(c-1)),c=1;else if(zmsuite.isMaxLimitReached())return;f=a.app||"m","m"===f?b=new msSearchCollection(a):"t"===f?b=new zmTaskSearch.taskCollection(a):"zmStreamsApp"===a.app?b=new zmStreamSearch.streamCollection(a):"cn"===a.app?b=new zmContactsSearch.contactsCollection(a):"n"===a.app&&(b=new zmNotesSearch.notesCollection(a)),b.setSearchQueryArr(a.searchQueryArr),e=zmSearch.getSearchTabObj(b,c),"m"===f&&(e.shortcuts=zmshCut.mail),zmsuite.setWorkSpace(e),"m"===f?d=new msSearchView:"t"===f?d=new zmTaskSearch.taskView:"cn"===f?d=new zmContactsSearch.contactsView:"n"===f?d=new zmNotesSearch.notesView:"zmStreamsApp"===f&&(d=new zmStreamSearch.streamView,d.setCSSToCenterDOM()),d.setInstanceId(c),d.setCollection(b),a.refineSearchView&&(d.refineSearchView=!0),d.search(),e.onDelete=_zm.bindFn(d.getOnClose,d),zmail.searchObj[c]=d,c+=1,"m"===f&&zmInit.setDisplayDensity()}},deleteSearch:function(a){a=a.replace(/[^0-9]/g,""),delete zmail.searchObj[a]},initSearch:function(){var a={},b=[],c="",d=9,e="srch",f="";if(f=$("#ztb-searchInput").val(),"1"===$("#zsfolder").val()&&"zm_Container"===zmTab.currentTab){var g=zmInit.getListingDetObj();c=g.fId,c&&b.push(c)}d=parseInt($("#zsfilter").val()),a={sString:f,sQuery:d,type:e,folderArr:b},zmSearch.addSearch(a)},openRefineSearchView:function(a,d){if(c>1&&zmsuite.isWorkspaceAvailable("zm_srch"+(c-1))&&d===b){if(zmsuite.showWorkSpace("zm_srch"+(c-1)),zmail.searchObj[c-1]){var e=zmail.searchObj[c-1];e.showFilterElem()}}else zmSearch.contextualSearch(a,"refineSearch")},hasSearchableText:function(a){var b,c,d;for(d=a.length,b=0;b<d;b+=1)for(c in a[b])if(a[b][c])return!0;return!1},showSearchDrop:function(){var a={},b={};b=zmSearch.forceSearch?t(zmSearch.forceSearch):t(),a.par=$("#ztb-search"),a.defaultclass=!1,a.spanClass="SC_dd nopd",a.parWidth=!0,a.list=b.list,a.clk=b.clk,zmsuite.showMenu(a),$("#zm_dropDown").css("z-index",999)},sendWarmUpRequest:function(a){var b,c;c=k(),"m"===c&&(a=encodeURIComponent(a),b={accId:zmail.accId,ty:"warmup",SrchQry:9,SearchStr:a},zmAjq.XHR({u:zmail.conPath+"/search.do",t:"POST",p:b,csr:"s",ep:null}))},getSearchParams:function(a){var b,c={};return b=zmail.searchObj[a].collection,c.srchStr=b.advSearchStr,b.folderArr.length&&(c.viewfolId=b.folderArr[0]),"yes"===b.attachFilter?c.attach=1:"no"===b.attachFilter&&(c.attach=0),"yes"===b.flagFilter?c.flag=1:"no"===b.flagFilter&&(c.flag=0),b.labelArr.length&&(c.label=b.labelArr[0]),"yes"===b.unreadFilter?c.unreadStatus=1:"no"===b.unreadFilter&&(c.unreadStatus=0),"yes"===b.responseFilter?c.resp=1:"no"===b.responseFilter&&(c.resp=0),"yes"===b.threadFilter?c.thd=1:"no"===b.threadFilter&&(c.thd=0),c},getSavedSearchName:function(a){var b,c,d,e,f,g,h,i,k,l,m="",n={};if(a=a||{},h=$.Deferred(),d=a.mode||"add","edit"===d&&h.resolve(),"add"===d||"rename"===d){switch(d){case"add":c="Provide a name for this view",m="New Search";break;case"rename":c="Rename Saved Search",m=zmail.savedSearchList[zmSearch.savedSearchId].FN}n={title:c,style:{width:"200px"},customClass:"noanim",buttons:[{txt:"Save",selected:!0,callback:function(){var b,c="",e=$("#zm_rnssrchpopup").find("input"),f="";b=e.val(),"rename"===d&&(c=zmSearch.savedSearchId,f=m.toLowerCase()),zmSearch.isValidName(b,a,c)?("rename"===d&&f===b.toLowerCase()?h.reject():h.resolve({savedsearchname:b}),zmsDialog.remove()):e.focus()}},{isCancel:!0,txt:"Cancel",callback:function(){zmsDialog.remove()}}],closeaction:function(){$("#zm_rnssrchpopup").remove(),h.reject()},afterDisplay:function(){$("#zm_rnssrchpopup").find("input").focus(),$("#zm_rnssrchpopup").find("input").select()}},"rename"===d?(g=zmsuite.getAppLeft().getNodes()[0].getLayer("zmlSSrchTreeH").el,i=$(".zm_compose"),k=i.offset(),e=k.left+i.width(),f=g.position().top<0?$(".zm_compose").offset().top:g.offset().top,l=f+250-$(document.body).height(),l>0&&(f-=l),n.posParent={top:f+"px",left:e+"px"}):"add"===d&&(n.mask=!0,n.pos="center"),b=$('<div id="zm_rnssrchpopup" class="SC_p10"><ul><li class="SC_p10"><input type="text" data-enableshortcuts="true" class="SC_tiput" value="'+m+'" placeholder="'+j.savedsearch.placeholder+'"/></li></div>'),$("#zm_rnssrchpopup").length||$(document.body).append(b),zmsDialog.create("zm_rnssrchpopup",n),$("#zmsdialog_zm_rnssrchpopup").mousedown(function(a){zmUtil.stopEvents(a,!0)}),$("#zmsdialog_zm_rnssrchpopup").click(function(a){zmUtil.hideMenu(!1,!0)})}return h.promise()},processSavedSearch:function(a){var b,c={};b={accId:zmail.accId},"rename"===a.mode&&(b.searchname=c.searchname=a.searchName),c.mode=b.method=a.mode,b.searchId=a.id,zmAjq.XHR({u:zmail.conPath+"/savesearch.do",t:"POST",fn:_zm.bindFn(this.initiateSavedSearch,this),p:b,ep:c})},initiateSavedSearch:function(a,b){var c,d,e,f,g,h=a.app||"m";a.searchid?"get"===b.mode?("m"===h&&(c=new msSearchCollection),c.app=h,c.updateCollection(a),zmSearch.setPrevAppSearch(h),zmSearch.addSearch(c)):"delete"===b.mode?(e=a.searchid,d="zmlSSrchTreeH",f=zmail.mailLeft.getNodes()[0].getLayer(d),g=zmList.getRowInfo(e,d),f.deleteNode(g),0===Object.keys(f.getListObject()).length&&zmail.mailLeft.getNodes()[0].deleteLayer(d),$.publish("savedSearch/deleted",[{searchid:e}]),zmUtil.succErrMsg("s",j.savedsearch.deleteSuccess)):"rename"===b.mode&&(d="zmlSSrchTreeH",f=zmail.mailLeft.getNodes()[0].getLayer(d),g=zmList.getRowInfo(a.searchid,d),g[a.searchid].FN=_zm.escapeTags(b.searchname),f.editNode(g,f.mapObject),$.publish("savedSearch/renamed",[{searchid:a.searchid,searchname:b.searchname}]),zmUtil.succErrMsg("s",j.savedsearch.renameSuccess)):zmUtil.succErrMsg("e",zmail.i18n.errproc)},addInitSearch:u,addTaskSearch:w,addNotesSearch:x,addStreamSearch:y,addContactsSearch:v,addAttachmentSearch:z,setPrevAppSearch:G,getPrevAppSearch:H,getSearchAppType:k,contextualSearch:I,searchQueryArr:a,updateSearchValues:F,getAFObj:A};return J}(),function(){"use strict";function a(){this.collection=void 0,this.id=void 0,this.listElem=void 0,this.prevElem=void 0,this.mainElem=void 0,this.filterElem=void 0,this.elemObj=void 0,this.centerObj=void 0,this.loadingBandFn=void 0}var b=!1;a.prototype={getHeaderObj:function(){var a={left:{leftHTML:"<b>"+zmText.get("search","resultsHeader")+"</b>"},right:[]};return a},getActionObj:function(){var a={list:{left:[],right:[{actionArr:[{iconList:["msi-close"],tooltip:zmText.get("search","closeTab")}]}]}};return a},constructListOuter:function(){var a,b,c,d,e,f;f=this,a=this.id,c={list:[]},e={left:{},right:[]},this.getActionObj&&(c=this.getActionObj()),this.getHeaderObj&&(e=this.getHeaderObj()),this.centerObj=zmsuite.getCenter(),b=this.centerObj[0].getNodes(),this.addSearchFilter&&(d=this.addSearchFilter(),zmSearch.refineSearchView=d),b[0].push(c.list),b[0].setListener("click",function(b,c){f.getActionObjHandler&&f.getActionObjHandler(b,c),"msi-close"===c&&(f.unbindOuterEvents(),f.deleteSearchObj(),zmsuite.closeWorkspace("zm_srch"+a))}),b[1].push(e),zmsuite.renderWorkSpace(),zmsuite.showWorkSpace("zm_srch"+a),this.addSearchFilter&&this.centerObj[1].$el.after(d),zmsuite.getCenterOuter().$el.data("data-detail",this.elemObj.viewDetails),"m"===this.elemObj.appType&&zmUtil.sTopMenu({type:"l"}),this.mainElem=this.centerObj[0].$el,this.listElem=this.centerObj[0].getNodes()[2].$el,this.prevElem=this.centerObj[1].$el,this.filterElem=this.mainElem.find(".SC_srch"),this.bindEvents()},updateHeaderObject:function(){var a;this.getHeaderObj&&(a=this.getHeaderObj());var b=this.centerObj[0].getNodes();b[1].push(a),b[1].paint(),this.bindEvents()},setInstanceId:function(a){var b;b=zmsuite.getCenter(),this.id=a,this.elemObj={prevElem:b[1].$el[0],listElem:b[0].getNodes()[2].$el[0],mainElem:b[0].$el,hdrId:"zmHdr",viewDetails:{fId:"",view:"search",flag:"",label:"",attach:""}}},bindEvents:function(){var a,b=this;a=this.centerObj[0].getNodes()[1].$el,a.find(".zm_savesearch").on("click",function(){b.collection.flushData(),b.collection.setSearchQueryArr(b.getAdvSearchQueryArr()),b.collection.sendRequestForSave(),b.cloneCollection()}),a.find(".zm_refine").on("click",function(){b.toggleFilterElem()}),$(this.listElem).scroll(_zm.bindFn(this.fillSearch,this))},deleteSearchObj:function(){var a="zm_srch"+this.id;return zmSearch.deleteSearch(a),!0},toggleFilterElem:function(){this.filterElem.hasClass("shw")?this.hideFilterElem():this.showFilterElem()},showFilterElem:function(){var a=this.filterElem.find("span[data-val='Cancel']");this.refineSearchView?a.css("visibility","hidden"):a.css("visibility","visible"),zmPrev.isPrevOpen("zm_srch"+this.id)&&(this.prevElem.hide(),b=!0),this.filterElem.addClass("shw")},hideFilterElem:function(){this.filterElem.removeClass("shw"),b&&(this.prevElem.show(),b=!1)},fillSearch:function(){var a=this.listElem,b=90,c=Math.round(100*(a[0].scrollTop+a.height())/a[0].scrollHeight);c>=b&&this.sendRequest("pagination")},search:function(){this.constructListOuter(),this.collection.flushData(),this.refineSearchView?this.toggleFilterElem():this.sendRequest()},sendRequest:function(a){a||(a="listing"),!this.collection.sending&&this.collection.hasNext&&(this.loadingBandFn=zmComponent.loadingBand({container:this.listElem[0],type:a})),this.collection.sendRequest()},setCollection:function(a){this.collection=a,this.cloneCollection&&this.cloneCollection(),this.bindOuterEvents(),this.bind&&this.bind()},bindOuterEvents:function(){var a=this,b="zm_srch"+this.id;$(this.collection).on("search/listUpdated",function(b,c,d){a.updateListing(b,c,d)}),$(this.collection).on("search/closeTab",function(){a.unbindOuterEvents(),a.deleteSearchObj(),zmsuite.closeWorkspace(b)})},unbindOuterEvents:function(){var a=this;$(a.collection).off("search/listUpdated"),$(a.collection).off("search/closeTab")},selectOption:function(a){a.removeClass("msi-unoption").addClass("msi-option")},unSelectOption:function(a){a.removeClass("msi-option").addClass("msi-unoption")},optionSelect:function(a,b){var c,d;c=a.target||a.srcElement,this.unSelectOption(b.find("i")),"I"===c.tagName?d=$(c):"SPAN"===c.tagName?d=$(c).prev():"DIV"===c.tagName&&(d=$(c).find("i")),this.selectOption(d)},getSearchConditionDom:function(){var a,b,c,d,e,f,g,h=$("<td></td>"),i=$("<table/>");for(d=this.collection.searchQueryArr,a=0;a<d.length;a++)c=d[a],e=c.lhs,f=c.value,g=c.contains?"true":"false",b=zmSearch.searchQueryArr.indexOf(e)+1,a===d.length-1?1===d.length?i.append(this.getSearchConstraintDom(b,g,f,!0)):i.append(this.getSearchConstraintDom(b,g,f)):i.append(this.getSearchConstraintDom(b,g,f,!1,!0));return h.append(i),h},getSerarchButtonsDom:function(){var a,b,c=this;return a=$('<td><div class="SC_PUbtm SC_tranbdr"><span class="sel">'+zmText.get("search","search")+'</span><span data-val="Cancel">'+zmText.get("search","cancel")+"</span></div></td>"),b=a.find("span"),this.searchBtn=b.eq(0),b.eq(0).on("click",function(){c.updateSearchParams()}),b.eq(1).on("click",function(){c.hideFilterElem()}),a},addRemConstraintEventHandler:function(a){var b,c,d;b=a.target||a.srcElement,c=b.className,b=$(b),"msi-plus"===c?(d=b.parents("tr").eq(0),this.addConstraint(d),this.searchBtn&&this.searchBtn[0].scrollIntoView()):"msi-minus"===c&&(d=b.parents("tr").eq(0),this.removeConstraint(d))},addConstraint:function(a){var b;b=this.getSearchConstraintDom(),a.after(b),a.find("span").html("<i class='msi-minus'></i><i class='msi-none'></i>")},removeConstraint:function(a){var b,c,d;c=a.parent(),a.remove(),b=c.children().length,d=c.find("tr:last").find("span"),b>1?d.html("<i class='msi-plus'></i><i class='msi-minus'></i>"):1===b&&d.html("<i class='msi-plus'></i><i class='msi-none'></i>")},getOnClose:function(){var a=this;return a.unbindOuterEvents(),$.publish("search/closeTab",[]),this.deleteSearchObj()},isDataFillPossible:function(){var a=this,b=a.listElem[0];return b.clientHeight>0&&!(b.scrollHeight>b.clientHeight)}},window.SearchOuterView=a}(),function(a){"use strict";a=a||{};var b={};b.escapeSpecialChars=function(a){return a.indexOf("=")!==-1&&a.indexOf("\\=")===-1&&(a=a.replace(new RegExp("=","gi"),"\\=")),a.indexOf("!")!==-1&&a.indexOf("\\!")===-1&&(a=a.replace(/!/gi,"\\!")),a.indexOf("&")!==-1&&a.indexOf("\\&")===-1&&(a=a.replace(/&/gi,"\\&")),a.indexOf("|")!==-1&&a.indexOf("\\|")===-1&&(a=a.replace(/\|/gi,"\\|")),a.indexOf('"')!==-1&&a.indexOf('\\"')===-1&&(a=a.replace(/"/gi,'\\"')),a.indexOf("(")!==-1&&a.indexOf("\\(")===-1&&(a=a.replace(/\(/gi,"\\(")),a.indexOf(")")!==-1&&a.indexOf("\\)")===-1&&(a=a.replace(/\)/gi,"\\)")),a.indexOf("<")!==-1&&a.indexOf("\\<)")===-1&&(a=a.replace(/</gi,"\\<")),a.indexOf(">")!==-1&&a.indexOf("\\>)")===-1&&(a=a.replace(/>/gi,"\\>")),a.indexOf("'")!==-1&&a.indexOf("\\')")===-1&&(a=a.replace(/'/gi,"\\'")),a.indexOf(" ")===-1&&a.indexOf(",")===-1||(a="( "+a+" )"),a};var c=function(){return!(!zmail.searchObj[1]||!zmail.searchObj[1].collection.getSearchType||"zm_stream"!==zmail.searchObj[1].collection.getSearchType())},d=function(a,b){var c,d=a.toLowerCase(),e=Object.keys(zmail.savedSearchList);for(c=0;c<e.length;c++)if(d===zmail.savedSearchList[e[c]].FN.toLowerCase()&&(!b||e[c]!==b))return!0;return!1},e=function(a,b,c){var e;return e=$.trim(a),e.length?zmUtil.hasSpecialChars(e)?(zmUtil.succErrMsg("e",zmText.get("search","savedsearch.nochar")),!1):"null"===e.toLowerCase()?(zmUtil.succErrMsg("e",zmText.get("search","savedsearch.nonull")),!1):!d(e,c)||(zmUtil.succErrMsg("e",zmText.get("search","savedsearch.alreadypresent")),!1):(zmUtil.succErrMsg("e",zmText.get("search","savedsearch.noempty")),!1)},f=function(){return a.searchField.val()},g=function(b){a.searchField.attr("placeholder",b)};a.util=b,a.isStreamSearchOpen=c,a.isValidName=e,a.getSearchFieldVal=f,a.updateSearchPlaceHolder=g,window.zmSearch=a}(zmSearch),function(a){"use strict";a=a||{},a.view={},window.zmSearch=a}(zmSearch),function(){"use strict";function a(a){this.searchQueryArr=[],this.advSearchStr=a&&a.advSearchStr||"",this.folderArr=a&&a.folderArr||[],this.dateRange=a&&a.dateRange?a.dateRange:{},this.labelArr=a&&a.labelArr||[],this.attachFilter=a&&a.attachFilter?a.attachFilter:"all",this.flagFilter=a&&a.flagFilter?a.flagFilter:"all",this.unreadFilter=a&&a.unreadFilter?a.unreadFilter:"all",this.responseFilter=a&&a.responseFilter?a.responseFilter:"all",this.threadFilter=a&&a.threadFilter?a.threadFilter:"all",this.searchList=[],this.savedSearchId=a&&a.savedSearchId||"",this.savedSearchName=a&&a.savedSearchName||"",this.threadObj={},this.hasNext=1,this.from=1,this.limit=25,this.sending=!1}a.prototype={setAdvSearchStr:function(a){this.advSearchStr=a},updateCollection:function(a){var b={};b.Jan=0,b.Feb=1,b.Mar=2,b.Apr=3,b.May=4,b.Jun=5,b.Jul=6,b.Aug=7,b.Sep=8,b.Oct=9,b.Nov=10,b.Dec=11;var c,d=this;if(a.eDate&&a.fDate){var e,f,g,h;e=a.fDate,h=e.split("-"),f=new Date(h[2],b[h[1]],h[0]),e=a.eDate,h=e.split("-"),g=new Date(h[2],b[h[1]],h[0]),d.setDateRange(f,g)}a.labId&&d.updateSearchLabel(a.labId),a.folId&&d.updateSearchFolder(a.folId),c="undefined"!=typeof a.resp?1===a.resp?"yes":"no":"all",d.updateSearchResponseFilter(c),c="undefined"!=typeof a.thd?1===a.thd?"yes":"no":"all",d.updateSearchThreadFilter(c),c="undefined"!=typeof a.hasAtt?1===a.hasAtt?"yes":"no":"all",d.updateSearchAttachFilter(c),c="undefined"!=typeof a.hasFlg?1===a.hasFlg?"yes":"no":"all",a.searchid&&d.setSavedSearchId(a.searchid),a.searchname&&d.setSavedSearchName(a.searchname),d.updateSearchFlagFilter(c),d.setSearchQueryArr($.parseJSON(zmUtil.decodeHTMLEntities(a.searchstring)))},getAdvSearchStr:function(){return this.advSearchStr},setSearchQueryArr:function(a){var b;this.searchQueryArr=a,b=this.getSearchQueryFromArr(this.searchQueryArr),this.setAdvSearchStr(b)},setThreadObj:function(a,b){this.threadObj[a]=b},getThreadObj:function(a){return this.threadObj[a]},addToFolderArr:function(a){this.folderArr||(this.folderArr=[]),this.folderArr.push(a)},updateSearchFolder:function(a){this.folderArr[0]=a},removeSearchFolder:function(){this.folderArr=[]},updateSearchLabel:function(a){this.labelArr[0]=a},removeSearchLabel:function(){this.labelArr=[]},updateSearchAttachFilter:function(a){this.attachFilter=a},updateSearchFlagFilter:function(a){this.flagFilter=a},updateSearchResponseFilter:function(a){this.responseFilter=a},updateSearchThreadFilter:function(a){this.threadFilter=a},setDateRange:function(a,b){a&&b?(this.dateRange.from=a,this.dateRange.to=b):this.dateRange={}},addToLabelArr:function(a){this.labelArr||(this.labelArr=[]),this.labelArr.push(a)},addToAttTypeArr:function(a){this.attTypeArr||(this.attTypeArr=[]),this.attTypeArr.push(a)},addSearchList:function(a){var b,c,d,e,f,g=a.length;e=zmCache.dolistObj(null,a),d=e.MO,f=a[g-1].stateinfo,this.hasNext=parseInt(f[13]),this.hasNext&&a[g-1].lastRT&&(this.cacheObj.lastRT=a[g-1].lastRT,this.cacheObj.M=a[g-2].M),this.searchList.length?(b=this.searchList.length,this.searchList=this.searchList.concat(d)):(b=0,this.searchList=d),c=this.searchList.length,this.from=c+1,$(this).trigger("search/listUpdated",[b,c])},deleteFromList:function(a){var b;b=this.searchList.indexOf(a),b!==-1&&(this.searchList.splice(b,1),this.from=this.searchList.length+1),this.searchList.length<25&&$(this).trigger("search/sendNewRequest",[])},setSavedSearchId:function(a){this.savedSearchId=a},setSavedSearchName:function(a){this.savedSearchName=a},getAdditionalParams:function(){var a={};return Object.keys(this.cacheObj).length&&(this.cacheObj.lastRT&&(a.lastRT=this.cacheObj.lastRT),this.cacheObj.M&&(a.lastM=this.cacheObj.M)),a},sendRequestForSave:function(){var a,b,c,d,e,f,g=this;!this.sending&&this.hasNext&&zmSearch.hasSearchableText(this.advSearchStr)&&(this.sending=!0,a={accId:zmail.accId},this.folderArr[0]&&(a.folId=this.folderArr[0]),this.labelArr[0]&&(a.labId=this.labelArr[0]),"yes"===this.attachFilter?a.hasAtt=1:"no"===this.attachFilter&&(a.hasAtt=0),"yes"===this.flagFilter?a.hasFlg=1:"no"===this.flagFilter&&(a.hasFlg=0),"yes"===this.unreadFilter?a.unread=0:"no"===this.unreadFilter&&(a.unread=1),"yes"===this.responseFilter?a.resp=1:"no"===this.responseFilter&&(a.resp=0),"yes"===this.threadFilter?a.thd=1:"no"===this.threadFilter&&(a.thd=0),b={0:"-Jan-",1:"-Feb-",2:"-Mar-",3:"-Apr-",4:"-May-",5:"-Jun-",6:"-Jul-",7:"-Aug-",8:"-Sep-",9:"-Oct-",10:"-Nov-",11:"-Dec-"},this.dateRange.from&&(c=this.dateRange.from,a.fDate=c.getDate()+b[c.getMonth()]+c.getFullYear()),this.dateRange.to&&(d=this.dateRange.to,a.eDate=d.getDate()+b[d.getMonth()]+d.getFullYear()),this.savedSearchId?(a.searchId=this.savedSearchId,a.searchname=this.savedSearchName,f="edit"):f="add",e={mode:f},zmSearch.getSavedSearchName(e).then(function(b){"add"===f&&(a.searchname=b.savedsearchname),a.method=f,a.searchStr=JSON.stringify(g.searchQueryArr),zmAjq.XHR({u:zmail.conPath+"/savesearch.do",t:"POST",fn:_zm.bindFn(g.savedSearchResponse,g),p:a,csr:"s",ep:e})}).fail(function(){g.sending=!1}))},getCurrentParams:function(){var a,b,c,d;return a={accId:zmail.accId,from:this.from,to:this.limit},this.folderArr[0]&&(a.viewfolId=this.folderArr[0]),this.labelArr[0]&&(a.labId=this.labelArr[0]),"yes"===this.attachFilter?a.hasAtt=1:"no"===this.attachFilter&&(a.hasAtt=0),"yes"===this.flagFilter?a.hasFlg=1:"no"===this.flagFilter&&(a.hasFlg=0),"yes"===this.unreadFilter?a.unread=0:"no"===this.unreadFilter&&(a.unread=1),"yes"===this.responseFilter?a.resp=1:"no"===this.responseFilter&&(a.resp=0),"yes"===this.threadFilter?a.thd=1:"no"===this.threadFilter&&(a.thd=0),b={0:"-Jan-",1:"-Feb-",2:"-Mar-",3:"-Apr-",4:"-May-",5:"-Jun-",6:"-Jul-",7:"-Aug-",8:"-Sep-",9:"-Oct-",10:"-Nov-",11:"-Dec-"},this.dateRange.from&&(c=this.dateRange.from,a.fDate=c.getDate()+b[c.getMonth()]+c.getFullYear()),this.dateRange.to&&(d=this.dateRange.to,a.eDate=d.getDate()+b[d.getMonth()]+d.getFullYear()),
a.thdView=!1,a.SearchStr=encodeURIComponent(this.advSearchStr),a},savedSearchResponse:function(a,b){if(this.sending=!1,a.searchid&&a.searchname){if(this.setSavedSearchId(a.searchid),this.setSavedSearchName(a.searchname),"add"===b.mode){if($("#zmlSSrchTree").length){var c,d,e,f="zmlSSrchTreeH";zmail.savedSearchList[a.searchid]={id:a.searchid,FN:a.searchname},c=zmail.mailLeft.getNodes()[0].getLayer(f),d=zmList.getRowInfo(a.searchid,f);for(e in d){d[e].FN=a.searchname,d[e].id=a.searchid;break}c.appendNode(d,c.mapObject)}else{var g={};g.id=a.searchid,g.FN=a.searchname,zmail.savedSearchList[a.searchid]=g;var h={id:"id",name:"FN"};if(Object.keys(zmail.savedSearchList).length>0){var i=new ZMLayer,j={type:"1",mapObject:h,disableSelection:!0,listId:"zmlSSrchTree",id:"zmlSSrchTreeH",dataObject:{headerObject:{licon:"msi-save",id:"zmlSSrchTreeH",name:"Saved Searches",showList:!0},listObject:zmail.savedSearchList}};i.push(j),zmail.mailLeft.getNodes()[0].insertLayerAfter("zmlview",i)}}zmUtil.succErrMsg("s",zmText.get("search","savedsearch.saveSuccess"))}else"edit"===b.mode&&zmUtil.succErrMsg("s",zmText.get("search","savedsearch.updateSuccess"));$(this).trigger("saveSearch/save",[])}else zmUtil.succErrMsg("e",zmail.i18n.errproc)},sendRequest:function(){var a,b,c,d;!this.sending&&this.hasNext&&zmSearch.hasSearchableText(this.advSearchStr)&&(this.sending=!0,a={accId:zmail.accId,from:this.from,to:this.limit},this.folderArr[0]&&(a.folId=this.folderArr[0]),this.labelArr[0]&&(a.labId=this.labelArr[0]),"yes"===this.attachFilter?a.hasAtt=1:"no"===this.attachFilter&&(a.hasAtt=0),"yes"===this.flagFilter?a.hasFlg=1:"no"===this.flagFilter&&(a.hasFlg=0),"yes"===this.unreadFilter?a.unread=0:"no"===this.unreadFilter&&(a.unread=1),"yes"===this.responseFilter?a.resp=1:"no"===this.responseFilter&&(a.resp=0),"yes"===this.threadFilter?a.thd=1:"no"===this.threadFilter&&(a.thd=0),b={0:"-Jan-",1:"-Feb-",2:"-Mar-",3:"-Apr-",4:"-May-",5:"-Jun-",6:"-Jul-",7:"-Aug-",8:"-Sep-",9:"-Oct-",10:"-Nov-",11:"-Dec-"},this.dateRange.from&&(c=this.dateRange.from,a.fDate=c.getDate()+b[c.getMonth()]+c.getFullYear()),this.dateRange.to&&(d=this.dateRange.to,a.eDate=d.getDate()+b[d.getMonth()]+d.getFullYear()),a.thdView=!1,$.extend(a,this.getAdditionalParams()),a.SearchStr=encodeURIComponent(this.advSearchStr),zmAjq.XHR({u:zmail.conPath+"/search.do",t:"POST",fn:_zm.bindFn(this.searchResponse,this),p:a,csr:"s",ep:null,oncaptchafailure:_zm.bindFn(this.onCaptchaFailure,this)}))},onCaptchaFailure:function(){$(this).trigger("search/closeTab",[])},searchResponse:function(a){this.sending=!1,this.addSearchList(a)},flushData:function(){this.hasNext=1,this.from=1,this.searchList=[],this.threadObj={},this.cacheObj={}},getSearchQueryFromArr:function(){var a,b,c,d,e,f="",g="",h="";for(c=this.searchQueryArr,b=c.length,a=0;a<b;a++)d=c[a],g=zmSearch.util.escapeSpecialChars(d.value),e=d.lhs,h=d.contains?" = ":" != ","to/cc"===e.toLowerCase()?" = "===h?f+="( To"+h+g+" ||Cc"+h+g+" )":" != "===h&&(f+="To"+h+g+" && Cc"+h+g):f+="entire message"===e.toLowerCase()?"Entire"+h+g:e+h+g,a!==b-1&&(f+=" && ");return f},getSearchVal:function(){var a;return a=this.searchQueryArr[0].value}},window.msSearchCollection=a}(),function(){"use strict";function a(){this.viewCollection=[]}var b=zmText.get("search"),c={getActionObj:function(){var a=b.mail.tooltips,c={list:{left:[{groupId:"view",actionArr:[{iconList:["msi-uncheck","msi-barrow"],dropAction:!0}]},{groupId:"MoveLabel",actionArr:[{iconList:["msi-folder"],dropAction:!0,tooltip:a.moveTo},{iconList:["msi-label"],dropAction:!0,tooltip:a.label}]},{groupId:"spamTrash",actionArr:[{iconList:["msi-trash"],tooltip:a["delete"]},{iconList:["msi-spam"],tooltip:a.spam},{iconList:["msi-notspam"],tooltip:a.notSpam}]},{groupId:"Archive",actionArr:[{iconList:["msi-archive"],tooltip:a.archive}]},{groupId:"action",actionArr:[{iconList:["msi-action"],dropAction:!0}]}],right:[{actionArr:[{iconList:["msi-classic"],dropAction:!0,tooltip:a.changeView},{iconList:["msi-close"],tooltip:a.closeTab}]}]}};return c},getActionObjHandler:function(a,b){zmInit.bindActionHeaderIcons(a,b)},checkForCollectionChanges:function(){var a=this.latestCollection,b=this.collection,c=a.advSearchStr===b.advSearchStr,d=0===$(a.folderArr).not(b.folderArr).length&&0===$(b.folderArr).not(a.folderArr).length,e=a.attachFilter===b.attachFilter&&a.flagFilter===b.flagFilter&&a.unreadFilter===b.unreadFilter&&a.responseFilter===b.responseFilter&&a.threadFilter===b.threadFilter,f=JSON.stringify(a.dateRange)===JSON.stringify(b.dateRange);return!!(c&&d&&e&&f)},cloneCollection:function(){this.latestCollection=$.extend({},this.collection),this.latestCollection.folderArr=this.collection.folderArr.length>0?this.collection.folderArr.slice(0):[],this.latestCollection.labelArr=this.collection.labelArr.length>0?this.collection.labelArr.slice(0):[],this.latestCollection.dateRange=$.extend({},this.collection.dateRange)},getHeaderObj:function(){var a,c,d,e="<span class='SC_lnk zm_refine'>"+b.refine+"</span>";return this.collection.savedSearchId?(d=this.collection.savedSearchName+e,this.checkForCollectionChanges()||(d+="<span class='SC_lnk zm_savesearch'>"+b.savedsearch.saveChanges+"</span>"),c={leftHTML:d}):c=this.refineSearchView?{leftHTML:b.mail.resultsHeader+e}:{leftHTML:b.mail.resultsHeader+e+"<span class='SC_lnk zm_savesearch'>"+b.savedsearch.save+"</span>"},a={left:c,right:[]}},handleDataFillIfPossible:function(){var a=this;a&&!a.isRemoved&&a.isDataFillPossible()&&a.collection.hasNext&&a.sendRequest("pagination")},updateListing:function(a,c,d){var e,f,g,h,i;for(i=document.createDocumentFragment(),h=this.collection.searchList,0===c&&this.clearViewCollection(),e=c;e<d;e++)f=new msSearchRowModel(h[e]),g=new msSearchRowView({model:f,type:"m",parent:this}),this.viewCollection[e]=g,i.appendChild(g.constructRow()[0]);this.loadingBandFn(),0===c&&(this.listElem.html(""),this.listElem.scrollTop(0),0===d&&this.listElem.html(zmInit.emptyRow(b.emptyResults))),this.listElem.append(i)},setEmptyListing:function(){var a;a=this.collection.searchList,0===a.length&&this.listElem.html(zmInit.emptyRow(b.emptyResults))},deleteSearchObj:function(){var a="zm_srch"+this.id;return this.isRemoved=!0,this.clearViewCollection(),zmSearch.deleteSearch(a),!0},clearViewCollection:function(){var a,b;for(b=this.viewCollection.length,a=0;a<b;a++)this.viewCollection[a]&&this.viewCollection[a].clearAll()},addSearchFilter:function(){var a;return a=this.getSearchFilterDOM()},bindOuterEvents:function(){var a,b,c=this,d="zm_srch"+this.id,e={};$(this.collection).on("search/listUpdated",function(a,b,d){c.refineSearchView&&(c.refineSearchView=!1),c.elemObj.listArr=c.collection.searchList,c.updateListing(a,b,d),c.updateHeaderObject(),e=zmSearch.getSearchTabObj(c.collection,c.id),zmTab.updateTabLst(e),c.handleDataFillIfPossible()}),$(this.collection).on("search/closeTab",function(){c.unbindOuterEvents(),c.deleteSearchObj(),zmsuite.closeWorkspace(d)}),$(this.collection).on("saveSearch/save",function(){c.updateHeaderObject()}),$(this.collection).on("search/sendNewRequest",_.debounce(function(){0===c.collection.from?c.collection.hasNext?c.sendRequest():$(c.collection).trigger("search/listUpdated",[0,0]):c.sendRequest("pagination")},50)),$.subscribe("savedSearch/deleted",function(a,b){c.collection.savedSearchId&&b.searchid===c.collection.savedSearchId&&(c.collection.setSavedSearchId(""),c.collection.setSavedSearchName(""),c.updateHeaderObject())}),$.subscribe("savedSearch/renamed",function(a,b){c.collection.savedSearchId&&b.searchid===c.collection.savedSearchId&&(c.collection.setSavedSearchName(b.searchname),c.updateHeaderObject())}),this.elemObj.searchType=3,this.elemObj.searchStr=this.collection.advSearchStr,this.elemObj.listArr=this.collection.searchList,this.elemObj.collection=this.collection,this.elemObj.id=this.id,this.elemObj.appType="m",a=this.elemObj,b=zmsuite.getCenter("zm_srch1")[0].getNodes()[2],b.setListener("click",function(b){c.hideFilterElem(),zmList.bindEventsMailRow(b,a)}),b.setListener("contextmenu",function(a){zmList.mailUtility(a)}),b.setDragDrop({onDrop:function(a,b,c,d){var e,f,g,h,i=[],j=[];for(g in c)e=g;for(h=b.length,g=0;g<h;g++)b[g].id.indexOf("t")!==-1?j.push(zmInit.zmsubStr(b[g].id,"t")):i.push(b[g].id);c[e].FN?(f={action:"move",folId:e,msgId:i,thd:j},zmmailAct.doActions("move","drop",f)):(f={action:"label",msgId:i,thd:j,lA:"add",lId:e},zmmailAct.applyActions("label","drop",f))},allowDrag:function(a){var b;return b=zmInit.getListingDetObj().fId,b!==zmail.folId.dId&&b!==zmail.folId.teId&&b!==zmail.folId.spId&&b!==zmail.folId.oId},allowDrop:function(a,b,c){var d,e;for(d in b)e=d;return b[e].FN?"inside"===c&&(e!==zmail.folId.dId&&e!==zmail.folId.teId&&e!==zmail.folId.oId):"inside"===c},dragStart:function(a,b){var c,d={};return b.length>1?(d.count=b.length,d.text="Messages selected"):(c=zmInit.zmsubStr(b[0].id,"t"),d.text=zmail.mailObj[c].SB),d},allowedParents:"#zmlTreeH,#zmllabelH"}),zmsuite.getCenter()[1].getNodes()[0].setListener("click",function(a,b){zmList.bindAction(a,b)}),$(a.listElem).scroll(_zm.bindFn(this.fillSearch,this))},getSearchFilterEntities:function(){var a;return a=document.createDocumentFragment(),a.appendChild(this.getAttachmentOptions()),a.appendChild(this.getFlagOptions()),a.appendChild(this.getConversationOptions()),a.appendChild(this.getRespondedOptions()),a},getAttachmentOptions:function(){var a,c,d=this,e=d.collection.attachFilter;return a=$('<td class="zm_atchopt"><div><i class="msi-option"></i><span>'+b.mail.allEmails+'</span></div><div><i class="msi-unoption"></i><span>'+b.mail.withAttachments+'</span></div><div><i class="msi-unoption"></i><span>'+b.mail.withoutAttachments+"</span></div></td>"),a.on("click","div",function(b){d.optionSelect(b,a)}),c=a.find("i"),"all"!==e&&(d.unSelectOption($(c[0])),"yes"===e?d.selectOption($(c[1])):d.selectOption($(c[2]))),a[0]},getFlagOptions:function(){var a,c,d=this,e=d.collection.flagFilter;return a=$('<td class="zm_flgopt"><div><i class="msi-option"></i><span>'+b.mail.allEmails+'</span></div><div><i class="msi-unoption"></i><span>'+b.mail.flagged+'</span></div><div><i class="msi-unoption"></i><span>'+b.mail.notFlagged+"</span></div></td>"),a.on("click","div",function(b){d.optionSelect(b,a)}),c=a.find("i"),"all"!==e&&(d.unSelectOption($(c[0])),"yes"===e?d.selectOption($(c[1])):d.selectOption($(c[2]))),a[0]},getConversationOptions:function(){var a,c,d=this,e=d.collection.threadFilter;return a=$('<td class="zm_convopt"><div><i class="msi-option"></i><span>'+b.mail.allEmails+'</span></div><div><i class="msi-unoption"></i><span>'+b.mail.withinConv+'</span></div><div><i class="msi-unoption"></i><span>'+b.mail.withNoConv+"</span></div></td>"),a.on("click","div",function(b){d.optionSelect(b,a)}),c=a.find("i"),"all"!==e&&(d.unSelectOption($(c[0])),"yes"===e?d.selectOption($(c[1])):d.selectOption($(c[2]))),a[0]},getRespondedOptions:function(){var a,c,d=this,e=d.collection.responseFilter;return a=$('<td class="zm_respopt"><div><i class="msi-option"></i><span>'+b.mail.allEmails+'</span></div><div><i class="msi-unoption"></i><span>'+b.mail.withReplies+'</span></div><div><i class="msi-unoption"></i><span>'+b.mail.withoutReplies+"</span></div></td>"),a.on("click","div",function(b){d.optionSelect(b,a)}),c=a.find("i"),"all"!==e&&(d.unSelectOption($(c[0])),"yes"===e?d.selectOption($(c[1])):d.selectOption($(c[2]))),a[0]},getSearchConstraintAFObj:function(a,b){var c={};switch(a){case 2:case 3:c=zmSearch.getAFObj(0,function(a){a&&b.val(a.eid)});break;case 4:case 1:case 5:case 6:case 7:c=zmSearch.getAFObj(2,function(){})}return c},getSearchConstraintDom:function(a,c,d,e,f){var g,h,i,j="",k=this;return f?e||(j='<i class="msi-minus"></i><i class="msi-none"></i>'):j=e?'<i class="msi-plus"></i><i class="msi-none"></i>':'<i class="msi-plus"></i><i class="msi-minus"></i>',g=$('<tr><td><div class="SC_select"><select class="select"><option value="1">'+b.dropdown.mail.subject+'</option><option value="2">Sender</option><option value="3">'+b.dropdown.mail.toOrcc+'</option><option value="4">'+b.common.content+'</option><option value="5">'+b.dropdown.common.attachmentName+'</option><option value="6">'+b.dropdown.common.attachmentContent+'</option><option value="7">'+b.dropdown.mail.entireMessage+'</option></select></div></td><td><div class="SC_select"><select class="select" id="zma3"><option value="yes">'+b.common.contains+'</option><option value="no">'+b.common.doesNotContain+'</option></select></div></td><td><input type="text" placeholder="'+b.common.placeHolder.searchWord+'"></td><td><span>'+j+"</span></td></tr>"),g.find("input").val(d),h=g.find("td"),a&&(h.eq(0).find("option[value='"+a+"']")[0].selected="selected"),a=a||1,i=g.find("input")[0],zmAutoFill.setAutofill(k.getSearchConstraintAFObj(a,$(i)),i),g.find("select").eq(0).on("change",function(){zmAutoFill.setAutofill(k.getSearchConstraintAFObj(this.selectedIndex+1,$(i)),i)}),c&&"true"!==c&&(h.eq(1).find("option[value='no']")[0].selected="selected"),g},getSearchFilterDOM:function(){var a,c;return a=$('<div class="SC_srch"><table><tr><td><table><tbody><tr class="sml"><td>'+b.mail.inFolder+"</td><td>"+b.mail.inDateRange+"</td><td>"+b.mail.withTags+'</td></tr><tr><td><span><input type="text" disabled></input></span></td><td><span><input type="text" disabled></input></span></td><td><span><input type="text" disabled></input></span></td><td></td></tr></tbody></table></td></tr><tr><td><table cellspacing="0"><tbody><tr class="sml"><td>'+b.common.attachments+"</td><td>"+b.common.flags+"</td><td>"+b.common.conversations+"</td><td>"+b.common.replies+"</td></tr><tr></tr></tbody></table></td></tr><tr></tr><tr></tr></table></div>"),c=a.find("tr"),c.eq(5).append(this.getSearchFilterEntities()),c.eq(6).append(this.getSearchConditionDom()),c.eq(7).append(this.getSerarchButtonsDom()),this.initAdvDiv(a),this.bindEventsToAdvDiv(a),a},bindEventsToAdvDiv:function(a){var c,d;c=a.find("span"),d=this,a.on("click","i",_zm.bindFn(this.addRemConstraintEventHandler,this)),c.eq(0).parent().on("click",function(){var a,b={},e=c.eq(0).find("input");b.parentDOM=e,b.displayAs="dropdown",b.excludeList=[zmail.folId.oId],b.showAllItem=!0,b.parWidth=!0,b.onSelect=function(b){"all"===b?(d.collection.removeSearchFolder(),e[0].value=d.getFolderText()):b&&(d.collection.updateSearchFolder(b),e[0].value=d.getFolderText(b)),a.hide()},a=zmUtil.createFLComp("folder",b),a.show()}),c.eq(1).parent().on("click",function(a){var c,e,f={};e=a.target||a.srcElement,c=[{htm:b.dropdown.common.all,data:{val:"all"}},{htm:b.mail.today,data:{val:"today"}},{htm:b.mail.yesterday,data:{val:"yesterday"}},{htm:b.mail.lastWeek,data:{val:"l7d"}},{htm:b.mail.thisMonth,data:{val:"mtd"}},{htm:b.mail.thisYear,data:{val:"ytd"}},{htm:b.mail.prevMonth,data:{val:"pm"}},{htm:b.mail.afterDate,data:{val:"ada"}},{htm:b.mail.specificRange,data:{val:"dr"}}],f.par=$(e),f.list=c,f.parWidth=!0,f.clk=function(a,b){var c,e,f,g,h;switch(c=a.val,e=d.collection,h=!0,f=zmUtil.getCurrentDateObj(),g=zmUtil.getCurrentDateObj(),c){case"all":f=g=null,zmUtil.hideMenu();break;case"today":zmUtil.hideMenu();break;case"yesterday":f.setDate(f.getDate()-1),g.setDate(g.getDate()-1),zmUtil.hideMenu();break;case"l7d":f.setDate(f.getDate()-7),zmUtil.hideMenu();break;case"mtd":f.setDate(1),zmUtil.hideMenu();break;case"ytd":f.setDate(1),f.setMonth(0),zmUtil.hideMenu();break;case"pm":f.setDate(1),f.setMonth(f.getMonth()-1),g.setFullYear(g.getFullYear(),g.getMonth(),0),zmUtil.hideMenu();break;case"ada":h=!1,zmUtil.showDatePicker(b,function(a){var b,c;c=new Date(a),b=new Date,d.setDateValue(d.getDateText(c,b)),e.setDateRange(c,b)});break;case"dr":h=!1,zmUtil.showDateRangePicker(b,function(a,b){var c,f;c=new Date(a),f=new Date(b),d.setDateValue(d.getDateText(c,f)),e.setDateRange(c,f)})}h&&(d.setDateValue(d.getDateText(f,g)),e.setDateRange(f,g))},zmsuite.showMenu(f)}),c.eq(2).parent().on("click",function(){var a,b={},e=c.eq(2).find("input");b.parentDOM=e,b.displayAs="dropdown",b.showAllItem=!0,b.parWidth=!0,b.onSelect=function(b){"all"===b?(d.collection.removeSearchLabel(),e[0].value=d.getLabelText()):b&&(d.collection.updateSearchLabel(b),e[0].value=d.getLabelText(b)),a.hide()},a=zmUtil.createFLComp("label",b),a.show()})},setDateValue:function(a){this.filterElem.find("span").eq(1).find("input")[0].value=a},getFolderText:function(a){var c;return c=a?zmInit.findFolName(a):b.mail.allFolders},getDateRangeText:function(){var a,c,d;return this.collection.dateRange&&this.collection.dateRange.from&&this.collection.dateRange.to?(a=this.collection.dateRange.from,c=this.collection.dateRange.to,d=this.getDateText(a,c)):d=b.dropdown.common.all,d},getLabelText:function(a){var c;return c=a?zmail.labInfo[a].dispName:b.dropdown.common.all},getDateText:function(a,c){var d,e,f;return a&&c?(d=zmUtil.getDateFromDateObj(a),e=zmUtil.getDateFromDateObj(c),f=d+" - "+e):f=b.dropdown.common.all,f},initAdvDiv:function(a){var b,c;b=this.collection.folderArr[0],c=this.collection.labelArr[0],a.find("input")[0].value=this.getFolderText(b),a.find("input")[1].value=this.getDateRangeText(),a.find("input")[2].value=this.getLabelText(c)},getAdvSearchQueryArr:function(){var a,b,c,d,e=this.filterElem.find("table").eq(3).find("tr"),f=e.length,g="",h=0,i=0,j=[];for(h=0;h<f;h++,i+=4)d={},b=e.eq(h).find("input").val().trim(),b&&(a=e.eq(h).find("select"),c=a.eq(0).val(),g="3"===c?"To/Cc":"7"===c?"Entire Message":zmSearch.searchQueryArr[c-1],d.lhs=g,d.value=b,"yes"===a.eq(1).val()?d.contains=1:d.contains=0,j.push(d));return j},getAdvSearchQuery:function(){var a,b,c,d=this.filterElem.find("table").eq(3).find("tr"),e=d.length,f="",g=0,h=0;for(g=0;g<e;g++,h+=4)b=d.eq(g).find("input").val().trim(),b&&(b=zmSearch.escapeSpecialChars(b),0!==g&&(f+=" && "),a=d.eq(g).find("select"),c=a.eq(0).val(),f+="3"===c?"To":"7"===c?"Entire":zmSearch.searchQueryArr[c-1],f+="yes"===a.eq(1).val()?" = ":" != ",f+=b,"3"===c&&(f+="|| Cc = "+b));return f},updateSearchParams:function(){var a,b,c,d,e,f;a=this.filterElem.find(".zm_atchopt"),b=this.filterElem.find(".zm_flgopt"),c=this.filterElem.find(".zm_convopt"),d=this.filterElem.find(".zm_respopt"),f=this.collection,e=this.getSelectedVal(a),f.updateSearchAttachFilter(e),e=this.getSelectedVal(b),f.updateSearchFlagFilter(e),e=this.getSelectedVal(c),f.updateSearchThreadFilter(e),e=this.getSelectedVal(d),f.updateSearchResponseFilter(e),f.setSearchQueryArr(this.getAdvSearchQueryArr()),zmSearch.hasSearchableText(this.collection.advSearchStr)&&(f.flushData(),this.hideFilterElem(),zmPrev.isPrevOpen("zm_srch"+this.id)&&zmPrev.clsPreview(),this.sendRequest(),zmWinTitle.updateTitle())},getSelectedVal:function(a){var b,c;return b=a.find(".msi-option"),c=a.find("i").index(b),0===c?c="all":1===c?c="yes":2===c&&(c="no"),c}};a.prototype=Object.create(SearchOuterView.prototype),$.extend(a.prototype,c),window.msSearchView=a}(),function(){"use strict";function a(a){this.obj=a,this.updateRowReadFn=void 0,this.updateRowUnreadFn=void 0,this.updateFlagRowFn=void 0,this.updateRowDeleteFn=void 0,this.updateLabelRowFn=void 0,this.updateRowMoveFn=void 0,this.updateRowArchiveFn=void 0,this.updateRowUnarchiveFn=void 0,this.updateRowSpamFn=void 0,this.updateRowNotspamFn=void 0,this.init()}a.prototype={updateRowRead:function(a,b,c){b===this.obj&&$(this).trigger("search/read",[b,c])},updateRowUnread:function(a,b,c){b===this.obj&&$(this).trigger("search/unread",[b,c])},updateFlagRow:function(a,b,c,d){b===this.obj&&$(this).trigger("search/flag",[b,c,d])},updateRowDelete:function(a,b,c){b===this.obj&&$(this).trigger("search/delete",[b,c])},updateLabelRow:function(a,b,c,d){b===this.obj&&$(this).trigger("search/label",[b,c,d])},updateRowMove:function(a,b,c,d){b===this.obj&&$(this).trigger("search/move",[b,c,d])},updateRowArchive:function(a,b,c){b===this.obj&&$(this).trigger("search/archive",[b,c])},updateRowUnarchive:function(a,b,c){b===this.obj&&$(this).trigger("search/unarchive",[b,c])},updateRowSpam:function(a,b,c){b===this.obj&&$(this).trigger("search/spam",[b,c])},updateRowNotspam:function(a,b,c,d){b===this.obj&&$(this).trigger("search/notspam",[b,c,d])},init:function(){this.updateRowReadFn=_zm.bindFn(this.updateRowRead,this),this.updateRowUnreadFn=_zm.bindFn(this.updateRowUnread,this),this.updateFlagRowFn=_zm.bindFn(this.updateFlagRow,this),this.updateRowDeleteFn=_zm.bindFn(this.updateRowDelete,this),this.updateLabelRowFn=_zm.bindFn(this.updateLabelRow,this),this.updateRowMoveFn=_zm.bindFn(this.updateRowMove,this),this.updateRowArchiveFn=_zm.bindFn(this.updateRowArchive,this),this.updateRowUnarchiveFn=_zm.bindFn(this.updateRowUnarchive,this),this.updateRowSpamFn=_zm.bindFn(this.updateRowSpam,this),this.updateRowNotspamFn=_zm.bindFn(this.updateRowNotspam,this),$.subscribe("mail/read",this.updateRowReadFn),$.subscribe("mail/unread",this.updateRowUnreadFn),$.subscribe("mail/flag",this.updateFlagRowFn),$.subscribe("mail/delete",this.updateRowDeleteFn),$.subscribe("mail/label",this.updateLabelRowFn),$.subscribe("mail/move",this.updateRowMoveFn),$.subscribe("mail/archive",this.updateRowArchiveFn),$.subscribe("mail/unarchive",this.updateRowUnarchiveFn),$.subscribe("mail/spam",this.updateRowSpamFn),$.subscribe("mail/notspam",this.updateRowNotspamFn)},unsubscribe:function(){$.unsubscribe("mail/read",this.updateRowReadFn),$.unsubscribe("mail/unread",this.updateRowUnreadFn),$.unsubscribe("mail/flag",this.updateFlagRowFn),$.unsubscribe("mail/delete",this.updateRowDeleteFn),$.unsubscribe("mail/label",this.updateLabelRowFn),$.unsubscribe("mail/move",this.updateRowMoveFn),$.unsubscribe("mail/archive",this.updateRowArchiveFn),$.unsubscribe("mail/unarchive",this.updateRowUnarchiveFn),$.unsubscribe("mail/spam",this.updateRowSpamFn),$.unsubscribe("mail/notspam",this.updateRowNotspamFn)}},window.msSearchRowModel=a}(),function(){"use strict";function a(a){this.model=a&&a.model,this.type=a&&a.type,this.parent=a&&a.parent,this.$el=void 0}a.prototype={constructRow:function(){var a,b;return"m"===this.type&&(b=zmInit.constructMailRow("",[this.model.obj]),a=$(b.querySelectorAll(".zmL")[0]),this.$el=a,this.subscribe()),this.$el},subscribe:function(){$(this.model).on("search/read",_zm.bindFn(this.mailRead,this)),$(this.model).on("search/unread",_zm.bindFn(this.mailUnread,this)),$(this.model).on("search/flag",_zm.bindFn(this.flagMail,this)),$(this.model).on("search/delete",_zm.bindFn(this.deleteMail,this)),$(this.model).on("search/label",_zm.bindFn(this.labelMail,this)),$(this.model).on("search/move",_zm.bindFn(this.moveMail,this)),$(this.model).on("search/archive",_zm.bindFn(this.archiveMail,this)),$(this.model).on("search/unarchive",_zm.bindFn(this.unarchiveMail,this)),$(this.model).on("search/spam",_zm.bindFn(this.markMailSpam,this)),$(this.model).on("search/notspam",_zm.bindFn(this.markMailNotspam,this))},clearAll:function(){this.model.unsubscribe()},mailRead:function(a,b,c){var d,e={};d={fId:"",view:"search",flag:"",label:"",attach:""},"msg"===c?e.trElem=this.$el:"thd"===c&&(e.thdElem=this.$el),this.$el.next().hasClass("zmTV")?e.thdContainer=this.$el.next():e.thdContainer=$(""),e.msgId=b,e.hdrId=this.parent.elemObj.hdrId+"S"+b,zmsearcActions.mailRead(c,e,d)},mailUnread:function(a,b,c){var d,e={};d={fId:"",view:"search",flag:"",label:"",attach:""},"msg"===c?e.trElem=this.$el:"thd"===c&&(e.thdElem=this.$el),e.thdContainer=$(""),e.msgId=b,e.hdrId=this.parent.elemObj.hdrId+"S"+b,zmsearcActions.mailUnread(c,e,d)},flagMail:function(a,b,c,d){var e,f={};e={fId:"",view:"search",flag:"",label:"",attach:""},"msg"===c?f.trElem=this.$el:"thd"===c&&(f.thdElem=this.$el),this.$el.next().hasClass("zmTV")?f.thdContainer=this.$el.next():f.thdContainer=$(""),f.msgId=b,f.hdrId=this.parent.elemObj.hdrId+"S"+b,f.prevElem=this.parent.prevElem,zmsearcActions.flagMail(c,d,f,e)},deleteMail:function(a,b,c,d){var e,f={};e={fId:"",view:"search",flag:"",label:"",attach:""},"msg"===c?f.trElem=this.$el:"thd"===c&&(f.thdElem=this.$el),this.$el.next().hasClass("zmTV")?f.thdContainer=this.$el.next():f.thdContainer=$(""),f.msgId=b,f.hdrId=this.parent.elemObj.hdrId+"S"+b,f.prevElem=this.parent.prevElem,zmsearcActions.deleteMail(c,d,f,e),this.parent.collection.deleteFromList(b),this.parent.setEmptyListing()},labelMail:function(a,b,c,d){var e,f={};e={fId:"",view:"search",flag:"",label:"",attach:""},"msg"===c?f.trElem=this.$el:"thd"===c&&(f.thdElem=this.$el),this.$el.next().hasClass("zmTV")?f.thdContainer=this.$el.next():f.thdContainer=$(""),f.msgId=b,f.hdrId=this.parent.elemObj.hdrId+"S"+b,f.prevElem=this.parent.prevElem,zmsearcActions.labelMail(c,d,f,e)},moveMail:function(a,b,c,d){var e,f={};if(e={fId:"",view:"search",flag:"",label:"",attach:""},"msg"===c?f.trElem=this.$el:"thd"===c&&(f.thdElem=this.$el),this.$el.next().hasClass("zmTV")?f.thdContainer=this.$el.next():f.thdContainer=$(""),f.msgId=b,f.hdrId=this.parent.elemObj.hdrId+"S"+b,f.prevElem=this.parent.prevElem,d.folderArr=this.parent.collection.folderArr,d.folId===zmail.folId.tId){var g=1;zmsearcActions.deleteMail(c,g,f,e),this.parent.collection.deleteFromList(b),this.parent.setEmptyListing()}else zmsearcActions.moveMail(c,d,f,e),d.folderArr[0]&&d.folderArr[0]!==d.folId&&(this.parent.collection.deleteFromList(b),this.parent.setEmptyListing())},archiveMail:function(a,b,c){var d,e={};d={fId:"",view:"search",flag:"",label:"",attach:""},"msg"===c?e.trElem=this.$el:"thd"===c&&(e.thdElem=this.$el),e.thdContainer=$(""),e.msgId=b,e.hdrId=this.parent.elemObj.hdrId+"S"+b,zmsearcActions.archiveMail(c,e,d)},unarchiveMail:function(a,b,c){var d,e={};d={fId:"",view:"search",flag:"",label:"",attach:""},"msg"===c?e.trElem=this.$el:"thd"===c&&(e.thdElem=this.$el),e.thdContainer=$(""),e.msgId=b,e.hdrId=this.parent.elemObj.hdrId+"S"+b,zmsearcActions.unarchiveMail(c,e,d)},markMailSpam:function(a,b,c){var d,e={};d={fId:"",view:"search",flag:"",label:"",attach:""},"msg"===c?e.trElem=this.$el:"thd"===c&&(e.thdElem=this.$el),e.thdContainer=$(""),e.msgId=b,e.hdrId=this.parent.elemObj.hdrId+"S"+b,e.prevElem=this.parent.prevElem,zmsearcActions.spamAction(c,e,d),this.parent.collection.deleteFromList(b),this.parent.setEmptyListing()},markMailNotspam:function(a,b,c,d){var e,f={};e={fId:"",view:"search",flag:"",label:"",attach:""},"msg"===c?f.trElem=this.$el:"thd"===c&&(f.thdElem=this.$el),f.thdContainer=$(""),f.msgId=b,f.hdrId=this.parent.elemObj.hdrId+"S"+b,f.prevElem=this.parent.prevElem,zmsearcActions.notspamAction(c,d,f,e),this.parent.collection.deleteFromList(b),this.parent.setEmptyListing()}},window.msSearchRowView=a}(),window.zmsearcActions=function(){"use strict";var a=function(a,b){a.length<=100?b.text(a.length-1):b.text("99+")},b=function(a,b){var c=zmInit.findFolName(b),d="",e=a.msgId;d=zmail.mailObj[e].AR?c+" (ARCHIVED)":c,a.trElem&&a.trElem.length&&a.trElem.find(".zmFdr span").html(c),$("#zmHdrS"+e+" .js-fnHolder").html(d),a.thdElem&&a.thdElem.length&&(a.thdElem.find(".zmFdr span").html(c),a.thdContainer&&a.thdContainer.length&&a.thdContainer.find(".zmFdr span").html(c))},c=function(b,c,d,e){var f,g,h=zmList.getListForAllMailsView(e,zmail.mailObj[b].T);if(f=zmsuite.getCenter("zm_srch1")[0].getNodes()[2].$el,h.length>1){g=f.find("#"+h[0]).parent();var i=g.prev().find(".zmtCt");c===zmail.folId.tId&&(a(h,i),"1"===i.text()&&(g.prev().find(".zm_td").remove(),g.prev().removeClass("zmTLst"),g.remove()))}else 1===h.length&&(zmPrev.clsPreview(),f.find("#t"+h[0]).remove());f.find("#"+b).remove()},d=function(a,b,c){var d=[];return zmail.listObj[b]?d=zmList.getListForAllMailsView(c,b):d.push(a),d},e=function(a,c,d){var e,f,g,h,i,j;e=zmail.folId.spId,f=c.msgId,h=c.trElem,g=c.thdElem,i=c.thdContainer,j=c.prevElem,"msg"===a?(b(c,e),j.attr("data-mid")===f&&zmPrev.clsPreview(),h.remove(),zmail.mailContainer.removeObject(f)):"thd"===a&&(g.remove(),i.remove(),j.attr("data-mid")===f&&zmPrev.updatePrevOnDeletion(f,"zm_srch1"))},f=function(a,c,d,e){var f,g,h,i,j;f=c.folId,g=d.msgId,i=c.folderArr?c.folderArr[0]:"",h=d.trElem,h.removeClass("zmarch"),j=d.prevElem,b(d,f),"msg"===a&&(zmPreviewTemplate.updateMailHeaderView(g),i&&i!==f&&(h.remove(),j.attr("data-mid")===g&&zmPrev.clsPreview()))},g=function(a,b,c){var e,f,h,i,j,k,l=zmsuite.getCenter("zm_srch1")[0].getNodes()[2].$el;if(e=b.trElem,k=b.thdElem,f=b.thdContainer,j=b.msgId,"msg"===a)e.removeClass("zm_urd"),f.hasClass("zmTV")&&(f.children("div").hasClass("zm_urd")||f.prev().removeClass("zm_urd")),$("#"+b.hdrId).find(".zmPT").removeClass("zm_urd");else if("thd"===a){k.removeClass("zm_urd"),f.children("div").removeClass("zm_urd"),i=$.extend({},c),i.view="all",h=d(j,zmail.mailObj[j].T,i);for(var m in h){var n=$.extend({},b);n.msgId=h[m],n.trElem=l.find("#"+h[m]),n.thdElem=$(""),n.thdContainer=$(""),g("msg",n,c)}}"msg"===a&&zmail.mailObj[j].T&&zmInit.checkThreadRead(zmail.mailObj[j].T)&&(f.length>0?f.prev().removeClass("zm_urd"):$("#zmListing .zmSLst").removeClass("zm_urd"))},h=function(a,b,c){var e,f,g,i,j,k,l=zmsuite.getCenter("zm_srch1")[0].getNodes()[2].$el;if(f=b.trElem,e=b.thdElem,g=b.thdContainer,k=b.msgId,"msg"===a)f.addClass("zm_urd"),g.hasClass("zmTV")&&g.children("div").hasClass("zm_urd")&&g.prev().addClass("zm_urd"),$("#"+b.hdrId).find(".zmPT").addClass("zm_urd");else if("thd"===a){e.addClass("zm_urd"),g.children("div").addClass("zm_urd"),j=$.extend({},c),j.view="all",i=d(k,zmail.mailObj[k].T,j);for(var m in i){var n=$.extend({},b);n.msgId=i[m],n.trElem=l.find("#"+i[m]),n.thdElem=$(""),n.thdContainer=$(""),h("msg",n,c)}}},i=function(a,b,c,e){var f,g,h,j,k,l,m,n=zmInit.flgClass(b);if(j=c.trElem,h=c.thdElem,k=c.prevElem,l=c.msgId,"msg"===a){if(zmail.mailObj[l].TH&&0!==zmail.folviewThread){var o,p;m=zmList.getListForAllMailsView(e,zmail.mailObj[l].T),o=m[0],p=$("#t"+o),zmmailAct.updateFlagStatusforThd(o,zmail.mailObj[l].NFG,b),f=zmInit.getThdFlagvalue(o),g=zmInit.flgClass(f),p.find(".zmflg").removeClass().addClass(g)}j.find(".zmflg").removeClass().addClass(n),k.attr("data-mid")===l&&$("#"+c.hdrId).find(".zmflg").removeClass().addClass(n)}else if("thd"===a){m=[];var q,r,s,t=zmsuite.getCenter("zm_srch1")[0].getNodes()[2].$el;for(s=zmail.mailObj[l].T,m=d(l,s,e),q=m.length,r=0;r<q;r++){var u=$.extend({},c);u.msgId=m[r],u.trElem=t.find("#"+m[r]),u.thdElem=$(""),u.thdContainer=$(""),i("msg",b,u,e)}h.find(".zmflg").removeClass().addClass(n)}},j=function(a,b,c,e){var f,g,h,i,k,l;if(f=c.thdElem,h=c.msgId,i=b.lA,k=b.lId,"msg"===a){if(zmail.mailObj[h].TH&&0!==zmail.folviewThread){var m;g=zmList.getListForAllMailsView(e,zmail.mailObj[h].T),m=g[0],f=f&&f.length?f:$("#t"+m),zmmailAct.updateLabelsforThd(m,[k],i)}}else if("thd"===a){g=[];var n,o,p=zmsuite.getCenter("zm_srch1")[0].getNodes()[2].$el;for(o=zmail.mailObj[h].T,g=d(h,o,e),n=g.length,l=0;l<n;l++)if("deleteall"===i&&zmail.mailObj[g[l]].TAG||"add"===i&&(!zmail.mailObj[g[l]].TAG||$.inArray(k,zmail.mailObj[g[l]].TAG)===-1)||"delete"===i&&$.inArray(k,zmail.mailObj[g[l]].TAG>=0)){var q=$.extend({},c);q.msgId=g[l],q.trElem=p.find("#"+g[l]),q.thdElem=$(""),q.thdContainer=$(""),j("msg",b,q,e)}}zmPreviewTemplate.refreshLabelsForMail(h,f)},k=function(a,d,e,f){var g,h,i,j,k;h=e.trElem,g=e.thdElem,i=e.thdContainer,j=e.prevElem,k=e.msgId,"msg"===a?(b(e,zmail.folId.tId),zmail.mailObj[k].T&&(zmail.mailObj[k].FD===zmail.folId.dId&&zmUtil.removeDraftMapping(k),c(k,zmail.folId.tId,zmail.mailObj[k].FD,f)),5!==d&&zmail.mailObj[k].FD===zmail.folId.tId&&(d=5),j.attr("data-mid")===k&&zmPrev.updatePrevOnDeletion(k,"zm_srch1"),zmail.mailObj[k].TH||h.remove(),5===d&&$.publish("/mail/msgDiscarded",[{draftId:k,actionType:"discard_draft"}]),zmail.mailContainer.removeObject(k)):"thd"===a&&(g.remove(),i.remove(),j.attr("data-mid")===k&&zmPrev.updatePrevOnDeletion(k,"zm_srch1")),"msg"===a&&zmPreviewTemplate.updateMailHeaderView(k)},l=function(a,c,d){var e,f,g;e=c.msgId,f=zmail.mailObj[e].FD,g=c.trElem,b(c,f),"msg"===a&&g.addClass("zmarch")},m=function(a,c,d){var e,f,g;e=c.msgId,f=zmail.mailObj[e].FD,g=c.trElem,b(c,f),"msg"===a&&g.removeClass("zmarch")},n=function(a,c,d,e){var f,g,h,i,j,k;g=d.msgId,h=d.trElem,j=d.thdElem,k=d.thdContainer,i=d.prevElem,"msg"===a?(f=c[0].folId,b(d,f),h.remove(),i.attr("data-mid")===g&&zmPrev.clsPreview(),zmail.mailContainer.removeObject(g)):"thd"===a&&(j.remove(),
k.remove(),zmPrev.clsPreview())},o={rmDuplicateLabel:function(a,b,c){for(var d,e,f,g=a.toString().split(","),h=g.length,i=[],j=0;j<h;j++){if(f=g[j],e=zmail.mailObj[f].TAG,d=!1,e)for(var k in e)if(e[k]===b){d=!0;break}d||i.push(f)}return i},mailRead:g,mailUnread:h,flagMail:i,deleteMail:k,moveMail:f,labelMail:j,archiveMail:l,unarchiveMail:m,spamAction:e,notspamAction:n};return o}(),window.zmStreamSearch=function(){"use strict";function a(a){this.searchQueryArr=[],this.searchList={},this.searchOrder=[],this.hasNext=void 0,this.range=25,this.sending=!1,this.entityType=a.entityType||-1}function b(){}var c=zmText.get("search");a.prototype={setSearchQueryArr:function(a){this.searchQueryArr=a},getSearchType:function(){return"zmStreamsApp"},addSearchList:function(a){var b,c;a&&a.order.length>this.range?(this.hasNext=1,a.order.pop()):this.hasNext=0,$.extend(this.searchList,a.list),this.searchOrder.length?(b=this.searchOrder.length,this.searchOrder=this.searchOrder.concat(a.order)):(b=0,this.searchOrder=a.order),c=this.searchOrder.length,this.from=c+1,$(this).trigger("search/listUpdated",[b,c])},deleteFromList:function(a){var b;b=this.searchList.indexOf(a),b!==-1&&this.searchList.splice(b,1),this.searchList.length<this.range&&this.sendRequest()},getSearchParams:function(){var a,b={};return a=this.searchQueryArr[0],a.Summary?b.summary=a.Summary:a["Attachment Name"]?b.attachname=a["Attachment Name"]:a["Attachment Content"]?b.attachContent=a["Attachment Content"]:b.SearchStr=encodeURIComponent(a.All),b},sendRequest:function(){var a,b,c={},d=this;!this.sending&&this.hasNext&&zmSearch.hasSearchableText(this.searchQueryArr)&&(this.sending=!0,a=this.searchOrder.length,c.start=a,c.actionType="viewSelfData",c.mode="searchStreams",c.grid="false",c.range=this.range,c.entityType=this.entityType,c.groupId=zmail.zuid,c.streamsView="true",b=function(){var a=$.Deferred();return zmAjq.XHR({u:zmail.conPath+"/stream.do",t:"POST",fn:function(b){a.resolve(b)},p:c,csr:"s"}),a.promise()},$.extend(c,this.getSearchParams()),$.when(b(),zmUtil.loadStreams()).done(function(a){d.searchResponse(a)}))},searchResponse:function(a){this.sending=!1,this.addSearchList(a)},flushData:function(){this.hasNext=1,this.from=1,this.searchList=[]},getSearchVal:function(){for(var a in this.searchQueryArr[0])return this.searchQueryArr[0][a]}};var d={updateListing:function(a,b,d){var e,f;f=this.collection.searchList,e=this.collection.searchOrder.slice(b,d),this.loadingBandFn(),0===b&&(this.listElem.html(""),this.listElem.scrollTop(0),0===d&&this.listElem.html(zmInit.emptyRow(c.emptyResults))),zmStreamsApp.PostApp.searchView({order:e,list:f},this.listElem[0])},getHeaderObj:function(){var a={left:{leftHTML:c.stream.resultsHeader},right:[]};return a},setCSSToCenterDOM:function(){zmsuite.getCenter()[0].$el.addClass("zms_streams")}};return b.prototype=Object.create(SearchOuterView.prototype),$.extend(b.prototype,d),{streamCollection:a,streamView:b}}(),function(){"use strict";function a(a){this.searchQueryArr=[],this.advSearchStr=a&&a.advSearchStr||"",this.searchList={},this.searchOrder=[],this.hasNext=1,this.limit=20,this.sending=!1}function b(){}a.prototype={setAdvSearchStr:function(a){this.advSearchStr=a},getAdvSearchStr:function(){return this.advSearchStr},setSearchQueryArr:function(a){var b;this.searchQueryArr=a,b=this.getSearchQueryFromArr(this.searchQueryArr),this.setAdvSearchStr(b)},addSearchList:function(a){var b,c;a.order||(a.order=[]),a.list||(a.list={}),a.order.length>this.limit?this.hasNext=1:this.hasNext=0,$.extend(this.searchList,a.list),this.searchOrder.length?(b=this.searchOrder.length,this.searchOrder=this.searchOrder.concat(a.order)):(b=0,this.searchOrder=a.order),c=this.searchOrder.length,this.from=c,$(this).trigger("search/listUpdated",[b,c])},deleteFromList:function(a){var b;b=this.searchList.indexOf(a),b!==-1&&this.searchList.splice(b,1),this.searchList.length<20&&this.sendRequest()},sendRequest:function(){var a,b,c,d={},e={load:"taskapp"},f=this;!this.sending&&this.hasNext&&zmSearch.hasSearchableText(this.advSearchStr)&&(this.sending=!0,a=this.searchOrder.length||0,d.start=a,d.limit=this.limit,d.search=this.getAdvSearchStr(),d.taction="searchTasks",d.isPrev="false",d.actionType="appView",d.streamsView=!0,d.groupId=zmail.zuid,d.entityType=3,b=function(){var a=$.Deferred();return zmAjq.XHR({u:zmail.conPath+"/taskView.do",t:"POST",fn:function(b){a.resolve(b)},p:d,csr:"s"}),a.promise()},c=function(){var a=$.Deferred();return zmUtil.loadTask(e,function(){a.resolve()}),a.promise()},$.when(b(),c()).done(function(a){f.searchResponse(a)}))},searchResponse:function(a){this.sending=!1,this.addSearchList(a)},flushData:function(){this.hasNext=1,this.from=0,this.searchList=[]},getSearchQueryFromArr:function(){return this.searchQueryArr[0].taskStr},getSearchVal:function(){return this.searchQueryArr[0].taskStr}};var c={updateListing:function(a,b,c){var d,e,f,g,h,i,j,k=[],l="NMSPID",m="TASKID";for(h=this.collection.searchList,g=this.collection.searchOrder,e=g.length,zmSearch.taskObj&&zmSearch.taskObj.deleteSubscribers&&zmSearch.taskObj.deleteSubscribers(),zmSearch.taskObj=zmTask._list.constructList(g,h,void 0,"zm_srch1"),this.loadingBandFn(),0===b&&(this.listElem.html(""),this.listElem.scrollTop(0),0===c&&this.listElem.html(zmInit.emptyRow(zmText.get("search","emptyResults")))),this.limit<e&&(e=this.limit),d=0;d<e;d++)f=$(k[d]),f.data("data-model",h[g[d]]),i=h[g[d]][l],j=h[g[d]][m],this.listElem.append(zmSearch.taskObj.centerListingObj[i][j].listingEl)},getHeaderObj:function(){var a={left:{leftHTML:zmText.get("search","task.resultsHeader")},right:[]};return a},bind:function(){var a;a=zmsuite.getCenter()[0].getNodes()[2],a.setListener("click",function(a){zmSearch.taskObj.listClickHandler(a)}),$.subscribe("search/closeTab",function(a){zmSearch.taskObj&&zmSearch.taskObj.deleteSubscribers()})}};b.prototype=Object.create(SearchOuterView.prototype),$.extend(b.prototype,c),window.zmTaskSearch={taskCollection:a,taskView:b}}(),window.zmNotesSearch=function(){"use strict";function a(a){this.searchQueryArr=[],this.advSearchStr=a&&a.advSearchStr||"",this.searchList={},this.searchOrder=[],this.hasNext=1,this.from=0,this.limit=10,this.sending=!1}function b(){}a.prototype={setAdvSearchStr:function(a){this.advSearchStr=a},getAdvSearchStr:function(){return this.advSearchStr},setSearchQueryArr:function(a){var b;this.searchQueryArr=a,b=this.getSearchQueryFromArr(this.searchQueryArr),this.setAdvSearchStr(b)},addSearchList:function(a){var b,c,d=a[0].Notes,e=a[0].page;e.showNextPage?this.hasNext=1:this.hasNext=0,$.extend(this.searchList,a),b=d.length?d.length:0,c=this.searchOrder.length,this.from=c+1,$(this).trigger("search/listUpdated",[b,c])},deleteFromList:function(a){var b;b=this.searchList.indexOf(a),b!==-1&&this.searchList.splice(b,1),this.searchList.length<25&&this.sendRequest()},sendRequest:function(){var a,b,c,d={},e=this;!this.sending&&this.hasNext&&zmSearch.hasSearchableText(this.advSearchStr)&&(this.sending=!0,a=this.searchOrder.length||0,d.start=a,d.limit=this.limit,d.search=this.getAdvSearchStr(),d.streamsView="Notes",d.mode="searchNotes",d.isPrev="false",d.groupId=zmail.zuid,d.actionType="viewSelfData",d.entityType=2,b=function(){var a=$.Deferred();return zmAjq.XHR({u:zmail.conPath+"/NotesAction.do",t:"POST",fn:function(b){a.resolve(b)},p:d,csr:"s"}),a.promise()},c=function(){var a=$.Deferred();return a.resolve(),a.promise()},$.when(b(),c()).done(function(a){e.searchResponse(a)}))},searchResponse:function(a){this.sending=!1,this.addSearchList(a)},flushData:function(){this.hasNext=1,this.from=0,this.searchList=[]},getSearchQueryFromArr:function(){return this.searchQueryArr[0].notesStr},getSearchVal:function(){return this.searchQueryArr[0].notesStr}};var c={updateListing:function(a,b,c){zmSearch.notesObj=zNote.listNotes(this.collection.searchList,{isnew:!0},this.listElem,zmSearch.notesObj)},getHeaderObj:function(){var a={left:{leftHTML:"Results From Notes"},right:[]};return a},bind:function(){var a;a=zmsuite.getCenter()[0].getNodes()[2],a.setListener("click",function(a){}),$.subscribe("search/closeTab",function(a){})}};return b.prototype=Object.create(SearchOuterView.prototype),$.extend(b.prototype,c),{notesCollection:a,notesView:b}}();