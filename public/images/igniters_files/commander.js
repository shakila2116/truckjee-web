!function(a){"use strict";a.call(zmail.Core.Namespaces.create("zmail.Commander.Views"),zmail.Core.Namespaces.get)}(function(a){"use strict";var b,c,d,e,f,g,h,i,j=a("_"),k=a("$.Deferred"),l=!0,m=this;this.init=j.once(function(){f=a("zmail.Paginator"),e=a("zmail.SearchComponents.ListView"),d=a("zmail.Search.ModeKeeper"),g=a("zmail.Search.Utils.CommonUtil"),b=a("zmail.Search.ViewInstance.SearchBox"),c=new e({$for:b.$el,$left:b.$leftParent,$top:b.$topParent,pageSize:10,hideOnRemove:!0,selectionStartIndex:0,onEscape:function(){d.mode=d.MODES.COMMANDS},onMouseDown:function(){d.mode=d.MODES.COMMANDS},text:function(a,b){if(j.isString(a))return a;if(i){var c=i.text||"description";if(j.isFunction(c))return c(a);if(j.isObject(a)&&j.isString(c)){var d=a[c];if(j.isString(d))return d;if(j.isArray(d)){var e=(b.query||"").toLowerCase();return j(d).find(function(a){return 0===a.toLowerCase().indexOf(e)})}return""}}},paginator:new f({pageSize:10,provider:function(a){if(i){if(j.isFunction(i.provider))return i.provider(a.query);if(j.isArray(i.provider)){var b=(a.query||"").toLowerCase(),c=i.filterProps||j.isString(i.text)&&i.text;return c&&(c=j.isArray(c)?c:[c]),i.provider.filter(function(a){return j.isString(a)?0===a.toLowerCase().indexOf(b):!j.isObject(a)||!c||g.isStartsWith(a,b,c)})}}return[]}}),onSelect:function(a){h&&h.resolve(a),m.clearText().reset()}}).unbind(),b.registerModeHandler(d.MODES.COMMAND_EXECUTION,{autofill:function(){return c}})}),this.showList=function(a){return i=a,h=k(),c.reset(),setTimeout(function(){d.mode=d.MODES.COMMAND_EXECUTION,c.change(b.getText())}),h.promise()},this.setText=function(a){return b.setText(a),this},this.clearText=function(){return b.setText(""),this},this.setPlaceholder=function(a){return b.setPlaceholder(a),this},this.preventDefault=function(){return l=!1,this},this.reset=function(a){(l||a)&&(l=!0,h=i=void 0,d.mode=d.MODES.COMMANDS)}}),function(a){"use strict";a.call(zmail.Core.Namespaces.create("zmail.Commander"),zmail.Core.Namespaces.get)}(function(a){"use strict";this.CommandError=function(a){this.message=a}}),function(a){"use strict";a.call(zmail.Core.Namespaces.create("zmail.Commander"),zmail.Core.Namespaces.get)}(function(a){"use strict";var b=a("_"),c=a("zmail.Maps.IndexedMap"),d=a("zmail.Maps.DelimitedMap"),e=a("zmail.Commander.Views"),f=a("zmUtil"),g=new d,h=new c,i={},j=this,k=function(){return{execute:j.execute,getByGroupName:j.getByGroupName,showList:e.showList,setText:e.setText,clearText:e.clearText,setPlaceholder:e.setPlaceholder,preventDefault:e.preventDefault,reset:e.reset}},l=function(a){return a?(b.isArray(a)||(a=[a]),a):[]};this.register=function(a){return l(a).reduce(function(a,b){var c=b.name;c in i&&f.debugLog("command-name: "+c+" already exits"),i[c]=b;var d=b.searchable!==!1?b.description:[];return l(d).forEach(function(a){h.add(a,c)}),l(b.group).forEach(function(a){g.add(a,c)}),a},this)},this.deRegister=function(a){var b=i[a];return b&&(delete i[a],l(b.description).forEach(function(b){h.remove(b,a)}),l(b.group).forEach(function(b){g.remove(b,a)})),this},this.get=function(a){return h.get(a).map(function(a){return i[a]})},this.getCommand=function(a){return i[a]},this.getByGroupName=function(a){return g.get(a).map(function(a){return i[a]})},this.execute=function(c){if(b.isString(c)&&(c=i[c]),c&&b.isFunction(c.action)){a("zmail.Commander.Views").reset();var d=[].slice.call(arguments);return d.splice(0,1),c.action.apply(b.extend(k(),c),d)}},this.isCommand=function(a){return!!(a&&a.name&&i[a.name])&&(a.description&&b.isFunction(a.action))}});