window.zmfolAction=function(a){"use strict";var b={},c={},d={},e=zmText.get("zmFolder"),f=function(a,b,c){zmAjq.XHR({u:zmail.conPath+"/folAction.do",t:"POST",fn:c,p:a,csr:"s",ep:b})},g=function(a,b,c,d){var f;b=b.toLowerCase();for(f in a)if(a[f].FN.toLowerCase()===b&&f!==c)return zmUtil.succErrMsg("e",e.folderCreateRename.folexist,d),!1;return!0},h=function(a,c){if("success"===a.status){b[a.folId]=Date.now(),zmmailAct.updateCount({fId:a.folId,mode:"upd",count:0});var d=[a.folId];c.mailId&&d.push(c.mailId),$.publish("folder/read",d)}},i=function(){$("#emptyfolpopup").remove()},j=function(){var a,b=function(c,d){var e=[];if(d=d||{},d.pathStack=d.pathStack||[],d.idStack=d.idStack||[],d.folderMap=d.folderMap||zmail.folTree[0],!c&&!d.isSubTree)return a||b(!0);d.isSubTree||(a=[]),a=a||[];var f;for(f in d.folderMap)e[d.folderMap[f].SE-1]=f;for(var g=0,h=e.length;g<h;g++)if(e[g]){f=e[g],d.pathStack.push(d.folderMap[f].FN),d.idStack.push(f);var i=zmail.folTree[1][f]&&zmail.folTree[1][f].CH?Object.keys(zmail.folTree[1][f].CH).length:0,j=d.idStack[0],k=d.idStack[d.idStack.length-2];a.push({id:f,name:d.folderMap[f].FN,path:d.pathStack.join("/")+"/",parentName:d.pathStack.length>1?d.pathStack[0]:"",parentID:j||null,immediateParentID:k||null,levelCount:d.pathStack.length-1,childCount:i}),zmail.folTree[1][f]&&b(!1,{pathStack:d.pathStack,idStack:d.idStack,folderMap:zmail.folTree[1][f].CH,isSubTree:!0}),d.pathStack.pop(),d.idStack.pop()}else e.splice(g,1),g--,h--;return a},c=function(){a=void 0};return $.subscribe("folder/added",c),$.subscribe("folder/trashemptied",c),$.subscribe("folder/moved",c),$.subscribe("folder/renamed",c),$.subscribe("/mail/accountSwitch",function(a,b){b=b||{},"success"===b.status&&c()}),b}(),k=function(a,b){b=b||{};var c=b.maxLength||50,d=b.filler||"...",e=d.length,f=b.separator||"/";a=a&&a.trim()||"";for(var g=a.split(f),h=0;h<g.length;h++)g[h]=g[h].trim(),g[h].length||(g.splice(h,1),h--);if(1===g.length)a.length>c&&(a=a.substr(0,c-e)+d);else if(2===g.length)a.length>c&&(a=d+f+g[1].substr(0,c-(e+1+e))+d);else{var i=g[0].length+g[g.length-1].length+2+e;a=i>c?d+f+g[g.length-1].substr(0,c-(e+1+e))+d:g[0]+f+d+f+g[g.length-1]}return a},l=function(){var a,b,c,d=0;c=zmail.folTree[0];for(a in c)c[a].SE>d&&(b=a,d=c[a].SE);return b};a.rgtFolId="";var m=function(a){return!!zmfolAction.getParentFolderId(a)};a.getFolCV=function(a){if(m(a)){var b=zmfolAction.getParentFolderId(a);return zmail.folTree[1][b].CH[a].CV}return zmail.folTree[0][a].CV},a.updateFoldersCV=function(a){var b,c,d,e=zmail.folTree;for(b in e[0])if(zmUtil.hasFolSpecConversation(b)){e[0][b].CV=a;var f=zmfolAction.getChildrenOf(b);for(d in f){c=f[d];var g=zmfolAction.getParentFolderId(c);e[1][g].CH[c].CV=a}}},a.updateCV=function(a,b){var c=zmail.folTree,d=zmfolAction.getParentFolderId(a);d?c[1][d].CH[a].CV=b:c[0][a].CV=b},a.getParentFolderId=function(a){var b=zmail.folTree[1];for(var c in b)if(b[c].CH[a])return c;return 0},a.hasChild=function(b,c){var d;return d=a.getParentFolderId(c),d===b||0!==d&&void(c=d)},a.hasObjLength=function(a){var b;for(b in a)return!0;return!1},a.insertNewFolder=function(a,b){var c=a.prefolId,d=a.folId,e=a.fName;if("success"===a.status){var f,g=[],h="zmlTreeH";f=zmail.mailLeft.getNodes()[0].getLayer(h),g[d]={E:0,FN:e,HC:0,SH:"-1",count:"0",IA:0,CV:zmail.folviewThread},f.insertNodeAfter(g,f.mapObject,c),$.publish("folder/added",{folderID:d})}else zmUtil.succErrMsg("e",a.emsg);b&&b.reqDoneClbk&&b.reqDoneClbk("success"===a.status,d)},a.insertNewSubFolder=function(a,b){var c=a.prefolId,d=a.pfolId,e=a.folId,f=a.fName;if("success"===a.status){var g,h=[],i="zmlTreeH";g=zmail.mailLeft.getNodes()[0].getLayer(i),h[e]={E:0,FN:f,HC:0,SH:"-1",count:"0",IA:0,CV:zmail.folviewThread},c?g.insertNodeAfter(h,g.mapObject,c,d):g.appendNode(h,g.mapObject,d),$.publish("folder/added",{folderID:e})}else zmUtil.succErrMsg("e",a.emsg);b&&b.reqDoneClbk&&b.reqDoneClbk("success"===a.status,e)},a.renameFolder=function(a){var b,c=a.folId,d=[],e="zmlTreeH",f=a.fName;"success"===a.status?(b=zmList.getRowInfo(c,e,"info"),b.FN=f,d[c]=b,zmList.editLeftRow(d,e),$.publish("folder/renamed",{folderID:c}),$.publish("/folder/rename")):zmUtil.succErrMsg("e",a.emsg)},a.markAsReadFolder=function(a){var b,c,d,e=zmInit.getListingDetObj();b=a?a:e.fId,c={accId:zmail.accId,mode:"read",folId:b};var g=[];zmail.listObj[b]&&(g=zmail.listObj[b].MO.slice()),d={action:"read",mailId:g},f(c,d,h)};var n=function(a){var b=a.id,c=zmail.mailObj[b];c&&c.FD===zmail.folId.tId&&0===c.TH&&zmail.mailContainer.removeObject(b)};a.emptyFolder=function(b,f,g){if("success"===b.status){c[b.folId]=Date.now(),zmsDialog.remove();var h=b.folId,i=zmUtil.getFolId(),j=zmInit.getListingDetObj();if(i===h&&zmPrev.clsPreview(),$("#emptyfolpopup").remove(),zmail.listObj[h]?$.publish("/mail/discardFromThread",{fId:h}):zmail.listObj[i]&&$.publish("/mail/discardFromThread",{fId:h,viewId:i}),$.publish("folder/archived",[h,b.isArchived]),h===zmail.folId.spId)j.fId===zmail.folId.spId&&$(zmail.mailCenter.listElem).html(zmInit.emptyRow()),zmmailAct.updateCount({fId:h,mode:"upd",count:0}),g||zmUtil.succErrMsg("s",e.emptyfolder.emptyspammsg);else if(h===zmail.folId.tId){j.fId===zmail.folId.tId?$(zmail.mailCenter.listElem).html(zmInit.emptyRow()):a.isDeletedFolder(j.fId)&&$.publish("/mail/listMails",{fId:zmail.folId.iId}),zmmailAct.updateCount({fId:h,mode:"upd",count:0});var k=zmail.mailLeft.getNodes()[0].getLayer("zmlTreeH");k.clearChild(zmail.folId.tId),g||zmUtil.succErrMsg("s",e.emptyfolder.emptytrashmsg),zmail.mailContainer.filter(n),$.publish("folder/trashemptied",{})}else if(h===zmail.folId.sId)j.fId===zmail.folId.sId&&$(zmail.mailCenter.listElem).html(zmInit.emptyRow()),g||zmUtil.succErrMsg("s",e.emptyfolder.emptysentmsg);else if(g||zmUtil.succErrMsg("s",zmText.applyArgs(e.emptyfolder.emptyfol,{foldername:zmInit.findFolName(h)})),delete zmail.listObj[h],j.fId===h?(zmInit.reInitListing(),f.selDate||f.leaveCount?(zmInit.setListingDetObj({}),zmInit.foldView({folId:h})):$(zmail.mailCenter.listElem).html(zmInit.emptyRow())):j.fId===zmail.folId.tId?$.publish("/mail/listMails",{fId:zmail.folId.tId}):zmUtil.isFolderId(i)||$.publish("/mail/listMails",{}),b.foltree){zmail.folCount=b.foltree;var l=zmail.mailLeft.getNodes()[0].getLayer("zmlTreeH");l.setCountObject(zmail.folCount),zmmailAct.updateCount({fId:h,mode:"upd",count:zmail.folCount[h].c}),zmmailAct.updateCount({fId:zmail.folId.tId,mode:"upd",count:zmail.folCount[zmail.folId.tId].c})}}else g||zmUtil.succErrMsg("e",b.emsg);d[b.folId]="1",zmInit.listingBand.SpamTrashBand.setBand()},a.getEmptyFolderStatus=function(a){return void 0!==d[a]?d[a]:""},a.resetEmptyFolderStatus=function(a){d[a]=""},a.sendEmptyFolderReq=function(b){var c,d,f;if(c=b?b:a.rgtFolId,!$("#emptyfolpopup").length){var g=[];zmUtil.getFolderObject(c).IA&&g.push(["DIV",{attrs:{"class":"zm_formLne"},child:[["DIV",{attrs:{"class":"SC_lne"}}]]}],["DIV",{attrs:{"class":"zm_formFld zm_formTxt"},child:[["DIV",{attrs:{"class":"zm_formCell"},child:[["I",{attrs:{"class":"msi-uncheck",id:"selArchive",onclick:"zmfolAction.selectOption(this);"}}],["SPAN",{attrs:{id:"selArchiveText",onclick:"zmfolAction.selectOption(this);"},child:[["text",e.emptyfolderdialog.includeArchive]]}]]}]]}]);var h=["DIV",{attrs:{id:"emptyfolpopup",style:"display:none","class":"zm_formArea zm_Formflex"},child:[["DIV",{attrs:{"class":"zm_formFld zm_formTxt"},child:[["DIV",{attrs:{"class":"zm_formCell"},child:[["I",{attrs:{"class":"msi-option",id:"optionAll",onclick:"zmfolAction.selectOption(this);"}}],["SPAN",{attrs:{onclick:"zmfolAction.selectOption(this);"},child:[["text",e.emptyfolderdialog.deleteall]]}]]}]]}],["DIV",{attrs:{"class":"zm_formFld"},child:[["DIV",{attrs:{"class":"zm_formCell"},child:[["I",{attrs:{"class":"msi-unoption",id:"optionRange",onclick:"zmfolAction.selectOption(this);"}}],["SPAN",{attrs:{onclick:"zmfolAction.selectOption(this);"},child:[["text",e.emptyfolderdialog.deletebydate]]}]]}],["DIV",{attrs:{"class":"zm_formCell"},child:[["INPUT",{attrs:{type:"text",id:"delDateVal",disabled:"true",d_format:zmail.userDateFormat}}]]}]]}],["DIV",{attrs:{"class":"zm_formFld"},child:[["DIV",{attrs:{"class":"zm_formCell"},child:[["I",{attrs:{"class":"msi-unoption",id:"optionCount",onclick:"zmfolAction.selectOption(this);"}}],["SPAN",{attrs:{onclick:"zmfolAction.selectOption(this);"},child:[["text",e.emptyfolderdialog.deletebycount]]}]]}],["DIV",{attrs:{"class":"zm_formCell"},child:[["INPUT",{attrs:{type:"text",value:"100",id:"delMailCount",disabled:"true"}}]]}]]}],g[0],g[1]]}],j=_zm.getDOM(h);$("body").append(j),d=zmInit.findFolName(c),d=d?" - "+d:"",$("#emptyfolpopup").attr("data-id",c),f=$("#delDateVal"),f.attr("value",(new Date).getDateBy(zmail.userDateFormat)),f.attr("readonly",!0);var k=ZEVENTS(f[0]).picker("date",{dform:zmail.userDateFormat.toUpperCase(),mode:"popup"}).bind(),l={title:e.emptyfolderdialog.title+" "+d,style:{width:"500px"},buttons:[{txt:e.dialogMenu.ok,selected:!0,callback:function(){zmfolAction.emptyMailsFromFolder(b),zmsDialog.remove(),$("#emptyfolpopup").remove()}},{isCancel:!0,txt:e.dialogMenu.cancel,callback:function(){zmsDialog.remove(),$("#emptyfolpopup").remove()}}],drag:!0,mask:!0,hideclose:!1,pos:"center",closeaction:function(){i(),ZEVENTS.remove(k),$("#"+k._cont).remove()}};zmsDialog.create("emptyfolpopup",l)}},a.selectOption=function(a){var b=$(a).attr("id")||$(a).prev().attr("id");b.indexOf("selArchive")!==-1&&(b="selArchive",$("#"+b).hasClass("msi-uncheck")?$("#"+b).removeClass().addClass("msi-check"):$("#"+b).removeClass().addClass("msi-uncheck")),$("#"+b).hasClass("msi-unoption")&&($("#emptyfolpopup i").each(function(a,b){($(b).hasClass("msi-option")||$(b).hasClass("msi-unoption"))&&$(b).removeClass("msi-option").addClass("msi-unoption")}),$("#"+b).removeClass("msi-unoption").addClass("msi-option"),"optionRange"===b?($("#delDateVal").attr("disabled",!1),$("#delDateVal").focus(),$("#delMailCount").attr("disabled",!0).blur()):"optionCount"===b?($("#delMailCount").attr("disabled",!1),$("#delMailCount").val("100").focus(),$("#delDateVal").unbind("click").blur(),$("#delDateVal").attr("disabled",!0)):($("#delDateVal").unbind("click").blur(),$("#delMailCount").attr("disabled",!0).blur(),$("#delDateVal").attr("disabled",!0)))},a.emptyMailsFromFolder=function(b){var c=$("#emptyfolpopup i.msi-option").attr("id"),f=$("#emptyfolpopup #selArchive").hasClass("msi-check");if(!c||!b)return!1;var g={accId:zmail.accId,mode:"emptyfolder",folId:b},h={};if("optionRange"===c)g.selDate=h.selDate=$("#delDateVal").val();else if("optionCount"===c){var i=$("#delMailCount");g.leaveCount=h.leaveCount=i.val();var j=parseInt(g.leaveCount)||0;if(j<1)return i.val("0"),zmUtil.succErrMsg("e",e.emptyfolder.emptycount),!1}f&&(g.includeArchiveMails=!0),d[b]="0",zmAjq.XHR({u:zmail.conPath+"/folAction.do",t:"POST",fn:a.emptyFolder,p:g,csr:"s",ep:h})},a.deleteFolder=function(a,b){if("success"===a.status){var c,d,e=a.folId,f="zmlTreeH";c=zmList.getRowInfo(e,f),"-1"!==c[e].SH&&b&&b.toTrash&&(c[e].SH="-1"),d=zmail.mailLeft.getNodes()[0].getLayer(f),"move"===b?d.moveNode(c,d.mapObject,a.prefolId,a.pfolId):d.moveNode(c,d.mapObject,null,zmail.folId.tId,!0),$.publish("folder/moved",{folderID:e,toTrash:"move"!==b})}else zmUtil.succErrMsg("e",a.emsg)},a.isValidFolder=function(b,c){var d,e=b.text(),f=c&&c.length&&c[0].id;return e=$.trim(e),"zmLTMenu_Rf"===b[0].id?d="rename":"zmLTMenu_Nf"!==b[0].id&&0!==f||(d="new"),!!a.isValidName(e,f,d)||(setTimeout(function(){b.focus()},100),!1)},a.isValidName=function(b,c,d){var f,h,i,j,k,l=zmail.folTree[0],m=zmail.folTree[1];if(f=$.trim(b),h=f.toLowerCase(),k=d.opType||d.mode,!f.length)return zmUtil.succErrMsg("e",e.folderCreateRename.folnull,d),!1;if(zmUtil.hasSpecialChars(f,"folderName"))return zmUtil.succErrMsg("e",e.folderCreateRename.folsplchar,d),!1;if("null"===h)return zmUtil.succErrMsg("e",e.folderCreateRename.folnull,d),!1;if("inbox"===h||"drafts"===h||"draft"===h||"templates"===h||"template"===h||"sent"===h||"spam"===h||"trash"===h||"outbox"===h)return zmUtil.succErrMsg("e",e.folderCreateRename.folnameerr,d),!1;if("rename"===k){if(i=a.getParentFolderId(c),m[i]?j=m[i].CH:l[c]&&(j=l),!g(j,f,c,d))return!1}else if("new"===k){if(c){if(!m[c])return!0;j=m[c].CH}else j=l;if(!g(j,f,c,d))return!1}else if("move"===k){if(i=a.getParentFolderId(c),!m[i])return!0;if(j=m[i].CH,!g(j,f,c,d))return!1}return!0},a.sendNewFolderReq=function(b,c){var d,e,f={};b||($("#zmLTMenu_Nf[contentEditable='true']").length?b=$.trim($("#zmLTMenu_Nf").text()):$("#zmActionNewfolder[contentEditable='true']").length&&(b=$.trim($("#zmActionNewfolder").text()))),b.length&&(e={accId:zmail.accId,mode:"add",fName:b},a.rgtFolId?(d=a.insertNewSubFolder,e.pfolId=a.rgtFolId,a.rgtFolId=""):d=a.insertNewFolder,c&&"function"==typeof c.reqDoneClbk&&(f.reqDoneClbk=c.reqDoneClbk),zmAjq.XHR({u:zmail.conPath+"/folAction.do",t:"POST",fn:d,p:e,csr:"s",ep:f}))},a.sendFolderMoveReq=function(b){var c,d;b.prefolId!==b.srcFolId&&(b.accId=zmail.accId,b.mode="move",c=a.deleteFolder,d="move",zmAjq.XHR({u:zmail.conPath+"/folAction.do",t:"POST",fn:c,p:b,csr:"s",ep:d}))},a.sendRenameFolderReq=function(b){var c,d;b=b||{},c=b.fName||$.trim($("#zmLTMenu_Rf").text()),c!==$("#"+a.rgtFolId).text()&&(d={accId:zmail.accId,folId:a.rgtFolId,mode:"edit",fName:c},zmAjq.XHR({u:zmail.conPath+"/folAction.do",t:"POST",fn:a.renameFolder,p:d,csr:"s"}))},a.onDrop=function(b,c,d,e){var f,h,i,j={},k=zmail.folTree[1];for(h in c)j.srcFolId=h;for(h in d)f=h;if("inside"===e){if(j.desFolId=f,zmfolAction.getParentFolderId(j.srcFolId)===f)return!1;if(k[f]&&(i=k[f].CH,!g(i,zmInit.findFolName(j.srcFolId),j.srcFolId)))return!1}else if("header"===e)j.prefolId=l();else{if(j.prefolId=f,f===zmail.folId.iId||f===zmail.folId.dId||f===zmail.folId.teId||f===zmail.folId.sId||f===zmail.folId.spId||f===zmail.folId.tId)return!1;"-1"!==zmail.folCount[f].p&&(j.desFolId=zmail.folCount[f].p)}a.sendFolderMoveReq(j)},a.allowDrag=function(a){var b,c;for(b in a)c=b;return c!==zmail.folId.iId&&c!==zmail.folId.dId&&c!==zmail.folId.teId&&c!==zmail.folId.sId&&c!==zmail.folId.spId&&c!==zmail.folId.oId&&c!==zmail.folId.tId},a.allowDrop=function(b,c,d){var e,f,g,h,i;if("header"===d)return!0;for(e in c)f=e;for(e in b)h=e;if(1===zmail.mailOpt.folSort&&"inside"!==d)return i=zmail.folTree[0][f],!("next"!==d||!i||Object.keys(zmail.folTree[0]).length!==i.SE);if(f===h)return!1;if(f===zmail.folId.iId&&"inside"===d)return!0;if(f===zmail.folId.iId||f===zmail.folId.dId||f===zmail.folId.teId||f===zmail.folId.sId||f===zmail.folId.spId||f===zmail.folId.oId||f===zmail.folId.tId)return!1;for(g=a.getParentFolderId(f);g;){if(g===h)return!1;g=a.getParentFolderId(g)}return!0},a.isDeletedFolder=function(b){for(var c=a.getChildrenOf(zmail.folId.tId),d=c.length,e=0;e<d;e++)if(c[e]===b)return!0;return!1},a.getMailFolderPaths=j,a.getShortFolderPath=k,a.getFolderPath=function(a){if(zmUtil.isFolderId(a)){var b,c,d=zmfolAction.getMailFolderPaths(),e=d.length;for(b=0;b<e;b++)if(c=d[b],c.id===a)return c}return""};var o=function(a,b){return zmfolAction.isValidFolder(a,$("#"+zmfolAction.rgtFolId))?(b(),!0):(a.focus(),!1)};a.newFolderMenuHandler=function(){return o(this.activeMenu.activeMenuElement,zmfolAction.sendNewFolderReq)},a.renameFolderMenuHandler=function(){return o(this.activeMenu.activeMenuElement,zmfolAction.sendRenameFolderReq)},a.showCreateFolderPopUp=function(b){var c,d,f,g,h,i,k,l,m,n="new",o="",p="",q=[],r=e.folderCreateRename.nestunder;b=b||{},g=b.mode||"new",k=$(".zm_compose"),l=k.offset(),i=l.top+"px",h=l.left+k.width()+"px","rename"===g?(f=e.folderCreateRename.editfolname,r=e.folderCreateRename.nestunder,o=zmInit.findFolName(a.rgtFolId)||"/"):"new"===g&&(f=e.folderCreateRename.Createfol),"rename"===g?m=a.getParentFolderId(a.rgtFolId):"new"===g&&(m="subfolder"===b.type?a.rgtFolId:0),q=j(),q=q.filter(function(a){return a.id===m}),q.length&&(p=q[0].path),p=p||"/",c={title:f,style:{width:"200px"},posParent:{top:i,left:h},customClass:"noanim",buttons:[{txt:e.dialogMenu.save,selected:!0,callback:function(){var c,d,e={};c=$("#zm_createfolpopup").find("input:first").val(),d="new"===b.mode?m:a.getParentFolderId(a.rgtFolId),"new"!==n&&d!==n?"new"===b.mode&&(n?a.rgtFolId=n:a.rgtFolId=""):"new"===b.mode&&"new"===n&&"subfolder"!==b.type&&(a.rgtFolId=""),zmfolAction.isValidName(c,a.rgtFolId,{mode:b.mode,parElem:$("#zm_createfolpopup")[0]})&&("new"===b.mode?zmfolAction.sendNewFolderReq(c):"rename"===b.mode?a.sendRenameFolderReq({fName:c}):"move"===b.mode&&(e.srcFolId=a.rgtFolId,n&&(e.desFolId=n),a.sendFolderMoveReq(e)),zmsDialog.remove())}},{isCancel:!0,txt:e.dialogMenu.cancel,callback:function(){zmsDialog.remove()}}],closeaction:function(){$("#zm_createfolpopup").remove()},afterDisplay:function(){$("#zm_createfolpopup").find("input")[0].focus()}},d=$("<div id='zm_createfolpopup'><ul><li><input type='text' maxlength='50'data-enableshortcuts='true' class='SC_tiput' value='"+o+"' placeholder='"+e.folderCreateRename.folname+"'/></li><li><div>"+r+"</div><span><input type='text' class='SC_tiput' value='"+p+"'/></span></li></ul></div>"),"new"!==b.mode?d.find("input")[1].disabled=!0:d.find("span").click(function(a){var b,c={};zmUtil.stopEvents(a,!0),zmUtil.hideMenu(!1,!0),c.parentDOM=$(this),c.displayAs="dropdown",c.excludeList=[zmail.folId.dId,zmail.folId.teId,zmail.folId.sId,zmail.folId.tId,zmail.folId.spId,zmail.folId.oId],c.showAllItem=!0,c.showAllItemText="/",c.onSelect=function(a){var d=c.parentDOM.find("input");"all"!==a?(n=a,d[0].value=zmInit.findFolName(a)):(n=0,d[0].value="/"),b.hide()},b=zmUtil.createFLComp("folder",c),b.show(),b.elem.zIndex(102)}),$("#zm_createfolpopup").length||$(document.body).append(d),zmsDialog.create("zm_createfolpopup",c),$("#zmsdialog_zm_createfolpopup").mousedown(function(a){zmUtil.stopEvents(a,!0)}),$("#zmsdialog_zm_createfolpopup").click(function(){zmUtil.hideMenu(!1,!0)})},a.archiveFolder=function(a,b){if("success"===a.status){zmsDialog.remove();var c=a.folId,d=zmUtil.getFolId(),f=zmInit.getListingDetObj(),g=!1;d===c&&zmPrev.clsPreview(),$("#archivefolpopup").remove(),"emptyArchivefolder"===b.mode?zmUtil.succErrMsg("s",zmText.applyArgs(e.archivefolder.deletearchive,{foldername:zmInit.findFolName(c)})):"unArchivefolder"===b.mode?zmUtil.succErrMsg("s",zmText.applyArgs(e.archivefolder.unarchivefol,{foldername:zmInit.findFolName(c)})):zmUtil.succErrMsg("s",zmText.applyArgs(e.archivefolder.archivefol,{foldername:zmInit.findFolName(c)})),$.publish("folder/archived",[c,a.isArchived]),"emptyArchivefolder"===b.mode&&(zmail.listObj[c]?$.publish("/mail/discardFromThread",{fId:c}):zmail.listObj[d]&&$.publish("/mail/discardFromThread",{fId:c,viewId:d})),"optionAll"!==b.mode&&delete zmail.listObj[c],f.fId===c?b.archDate||b.archCount||"unArchivefolder"===b.mode?(zmInit.reInitListing(),zmInit.setListingDetObj({}),zmInit.foldView({folId:c}),g=!0):"archive"===f.view&&"emptyArchivefolder"===b.mode?(zmInit.reInitListing(),$(zmail.mailCenter.listElem).html(zmInit.emptyRow())):"emptyArchivefolder"!==b.mode&&(zmInit.reInitListing(),$(zmail.mailCenter.listElem).html(zmInit.emptyRow()),zmmailAct.updateCount({fId:c,mode:"upd",count:0})):"unread"!==f.view&&($.publish("/mail/listMails",{}),g=!0),g&&zmInit.getFolderTreeCount()}else zmUtil.succErrMsg("e",a.emsg)},a.sendArchiveFolderReq=function(b){var c,d,f;if(c=b?b:a.rgtFolId,!$("#archivefolpopup").length){var g,h=zmList.getRowInfo(c,"zmlTreeH","info")||{};g=h.IA?["DIV",{attrs:{id:"archivefolpopup","class":"zm_formArea zm_Formflex"},child:[["DIV",{attrs:{"class":"zm_formFld zm_formTxt"},child:[["DIV",{attrs:{"class":"zm_formCell"},child:[["I",{attrs:{"class":"msi-option",id:"archiveAll"}}],["SPAN",{child:[["text",e.archivefolderdialog.archiveall]]}]]}]]}],["DIV",{attrs:{"class":"zm_formSubFld",id:"archiveoptions"},child:[["DIV",{attrs:{"class":"zm_formFld zm_formTxt"},child:[["DIV",{attrs:{"class":"zm_formCell"},child:[["I",{attrs:{"class":"msi-option",id:"optionAll"}}],["SPAN",{child:[["text",e.archivefolderdialog.archivefol]]}]]}]]}],["DIV",{attrs:{"class":"zm_formFld"},child:[["DIV",{attrs:{"class":"zm_formCell"},child:[["I",{attrs:{"class":"msi-unoption",id:"optionRange"}}],["SPAN",{child:[["text",e.archivefolderdialog.archivebydate]]}]]}],["DIV",{attrs:{"class":"zm_formCell"},child:[["INPUT",{attrs:{type:"text",id:"delDateVal",disabled:"true",d_format:zmail.userDateFormat,readonly:"readonly"}}]]}]]}],["DIV",{attrs:{"class":"zm_formFld"},child:[["DIV",{attrs:{"class":"zm_formCell"},child:[["I",{attrs:{"class":"msi-unoption",id:"optionCount"}}],["SPAN",{child:[["text",e.archivefolderdialog.archivebycount]]}]]}],["DIV",{attrs:{"class":"zm_formCell"},child:[["INPUT",{attrs:{type:"text",value:"100",id:"delMailCount",disabled:"true"}}]]}]]}]]}],["DIV",{attrs:{"class":"zm_formFld zm_formTxt"},child:[["DIV",{attrs:{"class":"zm_formCell"},child:[["I",{attrs:{"class":"msi-unoption",id:"unarchiveAll"}}],["SPAN",{child:[["text",e.archivefolderdialog.unarchiveall]]}]]}]]}],["DIV",{attrs:{"class":"zm_formFld zm_formTxt"},child:[["DIV",{attrs:{"class":"zm_formCell"},child:[["I",{attrs:{"class":"msi-unoption",id:"deleteArchives"}}],["SPAN",{child:[["text",e.archivefolderdialog.deletearchived]]}]]}]]}]]}]:["DIV",{attrs:{id:"archivefolpopup","class":"zm_formArea zm_Formflex"},child:[["DIV",{attrs:{"class":"zm_formFld zm_formTxt"},child:[["DIV",{attrs:{"class":"zm_formCell"},child:[["I",{attrs:{"class":"msi-option",id:"optionAll"}}],["SPAN",{child:[["text",e.archivefolderdialog.archivefol]]}]]}]]}],["DIV",{attrs:{"class":"zm_formFld"},child:[["DIV",{attrs:{"class":"zm_formCell"},child:[["I",{attrs:{"class":"msi-unoption",id:"optionRange"}}],["SPAN",{child:[["text",e.archivefolderdialog.archivebydate]]}]]}],["DIV",{attrs:{"class":"zm_formCell"},child:[["INPUT",{attrs:{type:"text",id:"delDateVal",disabled:"true",d_format:zmail.userDateFormat,readonly:"readonly"}}]]}]]}],["DIV",{attrs:{"class":"zm_formFld"},child:[["DIV",{attrs:{"class":"zm_formCell"},child:[["I",{attrs:{"class":"msi-unoption",id:"optionCount"}}],["SPAN",{child:[["text",e.archivefolderdialog.archivebycount]]}]]}],["DIV",{attrs:{"class":"zm_formCell"},child:[["INPUT",{attrs:{type:"text",value:"100",id:"delMailCount",disabled:"true"}}]]}]]}]]}];var i=_zm.getDOM(g);$("body").append(i),d=zmInit.findFolName(c),d=d?" - "+d:"",$("#archivefolpopup").attr("data-id",c),f=$("#delDateVal"),f.attr("value",(new Date).getDateBy(zmail.userDateFormat)),f.attr("readonly",!0);var j=ZEVENTS(f[0]).picker("date",{dform:zmail.userDateFormat.toUpperCase(),mode:"popup"}).bind(),k={title:e.archivefolderdialog.title+" "+d,style:{width:"500px"},buttons:[{txt:e.dialogMenu.ok,selected:!0,callback:function(){zmfolAction.archiveMailsFromFolder(b)}},{isCancel:!0,txt:e.dialogMenu.cancel,callback:function(){zmsDialog.remove(),$("#archivefolpopup").remove()}}],drag:!0,mask:!0,hideclose:!1,pos:"center",closeaction:function(){$("#archivefolpopup").remove(),ZEVENTS.remove(j),$("#"+j._cont).remove()}};zmsDialog.create("archivefolpopup",k),$("#archivefolpopup").off("click").on("click","i, span",function(){zmfolAction.selectArchiveOption(this,$("#archivefolpopup"))})}},a.selectArchiveOption=function(a,b){var c=$(a).attr("id")||$(a).prev().attr("id"),d=b.find("#"+c),e=b.find("#delDateVal"),f=b.find("#delMailCount"),g=b.find("#archiveoptions"),h=b.find("#unarchiveAll"),i=b.find("#deleteArchives"),j=b.find("#archiveAll");if(g.length||(g=b),$("#"+c).hasClass("msi-unoption"))switch(c){case"optionRange":g.find("i").removeClass("msi-option").addClass("msi-unoption"),d.removeClass("msi-unoption").addClass("msi-option"),e.attr("disabled",!1),e.focus(),f.attr("disabled",!0).blur();break;case"optionCount":g.find("i").removeClass("msi-option").addClass("msi-unoption"),d.removeClass("msi-unoption").addClass("msi-option"),f.attr("disabled",!1),f.val("100").focus(),e.unbind("click").blur(),e.attr("disabled",!0);break;case"optionAll":g.find("i").removeClass("msi-option").addClass("msi-unoption"),d.removeClass("msi-unoption").addClass("msi-option"),e.unbind("click").blur(),f.attr("disabled",!0).blur(),e.attr("disabled",!0);break;case"archiveAll":g.slideDown(),h.removeClass("msi-option").addClass("msi-unoption"),i.removeClass("msi-option").addClass("msi-unoption"),d.removeClass("msi-unoption").addClass("msi-option");break;case"unarchiveAll":g.slideUp(),j.removeClass("msi-option").addClass("msi-unoption"),i.removeClass("msi-option").addClass("msi-unoption"),d.removeClass("msi-unoption").addClass("msi-option");break;case"deleteArchives":g.slideUp(),j.removeClass("msi-option").addClass("msi-unoption"),h.removeClass("msi-option").addClass("msi-unoption"),d.removeClass("msi-unoption").addClass("msi-option")}},a.archiveMailsFromFolder=function(b){var c=$("#archivefolpopup i.msi-option");if(c=c.length>1?"archiveAll"===c[0].id?$("#archiveoptions i.msi-option").attr("id"):c[1].id:$("#archivefolpopup i.msi-option").attr("id"),!c||!b)return!1;var d=function(a,b){a&&b&&("unArchivefolder"===b.mode&&"Error while empty spam folder (Internal Error occurs)"===a?zmUtil.succErrMsg("e","Oops! An error occurred during this action. Try again later."):"emptyArchivefolder"===b.mode&&"Error while empty spam folder (Internal Error occurs)"===a&&zmUtil.succErrMsg("e","Oops! An error occurred during this action. Try again later."))},f={accId:zmail.accId,mode:"archivefolder",folId:b},g={};switch(c){case"optionRange":f.archDate=g.archDate=$("#delDateVal").val();break;case"optionCount":var h=$("#delMailCount"),i=h.val()||0;if(i=parseInt(i),f.archCount=g.archCount=i,i<1)return h.val("0"),zmUtil.succErrMsg("e",e.archivefolder.emptycount),!1;break;case"archiveAll":case"optionAll":g.mode="optionAll";break;case"unarchiveAll":f.mode=g.mode="unArchivefolder";break;case"deleteArchives":f.mode=g.mode="emptyArchivefolder"}zmAjq.XHR({u:zmail.conPath+"/folAction.do",t:"POST",fn:a.archiveFolder,p:f,csr:"s",ep:g,efn:d}),zmsDialog.remove()};var p=function(a,b){var c,d=$.Deferred();return a?("string"==typeof a&&(a=[a]),c=b?"addFoldersToSuppressList":"removeFoldersFromSuppressList",zmAjq.XHR({u:zmail.conPath+"/mailNotification.do",t:"POST",fn:function(){d.resolve()},p:{mode:c,accId:zmail.accId,folderIds:a.join(",")},csr:"s",efn:function(){d.reject()}}).fail(function(){d.reject()})):d.reject(),d.promise()};return a.getNotificationSuppressedFolders=function(a){var b=$.Deferred();return zmAjq.XHR({u:zmail.conPath+"/mailNotification.do",t:"POST",fn:function(a){a=a||{},b.resolve({folderList:a.status||[]})},p:{mode:"getSuppressedFolderList",accId:a||zmail.accId},csr:"s",efn:function(){b.reject()}}).fail(function(){b.reject()}),b.promise()},a.suppressNotification=function(a){return p(a,!0)},a.allowNotification=function(a){return p(a,!1)},a.handleWMSEvents=function(a,d,e){var f,g,i,j,k,l,m,n=Date.now();if(k=["addFolder","renameFolder","moveFolder","deleteFolder","emptyFolder","folderRead"],k.indexOf(a)!==-1)if(i=e.FD&&"null"!==e.FD?e.FD:"",g=e.PID&&"null"!==e.PID?e.PID:"",f=e.PREVID&&"null"!==e.PREVID?e.PREVID:"",j=e.FN||"",l={prefolId:f,pfolId:g,folId:i,fName:j,status:"success"},"addFolder"===a)zmInit.findFolName(i)||(g?zmfolAction.insertNewSubFolder:zmfolAction.insertNewFolder)(l);else if("renameFolder"===a)zmInit.findFolName(i)!==j&&zmfolAction.renameFolder(l);else if("deleteFolder"===a)zmfolAction.isDeletedFolder(i)||zmfolAction.deleteFolder(l,"delete");else if("moveFolder"===a)zmfolAction.getParentFolderId(i)!==g&&zmfolAction.deleteFolder(l,"move");else if("folderRead"===a){if(b[i]&&(m=n-b[i],m<=2e3))return;h(l,{})}else if("emptyFolder"===a){if(c[i]&&(m=n-c[i],m<=2e3))return;zmfolAction.emptyFolder(l,{},!0)}},a}({});