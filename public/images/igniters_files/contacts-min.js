var ZContacts={_rsvbObj:{}};ZContacts.getContextPath=function(){return zmail.forContactsApp?ZContacts.meta.serviceInfo.contacts_server_url:"/zm/"+(zmail.contactsProxyPath||"zc")},ZContacts.getCurrentAccount=function(){return this.acc},ZContacts.meta={isLoaded:!1,user:{},syncUrls:{},serviceInfo:{}},ZContacts.Constants={REGEX:{EMAIL_PATTERN:/^[\w]([\w\-\.\+\']*)@([\w\-\.]*)(\.[a-zA-Z]{2,22}(\.[a-zA-Z]{2}){0,2})$/i,PHONE_PATTERN:/^[\(\)\+\-0-9x\.\,\*\s#]{1,30}$/},Params:{FILTER_PREFIX:"filter_",MULTIPOST_SUFFIX:"_all",DELETEALL_PREFIX:"_"},StatusCode:{OK:200,NOT_FOUND:404},ChatStatus:{DELETED:-4,PENDING:-1,REQACC:-3,REJECTED:-2,OFFLINE:0,ONLINE:1,INVISIBLE:2,BUSY:3,IDLE:4,NO_CHAT:-10}},ZContacts.ZMailConstants={VIEW_ID_ALL_CONTACTS:"all_contacts_ctgry",VIEW_ID_ORG_CONTACTS:"org_contacts_ctgr",VIEW_ID_GRP_CONTACTS:"group_",CONTACTS_APP_ID:"zm_Contacts",WORKSPACE_APP_ID:"zm_createContact",CLEAN_WORKSPACE_APP_ID:"zm_cleanDuplicates",IMPORT_APP_ID:"zm_ImportContact",SEARCH_WORKSPACE_APP_ID:"zm_srch1",PERSONAL_ACCOUNT:"personal",ORG_ACCOUNT:"org",GROUP_ACCOUNT:"groups"},ZContacts.ImportMapConstants={PHONE_Map:{Mobile:"Mobile-MOBILE","Home Phone":"Home-HOME_PHONE","Work Phone":"Work-WORK_PHONE",Fax:"Fax-FAX","Other Phone":"Others-OTHER_PHONE"},IMS_Map:{"Google IM":"Google","Yahoo IM":"Yahoo","Skype IM":"Skype","AOL IM":"Aol","ICQ IM":"Icq","Jabber IM":"Jabber","MSN IM":"Msn","Other IM":"Other"},URLS_Map:{"Blog URL":"Blog","Personal Web Address":"Home","Company Web Address":"Work","LinkedIn URL":"Linkedin","Facebook URL":"Facebook","Twitter URL":"Twitter","Amazon URL":"Amazon","Flickr URL":"Flickr","Delicious URL":"Delicious","Other URL":"Others"}},ZContacts.ImportPage=!1,ZContacts.MappingType={Phone_Type:["Mobile","Home","Work","Fax","Others"],Ims_Type:["Google","Yahoo","Skype","Aol","Msn","Jabber","Icq","Other"],Urls_Type:["Home","Work","Blog","Linkedin","Facebook","Twitter","Amazon","Flickr","Delicious","Others"]},ZContacts.Utils={camelize:function(str){return str.charAt(0).toLowerCase()+str.substring(1)},isEmptyArray:function(arr){return!arr||!arr.length},isEmailId:function(str){return str&&ZContacts.Constants.REGEX.EMAIL_PATTERN.test(str.trim())},isValidPhoneNumber:function(str){return str&&ZContacts.Constants.REGEX.PHONE_PATTERN.test(str.trim())},encodeHTML:function(str){return str&&(str=str.replace(/"/gi,"&quot;").replace(/'/gi,"&#39;").replace(/</gi,"&lt;").replace(/>/gi,"&gt;")),str}};var REGEX_USERNAME=/^[A-Z][A-z0-9_]+([.][A-z0-9_]+)*[A-Za-z0-9]$/i,REGEX_EMAIL=/^[\w]([\w\-\.\+\']*)@([\w\-\.]*)(\.[a-zA-Z]{2,22}(\.[a-zA-Z]{2}){0,2})$/i;ZContacts.isUserNameRex=function(str){return str&&REGEX_USERNAME.test(str.trim())},ZContacts.isEmailIdRex=function(str){return str&&REGEX_EMAIL.test(str.trim())},ZContacts.StringBuilder=function(_iv){var arr=_iv?[_iv]:[];this.append=function(v){return arr.push(v),this},this.toString=function(){return arr.join("")},this.isEmpty=function(){return this.length()<1},this.length=function(){return arr.length}},ZContacts.Cookie={add:function(cn,cv,domain,maxage,secure){document.cookie=cn+"="+window.escape(cv)+";path=/"+(domain?";domain="+domain:"")+(maxage?";max-age="+maxage:"")+(secure?";secure="+secure:"")},get:function(cn){if(document.cookie.length>0){var beginIdx=document.cookie.indexOf(cn+"=");if(-1!==beginIdx){beginIdx=beginIdx+cn.length+1;var endIdx=document.cookie.indexOf(";",beginIdx);return-1===endIdx&&(endIdx=document.cookie.length),window.unescape(document.cookie.substring(beginIdx,endIdx))}}return""},append:function(cn,cv,domain,separator,maxage,secure){var oldcv=ZContacts.Cookie.get(cn),newcv="";newcv=oldcv?oldcv+separator+cv:cv,ZContacts.Cookie.add(cn,newcv,domain,maxage,secure)},remove:function(cn){document.cookie=cn+"=remove;path=/;max-age=0"},getCSRFValue:function(){return ZContacts.Cookie.get(ZContacts.meta.serviceInfo.csrf_cookie_name)}},ZContacts.I18N={data:{},load:function(arr){return $.extend(ZContacts.I18N.data,arr),this},get:function(key){return ZContacts.I18N.data[key]||key},formatMessage:function(){var msg=arguments[0];if(msg)for(var i=1;i<arguments.length;i++)msg=msg.replace("{"+(i-1)+"}",arguments[i]);return msg}},ZContacts.URI=function(){this.contextpath=ZContacts.getContextPath()+"/api/v1",this.apiResponse=null,this.resourceIdentifier=null,this.authUser=null,this.authPassword=null;var args=arguments;$.isArray(arguments[0])&&(args=arguments[0]),this.init.apply(this,args)},$.extend(ZContacts.URI.prototype,{init:function(type){var identifier,isFullURI="string"==typeof type;if(this.type=isFullURI?arguments[1]:type,!this.type||!this.type.superclass.__zresource)throw new Error(""+this.type+' is not a type of "ZResource"');if(isFullURI){var path=ZContacts.URI.trimSlash(type);this.requestURI=this.contextpath+"/"+path;var uriArr=path.split("/");uriArr.length%2===0&&(identifier=uriArr[uriArr.length-1])}else{var rmd=this.getRMD(),uriSB=new ZContacts.StringBuilder;if(rmd.parents){for(var parentIdIdx=1,i=0;i<rmd.parents.length;i++){var parent=rmd.parents[i],parentRMD=this.getRMD(parent),parentPath=parentRMD.path;parentPath||(parentPath=parentRMD.resourceName.toLowerCase());var parentIdentifier=arguments[parentIdIdx++];if(uriSB.append("/").append(parentPath),parentIdentifier)uriSB.append("/").append(parentIdentifier);else if(parentRMD.identifier)throw new Error("Unable to construct URI. Parent Identifier for the resource "+parentRMD.resourceName+" is missing for "+rmd.resourceName)}identifier=arguments[parentIdIdx]}else identifier=arguments[1];uriSB.append("/").append(rmd.path?rmd.path:rmd.resourceName.toLowerCase()),identifier&&uriSB.append("/").append(identifier),this.requestURI=this.contextpath+uriSB.toString()}return this.isInstance=!!identifier,this.resourceIdentifier=identifier,this},include:function(value){return this.includes=this.includes||[],this.includes.push(value),this},header:function(name,value){if(this.headers=this.headers||{},$.isPlainObject(name))for(var key in name)this.headers[key]=name[key];else if(name){if(null===value)return this.headers[name];this.headers[name]=value}return this},setSortBy:function(sortBy,asc){return asc=asc?"":"-",this.sort=asc+sortBy,this},addFilter:function(name,value){return this.filters=this.filters||{},this.filters[name]=value,this},addSearchQuery:function(query){return this.query=query,this},addSearchComparator:function(comparator){return this.search_comparator=comparator,this},addSearchFields:function(value){return this.searchFields=this.searchFields||[],this.searchFields=this.concat(value.split(",")),this},addFields:function(value){return this.fields=this.fields||[],this.fields=this.fields.concat(value.split(",")),this},setPagination:function(page,perPage){return this.pagination=this.pagination||{},this.pagination.page=page,this.pagination.per_page=perPage,this},addDeleteParam:function(key,value){return this.deleteParams=this.deleteParams||{},this.deleteParams[ZContacts.Constants.Params.DELETEALL_PREFIX+key]=value,this},addPostParam:function(key,value){return this.postParams=this.postParams||{},this.postParams[key]=value,this},getParams:function(){return $.param(this.getParamsObj())},getParamsObj:function(){var params={};if(this.includes&&(params.include=this.includes.join()),this.filters)for(var key in this.filters)params[ZContacts.Constants.Params.FILTER_PREFIX+key]=this.filters[key];return this.query&&(params.q=this.query,this.search_comparator&&(params.search_comparator=this.search_comparator),this.searchFields&&(params.search_fields=this.searchFields.join())),this.sort&&(params.sort=this.sort),this.fields&&(params.fields=this.fields.join()),this.pagination&&(params.page=this.pagination.page,params.per_page=this.pagination.per_page),params},getRMD:function(type){return type||(type=this.type),type.getResourceMetaData?type.getResourceMetaData(type):type.getRMD()},setAuthHeader:function(zuid,password){if(-1!==zuid.indexOf(":"))throw new Error("Invalid character present in ZUID "+zuid);return this.authUser=zuid||"",this.authPassword=password,this}}),$.extend(ZContacts.URI.prototype,{GETS:function(){if(this.isInstance)throw new Error("GETS operation is not supported in Multi URI for "+this.type);return this._sendRequest("GETS")},GET:function(){var rmd=this.getRMD();if(rmd.identifier&&!this.isInstance)throw new Error("GET operation is not supported in Multi URI for "+this.type);return this._sendRequest("GET")},POST:function(resource){return resource.length?this._saveAll(resource,!0):this._save(resource,!0)},PUT:function(resource){return resource&&resource.length?this._saveAll(resource,!1):this._save(resource,!1)},DELETE:function(resource){if($.isArray(resource))return this.DELETEALL(resource);if(resource&&!(resource instanceof this.type))throw new Error(""+resource+" is not an instance of "+this.type);return this._sendRequest("DELETE")},DELETEALL:function(resources){if(!resources.length&&!$.isArray(resources))throw new Error("Invalid argument passed "+resources+'. Expecting Array of "ZResource"');var rmd=this.getRMD();if(rmd.identifier&&this.isInstance)throw new Error("DELETEALL operation is supported only in Multi URI for "+this.type);for(var identifiers=new ZContacts.StringBuilder,i=0,len=resources.length;len>i;i++){var resource=resources[i];if(!(resource instanceof this.type))throw new Error(""+resource+" is not an instance of "+this.type);var identifier=resource.getIdentifier();if(!identifier)throw new Error("Identifier is must to DELETE Mutliple "+rmd.resourceName);0!==i&&identifiers.append(","),identifiers.append(identifier)}return this.addDeleteParam(rmd.identifier,identifiers.toString()),this._sendRequest("DELETE")}}),$.extend(ZContacts.URI.prototype,{_sendRequest:function(type,options){var _this=this,promise=$.Deferred();options=options||{},options.url=_this.requestURI;var rmd=_this.getRMD();options.exports=rmd.exports;var isWrite=!1;if(options.type||(options.type="GETS"===type?"GET":type),$.isEmptyObject(_this.params)||(options.data=$.param(_this.params)),options.headers=options.headers||{},_this.headers&&$.extend(options.headers,_this.headers),options.type||(options.type="GETS"===type?"GET":type),options.type&&"GET"!==options.type?(options.headers["X-HTTP-Method-Override"]=options.type,options.Accept="application/json","DELETE"===options.type&&_this.deleteParams&&(options.url+="?"+$.param(_this.deleteParams),options.data=null),_this.postParams&&(options.url+="?"+$.param(_this.postParams)),options.type="POST",isWrite=!0):options.data=_this.getParams(),options.headers["X-ZCSRF-TOKEN"]=ZContacts.meta.serviceInfo.csrf_param_name+"="+ZContacts.Cookie.getCSRFValue(),_this.authUser&&(options.headers["X-Authorization"]=new ZContacts.StringBuilder("ZohoContacts-password ").append(_this.authPassword)),"object"!==$.type(options.data)&&"array"!==$.type(options.data)||options._multiPartAttrs&&(!options._multiPartAttrs||options.formObj)||options.exports){if(options._multiPartAttrs||options.exports){var formData,multipartAttrs=options._multiPartAttrs,fileCount=0,resourceName=rmd.resourceName.toLowerCase(),dataJson=options.data[resourceName];if(window.FormData&&!options.exports)if(formData=new window.FormData,"photo"==resourceName)formData.append("photo",$(dataJson.photo).prop("files")[0]),fileCount++;else for(var elem in dataJson)-1!==multipartAttrs.indexOf(elem)&&$(dataJson[elem]).prop("files").length&&(dataJson[elem]=$(dataJson[elem]).prop("files")[0],fileCount++),formData.append(resourceName+"["+elem+"]",dataJson[elem]);else{var $iframeElem=$("<iframe src='javascript:;' width='0' name='fileUploadIframe' id='"+resourceName+"fileUploadIframe' border='0' style='display:none;'></iframe>"),$formElem=$("<form method="+options.type+" target='"+$iframeElem[0].name+"' action='"+options.url+"' encoding='multipart/form-data' enctype='multipart/form-data' style='display:none;'></form>"),isGetRequest="get"===options.type.toLowerCase();isGetRequest&&(dataJson=_this.getParamsObj()),$formElem.append($("<input value='"+ZContacts.Cookie.getCSRFValue()+"' name='"+ZContacts.meta.serviceInfo.csrf_param_name+"'/>"));for(var attrName in dataJson){var nodeName=isGetRequest?attrName:resourceName+"["+attrName+"]",elemNode=$("<input name='"+nodeName+"'/>");elemNode.val(dataJson[attrName]),multipartAttrs&&-1!==multipartAttrs.indexOf(attrName)&&dataJson[attrName].value&&($(dataJson[attrName].parentElement).append(dataJson[attrName].cloneNode()),elemNode=dataJson[attrName],elemNode.name=nodeName,fileCount++),$formElem.append(elemNode)}$("body").append($iframeElem).append($formElem),window.handleIFrameResponse=_this.handleIFrameResponse,ZContacts._rsvbObj[resourceName]={resolve:promise.resolve,reject:promise.reject,iframeElem:$iframeElem,formElem:$formElem}}if(0===fileCount&&multipartAttrs)for(var i=0;i<multipartAttrs.length;i++)delete options.data[resourceName][multipartAttrs[i]];if(!window.FormData||options.exports)return void ZContacts._rsvbObj[resourceName].formElem.submit();options.data=formData,options.processData=!1,options.contentType=!1}}else options.contentType="application/json",options.data=JSON.stringify(options.data);return options.success=function(json){_this.apiResponse=json;var isError=!$.isEmptyObject(json.error)||json.status_code<200||json.status_code>=300,representation=json[rmd.resourceName.toLowerCase()];if(404!==json.status_code||isWrite||(isError=!1),isError)return void promise.reject(json);if("GETS"===type){var array=[];if(representation)for(var i=0,len=representation.length;len>i;i++)array.push(_this.type.create().deserialize(representation[i]));array._apiResponse=_this.apiResponse,promise.resolve(array)}else if("GET"===type){var o=_this.type.create();_this.resourceIdentifier&&o.set(rmd.identifier,_this.resourceIdentifier),representation?(o.deserialize(representation),promise.resolve(o)):promise.resolve(json)}else promise.resolve(json)},options.error=function(jqXHR){var json;try{json=$.parseJSON(jqXHR.responseText)}catch(e){json={status_code:jqXHR.status}}promise.reject(json)},$.ajax(options),promise},handleIFrameResponse:function(responseData){var json=responseData,resourceName=json.resource_name.toLowerCase();if(resourceName){var isError=!$.isEmptyObject(json.error)||json.status_code<200||json.status_code>=300,rsvpObj=ZContacts._rsvbObj[resourceName];$(rsvpObj.iframeElem).remove(),$(rsvpObj.formElem).remove(),isError?rsvpObj.reject(json):rsvpObj.resolve(json),delete ZContacts._rsvbObj[resourceName]}},_save:function(resource,isPost){if(isPost&&!resource||resource&&!(resource instanceof this.type))throw new Error(""+resource+" is not an instance of "+this.type);var rmd=this.getRMD(),errorObj=null;if(resource&&(resource.build(),errorObj=resource._validate(isPost)),errorObj){var promise=$.Deferred();return promise.reject({errors:errorObj}),promise}var serializedData=resource?resource.serialize():null,ajaxOptions={data:serializedData,_multiPartAttrs:rmd.multipartAttrs};return resource&&resource.get("__form")&&(ajaxOptions.formObj=resource.get("__form")),this._sendRequest(isPost?"POST":"PUT",ajaxOptions)},_saveAll:function(resources,isPost){for(var ajaxOptions={data:{}},dataArr=[],resourceName=this.getRMD().resourceName.toLowerCase(),i=0;i<resources.length;i++)dataArr.push(resources[i].serialize()[resourceName]);return ajaxOptions.data[resourceName+ZContacts.Constants.Params.MULTIPOST_SUFFIX]=dataArr,this._sendRequest(isPost?"POST":"PUT",ajaxOptions)}}),ZContacts.URI.Headers={POST_AND_GET:"X-Post-And-Get"},ZContacts.URI.trimSlash=function(path){return path&&("/"===path.charAt(0)&&(path=path.substring(1)),path.endsWith("/")&&(path=path.substring(0,path.length-1))),path},ZContacts.ZResource=function(){},$.extend(ZContacts.ZResource.prototype,{resourceName:null,parent:null,identifier:null,attrs:null,subResources:null,set:function(k,v){return this[k]=v,this},get:function(k){return this[k]},addSubResource:function(resource){if(!(resource instanceof ZContacts.ZResource))throw"'"+resource+"' must be a sub class of 'ZResource'";var rmd=resource.getRMD(),name=ZContacts.Utils.camelize(rmd.resourceName);if(!this.getSubResourceType(name))throw"'"+name+"' resource is not a sub resource of '"+this.getRMD().resource+"'";var arr=this.get(name);return rmd.identifier?arr?arr.push(resource):(arr=[],this.set(name,arr),arr.push(resource)):this.set(name,resource),this},getSubResourceType:function(varName){var resourceMetaData=this.getRMD();return resourceMetaData._subResourceObjMap&&resourceMetaData._subResourceObjMap[varName]},_validate:function(isPost){var j,validateMethod=isPost?"validate":"validatePartial",errors=[],validatedOutput=this[validateMethod]&&this[validateMethod]();errors=this.addErrors(errors,validatedOutput);var subResourcesList=this.getRMD()._subResourcesList;if(!ZContacts.Utils.isEmptyArray(subResourcesList)){errors=errors?errors:[];for(var i=0,len=subResourcesList.length;len>i;i++){var arr=this.get(subResourcesList[i]);if(arr)if(arr.length)for(j=0;j<arr.length;j++)validatedOutput=arr[j].validate&&arr[j].validate(),errors=this.addErrors(errors,validatedOutput);else validatedOutput=arr.validate&&arr.validate(),errors=this.addErrors(errors,validatedOutput)}}return errors.length?errors:null},addErrors:function(errors,errorObj){return errorObj?($.isArray(errorObj)||$.isEmptyObject(errorObj)?errors=errorObj.length?errors.concat(errorObj):errorObj:errors.push(errorObj),errors):errors},getParentIdentifier:function(){var rmd=ZResource.getResourceMetaData(this.getRMD().parent);return rmd&&this.get("parent."+rmd.identifier)},clearSubResources:function(){var subResourcesList=this.getRMD()._subResourcesList;if(subResourcesList)for(var i=0,len=subResourcesList.length;len>i;i++)this.set(subResourcesList[i],null)},serialize:function(){for(var jsonObj={},json={},rmd=this.getRMD(),attrs=rmd.attrs||[],i=0,len=attrs.length;len>i;i++){var key=attrs[i],value=this.get(key);null!==value&&void 0!==value&&(json[key]=this.serializeAttr(key,value))}return jsonObj[rmd.resourceName.toLowerCase()]=json,jsonObj},setMultipartAttrs:function(){var formObj=this.get("__form");if(formObj&&$(formObj).is("form")){var keyIndex,multipartKeys=this.getRMD().multipartAttrs,$formObj=$(formObj);for(keyIndex=0;keyIndex<multipartKeys.length;keyIndex++){var multiPartKey=multipartKeys[keyIndex],$file=$formObj.find("input[name='"+multiPartKey+"']");this.set(multiPartKey,$file.get(0))}}},build:function(){this.setMultipartAttrs();var subResourcesList=this.getRMD()._subResourcesList;if(!ZContacts.Utils.isEmptyArray(subResourcesList))for(var i=0;i<subResourcesList.length;i++){var subResource=this.get(subResourcesList[i]);if(subResource)if($.isArray(subResource))for(var j=0;j<subResource.length;j++)subResource[j].build();else subResource.build()}},serializeAttr:function(key,value){var serializedData,subResourceType=this.getSubResourceType(key);if(subResourceType&&value){var arr=[];if($.isArray(value)){for(var j=0;j<value.length;j++)serializedData=value[j]?value[j].serialize()[key]:null,arr.push(serializedData);return arr}return value.serialize()[key]}return value},deserialize:function(json){for(var key in json)json.hasOwnProperty(key)&&this.deserializeAttr(key,json[key]);return this},deserializeAttr:function(key,value){var subResourceType=this.getSubResourceType(key);if(subResourceType)if($.isArray(value))for(var i=0,len=value.length;len>i;i++)this.addSubResource(subResourceType.create().deserialize(value[i]));else this.addSubResource(subResourceType.create().deserialize(value));else this.set(key,value);return this},merge:function(zresource){for(var key in zresource)zresource.hasOwnProperty(key)&&this.set(key,zresource[key]);return this},getIdentifier:function(){return this.get(this.getRMD().identifier)},getURI:function(isInstance){var type=this.constructor,identifiers=Array.prototype.slice.apply(arguments).slice(1);if(1===arguments.length)for(var rmd=this.getRMD();rmd.parent;){rmd=ZResource.getResourceMetaData(rmd.parent);var value=this.get("parent."+rmd.identifier);if(!value)throw new Error("Parent Identifier ("+rmd.resourceName+"."+rmd.identifier+") is missing in the ZResource.");identifiers.splice(0,0,value)}return isInstance&&identifiers.push(this.getIdentifier()),new ZContacts.URI([type].concat(identifiers))},POST:function(){var args=Array.prototype.slice.apply(arguments);return args.splice(0,0,!1),this.getURI.apply(this,args).POST(this)},PUT:function(){var args=Array.prototype.slice.apply(arguments);return args.splice(0,0,!0),this.getURI.apply(this,args).PUT(this)},DELETE:function(paramsObj){var uri=this.getURI(!0);if($.isPlainObject(paramsObj))for(var param in paramsObj)uri.addDeleteParams(param,paramsObj[param]);return uri.DELETE(this)},getRMD:function(){return ZContacts.RMD.getMetaData(this)}}),$.extend(ZContacts.ZResource,{extendClass:function(resourceProps){var superclass=ZContacts.ZResource,subclass=function(){};subclass.prototype=new ZContacts.ZResource,subclass.prototype.constructor=subclass;for(var name in superclass)superclass.hasOwnProperty(name)&&!subclass[name]&&(subclass[name]=superclass[name]);return subclass.superclass=superclass,subclass.superproto=superclass.prototype,subclass.resourceProps=resourceProps,$.extend(subclass.prototype,resourceProps),subclass},create:function(prop){var fn=this,ins=new fn;return prop&&ins.deserialize(prop),ins},__zresource:!0,getResourceMetaData:function(type){return ZContacts.RMD.getMetaData(type)},GET:function(parentIdentifier,identifier,params){return!params&&$.isPlainObject(identifier)&&(params=identifier,identifier=void 0),new ZContacts.URI(this,parentIdentifier,identifier).GET()},GETS:function(parentIdentifier,params){return!params&&$.isPlainObject(parentIdentifier)&&(params=parentIdentifier,parentIdentifier=void 0),new ZContacts.URI(this,parentIdentifier).GETS()}}),ZContacts.RMD={RESOURCE_META_DATA:{},getMetaData:function(type){type.create||(type=type.constructor);var metadata=this.RESOURCE_META_DATA[type.__zresource_name__];if(!metadata){if(metadata=this.getFilteredMetaData(type.resourceProps),metadata.parent){for(var parents=[],parent=metadata.parent;parent;)parents.splice(0,0,parent),parent=this.getMetaData(parent).parent;metadata.parents=parents}if(type.__zresource_name__=!metadata.parents||metadata.parents.length<1?metadata.resourceName:metadata.parents[0].__zresource_name__+metadata.resourceName,this.RESOURCE_META_DATA[type.__zresource_name__]=metadata,metadata.fixed_data){for(var fixedData=metadata.fixed_data,modifiedData=[],i=0;i<fixedData.length;i++){var d=fixedData[i];modifiedData.push(type.create(d))}metadata.fixed_data=modifiedData}this.setSubResources(type)}return metadata},setSubResources:function(type){var metaData=this.RESOURCE_META_DATA[type.__zresource_name__],subResources=metaData.subResources;if(!ZContacts.Utils.isEmptyArray(subResources)){metaData._subResourceObjMap={};for(var i=0,len=subResources.length;len>i;i++){var subResource=subResources[i],resourceName=this.getMetaData(subResource).resourceName,varName=ZContacts.Utils.camelize(resourceName);metaData.attrs.push(varName),metaData._subResourceObjMap[varName]=subResource}metaData._subResourcesList=Object.keys(metaData._subResourceObjMap)}for(var properties={},requiredMetaAttrs=this.requiredMetaAttrs,index=0;index<requiredMetaAttrs.length;index++)properties[requiredMetaAttrs[index]]=null;$.extend(type.prototype,properties)},requiredMetaAttrs:["resourceName","attrs","parent","identifier","multipartAttrs","subResources","exports","path","fixed_data"],getFilteredMetaData:function(metaData){for(var metaJson={},requiredMetaAttrs=this.requiredMetaAttrs,i=0;i<requiredMetaAttrs.length;i++){var attr=requiredMetaAttrs[i];metaData[attr]&&(metaJson[attr]=metaData[attr])}return metaJson}},function(){var ZResource=ZContacts.ZResource;ZContacts.Accounts=ZResource.extendClass({resourceName:"Accounts",getAccountId:function(){return this.account_id},getType:function(){return this.type},isWritable:this.isWritable,getCount:function(){return this.count},getName:function(){return this.name},getCategories:function(){return this.categories},getRootFolderId:function(){return"personal"==this.type?ZContacts.ZMailConstants.VIEW_ID_ALL_CONTACTS:"org"==this.type?ZContacts.ZMailConstants.VIEW_ID_ORG_CONTACTS:"groups"==this.type?ZContacts.ZMailConstants.VIEW_ID_GRP_CONTACTS+this.account_id:void 0}}),ZContacts.Contacts=ZResource.extendClass({resourceName:"Contacts",identifier:"contact_id",parent:ZContacts.Accounts,attrs:["first_name","middle_name","last_name","nick_name","gender","birth_month","birth_day","birth_year","company","job_title","designation","notes","categories"],getFullName:function(){return(this.first_name||"")+" "+(this.middle_name||"")+" "+(this.last_name||"")},getPrimaryEmail:function(){var emails=this.get("emails");if(emails)for(var i=0;i<emails.length;i++){var email=emails[i];if(email.get("is_primary"))return email.get("email_id")}return""}}),ZContacts.ContactsDuplicates=ZResource.extendClass({resourceName:"contacts/duplicates",identifier:"contact_id",parent:ZContacts.Accounts,attrs:["first_name","middle_name","last_name","nick_name","gender","birth_month","birth_day","birth_year","company","job_title","designation","notes"]}),ZContacts.ContactsMerge=ZResource.extendClass({resourceName:"merge",identifier:"contact_id",parent:ZContacts.Contacts,attrs:["first_name","middle_name","last_name","nick_name","gender","birth_month","birth_day","birth_year","company","job_title","designation","notes"]}),ZContacts.Categories=ZResource.extendClass({resourceName:"Categories",identifier:"category_id",parent:ZContacts.Accounts,attrs:["category_name"]}),ZContacts.ContactsCategories=ZResource.extendClass({resourceName:"categories",parent:ZContacts.Contacts,attrs:["category_name"]}),ZContacts.ContactsPhotos=ZResource.extendClass({resourceName:"photo_url",parent:ZContacts.Contacts,attrs:["photo_url"]}),ZContacts.ExportContacts=ZResource.extendClass({resourceName:"contacts/export",identifier:"export_contacts",parent:ZContacts.Accounts}),ZContacts.InviteChat=ZResource.extendClass({resourceName:"invite",parent:ZContacts.Contacts}),ZContacts.Emails=ZResource.extendClass({resourceName:"Emails",identifier:"email_id",parent:ZContacts.Contacts,attrs:["email_id","is_primary"]}),ZContacts.PhoneNumbers=ZResource.extendClass({resourceName:"Phones",identifier:"number",parent:ZContacts.Contacts,attrs:["number","type"]}),ZContacts.Ims=ZResource.extendClass({resourceName:"ims",identifier:"type",parent:ZContacts.Contacts,attrs:["address","type"]}),ZContacts.Urls=ZResource.extendClass({resourceName:"Urls",identifier:"url",parent:ZContacts.Contacts,attrs:["url","type"]}),ZContacts.Address=ZResource.extendClass({resourceName:"address",identifier:"type",parent:ZContacts.Contacts,attrs:["street_addr","street_addr1","city","state","country","postal_code","type"],isEmpty:function(){return!(this.get("street_addr")||this.get("street_addr1")||this.get("city")||this.get("state")||this.get("country")||this.get("postal_code"))}}),ZContacts.Photo=ZResource.extendClass({resourceName:"photo",identifier:"photo",parent:ZContacts.Contacts,attrs:["photo"],multipartAttrs:["photo"]}),ZContacts.Import=ZResource.extendClass({resourceName:"Import",identifier:"step",parent:ZContacts.Accounts,attrs:["importcontact"],multipartAttrs:["importcontact"],path:"contacts/import"}),ZContacts.Mapping=ZResource.extendClass({resourceName:"Mapping",parent:ZContacts.Accounts,attrs:["first_name","middle_name","last_name","nick_name","categories","emails","gender","birth_date","birth_month","birth_year","notes","company","job_title","designation","h_street_addr","h_street_addr1","h_city","h_state","h_country","h_postal_code","w_street_addr","w_street_addr1","w_city","w_state","w_country","w_postal_code"],path:"contacts/import/mapping"}),ZContacts.MappingPhone=ZResource.extendClass({resourceName:"Phones",identifier:"type",parent:ZContacts.Mapping,attrs:["number","type"]}),ZContacts.MappingIms=ZResource.extendClass({resourceName:"ims",identifier:"type",parent:ZContacts.Mapping,attrs:["ims","type"]}),ZContacts.MappingUrls=ZResource.extendClass({resourceName:"Urls",identifier:"type",parent:ZContacts.Mapping,attrs:["urls","type"]}),ZContacts.MappingConfirmation=ZResource.extendClass({resourceName:"confirmation",parent:ZContacts.Accounts,attrs:["account_name","account_id","category_id","category_name","overwrite_duplicate","file_format"],path:"contacts/import/confirm"}),ZContacts.ContactsImported=ZResource.extendClass({resourceName:"imported",parent:ZContacts.Accounts,path:"contacts/import/imported"}),ZContacts.selectbox=ZResource.extendClass({resourceName:"selectbox"}),ZContacts.CopyFrom=ZResource.extendClass({resourceName:"from",parent:ZContacts.Copy,attrs:["zid","contact_ids"]}),ZContacts.CopyTo=ZResource.extendClass({resourceName:"to",parent:ZContacts.Copy,attrs:["zid","category_id"]}),ZContacts.Copy=ZResource.extendClass({resourceName:"copy",parent:ZContacts.Accounts,attrs:["from","to"]}),$.extend(ZContacts.Copy.resourceProps,{subResources:[ZContacts.CopyFrom,ZContacts.CopyTo]}),$.extend(ZContacts.Contacts.resourceProps,{subResources:[ZContacts.Emails,ZContacts.PhoneNumbers,ZContacts.Ims,ZContacts.Urls,ZContacts.Address]}),$.extend(ZContacts.Mapping.resourceProps,{subResources:[ZContacts.MappingPhone,ZContacts.MappingIms,ZContacts.MappingUrls,ZContacts.Address]}),$.extend(ZContacts.ContactsDuplicates.resourceProps,{subResources:[ZContacts.Emails,ZContacts.PhoneNumbers,ZContacts.Ims,ZContacts.Urls,ZContacts.Address]}),$.extend(ZContacts.ContactsMerge.resourceProps,{subResources:[ZContacts.Emails,ZContacts.PhoneNumbers,ZContacts.Ims,ZContacts.Urls,ZContacts.Address]})}(),ZContacts.selectedCount=0,ZContacts._countObj={},ZContacts._childObj={},ZContacts._parentObj={},ZContacts._currentCategoryId,ZContacts._prevContact,ZContacts.categoryForAcc={},ZContacts.AccountsVsRootFolderMap={},ZContacts.setAccount=function(acc){this.acc=acc},ZContacts.getMessageFromResponse=function(json){return json.message?json.message:json.errors&&json.errors.length&&json.errors[0].message?json.errors[0].message:ZContacts.I18N.get("IAM.ERROR.GENERAL")};var zmcontact=function(){var URI=ZContacts.URI,encodeHTML=ZContacts.Utils.encodeHTML,I18N=ZContacts.I18N,ContactStatus=ZContacts.Constants.ChatStatus,headerObj={list:{left:{leftHTML:""},right:[]}},zcon={contactLeft:zmsuite.getLeft(),contactsCenter:zmsuite.getCenter()},listingMetaData={page:1,noOfResults:50,isLoading:!1},isRootFolder=function(catId){return catId||(catId=ZContacts._currentCategoryId),catId.substr(0,ZContacts.ZMailConstants.VIEW_ID_GRP_CONTACTS.length)==ZContacts.ZMailConstants.VIEW_ID_GRP_CONTACTS||catId==ZContacts.ZMailConstants.VIEW_ID_ALL_CONTACTS||catId==ZContacts.ZMailConstants.VIEW_ID_ORG_CONTACTS?!0:!1},initObj={initContactSuite:function(){zmcontact.init(),zmcontact.constructView(),zmcontact.loadFirstPage(zmcontact.getCategory(ZContacts.ZMailConstants.VIEW_ID_ALL_CONTACTS))},getActionMenuList:function(){return[{groupId:"select",actionArr:[{iconList:["msi-uncheck zcs-check"],tooltip:I18N.get("IAM.CONTACTS.SELECTALL")}]},{groupId:"sort",actionArr:[{iconList:["msi-sort"],tooltip:I18N.get("IAM.CONTACTS.SORT.BY")}]},{groupId:"delete",actionArr:[{iconList:["msi-trash"],tooltip:I18N.get("IAM.DELETE")}]},{groupId:"addto",actionArr:[{iconList:["msi-folder"],dropAction:!0,tooltip:I18N.get("IAM.CONTACTS.ADD.TO")}]},{groupId:"clearcategory",actionArr:[{iconList:["msi-clearContacts"],dropAction:!0,tooltip:I18N.get("IAM.CONTACTS.CLEAR.CATEGORY")}]},{groupId:"merge",actionArr:[{iconList:["msi-contactMerge"],tooltip:I18N.get("IAM.CONTACTS.MERGE")}]},{groupId:"mail",actionArr:[{iconList:["msi-mail"],tooltip:I18N.get("IAM.CONTACTS.SEND.MAIL")}]},{groupId:"action",actionArr:[{iconList:["msi-action"],dropAction:!0,tooltip:I18N.get("IAM.CONTACTS.MORE.ACTIONS"),separator:!0}]}]},getCategory:function(categoryId){var node=ZContacts._countObj[categoryId];if(-1==node.p){var index=0;index=categoryId==ZContacts.ZMailConstants.VIEW_ID_ALL_CONTACTS||categoryId==ZContacts.ZMailConstants.VIEW_ID_ORG_CONTACTS?0:1;var data=zcon.contactLeft.getNodes(0)[0].layerArr[index].listObject[categoryId],category={category_id:data.category_id,category_name:data.category_name,contacts_count:ZContacts._countObj[categoryId].c};return ZContacts.Categories.create(category)}var data=ZContacts._childObj[node.p].CH[categoryId],category={category_id:data.category_id,category_name:data.category_name,contacts_count:ZContacts._countObj[categoryId].c};return ZContacts.Categories.create(category)},getRootFolderId:function(categoryId){return categoryId||(categoryId=ZContacts._currentCategoryId),-1!=ZContacts._countObj[categoryId].p?ZContacts._countObj[categoryId].p:categoryId},loadCategoryContacts:function(categoryId){if(categoryId!=ZContacts._currentCategoryId){$(".SC_tre.Stre").removeClass("Stre"),$("#"+categoryId).addClass("Stre");var category=zmcontact.getCategory(categoryId);zmcontact._loadContacts(category),zmcontact.unChkAll()}},updateHeaderBand:function(category,count,isUpdate){if(zmTab.currentTab==ZContacts.ZMailConstants.SEARCH_WORKSPACE_APP_ID||zmTab.currentTab==ZContacts.ZMailConstants.CLEAN_WORKSPACE_APP_ID){var htm;htm=category.category_name;var cnt=category.contacts_count;1==cnt?htm+='<span class="sum"> '+formatMessage(I18N.get("IAM.SINGLE.CONTACT"),cnt)+" </span>":cnt>1&&(htm+='<span class="sum"> '+formatMessage(I18N.get("IAM.MULTIPLE.CONATCT"),cnt)+"</span>"),headerObj.list.left.leftHTML=htm;var headerNode=zmsuite.getWorkSpace(ZContacts.ZMailConstants.CONTACTS_APP_ID)[0].getNodes()[1];headerNode.push(headerObj.list),headerNode.paint(),zmTab.currentTab==ZContacts.ZMailConstants.SEARCH_WORKSPACE_APP_ID?htm=I18N.get("IAM.CONTACTS.SEARCH.RESULTS"):zmTab.currentTab==ZContacts.ZMailConstants.CLEAN_WORKSPACE_APP_ID&&(htm=I18N.get("IAM.CONTACTS.CLEAN.DUPLICATES"))}else{var htm=category.category_name;count&&ZContacts.selectedCount+count>0?(ZContacts.selectedCount=isUpdate?ZContacts.selectedCount+count:count,htm+=ZContacts.selectedCount>1?'<span class="sum"> '+formatMessage(I18N.get("IAM.CONTACTS.OF.SELECTED"),ZContacts.selectedCount)+"</span>":'<span class="sum"> '+formatMessage(I18N.get("IAM.CONTACTS.SELECTED"),ZContacts.selectedCount)+"</span>"):(count=category.contacts_count,1==count?htm+='<span class="sum"> '+formatMessage(I18N.get("IAM.SINGLE.CONTACT"),count)+" </span>":count>1&&(htm+='<span class="sum"> '+formatMessage(I18N.get("IAM.MULTIPLE.CONATCT"),count)+"</span>"),ZContacts.selectedCount=0)}headerObj.list.left.leftHTML=htm;var headerNode=zmsuite.getCenter()[0].getNodes()[1];headerNode.push(headerObj.list),headerNode.paint()},loadFirstPage:function(category){var div="<div class='SC_conLft'></div><div class='SC_conRgt'><div class='zcs-cont-details'></div><div class='zcs-cont-edit zcs-editor-form'></div></div>";$(zcon.contactsCenter.listElem).html(div),listingMetaData.page=1,zmcontact._loadContacts(category),zmcontact.unChkAll(),zmsuite.showExistingApp("zm_Contacts")},loadSearchFirstPage:function(category){zmcontact.unChkAll(),zmcontact._loadContacts(category)},loadNextPage:function(category){listingMetaData.hasMore&&(listingMetaData.page++,zmcontact._loadContacts(category))},_loadContacts:function(category,isSort){ZContacts._currentCategoryId=category.category_id,ZContacts._prevContact=void 0,ZContacts.setAccount(zmcontact.getAccByCategoryId(category.category_id)),$(".msi-uncheck.zcs-check").parents("li").attr("style","display: block;");var uri=new URI(ZContacts.Contacts,ZContacts.getCurrentAccount().getAccountId()).include("emails");uri.setPagination(listingMetaData.page,listingMetaData.noOfResults),isSort&&uri.setSortBy(ZContacts.sortBy,!0);var categoryId=category.get("category_id");isRootFolder(categoryId)||uri.addFilter("categories",categoryId),$(".SC_tre.Stre").removeClass("Stre"),$("#"+categoryId).addClass("Stre");var isNextPage=1!=listingMetaData.page;listingMetaData.isLoading=!0;var destroyLoadingDiv=zmComponent.loadingBand({container:$(zcon.contactsCenter.listElem).find(".SC_conLft").get(0),type:"pagination"});zcon.contactLeft.getNodes()[0].getLayer("VIEWS").setChildToggle(function(data){if(data.zmsData.eventInfo){var elem=data.zmsData.eventInfo.currentTarget;if($(elem).hasClass("msi-rarrow")&&$(elem).hasClass("msi-arrow45")){var rootFolderId=$(elem).parents(".SC_tre").attr("id");ZContacts.categoryForAcc[rootFolderId].fetched&&ZContacts.categoryForAcc[rootFolderId].appended||ZContacts.categoryForAcc[rootFolderId].fetched&&$(elem).hasClass("msi-arrow45")||zmcontact.appendCategories(rootFolderId)}}}),ZContacts.groups&&zcon.contactLeft.getNodes()[0].getLayer("GROUPS").setChildToggle(function(data){if(data.zmsData.eventInfo){var elem=data.zmsData.eventInfo.currentTarget;if($(elem).hasClass("msi-rarrow")&&$(elem).hasClass("msi-arrow45")){var rootFolderId=$(elem).parents(".SC_tre").attr("id");ZContacts.categoryForAcc[rootFolderId].fetched&&$(elem).hasClass("msi-arrow45")||zmcontact.appendCategories(rootFolderId)}}}),uri.GETS().then(function(json){destroyLoadingDiv(),listingMetaData.isLoading=!1,listingMetaData.hasMore=uri.apiResponse.has_more,zmcontact.contactsList(json,isNextPage);var rootFolderId=zmcontact.getRootFolderId(ZContacts._currentCategoryId);zmcontact.appendCategories(rootFolderId,!0)},function(json){destroyLoadingDiv(),listingMetaData.isLoading=!1,json.status_code===ZContacts.Constants.StatusCode.NOT_FOUND&&zmcontact.contactsList(null)})},init:function(){var contactsAppObj={appname:"Contacts",appId:ZContacts.ZMailConstants.CONTACTS_APP_ID,appIcon:"msi-contacts",searchPlaceHolder:I18N.get("IAM.CONTACTS.SEARCH.CONTACTS"),data:{LNodes:"2",CNodes:"3"}};contactsAppObj.handler={create:zmcontact.showQuickCreate},zmsuite.setAppInfo(contactsAppObj)},constructView:function(){zcon.contactLeft=zmsuite.getLeft(),zcon.contactsCenter=zmsuite.getCenter(),zmcontact.constructLeft(),zmcontact.constructCenter(),zmsuite.showApp(ZContacts.ZMailConstants.CONTACTS_APP_ID),zcon.contactsCenter.listElem=zcon.contactsCenter[0].getNodes()[2].$el[0]},updateCountInCategories:function(category,count,isUpdate){isUpdate?(count=ZContacts._countObj[category.category_id].c+count,ZContacts._countObj[category.category_id].c=count>=0?count:0,category.contacts_count=ZContacts._countObj[category.category_id].c):(ZContacts._countObj[category.category_id].c=count,category.contacts_count=count)},getCategoriesListLayer:function(categoryId){categoryId||(categoryId=ZContacts._currentCategoryId);var rootFolderId=zmcontact.getRootFolderId(categoryId),index=0;return rootFolderId.substr(0,ZContacts.ZMailConstants.VIEW_ID_GRP_CONTACTS.length)==ZContacts.ZMailConstants.VIEW_ID_GRP_CONTACTS&&(index=1),zcon.contactLeft.getNodes()[0].layerArr[index]},refreshContactCounts:function(){new URI(ZContacts.Accounts,ZContacts.getCurrentAccount().getAccountId()).include("categories,contacts.total_count").GET().then(function(accounts){var rootFolderId=zmcontact.getRootFolderId(ZContacts._currentCategoryId),count=accounts.get("contacts_count"),category=zmcontact.getCategory(rootFolderId);if(zmcontact.updateCountInCategories(category,count,!1),accounts.get("categories"))for(var categories=accounts.get("categories"),i=0;i<categories.length;i++){var category=categories[i];ZContacts._countObj[category.category_id]||(ZContacts._countObj[category.category_id]={}),ZContacts._countObj[category.category_id]={p:rootFolderId,c:category.contacts_count}}ZContacts.ImportPage||(zmcontact.updateHeaderBand(zmcontact.getCategory(ZContacts._currentCategoryId)),zmcontact.unChkAll())})},constructLeft:function(){var leftNodes=zcon.contactLeft.getNodes()[0];leftNodes.push({layerArr:[]});var views=[];views.push(ZContacts.user),ZContacts.org&&views.push(ZContacts.org),zmcontact.appendAccountLayer(views,"VIEWS"),ZContacts.groups&&ZContacts.groups.length&&zmcontact.appendAccountLayer(ZContacts.groups,"GROUPS"),zcon.contactLeft.setListener("click",function(data){(zmTab.currentTab!=ZContacts.ZMailConstants.CONTACTS_APP_ID||data.zmsData.eventInfo.currentTarget.id!=ZContacts._currentCategoryId)&&(zmsuite.showWorkSpace(ZContacts.ZMailConstants.CONTACTS_APP_ID),zmcontact.bindLeftActions(data))}),zcon.contactLeft.setListener("contextmenu",function(data){zmcontact.bindLeftActions(data)}),zcon.contactLeft.render()},fetchCategoriesFromDb:function(rootFolderId){if(!ZContacts._parentObj[rootFolderId]){var acc=ZContacts.AccountsVsRootFolderMap[rootFolderId];new URI(ZContacts.Categories,acc.getAccountId()).include("contacts.count").GETS().then(function(categories){var rootFolderId=ZContacts.AccountsVsRootFolderMap[acc.getAccountId()];if(ZContacts.categoryForAcc[rootFolderId].fetched=!0,categories&&categories.length>0){ZContacts._parentObj[rootFolderId]=[];for(var i=0;i<categories.length;i++){var category=categories[i];ZContacts._parentObj[rootFolderId].push(category),ZContacts._countObj[category.category_id]={c:0,p:-1}}}})}},appendCategories:function(rootFolderId,showChild){var prevElementId,layer=zmcontact.getCategoriesListLayer(rootFolderId),acc=ZContacts.AccountsVsRootFolderMap[rootFolderId];if(!ZContacts.categoryForAcc[rootFolderId].fetched||ZContacts.categoryForAcc[rootFolderId].appended)return ZContacts.categoryForAcc[rootFolderId].appended&&showChild?void layer.showChild($("#"+rootFolderId).find(".msi-rarrow"),rootFolderId,$("#"+rootFolderId)):void(ZContacts._parentObj[rootFolderId]||(acc.isWritable&&showChild&&layer.showChild($("#"+rootFolderId).find(".msi-rarrow"),rootFolderId,$("#"+rootFolderId)),new URI(ZContacts.Categories,acc.getAccountId()).include("contacts.count").GETS().then(function(categories){var rootFolderId=ZContacts.AccountsVsRootFolderMap[acc.getAccountId()];if(ZContacts.categoryForAcc[rootFolderId].fetched=!0,categories&&categories.length>0){ZContacts._parentObj[rootFolderId]=[],acc.categories=categories;for(var i=0;i<categories.length;i++){var category=categories[i];ZContacts._parentObj[rootFolderId].push(category),ZContacts._countObj[category.category_id]={c:0,p:-1};var rowInfo={};rowInfo[category.category_id]={category_id:category.category_id,category_name:encodeHTML(category.category_name),E:0,HC:0},ZContacts._childObj[rootFolderId]&&ZContacts._childObj[rootFolderId].CH[rootFolderId+"_add"]?layer.insertNodeBefore(rowInfo,layer.mapObject,rootFolderId+"_add",rootFolderId):0==i?(layer.appendNode(rowInfo,layer.mapObject,rootFolderId),prevElementId=category.category_id):layer.insertNodeAfter(rowInfo,layer.mapObject,prevElementId,rootFolderId),ZContacts.categoryForAcc[rootFolderId].appended=!0}}})));if(ZContacts._parentObj[rootFolderId])for(var i=0;i<ZContacts._parentObj[rootFolderId].length;i++){var category=ZContacts._parentObj[rootFolderId][i],rowInfo={};rowInfo[category.category_id]={category_id:category.category_id,category_name:encodeHTML(category.category_name),E:0,HC:0},ZContacts._childObj[rootFolderId]&&ZContacts._childObj[rootFolderId].CH[rootFolderId+"_add"]?layer.insertNodeBefore(rowInfo,layer.mapObject,rootFolderId+"_add",rootFolderId):0==i?(layer.appendNode(rowInfo,layer.mapObject,rootFolderId),prevElementId=category.category_id):layer.insertNodeAfter(rowInfo,layer.mapObject,prevElementId,rootFolderId),ZContacts.categoryForAcc[rootFolderId].appended=!0}else if(acc.isWritable)return void layer.showChild($("#"+rootFolderId).find(".msi-rarrow"),rootFolderId,$("#"+rootFolderId))},appendAccountLayer:function(accounts,type){var categoryMapObj={id:"category_id",name:"category_name",count:"count",hasChild:"HC",expChild:"E",sequence:"SE",parentId:"p",notBold:"notBold"},name=I18N.get("IAM.CONTACTS.VIEWS");"VIEWS"!=type&&(name=I18N.get("IAM.CONTACTS.GROUPS"));for(var acc,listObject={},expand=0,categoryTreeObj={type:"1",listId:type+"H",id:type,hasChild:!0,hasCountObject:!0,notBold:!0,mapObject:categoryMapObj,dataObject:{headerObject:{licon:"msi-folder",id:"zcateH",name:name,showList:!0,count:"<i class='msi-plus'></i>",onAdd:function(){window.open(ZContacts.meta.serviceInfo.groups_url)}}}},i=0;i<accounts.length;i++){var seq=1,hasChild=!1;acc=accounts[i];var rootFolderId=acc.getRootFolderId(),catName=encodeHTML(acc.getName());ZContacts.categoryForAcc[rootFolderId]={},expand=0,"groups"!=acc.getType()&&(categoryTreeObj.dataObject.headerObject.count=void 0),"personal"==acc.getType()&&(expand=1),ZContacts._countObj[rootFolderId]={c:acc.count,p:-1};var categories=acc.getCategories();if(categories&&categories.length){ZContacts._childObj[rootFolderId]={CH:{}},hasChild=!0,ZContacts._parentObj[rootFolderId]=[],ZContacts.categoryForAcc[rootFolderId].fetched=!0,ZContacts.categoryForAcc[rootFolderId].appended=!0;for(var j=0;j<categories.length;j++){ZContacts._parentObj[rootFolderId].push(categories[j]);var catId=categories[j].category_id.toString();ZContacts._countObj[catId]={c:categories[j].contacts_count,p:rootFolderId},ZContacts._childObj[rootFolderId].CH[catId]={category_id:catId,category_name:encodeHTML(categories[j].category_name),E:0,HC:!1,SE:seq},seq++}}acc.isWritable&&(hasChild=!0,ZContacts._countObj[rootFolderId+"_add"]={c:0,p:rootFolderId},ZContacts._childObj[rootFolderId]||(ZContacts._childObj[rootFolderId]={CH:{}}),ZContacts._childObj[rootFolderId].CH[rootFolderId+"_add"]={id:rootFolderId+"_add",account_id:acc.getAccountId(),category_id:rootFolderId+"_add",category_name:I18N.get("IAM.CONTACTS.ADD.CATEGORY"),E:0,HC:!1,SE:seq,addNewType:!0},seq++);var layer=zcon.contactLeft.getNodes()[0].getLayer(type);if(layer)layer.childObject=ZContacts._childObj,layer.countObject=ZContacts._countObj,layer.listObject[rootFolderId]={category_name:catName,category_id:rootFolderId,account:acc,type:acc.type,E:expand,HC:hasChild};else{listObject[rootFolderId]={category_name:catName,category_id:rootFolderId,account:acc,type:acc.type,E:expand,HC:hasChild},categoryTreeObj.dataObject.listObject=listObject,categoryTreeObj.dataObject.countObject=ZContacts._countObj,categoryTreeObj.dataObject.childObject=ZContacts._childObj;var categoriesLayer=new ZMLayer;categoriesLayer.push(categoryTreeObj),zcon.contactLeft.getNodes()[0].layerArr.push(categoriesLayer)}}},showCreateCategoryPopUp:function(obj,data){var popOpt,folTitle,folMode,posLeft,posTop,posElem,posOffset;obj=obj||{},folMode=obj.mode||"new",posElem=$(".zm_compose"),posOffset=posElem.offset(),posTop=posOffset.top+"px",posLeft=posOffset.left+posElem.width()+"px";var categoryMapObj={id:"category_id",name:"category_name",hasChild:"HC",expChild:"E",sequence:"SE",parentId:"p"},categoryName="";"rename"===folMode?(folTitle=I18N.get("IAM.CONTACTS.RENAME.CATEGORY"),categoryName=encodeHTML(data.category.category_name)):"new"===folMode&&(folTitle=I18N.get("IAM.CONTACTS.ADD.CATEGORY"));var all_contacts_id=obj.id;popOpt={title:folTitle,style:{width:"200px"},posParent:{top:posTop,left:posLeft},buttons:[{txt:I18N.get("IAM.SAVE"),selected:!0,callback:function(){var newCategoryName=$("#zc_categorypopup").find("input:first").val();if(zmcontact.isValidCategoryName(newCategoryName,{mode:obj.mode,parElem:$("#zc_categorypopup")[0]})){var categoryModel=ZContacts.Categories.create({category_name:newCategoryName});"new"===obj.mode?new URI(ZContacts.Categories,obj.account_id).POST(categoryModel).then(function(json){var category=data.category;category||(category=data.rowObject[data.eventInfo.currentTarget.id],category.category_id=category.category_id.replace("_add",""));var rootFolderId=zmcontact.getRootFolderId(category.category_id);ZContacts._parentObj[rootFolderId]||(ZContacts._parentObj[rootFolderId]=[]),ZContacts._parentObj[rootFolderId].push(json.categories),ZContacts._countObj[category.category_id]={c:0,p:-1};var rowInfo={};rowInfo[json.categories.category_id]={category_id:json.categories.category_id,category_name:encodeHTML(json.categories.category_name),E:1,HC:0};var layer=zmcontact.getCategoriesListLayer(rootFolderId);layer.insertNodeBefore(rowInfo,categoryMapObj,rootFolderId+"_add",rootFolderId),zmcontact.refreshContactCounts(),zmUtil.succErrMsg("s",I18N.get("IAM.CONTACTS.ERROR.CATEGORY.ADDED"))},function(json){zmUtil.succErrMsg("e",ZContacts.getMessageFromResponse(json))}):"rename"===obj.mode&&new URI(ZContacts.Categories,obj.account_id,data.category.category_id).PUT(categoryModel).then(function(json){data.category.category_name=json.categories.category_name;for(var rootFolderId=zmcontact.getRootFolderId(data.category.category_id),listObj=ZContacts._parentObj[rootFolderId],i=0;i<listObj.length;i++){var cat=listObj[i];if(cat.category_id==data.category.category_id){cat.category_name=encodeHTML(json.categories.category_name);break}}var rowObj={};rowObj[data.category.category_id]=data.category;var editChild={};editChild[data.category.category_id]={E:1,HC:0,category_name:encodeHTML(json.categories.category_name),category_id:data.category.category_id},zmcontact.getCategoriesListLayer(all_contacts_id).editNode(rowObj,categoryMapObj,editChild),zmcontact.updateHeaderBand(zmcontact.getCategory(ZContacts._currentCategoryId)),zmUtil.succErrMsg("s",I18N.get("IAM.CONTACTS.ERROR.CATEGORYNAME.CHANGED"))},function(json){zmUtil.succErrMsg("e",ZContacts.getMessageFromResponse(json))}),zmsDialog.remove()}$("#zmsdialog_zm_createfolpopup").hide()}},{isCancel:!0,txt:I18N.get("IAM.CANCEL"),callback:function(){zmsDialog.remove()}}],closeaction:function(){$("#zc_categorypopup").remove()},afterDisplay:function(){$("#zc_categorypopup").find("input")[0].focus()}};var $createFolElem=$("<div id='zc_categorypopup' class='SC_p10'><ul><li class='SC_p10'><input type='text' class='SC_tiput' placeholder='"+I18N.get("IAM.CONTACTS.CATEGORY.NAME")+"'/></li></ul></div>");$createFolElem.find(".SC_tiput").val(categoryName),$("#zc_categorypopup").length||$(document.body).append($createFolElem),zmsDialog.create("zc_categorypopup",popOpt),$("#zmsdialog_zc_categorypopup").mousedown(function(ev){zmUtil.stopEvents(ev,!0)}),$("#zmsdialog_zc_categorypopup").click(function(){zmUtil.hideMenu(!1,!0)}),$("#zmsdialog_zc_categorypopup").keypress(function(e){13==e.which&&$(this).find(".sel")[0].click()})},isValidCategoryName:function(catName){return catNameLwrCase=catName.toLowerCase(),catName.length?!0:(zmUtil.succErrMsg("e",I18N.get("IAM.CONTACTS.ERROR.INVALID.CATEGORY.NAME")),!1)},bindLeftActions:function(data){var layerType,elem,evntType,evntObj,rowobj;data=data.zmsData,rowobj=data.rowObject,evntType=data.type,evntObj=data.eventInfo,elem=evntObj.srcElement||evntObj.target,layerType=data.rowInfo.type,"contextmenu"==evntType&&"_add"!=evntObj.currentTarget.id.substr("-4")?zmcontact.rightClickMenu(evntObj,rowobj):"click"==evntType&&"list"==layerType&&("_add"==evntObj.currentTarget.id.substr("-4")?zmcontact.showCreateCategoryPopUp({mode:"new",account_id:data.rowObject[evntObj.currentTarget.id].account_id,id:data.rowObject[evntObj.currentTarget.id].category_id},data):(ZContacts.currentCategoryId=data.eventInfo.currentTarget.id,zmcontact.loadFirstPage(zmcontact.getCategory(ZContacts.currentCategoryId))))},rightClickMenu:function(e,categoryModel){if(!e.currentTarget.id)return!1;var menuObj={clk:function(ev,data,layerId){zmcontact.bindAction(data,ev,layerId)},conArr:[]},rootFolderId=zmcontact.getRootFolderId(e.currentTarget.id.toString()),acc=ZContacts.AccountsVsRootFolderMap[rootFolderId];acc.isWritable&&(isRootFolder(e.currentTarget.id)?menuObj.conArr.push({htm:I18N.get("IAM.CONTACTS.ADD.CATEGORY"),id:"RtMenu_ADD",data:{action:"Add",category:categoryModel[e.currentTarget.id]}},{sep:!0,id:"rightMenu_lne2"}):(menuObj.conArr.push({htm:I18N.get("IAM.CONTACTS.RENAME"),id:"RtMenu_RN",data:{action:"Rename",category:categoryModel[e.currentTarget.id]}}),menuObj.conArr.push({sep:!0,id:"rightMenu_lne2"}),menuObj.conArr.push({htm:I18N.get("IAM.DELETE"),id:"RtMenu_DC",data:{action:"Delete",category:categoryModel[e.currentTarget.id]}}),menuObj.conArr.push({sep:!0,id:"rightMenu_lne2"}))),menuObj.conArr.push({htm:I18N.get("IAM.CONTACTS.EXPORT"),id:"RtMenu_EX",data:{action:"Export",category:categoryModel[e.currentTarget.id]}}),"groups"==acc.type&&(menuObj.conArr.push({sep:!0,id:"rightMenu_lne2"}),menuObj.conArr.push({htm:I18N.get("IAM.CONTACTS.MANAGE.GROUPS"),id:"RtMenu_EX",data:{action:"Manage"}})),zmsuite.showContextMenu(e,menuObj),zmUtil.stopEvents(e)},bindAction:function(data,elem){if(data){var mode=data.action;if("Manage"==mode)return zmUtil.hideMenu(),void window.open(ZContacts.meta.serviceInfo.groups_url);var categoryId=data.category.category_id,rootFolderId=zmcontact.getRootFolderId(categoryId),acc=ZContacts.AccountsVsRootFolderMap[rootFolderId];switch(mode){case"Add":zmUtil.hideMenu(),zmcontact.showCreateCategoryPopUp({mode:"new",account_id:acc.getAccountId(),id:categoryId},data);break;case"Rename":zmUtil.hideMenu(),zmcontact.showCreateCategoryPopUp({mode:"rename",account_id:acc.getAccountId(),id:$("#"+data.category.category_id).parent().children()[0].id},data,elem);break;case"Delete":zmUtil.hideMenu(),zmcontact.deletecategory(data);break;case"Export":zmUtil.hideMenu(),zmcontact.exportPopUp(zmsuite.getCenter()[0].getNodes()[2],data.category);break;default:zmUtil.hideMenu()}}},bindHeaderIcons:function(ev,iconName){var elem=ev.srcElement||ev.target,menuNode=zmsuite.getCenter()[0].getNodes()[0],contactsNode=zmsuite.getCenter()[0].getNodes()[2];switch(iconName){case"msi-uncheck zcs-check":zmcontact.chkAll(elem);break;case"msi-uncheck msi-partcheck zcs-check":case"msi-check zcs-check":zmcontact.unChkAll(elem);break;case"msi-sort":zmUtil.hideMenu(),menuNode.$el.find(".msi-sort").closest("b").addClass("SC_ddn");var listObj={},fnameTick="",lnameTick="";"fname"==ZContacts.sortBy?fnameTick="class='msi-tick'":lnameTick="class='msi-tick'";var list=[{htm:"<i "+fnameTick+"></i>"+I18N.get("IAM.CONTACTS.FIRSTNAME"),data:{action:"fname"}},{sep:!0,id:"rightMenu_lne2"},{htm:"<i "+lnameTick+"></i>"+I18N.get("IAM.CONTACTS.LASTNAME"),data:{action:"lname"}}];listObj.par=menuNode.$el.find(".msi-sort").closest("li"),listObj.defaultclass=!0,listObj.parWidth=!0,listObj.onHide=function(){menuNode.$el.find(".msi-sort").closest("b").removeClass()},listObj.list=list,listObj.clk=function(data,elem){"msi-tick"!=$(elem).find("i").attr("class")&&($(elem).parent().find(".msi-tick").removeClass("msi-tick"),$(elem).find("i").addClass("msi-tick"),ZContacts.sortBy=data.action,zmcontact._loadContacts(zmcontact.getCategory(ZContacts._currentCategoryId),!0)),zmUtil.hideMenu(),menuNode.$el.find(".msi-action").closest("b").removeClass()},zmsuite.showMenu(listObj);break;case"msi-contactMerge":var noOfContactsSelected=contactsNode.$el.find(".zmL.SC_cont.SC_check").length;if(2>noOfContactsSelected||noOfContactsSelected>5)zmUtil.succErrMsg("e",formatMessage(I18N.get("IAM.CONTACTS.ERROR.SELECT.LIMIT"),5)),zmcontact.unChkAll(),ev.stopPropagation();else{var contactIds=zmcontact.getSelectedContactIds(zmsuite.getCenter()[0].getNodes()[2].$el);contactIds&&zmcontact.showMergeUI(contactIds,!0)}break;case"msi-action":zmUtil.hideMenu(),menuNode.$el.find(".msi-action").closest("b").addClass("SC_ddn");var listObj={},list=[];list.push({htm:I18N.get("IAM.CONTACTS.EXPORT"),data:{action:"export"}}),ZContacts.getCurrentAccount().isWritable&&(list.push({htm:I18N.get("IAM.CONTACTS.IMPORT"),data:{action:"import"}}),list.push({htm:I18N.get("IAM.CONTACTS.RESET.CONTACTS"),data:{action:"reset"}}),list.push({htm:I18N.get("IAM.CONTACTS.CLEAN.DUPLICATES"),data:{action:"clean_dupes"}})),listObj.par=menuNode.$el.find(".msi-action").closest("li"),listObj.defaultclass=!0,listObj.parWidth=!0,listObj.onHide=function(){menuNode.$el.find(".msi-action").closest("b").removeClass()},listObj.list=list,listObj.clk=function(data){if("import"==data.action){if(zmsuite.isWorkspaceAvailable(ZContacts.ZMailConstants.IMPORT_APP_ID)){zmUtil.hideMenu(),$("#impcont").replaceWith($("#impcont").val("").clone(!0));var contactImport=new ZContacts.contactimport;return contactImport.createPageContent(getHtmlForImport()),void zmsuite.showWorkSpace(ZContacts.ZMailConstants.IMPORT_APP_ID)}var importTabObj={appname:I18N.get("IAM.CONTACTS.IMPORT.CONTACTS"),appId:ZContacts.ZMailConstants.IMPORT_APP_ID,appIcon:"msi-edit",searchPlaceHolder:I18N.get("IAM.CONTACTS.SEARCH.CONTACTS"),data:{CNodes:"3"}};zmsuite.setWorkSpace(importTabObj),zmsuite.showWorkSpace(ZContacts.ZMailConstants.IMPORT_APP_ID);var workspaceCenter=zmsuite.getCenter(ZContacts.ZMailConstants.IMPORT_APP_ID),centerNodes=workspaceCenter[0].getNodes();centerNodes[0].push([]);var headerObj={left:{leftHTML:I18N.get("IAM.CONTACTS.IMPORT.CONTACTS")},right:[]};centerNodes[1].push(headerObj);var headericon={left:[],right:[{actionArr:[{iconList:["msi-close"],tooltip:I18N.get("IAM.CONTACTS.CLOSE.TAB")}]}]};centerNodes[0].push(headericon),centerNodes[0].setListener("click",function(ev,iconName){"msi-close"==iconName&&zmsuite.closeWorkspace("zm_ImportContact")});var listingCenter=centerNodes[2],$containerDiv=$("<div>").addClass("SC_import").width("1080px"),contactImport=new ZContacts.contactimport;ZContacts.contactimport.$containerElem=$containerDiv,contactImport.createPageContent(getHtmlForImport()),listingCenter.$el.append($containerDiv),listingCenter.$el.addClass("zcs-import-form"),zmsuite.renderWorkSpace()}if("export"==data.action&&zmcontact.exportPopUp(contactsNode),"reset"==data.action){var rootFolderId=zmcontact.getRootFolderId(),arg=ZContacts._countObj[rootFolderId].c,msg=rootFolderId==ZContacts.ZMailConstants.VIEW_ID_ORG_CONTACTS?formatMessage(I18N.get("IAM.ERROR.SURE.RESETALL.CONTACTS.ORG"),arg):rootFolderId.substr(0,ZContacts.ZMailConstants.VIEW_ID_GRP_CONTACTS.length)==ZContacts.ZMailConstants.VIEW_ID_GRP_CONTACTS?formatMessage(I18N.get("IAM.ERROR.SURE.RESETALL.CONTACTS.GROUP"),arg,ZContacts.getCurrentAccount().getName()):formatMessage(I18N.get("IAM.ERROR.SURE.RESETALL.CONTACTS.PERSONAL"),arg);zmsDialog.confirm(msg,{onOk:function(){zmcontact.deleteAllContacts();var category=zmcontact.getCategory(ZContacts._currentCategoryId);zmcontact.updateCountInCategories(category,0,!1),zmcontact.updateHeaderBand(category)}})}"clean_dupes"==data.action&&new URI(ZContacts.ContactsDuplicates,ZContacts.getCurrentAccount().getAccountId()).GETS().then(function(contacts){if(!contacts.length)return void zmUtil.succErrMsg("e",I18N.get("IAM.CONTACTS.NO.DUPES.FOUND"));if(zmsuite.isWorkspaceAvailable(ZContacts.ZMailConstants.CLEAN_WORKSPACE_APP_ID))zmsuite.showWorkSpace(ZContacts.ZMailConstants.CLEAN_WORKSPACE_APP_ID);else{var contactsTabObj2={appname:I18N.get("IAM.CONTACTS.CLEAN.DUPLICATES"),appId:ZContacts.ZMailConstants.CLEAN_WORKSPACE_APP_ID,appIcon:"msi-contactMerge",searchPlaceHolder:I18N.get("IAM.CONTACTS.CLEAN.DUPLICATES"),data:{CNodes:"3"}};zmsuite.setWorkSpace(contactsTabObj2),zmsuite.showWorkSpace(ZContacts.ZMailConstants.CLEAN_WORKSPACE_APP_ID)}var workspaceCenter=zmsuite.getCenter(ZContacts.ZMailConstants.CLEAN_WORKSPACE_APP_ID),centerNodes=workspaceCenter[0].getNodes();centerNodes[0].push([]);var headerObj={left:{leftHTML:I18N.get("IAM.CONTACTS.CLEAN.DUPLICATES")},right:[]};centerNodes[1].push(headerObj);var headericon={left:[],right:[{actionArr:[{iconList:["msi-close"],tooltip:I18N.get("IAM.CONTACTS.CLOSE.TAB")}]}]};centerNodes[0].push(headericon),centerNodes[0].setListener("click",function(ev,iconName){"msi-close"==iconName&&zmsuite.closeWorkspace(ZContacts.ZMailConstants.CLEAN_WORKSPACE_APP_ID)});centerNodes[2];zmcontact.unChkAll();var isCleanDupes=!0;zmcontact.contactsList(contacts,!1,isCleanDupes),zmsuite.renderWorkSpace()}),$("#zm_dropDown").hide(),menuNode.$el.find(".msi-action").closest("b").removeClass()},zmsuite.showMenu(listObj);break;case"msi-trash":var contactIds=zmcontact.getSelectedContactIds(contactsNode.$el);zmcontact.deleteMultiContacts(contactIds);break;case"msi-folder":zmcontact.addTo(menuNode.$el.find(".msi-folder").closest("li"),"move");break;case"msi-clearContacts":var msg,selectedContactIds=zmcontact.getSelectedContactIds(contactsNode.$el),categoryId=ZContacts._currentCategoryId;msg=1==selectedContactIds.length?formatMessage(I18N.get("IAM.CONTACTS.SURE.REMOVE.FROM.CATEGORY"),$("#"+selectedContactIds[0]).get(0).__zc_contact.getFullName().trim()):formatMessage(I18N.get("IAM.CONTACTS.SURE.REMOVE.THESE.FROM.CATEGORY"),selectedContactIds.length),zmsDialog.confirm(msg,{onOk:function(){new URI(ZContacts.ContactsCategories,ZContacts.getCurrentAccount().getAccountId(),selectedContactIds,categoryId).DELETE().then(function(resp){var elem,loadedCntDetail=$("div[data-field-type=zcs-cnt-view]"),selectedCount=selectedContactIds.length,category=zmcontact.getCategory(categoryId);if(204==resp.status_code){for(var i=0;i<selectedContactIds.length;i++){elem=$("#"+selectedContactIds[i]);var nextElem;if(!elem.next().length&&!elem.prev().length)return zmcontact.updateCountInCategories(category,-selectedCount,!0),zmcontact._loadContacts(category),zmcontact.unChkAll(),void zmcontact.updateHeaderBand(category);elem.next().length?nextElem=elem.next():(nextElem=$($(".zmL.SC_cont")[0]),zmcontact.initScroll($(zmsuite.getCenter()[0].getNodes()[2].$el.children()[0]),nextElem,elem)),elem.remove()}nextElem.click(),zmcontact.updateCountInCategories(category,-selectedCount,!0),zmcontact.unChkAll(),zmcontact.updateHeaderBand(category),"zcs-cnt-view"!=loadedCntDetail.attr("data-field-type")&&zmcontact.loadContactDetails($("div[data-field-type=zcs-cnt-view]")[0].id),zmUtil.succErrMsg("s",ZContacts.I18N.get("IAM.CONTACTS.REMOVED.FROM.CATEGORY"))}else zmUtil.succErrMsg("e",ZContacts.I18N.get("IAM.ERROR.GENERAL"))})}});break;case"msi-mail":var selectedMailIds=zmcontact.getSelectedMailIds(contactsNode.$el).toString();if(selectedMailIds.split(",").length>100)return void zmUtil.succErrMsg("e",formatMessage(ZContacts.I18N.get("IAM.CONTACTS.ERROR.EMAIL.LIMIT.SEND"),100));zmcontact.sendMail(selectedMailIds)}},sendMail:function(mailIds){if(zmail.forContactsApp){var mailBoxExist=zmail.isMailBoxExist;if(mailBoxExist){var url=zmail.urls.mailToUrl.replace(/&amp;/g,"&").replace(/&equals;/g,"=");return void zmcontact.wopen(url+mailIds,80,77).focus()}window.location.href="mailto:"+mailIds.split(",").join(";")}else zmUtil.compose({TO:mailIds})},wopen:function(url,wd,ht,name){var nW=parseInt(wd*screen.width/100),nH=parseInt(ht*screen.height/100),l=(screen.width-nW)/2,t=(screen.height-nH)/2;return name=name?name:(new Date).getTime(),window.open(url,name,"height="+nH+", width="+nW+",status=yes,toolbar=no,top="+t+", left="+l+", menubar=no,location=no,scrollbars=yes,resizable=yes")},exportPopUp:function(contactsNode,category){var noOfContactsSelected=contactsNode.$el.find(".zmL.SC_cont.SC_check").length,contactIdsArr=zmcontact.getSelectedContactIds(zmsuite.getCenter()[0].getNodes()[2].$el),exportDiv={};if(exportDiv.title=I18N.get("IAM.CONTACTS.EXPORT.CONTACTS"),exportDiv.mask=!0,exportDiv.buttons=[{txt:I18N.get("IAM.CONTACTS.EXPORT.CONTACTS"),selected:!0,callback:function(){var categoryId,account_id=ZContacts.getCurrentAccount().getAccountId();if(category){categoryId=category.category_id.toString();var rootFolderId=zmcontact.getRootFolderId(categoryId);account_id=ZContacts.AccountsVsRootFolderMap[rootFolderId].getAccountId()}zmcontact.exportContacts(account_id,contactIdsArr,categoryId)}},{isCancel:!0,txt:I18N.get("IAM.CANCEL"),callback:function(){zmsDialog.remove(),$("#zcs_exportPopup").remove()}}],exportDiv.closeaction=function(){zmsDialog.remove(),$("#zcs_exportPopup").remove()},exportDiv.pos="center",createFolElem=$("<div id='zcs_exportPopup'></div>"),!$("#zcs_exportPopup").length){var tags="<div class='SC_tdtl'>";if(noOfContactsSelected)tags=tags+"<div class='SC_flt SC_fst' style='padding-top: 6px;'><ul><li><b>"+formatMessage(I18N.get("IAM.CONTACTS.OF.SELECTED"),noOfContactsSelected)+"</b></li></ul></div>";else if(category){var categoryId=category.category_id,rootFolderId=zmcontact.getRootFolderId(categoryId),name=encodeHTML(category.category_name);rootFolderId==categoryId&&(name=I18N.get("IAM.CONTACTS.ALL.CONTACTS"));var acc=ZContacts.AccountsVsRootFolderMap[rootFolderId];tags=tags+"<div class='SC_flt' style='width: 30%' id='zcs_account'><ul><li><b><input id='"+acc.getAccountId()+"' name='"+encodeHTML(acc.getName())+"' placeholder='"+encodeHTML(acc.getName())+'\' class=\'SC_tiput\' onclick=\'zmcontact.getScrollList($("#zcs_exportPopup").find("#zcs_account ul li"), "account")\' readonly=readonly></b></li></ul></div>',tags=tags+"<div class='SC_flt' style='width: 30%' id='zcs_category'><ul><li><b><input id='"+category.category_id+"' name='"+name+"'placeholder='"+name+'\' class=\'SC_tiput\' onclick=\'zmcontact.getScrollList($("#zcs_exportPopup").find("#zcs_category ul li"), "category", "'+rootFolderId+"\")' readonly=readonly></b></li></ul></div>"}else{var category=zmcontact.getCategory(ZContacts._currentCategoryId),rootFolderId=zmcontact.getRootFolderId(category.category_id),acc=ZContacts.getCurrentAccount();tags=tags+"<div class='SC_flt' style='width: 30%' id='zcs_account'><ul><li><b><input id='"+acc.getAccountId()+"' name='"+acc.getName()+"'placeholder='"+encodeHTML(acc.getName())+'\' class=\'SC_tiput\' onclick=\'zmcontact.getScrollList($("#zcs_exportPopup").find("#zcs_account ul li"), "account")\' readonly=readonly></b></li></ul></div>',tags=tags+"<div class='SC_flt' style='width: 30%' id='zcs_category'><ul><li><b><input id='"+category.category_id+"' name='"+encodeHTML(category.category_name)+"'placeholder='"+I18N.get("IAM.CONTACTS.ALL.CONTACTS")+'\' class=\'SC_tiput\' onclick=\'zmcontact.getScrollList($("#zcs_exportPopup").find("#zcs_category ul li"), "category", "'+rootFolderId+"\")' readonly=readonly></b></li></ul></div>"}tags=tags+"<div class='SC_flt' style='width: 30%;' id='zcs_format'><ul><li><b><input class='SC_tiput' placeholder='"+I18N.get("IAM.CONTACTS.EXPORT.FORMAT.CSV")+"' id='format' data-field-type='csv' style='display: inline-block;' onclick='zmcontact.getFormatList(this)' readonly=readonly></b></li></ul></div></div>",createFolElem.append(tags),$(document.body).append(createFolElem)}zmsDialog.create("zcs_exportPopup",exportDiv),$("#zcs_exportPopup").parents(".SC_pe").on("click",function(e){e.stopPropagation()}),$("#zcs_exportPopup").parents(".SC_Pop").on("click",function(){this.remove()})},exportContacts:function(account_id,contactIdsArr,categoryId){var form=document.createElement("form"),format=$("#zcs_format input")[0].getAttribute("data-field-type").trim(),formatEle=document.createElement("input");formatEle.setAttribute("name","filter_format"),formatEle.setAttribute("value",format),form.appendChild(formatEle);var uri=new URI(ZContacts.ExportContacts,account_id).requestURI;if(contactIdsArr&&contactIdsArr.length)uri+="/"+contactIdsArr.join(",");else if(categoryId||(categoryId=$("#zcs_category input")[0].id),!isRootFolder(categoryId)){var catEle=document.createElement("input");catEle.setAttribute("name","filter_categories"),catEle.setAttribute("value",categoryId),form.appendChild(catEle)}var csrfElem=document.createElement("input");csrfElem.setAttribute("value",ZContacts.Cookie.getCSRFValue()),csrfElem.setAttribute("name",ZContacts.meta.serviceInfo.csrf_param_name),form.appendChild(csrfElem),form.setAttribute("action",uri),form.setAttribute("method","get");var iframe=document.createElement("iframe");iframe.setAttribute("src",ZContacts.meta.serviceInfo.contacts_server_url+"/html/blank.html"),iframe.setAttribute("width",0),iframe.setAttribute("heigth",0),iframe.style.display="none",iframe.setAttribute("name","zcs_exportFrame"),form.target="zcs_exportFrame",form.appendChild(iframe),document.body.appendChild(form),zmcontact.unChkAll(),zmsDialog.remove(),form.submit()},getSelectedMailIds:function(ele){var mailArr=[];ele=$(ele.find(".zmL.SC_cont.SC_check"));for(var i=0;i<ele.length;i++)ele.get(i).__zc_contact.emails&&mailArr.push(ele.get(i).__zc_contact.getPrimaryEmail());return mailArr},showMergeUI:function(contactIds,isMerge){new URI(ZContacts.Contacts,ZContacts.getCurrentAccount().getAccountId(),contactIds).include("emails").include("phones").include("ims").include("address").include("urls").GET().then(function(contacts){if(!contacts[0])return zmcontact.loadFirstPage(zmcontact.getCategory(ZContacts._currentCategoryId)),void zmUtil.succErrMsg("e",ZContacts.I18N.get("IAM.ERROR.GENERAL"));var leftObj;if(!isMerge){leftObj={leftHTML:I18N.get("IAM.CONTACTS.CLEAN.DUPLICATES")};var headerObj={left:leftObj,right:[]};zmsuite.getCenter()[0].getNodes()[1].push(headerObj),zmsuite.getCenter()[0].getNodes()[1].paint()}zmcontact.showMergePage(contacts,contactIds,isMerge)})},checkFav:function(t){var $t=$(t);$t.parent(".zcs-mfield-row").siblings().find(".SC_fav").removeClass("SC_fav"),$t.addClass("SC_fav")},getFormatList:function(){var formatObj={},format=[{htm:I18N.get("IAM.CONTACTS.EXPORT.FORMAT.CSV"),data:{action:"csv"}},{htm:I18N.get("IAM.CONTACTS.EXPORT.FORMAT.VCF"),data:{action:"vcf"}},{htm:I18N.get("IAM.CONTACTS.EXPORT.FORMAT.LDIF"),data:{action:"ldif"}},{htm:I18N.get("IAM.CONTACTS.EXPORT.FORMAT.HTML"),data:{action:"html"}},{htm:I18N.get("IAM.CONTACTS.EXPORT.FORMAT.OUTLOOK.CSV"),data:{action:"outlook"}}];formatObj.list=format,formatObj.par=$("#zcs_exportPopup").find("#zcs_format ul li"),formatObj.defaultclass=!0,formatObj.parWidth=!0,formatObj.onHide=function(){},formatObj.clk=function(data){"csv"==data.action&&($("#zmsdialog_zcs_exportPopup").find("#format")[0].placeholder=I18N.get("IAM.CONTACTS.EXPORT.FORMAT.CSV")),"vcf"==data.action&&($("#zmsdialog_zcs_exportPopup").find("#format")[0].placeholder=I18N.get("IAM.CONTACTS.EXPORT.FORMAT.VCF")),"ldif"==data.action&&($("#zmsdialog_zcs_exportPopup").find("#format")[0].placeholder=I18N.get("IAM.CONTACTS.EXPORT.FORMAT.LDIF")),"html"==data.action&&($("#zmsdialog_zcs_exportPopup").find("#format")[0].placeholder=I18N.get("IAM.CONTACTS.EXPORT.FORMAT.HTML")),"outlook"==data.action&&($("#zmsdialog_zcs_exportPopup").find("#format")[0].placeholder=I18N.get("IAM.CONTACTS.EXPORT.FORMAT.OUTLOOK.CSV")),$("#zmsdialog_zcs_exportPopup").find("#format")[0].setAttribute("data-field-type",data.action),$("#zm_dropDown").hide()},zmsuite.showMenu(formatObj)},addTo:function(parentEle,operation){var contactsNode=zmsuite.getCenter()[0].getNodes()[2],contactIdsArr=zmcontact.getSelectedContactIds(contactsNode.$el),viewCategoriesList=null,config={};config.parentDOM=parentEle,config.displayAs="dropdown",config.hltPar=!0,config.offsets={left:0,top:0},config.onSelect=function(id){if(null==id)return zmcontact.unChkAll(),void viewCategoriesList.hide();var destZid=ZContacts.AccountsVsRootFolderMap[zmcontact.getRootFolderId(id)],sourceZid=ZContacts.getCurrentAccount().getAccountId(),categoryId=isRootFolder(id)?-1:id;if("move"==operation)if(sourceZid==destZid.account_id)zmcontact.addContactsToCategory(contactIdsArr,categoryId);else{var copy=ZContacts.Copy.create(),copyfrom=ZContacts.CopyFrom.create({zid:sourceZid,contact_ids:contactIdsArr}),copyto=ZContacts.CopyTo.create({zid:destZid.account_id,category_id:categoryId});copy.addSubResource(copyfrom),copy.addSubResource(copyto),new URI(ZContacts.Copy,destZid.getAccountId()).POST(copy).then(function(response){return 201==response.status_code?(zmcontact.updateCountInCategories(zmcontact.getCategory(id),contactIdsArr.length,!0),zmcontact.unChkAll(),void zmUtil.succErrMsg("s",formatMessage(ZContacts.I18N.get("IAM.CONTACTS.ADDED.TO.CATEGORY.SUCCESSFULLY"),zmcontact.getCategory(id).category_name))):void zmUtil.succErrMsg("s",I18N.get("IAM.ERROR.GENERAL"))},function(json){zmUtil.succErrMsg("e",ZContacts.getMessageFromResponse(json))})}viewCategoriesList.hide()};config.dataCallback=function(){var cat=[];if(ZContacts.getCurrentAccount().isWritable){cat.push({display_text:encodeHTML(ZContacts.getCurrentAccount().name+"/"),tooltip:encodeHTML(ZContacts.getCurrentAccount().name+"/")});var cate=ZContacts._parentObj[ZContacts.getCurrentAccount().getRootFolderId()];if(cate)for(var i=0;i<cate.length;i++){var display="/"+cate[i].category_name+"/";if(display.length>20)var displayText=".../"+cate[i].category_name.substring(0,19)+"...";else var displayText=ZContacts.getCurrentAccount().name+"/"+cate[i].category_name+"/";cat.push({id:cate[i].category_id,name:cate[i].encrypt_cat_id,display_text:encodeHTML(displayText),tooltip:encodeHTML(ZContacts.getCurrentAccount().name+"/"+cate[i].category_name+"/")})}}for(var i=0;i<ZContacts.AccountsList.length;i++)if(ZContacts.AccountsList[i].id!=ZContacts.getCurrentAccount().account_id){var rootFolderId=ZContacts.AccountsVsRootFolderMap[ZContacts.AccountsList[i].id],acc=ZContacts.AccountsVsRootFolderMap[rootFolderId];acc.isWritable&&cat.push({id:ZContacts.AccountsVsRootFolderMap[ZContacts.AccountsList[i].id],display_text:encodeHTML(ZContacts.AccountsList[i].name+"/"),tooltip:encodeHTML(ZContacts.AccountsList[i].name+"/")})}return cat},viewCategoriesList=zmUtil.createFLComp("generic",config),viewCategoriesList.show()},getScrollList:function(parentEle,operation,rootFolderId){var contactsNode=zmsuite.getCenter()[0].getNodes()[2],viewCategoriesList=(zmcontact.getSelectedContactIds(contactsNode.$el),null),config={};config.parentDOM=parentEle,config.displayAs="dropdown",config.hltPar=!0,config.offsets={left:0,top:0},config.onSelect="account"!=operation?function(id,elem){"category"==operation&&id&&$("#zcs_category").find("input").attr({id:id,placeholder:elem.display_text,name:elem.name}),viewCategoriesList.hide()}:function(id){var rootFolderId=ZContacts.AccountsVsRootFolderMap[id],acc=ZContacts.AccountsVsRootFolderMap[rootFolderId];$("#zcs_account").find("input").attr({id:id,name:encodeHTML(acc.name),placeholder:encodeHTML(acc.name)});var onclickValue='zmcontact.getScrollList(this, "category", "'+rootFolderId+'")';$("#zcs_category").find("input").attr({onclick:onclickValue,id:ZContacts.AccountsVsRootFolderMap[id],name:I18N.get("IAM.CONTACTS.ALL.CONTACTS"),placeholder:I18N.get("IAM.CONTACTS.ALL.CONTACTS")}),viewCategoriesList.hide(),zmcontact.fetchCategoriesFromDb(rootFolderId)},config.dataCallback=function(){return"account"==operation?ZContacts.AccountsList:zmcontact.getCategoriesList(rootFolderId,operation)},viewCategoriesList=zmUtil.createFLComp("generic",config),viewCategoriesList.show()},getCategoriesList:function(categoryId,operation){var cat=[];categoryId||(categoryId=ZContacts._currentCategoryId);var rootFolderId=zmcontact.getRootFolderId(categoryId);"category"==operation&&cat.push({id:rootFolderId,name:ZContacts.AccountsVsRootFolderMap[rootFolderId].getName(),display_text:I18N.get("IAM.CONTACTS.ALL.CONTACTS")});var cate=ZContacts._parentObj[rootFolderId];if(cate)for(var i=0;i<cate.length;i++)cat.push({id:cate[i].category_id,name:cate[i].encrypt_cat_id,display_text:encodeHTML(cate[i].category_name)});return 0==cat.length&&cat.push({display_text:I18N.get("IAM.CONTACTS.NO.CATEGORIES")}),cat},addContactsToCategory:function(contactIdsArr,categoryId){if(!isRootFolder(categoryId)){var contactIds=contactIdsArr.join(",");new URI(ZContacts.ContactsCategories,ZContacts.getCurrentAccount().getAccountId(),contactIds,categoryId).POST(ZContacts.ContactsCategories.create({})).then(function(response){if(200==response.status_code){var oldCat=zmcontact.getCategory(categoryId);new URI(ZContacts.Categories,ZContacts.getCurrentAccount().getAccountId(),categoryId).include("contacts.total_count").GET().then(function(json){var count=json.get("contacts_count");ZContacts._countObj[categoryId]||(ZContacts._countObj[categoryId]={c:count,p:ZContacts.AccountsVsRootFolderMap[ZContacts.getCurrentAccount().getAccountId()]});var category=zmcontact.getCategory(categoryId);zmcontact.updateCountInCategories(category,count,!1),categoryId==ZContacts._currentCategoryId&&zmcontact.loadFirstPage(zmcontact.getCategory(ZContacts._currentCategoryId)),zmUtil.succErrMsg("s",formatMessage(ZContacts.I18N.get("IAM.CONTACTS.ADDED.TO.CATEGORY.SUCCESSFULLY"),oldCat.get("category_name")))})}else zmUtil.succErrMsg("e",I18N.get("IAM.ERROR.GENERAL"))},function(){zmUtil.succErrMsg("e",I18N.get("IAM.ERROR.GENERAL"))})}zmcontact.unChkAll()},deleteMultiContacts:function(contactIds){if(""==contactIds)return void zmUtil.succErrMsg("e",I18N.get("IAM.CONTACTS.NO.CONTACTS"));if(1==contactIds.length)return void zmcontact.deleteSingleContact(contactIds,$("#"+contactIds).get(0).__zc_contact.getFullName().trim());var msg,rootFolderId=zmcontact.getRootFolderId(ZContacts._currentCategoryId);rootFolderId==ZContacts.ZMailConstants.VIEW_ID_ALL_CONTACTS?msg=formatMessage(I18N.get("IAM.CONTACTS.SURE.DELETE.THESE"),contactIds.length):rootFolderId==ZContacts.ZMailConstants.VIEW_ID_ORG_CONTACTS?msg=formatMessage(I18N.get("IAM.CONTACTS.SURE.DELETE.CONTACTS.ORG"),contactIds.length):rootFolderId.substr(0,ZContacts.ZMailConstants.VIEW_ID_GRP_CONTACTS.length)==ZContacts.ZMailConstants.VIEW_ID_GRP_CONTACTS&&(msg=formatMessage(I18N.get("IAM.CONTACTS.SURE.DELETE.CONTACTS.GROUP"),contactIds.length,ZContacts.getCurrentAccount().getName())),zmsDialog.confirm(msg,{onOk:function(){zmcontact.deleteContact(contactIds),zmcontact.unChkAll()}})},deleteSingleContact:function(contactId,name){var msg,rootFolderId=zmcontact.getRootFolderId(ZContacts._currentCategoryId);rootFolderId==ZContacts.ZMailConstants.VIEW_ID_ALL_CONTACTS?msg=formatMessage(I18N.get("IAM.CONTACTS.CONFIRM.DELETE.SINGLE.CONTACT"),name):rootFolderId==ZContacts.ZMailConstants.VIEW_ID_ORG_CONTACTS?msg=formatMessage(I18N.get("IAM.ERROR.SURE.RESETONE.CONTACTS.ORG"),name):rootFolderId.substr(0,ZContacts.ZMailConstants.VIEW_ID_GRP_CONTACTS.length)==ZContacts.ZMailConstants.VIEW_ID_GRP_CONTACTS&&(msg=formatMessage(I18N.get("IAM.ERROR.SURE.RESETONE.CONTACTS.GROUP"),name,ZContacts.getCurrentAccount().getName())),zmsDialog.confirm(msg,{onOk:function(){contactId=contactId.toString().split(","),zmcontact.deleteContact(contactId)}})},deleteAllContacts:function(){zmcontact._deleteContacts("reset")},deleteContact:function(contactId){contactId&&zmcontact._deleteContacts(contactId)},_deleteContacts:function(param){new ZContacts.URI(ZContacts.Contacts,ZContacts.getCurrentAccount().getAccountId(),param).DELETE().then(function(response){if(204==response.status_code)if(zmcontact.refreshContactCounts(),zmTab.currentTab==ZContacts.ZMailConstants.SEARCH_WORKSPACE_APP_ID){var searchRequest=new zmContactsSearch.contactsCollection;searchRequest.sendRequest(zmcontact.searchValue),zmUtil.succErrMsg("s",I18N.get("IAM.CONTACTS.ERROR.DELETE.SUCCESS"))}else if("reset"==param)zmcontact._loadContacts(zmcontact.getCategory(ZContacts._currentCategoryId)),zmUtil.succErrMsg("s",I18N.get("IAM.CONTACTS.ERROR.DELETE.SUCCESS"));else{var elem=$(zmsuite.getCenter()[0].$el.find("div[data-field-type=zcs-cnt-view]")[0]);if(zmTab.currentTab==ZContacts.ZMailConstants.CONTACTS_APP_ID){var deletingElem=$("#"+param[param.length-1]);deletingElem.length&&(elem=deletingElem)}if(elem){var noOfRowsDelete,noOfRow;if(noOfRow=zmsuite.getCenter()[0].$el.find(".zmL.SC_cont"),noOfRowsDelete=zmTab.currentTab==ZContacts.ZMailConstants.CLEAN_WORKSPACE_APP_ID?1:param.length,noOfRow.length==noOfRowsDelete)zmcontact._loadContacts(zmcontact.getCategory(ZContacts._currentCategoryId)),zmTab.currentTab==ZContacts.ZMailConstants.CLEAN_WORKSPACE_APP_ID&&zmsuite.closeWorkspace(ZContacts.ZMailConstants.CLEAN_WORKSPACE_APP_ID);else{zmTab.currentTab==ZContacts.ZMailConstants.CLEAN_WORKSPACE_APP_ID&&zmcontact._loadContacts(zmcontact.getCategory(ZContacts._currentCategoryId));var nextElem;$.each(param,function(key,value){$("#"+value).remove()}),$(elem).next().length?nextElem=$(elem).next():(nextElem=$(zmsuite.getCenter()[0].$el.find(".zmL.SC_cont")[0]),zmcontact.initScroll($(zmsuite.getCenter()[0].getNodes()[2].$el.children()[0]),nextElem,elem)),$(nextElem).click(),elem.remove()}}zmUtil.succErrMsg("s",I18N.get("IAM.CONTACTS.ERROR.DELETE.SUCCESS"))}else zmUtil.succErrMsg("e",I18N.get("IAM.ERROR.GENERAL"))})},getSelectedContactIds:function(elem){for(var contactIdsArr=[],i=0;i<elem.find(".zmL.SC_cont.SC_check").length;i++)contactIdsArr.push(elem.find(".zmL.SC_cont.SC_check")[i].id);return contactIdsArr},constructCenter:function(){var centerNodes=zcon.contactsCenter[0].getNodes();centerNodes[0].push(zmcontact.getActionMenuList()),centerNodes[0].setListener("click",function(event,iconName){zmcontact.bindHeaderIcons(event,iconName)}),centerNodes[2].setListener("click",function(event){zmcontact.bindEventsContactsRow(event)}),centerNodes[2].setListener("contextmenu",function(){}),zmsuite.renderCenter()},chkAll:function(elem){var centerNode=zmsuite.getCenter()[0].getNodes();if(!centerNode[2].$el.find(".zcs-contDup-row").length&&centerNode[2].$el.find(".zmL.SC_cont").length){centerNode[0].hideGroup("sort"),$(elem).hasClass("msi-uncheck")||(elem=$(elem).find(".msi-uncheck")),$(elem).attr("class","msi-check zcs-check"),$(".SC_conLft .zmL.SC_cont").addClass("SC_check"),centerNode[2].$el.find(".msi-uncheck").removeClass("msi-uncheck").addClass("msi-check");var selectedCount=$(".SC_check").length;zmcontact.updateHeaderBand(zmcontact.getCategory(ZContacts._currentCategoryId),selectedCount,!1),selectedCount&&(centerNode[0].showGroup("mail"),centerNode[0].showGroup("addto")),ZContacts.getCurrentAccount().isWritable&&(selectedCount&&(centerNode[0].showGroup("delete"),isRootFolder()||centerNode[0].showGroup("clearcategory")),selectedCount>1?centerNode[0].showGroup("merge"):centerNode[0].hideGroup("merge"))}},unChkAll:function(){var centerNode=zmsuite.getCenter()[0].getNodes();centerNode[0].$el.find(".msi-partcheck").removeClass().addClass("msi-uncheck zcs-check"),centerNode[0].$el.find(".msi-check").removeClass().addClass("msi-uncheck zcs-check"),centerNode[2].$el.find(".SC_check").removeClass("SC_check"),centerNode[2].$el.find(".msi-check").removeClass("msi-check").addClass("msi-uncheck"),zmcontact.updateHeaderBand(zmcontact.getCategory(ZContacts._currentCategoryId),0,!1),centerNode[0].hideGroup("delete"),centerNode[0].hideGroup("mail"),centerNode[0].hideGroup("addto"),centerNode[0].hideGroup("clearcategory"),centerNode[0].hideGroup("merge"),ZContacts._countObj[ZContacts._currentCategoryId].c>1&&zmTab.currentTab!=ZContacts.ZMailConstants.SEARCH_WORKSPACE_APP_ID?centerNode[0].showGroup("sort"):centerNode[0].hideGroup("sort")},deletecategory:function(data){var category_id=data.category.category_id,account_id=zmcontact.getAccByCategoryId(zmcontact.getRootFolderId(category_id)).getAccountId(),rowObj={};rowObj[category_id]=data.category,zmsDialog.confirm(I18N.get("IAM.CONTACTS.ERROR.SURE.DLT.CATEGORY"),{onOk:function(){new URI(ZContacts.Categories,account_id,category_id).DELETE().then(function(){zmUtil.succErrMsg("s",I18N.get("IAM.CONTACTS.ERROR.DLTCATGRY.SUCCESS"));for(var rootFolderId=zmcontact.getRootFolderId(category_id),listObj=ZContacts._parentObj[rootFolderId],catArr=[],i=0;i<listObj.length;i++){var cat=listObj[i];cat.category_id!=category_id&&catArr.push(cat)}ZContacts._parentObj[rootFolderId]=[],ZContacts._parentObj[rootFolderId]=catArr,delete ZContacts._countObj[category_id],delete ZContacts._childObj[rootFolderId].CH[category_id],zmcontact.loadFirstPage(zmcontact.getCategory(rootFolderId)),zmcontact.getCategoriesListLayer(rootFolderId).deleteNode(rowObj,rootFolderId)},function(json){zmUtil.succErrMsg("e",ZContacts.getMessageFromResponse(json))})}})},getAccByCategoryId:function(categoryId){return categoryId=zmcontact.getRootFolderId(categoryId),ZContacts.AccountsVsRootFolderMap[categoryId]},bindEventsContactsRow:function(evt){var clsNme,$listRow,contact,tEle=evt.target||$tEle;$tEle=$(tEle),clsNme=$tEle.attr("class")||"",$listRow=$(tEle).closest(".zmL"),$(evt.target).hasClass("SC_cont")||($tEle=$(evt.target).parents(".SC_cont")),$tEle.length&&!$tEle.hasClass("zmSLst")&&($(".SC_cont.zmSLst").removeClass("zmSLst"),$tEle.addClass("zmSLst"),$listRow.size()>0&&(contact=$listRow.get(0).__zc_contact,zmcontact.loadContactDetails(contact.get("contact_id"))))},contactsList:function(contacts,isNextPage,isCleanDupes){var menuNode;zmTab.currentTab==ZContacts.ZMailConstants.SEARCH_WORKSPACE_APP_ID||zmTab.currentTab==ZContacts.ZMailConstants.CONTACTS_APP_ID?menuNode=zmsuite.getWorkSpace(ZContacts.ZMailConstants.CONTACTS_APP_ID)[0]:zmTab.currentTab==ZContacts.ZMailConstants.CLEAN_WORKSPACE_APP_ID&&(menuNode=zmsuite.getCenter()[0].getNodes()[0]);var cntElem=$(zmcontact.constructContactsRow(contacts,isCleanDupes)),listElem=zmsuite.getCenter()[0].getNodes()[2].$el[0];if(!(zmTab.currentTab==ZContacts.ZMailConstants.SEARCH_WORKSPACE_APP_ID||contacts&&contacts.length))return void $(zcon.contactsCenter.listElem).html('<div class="SC_nmsg">'+I18N.get("IAM.CONTACTS.NO.CONTACTS")+"</div>");if(isCleanDupes){zmcontact.unChkAll();var div="<div class='SC_conLft' id='zcs_conLft'></div><div class='SC_conRgt' id='zcs_conRgt'><div class='zcs-cont-details'></div><div class='zcs-cont-edit zcs-editor-form'></div></div>";return $(listElem).html(div),$(listElem).find(".SC_conLft").html(cntElem),void $(listElem).find(".SC_conLft").children()[0].click()}if(isNextPage)contacts&&contacts.length>0&&(1==menuNode.$el.find(".msi-check").length&&menuNode.$el.find(".msi-check").removeClass().addClass("msi-uncheck msi-partcheck zcs-check"),$(zcon.contactsCenter.listElem).find(".SC_conLft").append(cntElem));else if(zmTab.currentTab==ZContacts.ZMailConstants.SEARCH_WORKSPACE_APP_ID){if(zmcontact.unChkAll(),!(contacts&&contacts.length>0))return void $(listElem).html('<div class="SC_nmsg">'+I18N.get("IAM.CONTACTS.NO.CONTACTS")+"</div>");var div="<div class='SC_conLft'></div><div class='SC_conRgt' id='zcs_srch'><div class='zcs-cont-details'></div><div class='zcs-cont-edit zcs-editor-form'></div></div>";$(listElem).html(div),$(listElem).find(".SC_conLft").html(cntElem),$(listElem).find(".SC_conLft").children()[0].click()}else $(zcon.contactsCenter.listElem).find(".SC_conLft").html(cntElem),$(zcon.contactsCenter.listElem).find(".SC_conLft").children()[0].click();$("#ms_load").remove(),$(zcon.contactsCenter.listElem).children(".SC_conLft").unbind("scroll").bind("scroll",function(){isCleanDupes||zmcontact.scrollDownContacts()})},showQuickCreate:function(elem){return ZContacts.getCurrentAccount().isWritable?void zmcontact.utilQuickCreate(elem):void zmsDialog.alert(I18N.get("IAM.CONTACTS.ERROR.WRITE.OPERATION.NOT.ALLOWED"))},utilQuickCreate:function(){var posElem=$(".zm_compose"),posOffset=posElem.offset(),posTop=posOffset.top+"px",posLeft=posOffset.left+posElem.width()+"px";if(zmsuite.isWorkspaceAvailable("zm_createContact"))return void zmsuite.showWorkSpace("zm_createContact");var contactEditor=new ZContacts.ContactEditor(!0),editorActions={save:function(t){var contact=contactEditor.toContactsModel(ZContacts.Contacts.create());if(contact){var elem;elem=t?$(t.currentTarget.parentElement):this.$e.find(".SC_PUbtm"),zmcontact.restrictClick(elem,!0);var container,type;$("#zcs_loading").length||(contactEditor.quickCreate?($("#zmsdialog_zc_contactpopup").prepend("<div id='zcs_loading' style='padding-bottom: 10px;' ></div>"),type="listing"):($(".SC_PUbtm").append("<div id='zcs_loading'></div>"),type="pagination")),container=$("#zcs_loading").get(0);var destroyLoadingDiv=zmComponent.loadingBand({container:container,type:type});new URI(ZContacts.Contacts,ZContacts.getCurrentAccount().getAccountId()).POST(contact).then(function(json){$(".SC_PUbtm").removeAttr("disabled"),destroyLoadingDiv(),contactEditor.quickCreate?zmsDialog.remove():zmsuite.showWorkSpace("zm_Contacts"),zmcontact.constructCenter();var currentCategory=zmcontact.getCategory(ZContacts._currentCategoryId);if(isRootFolder())zmUtil.succErrMsg("s",I18N.get("IAM.CONTACTS.ERROR.ADDED.SUCCESS")),zmcontact.updateCountInCategories(currentCategory,1,!0),zmcontact.loadFirstPage(currentCategory);else{var contactIdsArr=[];contactIdsArr.push(json.contacts.contact_id),zmcontact.addContactsToCategory(contactIdsArr,ZContacts._currentCategoryId);var rootFolderId=zmcontact.getRootFolderId(ZContacts._currentCategoryId),rootFolderCategory=zmcontact.getCategory(rootFolderId);zmcontact.updateCountInCategories(rootFolderCategory,1,!0)}contactEditor.quickCreate||zmsuite.closeWorkspace("zm_createContact")},function(json){$(".SC_PUbtm").removeAttr("disabled"),destroyLoadingDiv(),zmUtil.succErrMsg("e",ZContacts.getMessageFromResponse(json))})}},cancel:function(){$(".SC_PUbtm").removeAttr("disabled"),contactEditor.quickCreate?zmsDialog.remove():zmsuite.closeWorkspace("zm_createContact")}};contactEditor.setOptions({actions:editorActions});var tit=I18N.get("IAM.CONTACTS.ADD.CONTACT")+" - ("+ZContacts.getCurrentAccount().getName()+")",popOpt={title:tit,posParent:{top:posTop,left:posLeft},buttons:[{txt:I18N.get("IAM.SAVE"),selected:!0,callback:editorActions.save},{isCancel:!0,txt:I18N.get("IAM.CANCEL"),callback:editorActions.cancel}],afterDisplay:function(){$("#zc_contactpopup").find('[data-field-type="first_name"]')[0].focus()}};$("#zc_contactpopup").remove(),$(document.body).append('<div id="zc_contactpopup" class="SC_p10"></div>'),zmsDialog.create("zc_contactpopup",popOpt),contactEditor.render($("#zc_contactpopup")),$("#zmsdialog_zc_contactpopup").mousedown(function(ev){zmUtil.stopEvents(ev,!0)}),$("#zmsdialog_zc_contactpopup").keypress(function(e){13==e.which&&$(this).find(".sel")[0].click()})},scrollDownContacts:function(){var listElem=$(zcon.contactsCenter.listElem).children(".SC_conLft"),PAGINATE_SCROLL_PERCENT=98,currentScrollPercent=Math.round(100*(listElem[0].scrollTop+listElem.height())/listElem[0].scrollHeight);currentScrollPercent>=PAGINATE_SCROLL_PERCENT&&!listingMetaData.isLoading&&zmcontact.loadNextPage(zmcontact.getCategory(ZContacts._currentCategoryId))},constructContactsRow:function(contacts,isCleanDupes){for(var fragment=document.createDocumentFragment(),i=0;i<contacts.length;i++){var contact=contacts[i];fragment.appendChild(zmcontact.getContactRowElement(contact,isCleanDupes).get(0))}return fragment},setAccountPhoto:function(t,contact_id){doAllowClick($(t))&&(zmcontact.restrictClick($("#zcs_uploadPopup").parent().siblings(".SC_PUbtm").children("span"),!0),zmcontact.restrictClick($(t),!0),zmcontact.uploadPhoto(contact_id+""))},setPhotoPath:function(value){value&&""!=value?(value.length>20&&(value=value.substring(0,17)+"..."),$("#zcs_choose_desktop").html(value)):$("#zcs_choose_desktop").html(I18N.get("IAM.CONTACTS.CHOOSE.FROM.DESKTOP"))},uploadPhoto:function(contact_id,isUpload){var photo=ZContacts.Photo.create();isUpload&&photo.set("__form","#zcs_uploadPopup"),$("#zcs_uploadPopup").parents("#zmsdialog_zcs_uploadPopup").prepend("<div id='uploadLoading' style='margin-bottom: 5%;' ></div>");var destroyLoadingDiv=zmComponent.loadingBand({container:$("#uploadLoading").get(0),type:"listing"});new URI(ZContacts.Photo,ZContacts.getCurrentAccount().getAccountId(),contact_id).POST(photo).then(function(json){if(zmcontact.restrictClick($("#zcs_uploadPopup").parent().siblings(".SC_PUbtm"),!1),zmcontact.restrictClick($("#zcs_user_photo"),!1),destroyLoadingDiv(),$("#uploadLoading").remove(),200==json.status_code){zmUtil.succErrMsg("s",ZContacts.getMessageFromResponse(json));var date=new Date;$("#"+json.photo.contact_id).find("img").attr("src",json.photo.photo_url+"?cache="+date.getTime()),$("#"+json.photo.contact_id+"_img").attr("src",json.photo.photo_url+"?cache="+date.getTime()),$("#"+json.photo.contact_id).get(0).__zc_contact.set("photo_url",json.photo.photo_url),zmsDialog.remove(),$("#zcs_uploadPopup").remove()}else zmUtil.succErrMsg("e",ZContacts.getMessageFromResponse(json))},function(json){zmcontact.restrictClick($("#zcs_uploadPopup").parent().siblings(".SC_PUbtm").children("span"),!1),zmcontact.restrictClick($("#zcs_user_photo"),!1),destroyLoadingDiv(),$("#uploadLoading").remove(),zmUtil.succErrMsg("e",ZContacts.getMessageFromResponse(json))}),$("#cnt-photo").val(""),zmcontact.setPhotoPath("")},openUploadPopup:function(contact_id,contact_name,contact_zuid){if(!ZContacts.getCurrentAccount().isWritable)return!1;createFolElem=$("<form id='zcs_uploadPopup'></div>");var tags=new ZContacts.StringBuilder;tags.append('<div class="SC_tdtl" style="width: 450px">'),tags.append('<div class="SC_tiput" id="'+contact_id+'" style="float: left; width: 150px;height: auto; background-color: #fcfcfc;cursor: pointer;padding-top: 0%;padding-left: 0%;padding-right: 0%;padding-bottom: 0%;">'),tags.append('<input style="left: 30px;top: 66px;width: 33%;position: absolute;cursor: pointer;height: 31px;opacity: 0" id="cnt-photo" name="photo" onchange="zmcontact.setPhotoPath(this.files[0].name);" type="file" readonly="readonly"/>'),tags.append('<div id="zcs_choose_desktop" style="font-size: 12px;color: #878787;max-width:100%;cursor: pointer;height: 97%;text-align : center;line-height: 30px;white-space: nowrap;overflow: hidden;padding-left: 5px;">'+I18N.get("IAM.CONTACTS.CHOOSE.FROM.DESKTOP")+"</div></div>"),-1!=contact_zuid&&(tags.append('<div style="text-align: center;float: left;margin-left: 10px;margin-right: 10px;margin-top: 5px;color: #878787;font-size: 12px;line-height: 20px;">'+I18N.get("OR")+"</div>"),tags.append('<div class="SC_tiput" style="padding-bottom: 0%;padding-right: 3%;float: left;width: auto;max-width: 300px;margin: auto;height: auto;font-size: 12px;color: #878787;background-color: #fcfcfc;cursor: pointer;" id="zcs_user_photo" onclick="zmcontact.setAccountPhoto(this, \''+contact_id+"');\">"),tags.append('<div style="float: left;margin-top: -2px;margin-left: -2px;"><img style="height: 25px;width: 25px;border-radius: 100%;" src="'+ZContacts.meta.serviceInfo.contacts_server_url+"/file?ID="+contact_zuid+'" /></div>'),tags.append('<span style="margin-left: 10px;line-height: 20px;">'+I18N.get("IAM.CONTACTS.KEEP.USER.PHOTO")+"</span>"),tags.append("</div>")),tags.append("</div>"),tags.append('<div style="clear: both;padding-top: 20px;">'),tags.append('<li style="font-size: 13px;color: #999;padding-bottom: 5px;">'+I18N.get("IAM.NOTE")+":</li>"),tags.append('<li style="font-size: 11px;color: #878787">'+I18N.get("IAM.UPLOAD.NOTE1")+"</li>"),tags.append('<li style="font-size: 11px;color: #878787">'+formatMessage(I18N.get("IAM.UPLOAD.NOTE2"),2e3)+"</li>"),tags.append('<li style="font-size: 11px;color: #878787">'+I18N.get("IAM.UPLOAD.NOTE3")+"</li>"),tags.append("</div>"),tags.append("</form>"),createFolElem.append(tags.toString()),$(document.body).append(createFolElem);var uploadDiv={};uploadDiv.title=formatMessage(I18N.get("IAM.CONTACTS.UPLOAD.TITLE"),contact_name),uploadDiv.mask=!0,uploadDiv.buttons=[{txt:I18N.get("IAM.UPLOAD"),selected:!0,callback:function(data){var button=$(data.toElement);if(doAllowClick(button)){var elem=$("#cnt-photo"),file=elem.val();if(""==file)return void zmUtil.succErrMsg("e",I18N.get("IAM.CONTACTS.PLEASE.CHOOSE.PHOTO"));if(!/\.(jpe?g|png|gif|bmp)$/i.test(file))return void zmUtil.succErrMsg("e",I18N.get("IAM.CONTACTS.INVALID.PHOTO"));zmcontact.restrictClick($("#zcs_user_photo"),!0),zmcontact.restrictClick(button.parent().children("span"),!0),zmcontact.uploadPhoto(contact_id,!0)}}},{isCancel:!0,txt:I18N.get("IAM.CANCEL"),callback:function(data){var button=$(data.toElement);doAllowClick(button)&&(zmsDialog.remove(),$("#zcs_uploadPopup").remove())}},{isCancel:!0,txt:I18N.get("IAM.CONTACTS.RESET.TO.DEFAULT"),callback:function(data){var button=$(data.toElement);if(doAllowClick(button)){zmcontact.restrictClick($("#zcs_user_photo"),!0),zmcontact.restrictClick(button.parent().children("span"),!0);var elem=$("#cnt-photo"),contact_id=elem.parent().attr("id");$("#zcs_uploadPopup").parents("#zmsdialog_zcs_uploadPopup").prepend("<div id='uploadLoading' style='margin-bottom: 5%;' ></div>");var destroyLoadingDiv=zmComponent.loadingBand({container:$("#uploadLoading").get(0),type:"listing"});new URI(ZContacts.Photo,ZContacts.getCurrentAccount().getAccountId(),contact_id).DELETE().then(function(json){zmcontact.restrictClick(button.parent().children("span"),!1),zmcontact.restrictClick($("#zcs_user_photo"),!1),destroyLoadingDiv(),$("#uploadLoading").remove(),204==json.status_code?(zmUtil.succErrMsg("s",I18N.get("IAM.CONTACTS.PHOTO.RESET.SUCCESS")),$("#"+json.photo.contact_id).find("img").attr("src",json.photo.photo_url),$("#"+json.photo.contact_id+"_img").attr("src",json.photo.photo_url),$("#"+json.photo.contact_id).get(0).__zc_contact.set("photo_url",json.photo.photo_url),zmsDialog.remove(),$("#zcs_uploadPopup").remove()):zmUtil.succErrMsg("e",ZContacts.getMessageFromResponse(json))},function(json){zmcontact.restrictClick(button.parent().children("span"),!1),zmcontact.restrictClick($("#zcs_user_photo"),!1),destroyLoadingDiv(),$("#uploadLoading").remove(),zmUtil.succErrMsg("e",ZContacts.getMessageFromResponse(json))})}}}],uploadDiv.closeaction=function(){zmsDialog.remove(),$("#zcs_uploadPopup").remove()},uploadDiv.pos="center",zmsDialog.create("zcs_uploadPopup",uploadDiv),$("#zcs_uploadPopup").ready(function(){$($("#zcs_uploadPopup").parent().siblings(".SC_PUbtm").children("span")[2]).css("float","right")}),$("#zcs_uploadPopup").parents(".SC_pe").on("click",function(e){e.stopPropagation()}),$("#zcs_uploadPopup").parents(".SC_Pop").on("click",function(){this.remove()})},loadContactDetails:function(contactId){$("div[data-field-type=zcs-cnt-view]:not(:has(.zcs-contDup-row))").attr("data-field-type",""),$("#"+contactId).attr("data-field-type","zcs-cnt-view");var $detailsContainer=zmsuite.getCenter()[0].getNodes()[2].$el.find(".zcs-cont-details");$detailsContainer.html("");var destroyLoadingDiv=zmComponent.loadingBand({container:$detailsContainer.get(0),type:"pagination"});new URI(ZContacts.Contacts,ZContacts.getCurrentAccount().getAccountId(),contactId.toString()).include("emails").include("phones").include("ims").include("address").include("urls").include("categories").GET().then(function(contact){destroyLoadingDiv(),zmcontact.renderContactDetails(contact),zmTab.currentTab!=ZContacts.ZMailConstants.CLEAN_WORKSPACE_APP_ID&&zmcontact.switchDetailsPage(!0)})},renderContactDetails:function(contact){var contact_id=contact.get("contact_id"),name=contact.getFullName(),contact_zuid=contact.get("contact_zuid"),contacts_details=new ZContacts.StringBuilder;contacts_details.append("<div>"),contacts_details.append('<div style="float:left; padding:20px;"><div class="zcs-left" style="height: 102px";>'),contacts_details.append('<div class="zcs-left" id="zcs-photo">'),contacts_details.append('<img id="'+contact_id+'_img" style="position: absolute;" src=').append(contact.get("photo_url")).append(' width="98" height="98" class="zcs-thumnail">'),ZContacts.getCurrentAccount().isWritable&&contacts_details.append('<div id="zcs-change-photo" width="98" height="98" style="display: none;position: absolute; color: #fff; font-weight: bold; background: rgba(0,0,0,0.6); border-radius: 100%; top: 21px; left: 21px; height: 98px;width: 98px;text-align: center; font-size: 10px;text-transform: uppercase;line-height: 96px;">'+I18N.get("IAM.TITLE.CHANGE")+"</div>"),contacts_details.append("</div>"),contacts_details.append('<div style="margin-left: 125px;" class="zcs-name-info">');var nickName=encodeHTML(contact.get("nick_name"));contacts_details.append('<div class="zcs-title">').append(encodeHTML(contact.getFullName().trim())).append(nickName?" ("+nickName+")":"").append("</div>"),contact.getPrimaryEmail()&&contacts_details.append('<div class="zcs-title-mail">').append(encodeHTML(contact.getPrimaryEmail())).append("</div>");var workAddress=null,homeAddr=null;if(contact.address)for(var i=0;i<contact.address.length;i++){var addr=contact.address[i];"home"===addr.get("type")?homeAddr=addr:"work"===addr.get("type")&&(workAddress=addr)}(contact.job_title||contact.designation||contact.company)&&(contacts_details.append('<div style="font-size: 11px;color:#9c999c;">'),contact.job_title&&(contacts_details.append(encodeHTML(contact.job_title)),contact.designation&&contacts_details.append(", ")),contact.designation&&contacts_details.append(encodeHTML(contact.designation)).append("<br>"),contact.company&&contacts_details.append(encodeHTML(contact.company)),contacts_details.append("</div>"));var contactId=contact.get("contact_id"),contactName=contact.first_name;if(contacts_details.append('<div class="zcs-title-edit">'),ZContacts.getCurrentAccount().isWritable&&contacts_details.append('<a href="javascript:;" id="zcs-ac-editcont">').append(I18N.get("IAM.CONTACTS.EDIT.CONTACT")).append('</a> | <a href="javascript:;" onclick="zmcontact.deleteSingleContact(\''+contactId+"', '"+contactName+"')\">").append(I18N.get("IAM.DELETE")).append("</a> | "),contacts_details.append('<a href="javascript:;" id="zcs-print">').append(I18N.get("IAM.PRINT")).append("</a></div>"),contacts_details.append("</div>"),contacts_details.append("</div>"),contact.emails&&contact.emails.length||contact.get("categories")&&contact.get("categories").length){if(contacts_details.append('<div class="zcs-space"></div>'),contacts_details.append('<div class="zcs-left"><div class="zcs-left">').append(I18N.get("IAM.CONTACTS.GENERAL")).append("</div>"),contacts_details.append("<div>"),contact.emails&&contact.emails.length){contacts_details.append('<div class="zcs-top">'),contacts_details.append('<div  class="zcs-contacts-info">').append(I18N.get("IAM.EMAIL.IDS")).append(":</div>"),contacts_details.append('<div class="zcs-contacts-info-right">');for(var i=0;i<contact.emails.length;i++){var emailId=encodeHTML(contact.emails[i].email_id);i>0&&contacts_details.append("<br>"),contacts_details.append('<a href="mailto:').append(emailId).append('">').append(emailId).append("</a>")}contacts_details.append("</div></div>")}if(contact.get("categories")&&contact.get("categories").length){contacts_details.append('<div style="clear:both;" class="zcs-top">'),contacts_details.append('<div  class="zcs-contacts-info">').append(I18N.get("IAM.CONTACTS.CATEGORIES")).append(":</div>"),contacts_details.append('<div class="zcs-contacts-info-right">');for(var i=0;i<contact.get("categories").length;i++){var category=encodeHTML(contact.get("categories")[i]);i>0&&contacts_details.append("<br>"),category=category.split(",");var html="<span style='cursor: pointer;text-decoration: underline;color: #337fe5;' onclick='zmcontact.loadCategoryContacts(\""+category[0]+"\")'>"+category[1]+"</span>";contacts_details.append(html)}contacts_details.append("</div></div>")}contacts_details.append("</div>")}if(contact.phones){contacts_details.append('<div class="zcs-space"></div>'),contacts_details.append('<div class="zcs-left"><div class="zcs-left">').append(I18N.get("IAM.CONTACTS.BASIC.PHONE")).append("</div>"),contacts_details.append("<div>");for(var i=0;i<contact.phones.length;i++){var type=contact.phones[i].type,number=encodeHTML(contact.phones[i].number);contacts_details.append('<div class="zcs-top" style="clear:both;">'),"mobile"==type&&(type=I18N.get("IAM.CONTACTS.BASIC.MOBILE")),"home"==type&&(type=I18N.get("IAM.CONTACTS.BASIC.HOME")),"work"==type&&(type=I18N.get("IAM.CONTACTS.BASIC.WORK")),"fax"==type&&(type=I18N.get("IAM.CONTACTS.BASIC.FAX")),"others"==type&&(type=I18N.get("IAM.CONTACTS.OTHERS")),contacts_details.append('<div  class="zcs-contacts-info">').append(type).append(": </div>"),contacts_details.append('<div class="zcs-contacts-info-right">'),contacts_details.append(number),contacts_details.append("</div>"),contacts_details.append("</div>")}}if(contact.ims&&contact.ims.length){contacts_details.append('<div class="zcs-space"></div>'),contacts_details.append('<div class="zcs-left"><div class="zcs-left">').append(I18N.get("IAM.CONTACTS.IM.FULL")).append("</div>"),contacts_details.append("<div>");for(var i=0;i<contact.ims.length;i++){contacts_details.append('<div class="zcs-top" style="clear:both;">');var type=contact.ims[i].type;"google"==type&&(type=I18N.get("IAM.CONTACTS.IM.GOOGLE")),"yahoo"==type&&(type=I18N.get("IAM.CONTACTS.IM.YAHOO")),"skype"==type&&(type=I18N.get("IAM.CONTACTS.IM.SKYPE")),"aol"==type&&(type=I18N.get("IAM.CONTACTS.IM.AOL")),"icq"==type&&(type=I18N.get("IAM.CONTACTS.IM.ICQ")),"msn"==type&&(type=I18N.get("IAM.CONTACTS.IM.MSN")),"jabber"==type&&(type=I18N.get("IAM.CONTACTS.IM.JABBER")),"others"==type&&(type=I18N.get("IAM.CONTACTS.OTHERS")),contacts_details.append('<div  class="zcs-contacts-info">').append(type).append(":</div>"),contacts_details.append('<div class="zcs-contacts-info-right">'),contacts_details.append(encodeHTML(contact.ims[i].address)),contacts_details.append("</div>"),contacts_details.append("</div>")}contacts_details.append("</div>")}if(homeAddr&&!homeAddr.isEmpty()&&(contacts_details.append('<div class="zcs-space"></div>'),contacts_details.append('<div class="zcs-left"><div class="zcs-left">').append(I18N.get("IAM.CONTACTS.OTHERS.HADDRESS")).append("</div>"),contacts_details.append("<div>"),homeAddr&&!homeAddr.isEmpty())){var address="";homeAddr.street_addr&&(address+=encodeHTML(homeAddr.street_addr+",")),homeAddr.street_addr1&&(address=address+encodeHTML(homeAddr.street_addr1)+",<br>"),homeAddr.city&&(address+=encodeHTML(homeAddr.city+",")),homeAddr.state&&(address=address+encodeHTML(homeAddr.state)+",<br>"),homeAddr.country&&(address+=encodeHTML(homeAddr.country+",")),homeAddr.postal_code&&(address+=encodeHTML(homeAddr.postal_code)),address&&(","==address.substr("-1")&&(address=address.substring(0,address.length-1)),contacts_details.append('<div class="zcs-top">'),contacts_details.append('<div  class="zcs-contacts-info">').append(I18N.get("IAM.CONTACTS.WORK.ADDRESS")).append(":</div>"),contacts_details.append('<div class="zcs-contacts-info-right">'),contacts_details.append(address),contacts_details.append("</div>"),contacts_details.append("</div>"))}if(workAddress&&!workAddress.isEmpty()&&(contacts_details.append('<div class="zcs-space"></div>'),contacts_details.append('<div class="zcs-left"><div class="zcs-left">').append(I18N.get("IAM.CONTACTS.EXPORT.WORK.ADDRESS")).append("</div>"),contacts_details.append("<div>"),workAddress&&!workAddress.isEmpty())){var address="";workAddress.street_addr&&(address+=workAddress.street_addr+","),workAddress.street_addr1&&(address=address+encodeHTML(workAddress.street_addr1)+",<br>"),workAddress.city&&(address+=encodeHTML(workAddress.city+",")),workAddress.state&&(address=address+encodeHTML(workAddress.state)+",<br>"),workAddress.country&&(address+=encodeHTML(workAddress.country+",")),workAddress.postal_code&&(address=address+encodeHTML(workAddress.postal_code)+"<br>"),address&&(","==address.substr("-1")&&(address=address.substring(0,address.length-1)),contacts_details.append('<div class="zcs-top">'),contacts_details.append('<div  class="zcs-contacts-info">').append(I18N.get("IAM.CONTACTS.WORK.ADDRESS")).append(":</div>"),contacts_details.append('<div class="zcs-contacts-info-right">'),contacts_details.append(address),contacts_details.append("</div>"),contacts_details.append("</div>"))}if(contact.gender||contact.notes||contact.birth_day){if(contacts_details.append('<div class="zcs-space"></div>'),contacts_details.append('<div class="zcs-left"><div class="zcs-left">').append(I18N.get("IAM.CONTACTS.PERSONAL")).append("</div>"),contacts_details.append("<div>"),contact.gender&&(contacts_details.append('<div class="zcs-top">'),contacts_details.append('<div  class="zcs-contacts-info">').append(I18N.get("IAM.CONTACTS.GENDER")).append(":</div>"),contacts_details.append('<div class="zcs-contacts-info-right">'),contacts_details.append("M"===contact.gender?I18N.get("IAM.CONTACTS.GENDER.MALE"):I18N.get("IAM.CONTACTS.GENDER.FEMALE")),contacts_details.append("</div>"),contacts_details.append("</div>")),contact.birth_day){contacts_details.append('<div class="zcs-top" style="clear:both;">'),contacts_details.append('<div  class="zcs-contacts-info">').append(I18N.get("IAM.CONTACTS.BASIC.BDAY")).append(":</div>"),contacts_details.append('<div class="zcs-contacts-info-right">');var bday="";contact.birth_day&&(bday=bday+contact.birth_day+"-"),contact.birth_month&&(bday+=contact.birth_month),contact.birth_year&&(bday=bday+"-"+contact.birth_year),contacts_details.append(bday),contacts_details.append("</div>"),contacts_details.append("</div>")}contact.notes&&(contacts_details.append('<div class="zcs-top" style="clear:both;">'),contacts_details.append('<div  class="zcs-contacts-info">').append(I18N.get("IAM.CONTACTS.NOTES")).append(":</div>"),contacts_details.append('<div class="zcs-contacts-info-right">'),contacts_details.append(encodeHTML(contact.notes)),contacts_details.append("</div>"),contacts_details.append("</div>"))}if(contact.urls&&contact.urls.length){contacts_details.append('<div class="zcs-space"></div>'),contacts_details.append('<div class="zcs-left"><div class="zcs-left">').append(I18N.get("IAM.CONTACTS.URLS")).append("</div>"),contacts_details.append("<div>");for(var type,i=0;i<contact.urls.length;i++){contacts_details.append('<div style="clear:both;" class="zcs-top">'),type=contact.urls[i].type,type=I18N.get("home"==type?"IAM.CONTACTS.EXPORT.PERSONALWEB.ADDRESS":"work"==type?"IAM.CONTACTS.EXPORT.COMPANYWEB.ADDRESS":"blog"==type?"IAM.CONTACTS.BLOG.URL":"linkedin"==type?"IAM.CONTACTS.LINKEDIN.URL":"facebook"==type?"IAM.CONTACTS.FACEBOOK.URL":"twitter"==type?"IAM.CONTACTS.TWITTER.URL":"amazon"==type?"IAM.CONTACTS.AMAZON.URL":"flickr"==type?"IAM.CONTACTS.FLICKR.URL":"delicious"==type?"IAM.CONTACTS.DELICIOUS.URL":"IAM.CONTACTS.OTHERS"),contacts_details.append('<div  class="zcs-contacts-info">').append(type).append(":</div>"),contacts_details.append('<div class="zcs-contacts-info-right">');var readUrl=contact.urls[i].url;-1==readUrl.indexOf("://")?contacts_details.append('<a href="//').append(readUrl).append('" target="_blank" >').append(encodeHTML(readUrl)).append("</a>"):contacts_details.append('<a href="').append(readUrl).append('" target="_blank" >').append(encodeHTML(readUrl)).append("</a>"),contacts_details.append("</div>"),contacts_details.append("</div>")}contacts_details.append("</div>")}contacts_details.append("</div>"),contacts_details.append("</div>"),contacts_details.append("</div>");var rightContainer="";rightContainer=zmTab.currentTab==ZContacts.ZMailConstants.SEARCH_WORKSPACE_APP_ID?$("#zcs_srch")[0]:$(".SC_conRgt")[0],$(rightContainer).find(".zcs-cont-details").html(contacts_details.toString()),$(rightContainer).find("#zcs-ac-editcont").click(function(){zmcontact.showEditPage(contact)}),$(rightContainer).find("#zcs-print").click(function(){zmcontact.printContact(contactId)}),$(rightContainer).find("#zcs-photo").click(function(){ZContacts.getCurrentAccount().isWritable&&zmcontact.openUploadPopup(contact_id,name,contact_zuid)}),$(rightContainer).find("#zcs-photo").mouseover(function(){ZContacts.getCurrentAccount().isWritable&&$(this).find("#zcs-change-photo").css("display","block").css("cursor","pointer")}),$(rightContainer).find("#zcs-photo").mouseout(function(){ZContacts.getCurrentAccount().isWritable&&$(this).find("div").css("display","none")})},printContact:function(){var printDiv={};if(printDiv.title=I18N.get("IAM.PRINT.PREVIEW"),printDiv.mask=!0,printDiv.buttons=[{txt:I18N.get("IAM.PRINT"),selected:!0,callback:function(){var prtContent=document.getElementById("zcs_printPopup"),winPrint=window.open("","","left=0,top=0,width=700,height=800,toolbar=no,scrollbars=yes,status=no");winPrint.document.write('<html><body onload="window.print()">'),winPrint.document.write('<link type="text/css" rel="stylesheet" href="'+ZContacts.meta.serviceInfo.contacts_server_url+'/new/css/new_style.css">');var logoSrc=ZContacts.meta.serviceInfo.contacts_server_url+"/images/contacts-logo.gif";winPrint.document.write('<img alt="'+I18N.get("IAM.CONTACTS.ZOHO")+'" src="'+logoSrc+'" style="margin-top: -2px;height:24px;"/></div>'),winPrint.document.write(prtContent.innerHTML),winPrint.document.write("</body></html>"),winPrint.document.close(),winPrint.focus(),zmsDialog.remove()}},{isCancel:!0,txt:I18N.get("IAM.CANCEL"),callback:function(){zmsDialog.remove(),$("#zcs_printPopup").remove()}}],printDiv.closeaction=function(){zmsDialog.remove(),$("#zcs_printPopup").remove()},printDiv.pos="center",createFolElem=$("<div id='zcs_printPopup'></div>"),!$("#zcs_printPopup").length){var tags="<div style='width: 200%; max-height: 555px; position: relative;'>",prtContent=zmsuite.getCenter()[0].getNodes()[2].$el.find(".zcs-cont-details");tags=tags+prtContent[0].innerHTML+"</div>",createFolElem.append(tags),$(document.body).append(createFolElem),$("#zcs_printPopup").ready(function(){$("#zcs_printPopup").find(".zcs-title-edit").remove()})}zmsDialog.create("zcs_printPopup",printDiv),$("#zcs_printPopup").parents(".SC_pe").on("click",function(e){e.stopPropagation()}),$("#zcs_printPopup").parents(".SC_Pop").on("click",function(){this.remove()})},switchDetailsPage:function(isDetail){var rightContainer=zmsuite.getWorkSpace(zmTab.currentTab)[0].$el.find(".SC_mclst").find(".SC_conRgt");isDetail?($(rightContainer).find(".zcs-cont-details").show(),$(rightContainer).find(".zcs-cont-edit").hide()):($(rightContainer).find(".zcs-cont-details").hide(),$(rightContainer).find(".zcs-cont-edit").show())},initScroll:function(scrollElem,currElem,nearElem){var diff,diffLen,sTop=scrollElem.scrollTop(),currTop=currElem.offset().top,prevTop=nearElem.offset().top,halfHeight=scrollElem.height()/2;diffLen=currTop-prevTop,scrollElem.scrollTop(sTop+diffLen),0>currTop?(diff=halfHeight-currTop,scrollElem.scrollTop(sTop-diff)):currTop>scrollElem.height()&&(diff=currTop-halfHeight,scrollElem.scrollTop(sTop+diff))},showMergePage:function(contacts,contactIds,isMerge){function distinctField(fieldArr,fieldObj){$.each(fieldArr,function(key,value){fieldObj[key]&&-1==value.indexOf(fieldObj[key].trim())&&(value[value.length]=fieldObj[key].trim())})}for(var editorActions={merge:function(){var contactModel=this.toContactsModel(ZContacts.ContactsMerge.create());contactModel&&zmsDialog.confirm(formatMessage(I18N.get("IAM.CONTACTS.MERGE.CONFIRM"),contactIds.length),{onOk:function(){new URI(ZContacts.ContactsMerge,ZContacts.getCurrentAccount().getAccountId(),contactIds).POST(contactModel).then(function(response){if(201==response.status_code){if(zmUtil.succErrMsg("s",I18N.get("IAM.CONTACTS.DUPLICATES.MERGED.SUCCESSFULLY")),!isMerge){var noOfRow=$(".zcs-contDup-row").parents(".SC_cont");if(1!=noOfRow.length){var elem=$("div[id='"+contactIds+"']"),nextElem=elem.next();return nextElem.length||(nextElem=$($(".zcs-contDup-row").parents("#zcs_conLft").find(".zmL")[0])),nextElem.click(),elem.remove(),zmcontact.initScroll($(zmsuite.getCenter()[0].getNodes()[2].$el.children()[0]),nextElem,elem),zmcontact._loadContacts(zmcontact.getCategory(ZContacts._currentCategoryId)),void zmcontact.refreshContactCounts()}1==noOfRow.length&&zmsuite.isWorkspaceAvailable(ZContacts.ZMailConstants.CLEAN_WORKSPACE_APP_ID)&&zmsuite.closeWorkspace(ZContacts.ZMailConstants.CLEAN_WORKSPACE_APP_ID)}return zmcontact._loadContacts(zmcontact.getCategory(ZContacts._currentCategoryId)),void zmcontact.refreshContactCounts()}})}})},skip:function(){var prevElem=$('div[data-field-type="zcs-cnt-view"]:has(.zcs-contDup-row)');if(1==$(".zcs-contDup-row").length)zmsuite.isWorkspaceAvailable(ZContacts.ZMailConstants.CLEAN_WORKSPACE_APP_ID)&&zmsuite.closeWorkspace(ZContacts.ZMailConstants.CLEAN_WORKSPACE_APP_ID);else{prevElem.next().length?prevElem.next().click():$(".zcs-contDup-row").parents("#zcs_conLft").find(".zmL")[0].click();var currElem=$('div[data-field-type="zcs-cnt-view"]');zmcontact.initScroll($(zmsuite.getCenter()[0].getNodes()[2].$el.children()[0]),currElem,prevElem)}},deleteContact:function(){var elem=$("div[data-field-type=zcs-cnt-view]:has(.zcs-contDup-row)"),id=elem[0].id;zmcontact.deleteMultiContacts(id.split(","))},cancel:function(){zmTab.currentTab==ZContacts.ZMailConstants.CLEAN_WORKSPACE_APP_ID?zmsuite.closeWorkspace(ZContacts.ZMailConstants.CLEAN_WORKSPACE_APP_ID):zmcontact.switchDetailsPage(!0),zmcontact.updateHeaderBand(zmcontact.getCategory(ZContacts._currentCategoryId)),zmcontact.unChkAll()}},nameArr={first_name:[],middle_name:[],last_name:[],nick_name:[],job_title:[],designation:[],company:[],notes:[]},hmeAddrArr={street_addr:[],street_addr1:[],city:[],state:[],country:[],postal_code:[]},wrkAddrArr={street_addr:[],street_addr1:[],city:[],state:[],country:[],postal_code:[]},contact=contacts[0],i=0;contacts[i];i++){if(0!=i){var length=contact.emails?contact.emails.length:0;if(contacts[i].emails){0==length&&(contact.emails=[]);for(var j=0;j<contacts[i].emails.length&&contact.emails&&-1==contact.emails.indexOf(contacts[i].emails[j].email_id);j++)contact.emails[length+j]={is_primary:!1,email_id:contacts[i].emails[j].email_id}}if(length=contact.phones?contact.phones.length:0,contacts[i].phones){0==length&&(contact.phones=[]);for(var j=0;j<contacts[i].phones.length&&contact.phones&&-1==contact.phones.indexOf(contacts[i].phones[j].number);j++)contact.phones[length+j]={type:contacts[i].phones[j].type,number:contacts[i].phones[j].number}}if(length=contact.ims?contact.ims.length:0,contacts[i].ims){0==length&&(contact.ims=[]);for(var j=0;j<contacts[i].ims.length&&contact.ims&&-1==contact.ims.indexOf(contacts[i].ims[j].address);j++)contact.ims[length+j]={type:contacts[i].ims[j].type,address:contacts[i].ims[j].address}}if(length=contact.urls?contact.urls.length:0,contacts[i].urls){0==length&&(contact.urls=[]);for(var j=0;j<contacts[i].urls.length&&contact.urls&&-1==contact.urls.indexOf(contacts[i].urls[j].url);j++)contact.urls[length+j]={type:contacts[i].urls[j].type,url:contacts[i].urls[j].url}}}distinctField(nameArr,contacts[i]);var hmeAddr,wrkAddr;contacts[i].address&&contacts[i].address.length&&(hmeAddr="home"==contacts[i].address[0].type?contacts[i].address[0]:contacts[i].address[1],wrkAddr="work"==contacts[i].address[0].type?contacts[i].address[0]:contacts[i].address[1]),hmeAddr&&distinctField(hmeAddrArr,hmeAddr),wrkAddr&&distinctField(wrkAddrArr,wrkAddr)}$.each(nameArr,function(key,value){if("notes"!=key){var firstCntField;contacts[0][key]&&(firstCntField=contacts[0][key].trim()),1==nameArr[key].length&&value[0]==firstCntField&&(nameArr[key]=[])}});var firstCntHmeAddr;contacts[0].address&&contacts[0].address.length&&(firstCntHmeAddr="home"==contacts[0].address[0].type?contacts[0].address[0]:contacts[0].address[1]),firstCntHmeAddr&&0!=i&&$.each(hmeAddrArr,function(key,value){var firstCntField;firstCntHmeAddr[key]&&(firstCntField=firstCntHmeAddr[key].trim()),1==hmeAddrArr[key].length&&value[0]==firstCntField&&(hmeAddrArr[key]=[])});var firstCntWrkAddr;contacts[0].address&&contacts[0].address.length&&(firstCntWrkAddr="work"==contacts[0].address[0].type?contacts[0].address[0]:contacts[0].address[1]),firstCntWrkAddr&&0!=i&&$.each(wrkAddrArr,function(key,value){var firstCntField;firstCntWrkAddr[key]&&(firstCntField=firstCntWrkAddr[key].trim()),1==wrkAddrArr[key].length&&value[0]==firstCntField&&(wrkAddrArr[key]=[])});var contact=ZContacts.ContactsDuplicates.create(contact),ceditor=new ZContacts.ContactEditor(!1,contact,{actions:editorActions}),$rightContainer=zmsuite.getCenter()[0].getNodes()[2].$el;if(ceditor.render($rightContainer.find(".zcs-cont-edit"),!0),zmsuite.getCenter()[0].$el.find('input[data-field-type="middle_name"]').after('<div id="zcs-first-middle" class="zcs-mr10" style="width :66.5%;float: left;">'),nameArr.first_name.length||nameArr.middle_name.length){zmsuite.getCenter()[0].$el.find("#zcs-first-middle").append('<div id="zcs-dup-first" style="width:48%; margin-right: 8px;" class="zcs-merge-all-fields">');for(var i=0;i<nameArr.first_name.length;i++)zmsuite.getCenter()[0].$el.find("#zcs-dup-first").append("<label onclick=\"$('input[data-field-type=first_name]').val('"+encodeHTML(nameArr.first_name[i])+'\');" class="zcs-merge-field" style="cursor: pointer;">'+nameArr.first_name[i]+"</label>");zmsuite.getCenter()[0].$el.find("#zcs-dup-first").append("</div>")}if(nameArr.first_name.length||nameArr.middle_name.length){zmsuite.getCenter()[0].$el.find("#zcs-first-middle").append('<div id="zcs-dup-middle" style="width:47%" class="zcs-merge-all-fields">');for(var i=0;i<nameArr.middle_name.length;i++)zmsuite.getCenter()[0].$el.find("#zcs-dup-middle").append("<label onclick=\"$('input[data-field-type=middle_name]').val('"+encodeHTML(nameArr.middle_name[i])+'\');" class="zcs-merge-field" style="cursor: pointer;">'+nameArr.middle_name[i]+"</label>");zmsuite.getCenter()[0].$el.find("#zcs-dup-middle").append("</div>")}if(zmsuite.getCenter()[0].$el.find("#zcs-first-middle").append("</div>"),zmsuite.getCenter()[0].$el.find("#zcs-first-middle").after('<div style="clear: both;"></div>'),zmsuite.getCenter()[0].$el.find('input[data-field-type="nick_name"]').after('<div id="zcs-last-nick" class="zcs-mr10" style="width :66.5%;float: left;">'),nameArr.last_name.length||nameArr.nick_name.length){zmsuite.getCenter()[0].$el.find("#zcs-last-nick").append('<div id="zcs-dup-last" style="width:48%; margin-right: 8px;" class="zcs-merge-all-fields">');for(var i=0;i<nameArr.last_name.length;i++)zmsuite.getCenter()[0].$el.find("#zcs-dup-last").append("<label onclick=\"$('input[data-field-type=last_name]').val('"+encodeHTML(nameArr.last_name[i])+'\');" class="zcs-merge-field" style="cursor: pointer;">'+nameArr.last_name[i]+"</label>");zmsuite.getCenter()[0].$el.find("#zcs-dup-last").append("</div>")}if(nameArr.last_name.length||nameArr.nick_name.length){zmsuite.getCenter()[0].$el.find("#zcs-last-nick").append('<div id="zcs-dup-nick" style="width:47%" class="zcs-merge-all-fields">');for(var i=0;i<nameArr.nick_name.length;i++)zmsuite.getCenter()[0].$el.find("#zcs-dup-nick").append("<label onclick=\"$('input[data-field-type=nick_name]').val('"+encodeHTML(nameArr.nick_name[i])+'\');" class="zcs-merge-field" style="cursor: pointer;">'+nameArr.nick_name[i]+"</label>");zmsuite.getCenter()[0].$el.find("#zcs-dup-nick").append("</div>")}if(zmsuite.getCenter()[0].$el.find("#zcs-last-nick").append("</div>"),zmsuite.getCenter()[0].$el.find('input[data-field-type="hme_street_addr"]').after('<div id="zcs-hme-street" class="zcs-mr10" style="width :66.5%;float: left;">'),hmeAddrArr.street_addr.length){zmsuite.getCenter()[0].$el.find("#zcs-hme-street").append('<div id="zcs-dup-streetadd" style="width: 147.6%" class="zcs-merge-all-fields">');for(var i=0;i<hmeAddrArr.street_addr.length;i++)zmsuite.getCenter()[0].$el.find("#zcs-dup-streetadd").append("<label onclick=\"$('input[data-field-type=hme_street_addr]').val('"+encodeHTML(hmeAddrArr.street_addr[i])+'\');" class="zcs-merge-field" style="cursor: pointer;">'+hmeAddrArr.street_addr[i]+"</label>");zmsuite.getCenter()[0].$el.find("#zcs-dup-streetadd").append("</div>"),zmsuite.getCenter()[0].$el.find("#zcs-hme-street").append("</div>"),zmsuite.getCenter()[0].$el.find("#zcs-hme-street").append('<div style="clear: both;"></div>')}if(zmsuite.getCenter()[0].$el.find('input[data-field-type="hme_street_addr1"]').after('<div id="zcs-hme-street1" class="zcs-mr10" style="width :66.5%;float: left;">'),hmeAddrArr.street_addr1.length){zmsuite.getCenter()[0].$el.find("#zcs-hme-street1").append('<div id="zcs-dup-streetadd1" style="width: 147.6%" class="zcs-merge-all-fields">');for(var i=0;i<hmeAddrArr.street_addr1.length;i++)zmsuite.getCenter()[0].$el.find("#zcs-dup-streetadd1").append("<label onclick=\"$('input[data-field-type=hme_street_addr1]').val('"+encodeHTML(hmeAddrArr.street_addr1[i])+'\');" class="zcs-merge-field" style="cursor: pointer;">'+hmeAddrArr.street_addr1[i]+"</label>");zmsuite.getCenter()[0].$el.find("#zcs-dup-streetadd1").append("</div>"),zmsuite.getCenter()[0].$el.find("#zcs-hme-street1").append("</div>"),zmsuite.getCenter()[0].$el.find("#zcs-hme-street1").append('<div style="clear: both;"></div>')}if(zmsuite.getCenter()[0].$el.find('input[data-field-type="hme_state"]').after('<div id="zcs-hme-state-city" class="zcs-mr10" style="width: 99.1%;float: left;">'),hmeAddrArr.city.length||hmeAddrArr.state.length){zmsuite.getCenter()[0].$el.find("#zcs-hme-state-city").append('<div id="zcs-dup-city" style="width: 49%;margin-right: 8px" class="zcs-merge-all-fields">');for(var i=0;i<hmeAddrArr.city.length;i++)zmsuite.getCenter()[0].$el.find("#zcs-dup-city").append("<label onclick=\"$('input[data-field-type=hme_city]').val('"+encodeHTML(hmeAddrArr.city[i])+'\');" class="zcs-merge-field" style="cursor: pointer;">'+hmeAddrArr.city[i]+"</label>");zmsuite.getCenter()[0].$el.find("#zcs-dup-city").append("</div>")}if(hmeAddrArr.city.length||hmeAddrArr.state.length){zmsuite.getCenter()[0].$el.find("#zcs-hme-state-city").append('<div id="zcs-dup-state" style="width: 48%" class="zcs-merge-all-fields">');for(var i=0;i<hmeAddrArr.state.length;i++)zmsuite.getCenter()[0].$el.find("#zcs-dup-state").append("<label onclick=\"$('input[data-field-type=hme_state]').val('"+encodeHTML(hmeAddrArr.state[i])+'\');" class="zcs-merge-field" style="cursor: pointer;">'+hmeAddrArr.state[i]+"</label>");zmsuite.getCenter()[0].$el.find("#zcs-dup-state").append("</div>")}if(zmsuite.getCenter()[0].$el.find("#zcs-hme-state-city").append("</div>"),zmsuite.getCenter()[0].$el.find("#zcs-hme-state-city").append('<div style="clear: both;"></div>'),zmsuite.getCenter()[0].$el.find('input[data-field-type="hme_postal_code"]').after('<div id="zcs-hme-country-pin" class="zcs-mr10" style="width: 99.1%;float: left;">'),hmeAddrArr.country.length||hmeAddrArr.postal_code.length){zmsuite.getCenter()[0].$el.find("#zcs-hme-country-pin").append('<div id="zcs-dup-country" style="width: 49%;margin-right: 8px" class="zcs-merge-all-fields">');for(var i=0;i<hmeAddrArr.country.length;i++)zmsuite.getCenter()[0].$el.find("#zcs-dup-country").append("<label onclick=\"$('input[data-field-type=hme_country]').val('"+encodeHTML(hmeAddrArr.country[i])+'\');" class="zcs-merge-field" style="cursor: pointer;">'+hmeAddrArr.country[i]+"</label>");zmsuite.getCenter()[0].$el.find("zcs-dup-country").append("</div>")}if(hmeAddrArr.country.length||hmeAddrArr.postal_code.length){zmsuite.getCenter()[0].$el.find("#zcs-hme-country-pin").append('<div id="zcs-dup-pin" style="width: 48%" class="zcs-merge-all-fields">');for(var i=0;i<hmeAddrArr.postal_code.length;i++)zmsuite.getCenter()[0].$el.find("#zcs-dup-pin").append("<label onclick=\"$('input[data-field-type=hme_postal_code]').val('"+encodeHTML(hmeAddrArr.postal_code[i])+'\');" class="zcs-merge-field" style="cursor: pointer;">'+hmeAddrArr.postal_code[i]+"</label>");zmsuite.getCenter()[0].$el.find("#zcs-dup-pin").append("</div>")}if(zmsuite.getCenter()[0].$el.find("#zcs-hme-country-pin").append("</div>"),zmsuite.getCenter()[0].$el.find("#zcs-hme-country-pin").append('<div style="clear: both;"></div>'),zmsuite.getCenter()[0].$el.find('input[data-field-type="company"]').after('<div id="zcs-work-company" class="zcs-mr10" style="width :66.5%;float: left;">'),nameArr.company.length){zmsuite.getCenter()[0].$el.find("#zcs-work-company").append('<div id="zcs-dup-company" style="width: 147.6%" class="zcs-merge-all-fields">');for(var i=0;i<nameArr.company.length;i++)zmsuite.getCenter()[0].$el.find("#zcs-dup-company").append("<label onclick=\"$('input[data-field-type=company]').val('"+encodeHTML(nameArr.company[i])+'\');" class="zcs-merge-field" style="cursor: pointer;">'+nameArr.company[i]+"</label>");zmsuite.getCenter()[0].$el.find("#zcs-dup-company").append("</div>"),zmsuite.getCenter()[0].$el.find("#zcs-work-company").append("</div>"),zmsuite.getCenter()[0].$el.find("#zcs-work-company").append('<div style="clear: both;"></div>')}if(zmsuite.getCenter()[0].$el.find('input[data-field-type="designation"]').after('<div id="zcs-work-job-designation" class="zcs-mr10" style="width :99.1%;float: left;">'),nameArr.job_title.length||nameArr.designation.length){zmsuite.getCenter()[0].$el.find("#zcs-work-job-designation").append('<div id="zcs-dup-job_title" style="width: 49%;margin-right: 8px" class="zcs-merge-all-fields">');for(var i=0;i<nameArr.job_title.length;i++)zmsuite.getCenter()[0].$el.find("#zcs-dup-job_title").append("<label onclick=\"$('input[data-field-type=job_title]').val('"+encodeHTML(nameArr.job_title[i])+'\');"  class="zcs-merge-field" style="cursor: pointer;">'+nameArr.job_title[i]+"</label>");zmsuite.getCenter()[0].$el.find("#zcs-dup-job_title").append("</div>")}if(nameArr.job_title.length||nameArr.designation.length){zmsuite.getCenter()[0].$el.find("#zcs-work-job-designation").append('<div id="zcs-dup-designation" style="width: 48%" class="zcs-merge-all-fields">');for(var i=0;i<nameArr.designation.length;i++)zmsuite.getCenter()[0].$el.find("#zcs-dup-designation").append("<label onclick=\"$('input[data-field-type=designation]').val('"+encodeHTML(nameArr.designation[i])+'\');" class="zcs-merge-field" style="cursor: pointer;">'+nameArr.designation[i]+"</label>");zmsuite.getCenter()[0].$el.find("#zcs-dup-designation").append("</div>")}if(zmsuite.getCenter()[0].$el.find("#zcs-work-job-designation").append("</div>"),zmsuite.getCenter()[0].$el.find("#zcs-work-job-designation").append('<div style="clear: both;"></div>'),zmsuite.getCenter()[0].$el.find('input[data-field-type="wrk_street_addr"]').after('<div id="zcs-work-street" class="zcs-mr10" style="width :66.5%;float: left;">'),wrkAddrArr.street_addr.length){zmsuite.getCenter()[0].$el.find("#zcs-work-street").append('<div id="zcs-dup-wrk_street_addr" style="width: 147.6%" class="zcs-merge-all-fields">');for(var i=0;i<wrkAddrArr.street_addr.length;i++)zmsuite.getCenter()[0].$el.find("#zcs-dup-wrk_street_addr").append("<label onclick=\"$('input[data-field-type=wrk_street_addr]').val('"+encodeHTML(wrkAddrArr.street_addr[i])+'\');" class="zcs-merge-field" style="cursor: pointer;">'+wrkAddrArr.street_addr[i]+"</label>");zmsuite.getCenter()[0].$el.find("#zcs-dup-wrk_street_addr").append("</div><br><br>"),zmsuite.getCenter()[0].$el.find("#zcs-work-street").append("</div>"),zmsuite.getCenter()[0].$el.find("#zcs-work-street").append('<div style="clear: both;"></div>')}if(zmsuite.getCenter()[0].$el.find('input[data-field-type="wrk_street_addr1"]').after('<div id="zcs-work-street1" class="zcs-mr10" style="width :66.5%;float: left;">'),wrkAddrArr.street_addr1.length){zmsuite.getCenter()[0].$el.find("#zcs-work-street1").append('<div id="zcs-dup-wrk_street_addr1" style="width: 147.6%" class="zcs-merge-all-fields">');for(var i=0;i<wrkAddrArr.street_addr1.length;i++)zmsuite.getCenter()[0].$el.find("#zcs-dup-wrk_street_addr1").append("<label onclick=\"$('input[data-field-type=wrk_street_addr1]').val('"+encodeHTML(wrkAddrArr.street_addr1[i])+'\');" class="zcs-merge-field" style="cursor: pointer;">'+wrkAddrArr.street_addr1[i]+"</label>");zmsuite.getCenter()[0].$el.find("#zcs-dup-wrk_street_addr1").append("</div>"),zmsuite.getCenter()[0].$el.find("#zcs-work-street1").append("</div>"),zmsuite.getCenter()[0].$el.find("#zcs-work-street1").append('<div style="clear: both;"></div>')}if(zmsuite.getCenter()[0].$el.find('input[data-field-type="wrk_state"]').after('<div id="zcs-work-city-state" class="zcs-mr10" style="width: 99.1%;float: left;">'),wrkAddrArr.city.length||wrkAddrArr.state.length){zmsuite.getCenter()[0].$el.find("#zcs-work-city-state").append('<div id="zcs-dup-wrk_city" style="width: 49%;margin-right: 8px" class="zcs-merge-all-fields">');for(var i=0;i<wrkAddrArr.city.length;i++)zmsuite.getCenter()[0].$el.find("#zcs-dup-wrk_city").append("<label onclick=\"$('input[data-field-type=wrk_city]').val('"+encodeHTML(wrkAddrArr.city[i])+'\');" class="zcs-merge-field" style="cursor: pointer;">'+wrkAddrArr.city[i]+"</label>");zmsuite.getCenter()[0].$el.find("#zcs-dup-wrk_city").append("</div>")}if(wrkAddrArr.city.length||wrkAddrArr.state.length){zmsuite.getCenter()[0].$el.find("#zcs-work-city-state").append('<div id="zcs-dup-wrk_state" style="width: 48%;" class="zcs-merge-all-fields">');for(var i=0;i<wrkAddrArr.state.length;i++)zmsuite.getCenter()[0].$el.find("#zcs-dup-wrk_state").append("<label onclick=\"$('input[data-field-type=wrk_state]').val('"+encodeHTML(wrkAddrArr.state[i])+'\');" class="zcs-merge-field" style="cursor: pointer;">'+wrkAddrArr.state[i]+"</label>");zmsuite.getCenter()[0].$el.find("#zcs-dup-wrk_state").append("</div>")}if(zmsuite.getCenter()[0].$el.find("#zcs-work-city-state").append("</div>"),zmsuite.getCenter()[0].$el.find("#zcs-work-city-state").append('<div style="clear: both;"></div>'),zmsuite.getCenter()[0].$el.find('input[data-field-type="wrk_postal_code"]').after('<div id="zcs-work-country-pin" class="zcs-mr10" style="width: 99.1%;float: left;">'),wrkAddrArr.country.length||wrkAddrArr.postal_code.length){zmsuite.getCenter()[0].$el.find("#zcs-work-country-pin").append('<div id="zcs-dup-wrk_country" style="width: 49%;margin-right: 8px" class="zcs-merge-all-fields">');for(var i=0;i<wrkAddrArr.country.length;i++)zmsuite.getCenter()[0].$el.find("#zcs-dup-wrk_country").append("<label onclick=\"$('input[data-field-type=wrk_country]').val('"+encodeHTML(wrkAddrArr.country[i])+'\');" class="zcs-merge-field" style="cursor: pointer;">'+wrkAddrArr.country[i]+"</label>");zmsuite.getCenter()[0].$el.find("#zcs-dup-wrk_country").append("</div>")}if(wrkAddrArr.country.length||wrkAddrArr.postal_code.length){zmsuite.getCenter()[0].$el.find("#zcs-work-country-pin").append('<div id="zcs-dup-postal_code" style="width: 48%;" class="zcs-merge-all-fields">');for(var i=0;i<wrkAddrArr.postal_code.length;i++)zmsuite.getCenter()[0].$el.find("#zcs-dup-postal_code").append("<label onclick=\"$('input[data-field-type=wrk_postal_code]').val('"+encodeHTML(wrkAddrArr.postal_code[i])+'\');" class="zcs-merge-field" style="cursor: pointer;">'+wrkAddrArr.postal_code[i]+"</label>");zmsuite.getCenter()[0].$el.find("#zcs-dup-postal_code").append("</div>")}zmsuite.getCenter()[0].$el.find("#zcs-work-country-pin").append("</div>"),zmsuite.getCenter()[0].$el.find("#zcs-work-country-pin").append('<div style="clear: both;"></div>'),isMerge&&($("#zcs-top-btn").remove(),$("#zcs-delete-btn").remove(),$("#zcs-skip-btn").remove(),zmcontact.switchDetailsPage(!1))},showEditPage:function(contact){var editorActions={save:function(){var contactModel=this.toContactsModel(ZContacts.Contacts.create());if(contactModel){zmcontact.restrictClick(this.$e.find(".SC_PUbtm"),!0),$(".SC_PUbtm").append("<div id='zcs_loading'></div>");var destroyLoadingDiv=zmComponent.loadingBand({container:$("#zcs_loading").get(0),type:"pagination"}),contactId=contact.get("contact_id").toString();new URI(ZContacts.Contacts,ZContacts.getCurrentAccount().getAccountId(),contactId).PUT(contactModel).then(function(json){if(destroyLoadingDiv(),json.status_code!==ZContacts.Constants.StatusCode.OK)return void zmUtil.succErrMsg("e",ZContacts.getMessageFromResponse(json));$(".SC_PUbtm").removeAttr("disabled"),zmUtil.succErrMsg("s",ZContacts.getMessageFromResponse(json)),contactModel.set("photo_url",contact.get("photo_url")),contactModel.set("contact_id",contact.get("contact_id"));var $rowEle=zmcontact.getContactRowElement(contactModel),oldRowEle=zmsuite.getCenter()[0].getNodes()[2].$el.find("#"+contactId);$rowEle.insertAfter(oldRowEle),oldRowEle.remove(),zmcontact.renderContactDetails(contactModel),zmcontact.switchDetailsPage(!0)},function(json){destroyLoadingDiv(),$(".SC_PUbtm").removeAttr("disabled"),zmUtil.succErrMsg("e",ZContacts.getMessageFromResponse(json))}),zmcontact.unChkAll()}},cancel:function(){$(".SC_PUbtm").removeAttr("disabled"),zmcontact.loadContactDetails(contact.get("contact_id")),zmcontact.updateHeaderBand(zmcontact.getCategory(ZContacts._currentCategoryId))}},ceditor=new ZContacts.ContactEditor(!1,contact,{actions:editorActions}),$rightContainer=zmsuite.getCenter()[0].getNodes()[2].$el;ceditor.render($rightContainer.find(".zcs-cont-edit"),!0),$(".zcs-cont-edit").keypress(function(e){13==e.which&&$(this).find("#zcs-save-btn")[0].click()}),zmcontact.switchDetailsPage(!1),zmsuite.getCenter()[0].getNodes()[2].$el.find('[data-field-type="first_name"]')[0].focus()},showDuplicates:function(event){var t=event.target;if($(t).hasClass("SC_cont")||(t=$(t).parents(".zmL.SC_cont")[0]),!$(t).hasClass("zmSLst")){$(".zmL.SC_cont.zmSLst").removeClass("zmSLst"),$('div[data-field-type="zcs-cnt-view"]').attr("data-field-type",""),t.setAttribute("class","zmL SC_cont zmSLst"),t.setAttribute("data-field-type","zcs-cnt-view");var id=t.id;zmcontact.showMergeUI(id.split(","))}event.stopPropagation()},getContactRowElement:function(contact,isCleanDupes){var cRow=new ZContacts.StringBuilder;if(isCleanDupes){var contact_id=contact.contact_id.toString();contact=ZContacts.Contacts.create(contact),cRow.append("<div class='zmL SC_cont' data-field-type='' onclick='zmcontact.showDuplicates(event)' id='").append(contact_id).append("'>");var count=contact_id.split(",").length;cRow.append("<div class='zmLst'>"),cRow.append("<div class='zmDtl'>"),cRow.append("<div class='zcs-contDup-row'><span>").append(encodeHTML(contact.getFullName().trim())).append("</span>"),cRow.append("<div class='zcs-matched-count'><b title='"+count+" "+I18N.get("IAM.CONTACTS.MATCHED")+"'>"+count+"</b></div>"),cRow.append("</div></div>"),cRow.append("</div>"),cRow.append("</div>")}else{var photo_url=contact.get("photo_url"),contactZuid=contact.get("contact_zuid"),contactStatus=contact.get("status"),contact_id=contact.get("contact_id").toString();if(cRow.append("<div class='zmL SC_cont' data-field-type='' id='").append(contact_id).append("'>"),cRow.append("<div class='zmLst'>"),cRow.append("<div class='zmFlt'>"),cRow.append("<i class='msi-uncheck' onclick='zmcontact.select(event)'></i>"),-1!=contactZuid){var presence,status=WmsContacts.getStatusType(contactZuid);status==ContactStatus.OFFLINE?(status="wms-0",presence=I18N.get("IAM.OFFLINE")):status==ContactStatus.ONLINE?(status="wms-1-1",presence=I18N.get("IAM.ONLINE")):status==ContactStatus.INVISIBLE?(status="wms-2-1",presence=I18N.get("IAM.INVISIBLE")):status==ContactStatus.BUSY?(status="wms-3-1",presence=I18N.get("IAM.BUSY")):status==ContactStatus.IDLE&&(status="wms-4-1",presence=I18N.get("IAM.IDLE")),cRow.append("<i class='"+status+"' title='"+presence+"'></i>")}if(cRow.append("</div>"),cRow.append("<div class='zmDtl'>"),cRow.append("<div class='zmImg'>"),cRow.append("<img src='"+photo_url+"'>"),cRow.append("</div>"),cRow.append("<div class='zmFrm'><span>").append(encodeHTML(contact.getFullName().trim())).append("</span></div>"),contact.getPrimaryEmail()){if(cRow.append("<div class='zmSub'><span>").append(encodeHTML(contact.getPrimaryEmail())).append("</span></div>"),cRow.append("<div class='SC_icn'>"),cRow.append(zmail.forContactsApp?"<a onclick='zmcontact.sendMail(\""+contact.getPrimaryEmail()+"\")' style='text-decoration: none !important;'><i class='msi-mail' title='"+I18N.get("IAM.CONTACTS.SEND.MAIL")+"'></i></a>":"<i class='msi-mail' title='"+I18N.get("IAM.CONTACTS.SEND.MAIL")+'\'onclick=\'zmUtil.compose({"TO": "'+contact.getPrimaryEmail()+"\" });'></i>"),"personal"==ZContacts.getCurrentAccount().getType())if(-1==contactZuid)cRow.append("<i class='msi-invite-zoho' title='"+I18N.get("IAM.CONTACTS.INVITE.ZOHO")+"' onclick='zmcontact.inviteChat(event, \""+contact_id+"\",0)'></i>");else if(contactStatus>=0)cRow.append("<i class='msi-chat' title='"+I18N.get("IAM.CONTACTS.CHAT")+"' onclick='zmcontact.openChat(\""+contactZuid+"\",event)'></i>");else if(contactStatus==ContactStatus.DELETED||contactStatus==ContactStatus.REJECTED){var chat;chat=I18N.get(contactStatus==ContactStatus.DELETED?"IAM.CONTACTS.DELETED":"IAM.CONTACTS.REJECTED"),cRow.append("<i class='msi-chat-rejected' title='"+chat+"' onclick='zmcontact.inviteChat(event, \""+contact_id+'",'+contactStatus+")'></i>")}else contactStatus==ContactStatus.NO_CHAT?cRow.append("<i class='msi-invite-chat' title='"+I18N.get("IAM.CONTACTS.INVITE.TO.CHAT")+"' onclick='zmcontact.inviteChat(event, \""+contact_id+'",'+contactStatus+")'></i>"):(contactStatus==ContactStatus.PENDING||contactStatus==ContactStatus.REQACC)&&cRow.append("<i class='msi-chat-pending' title='"+I18N.get("IAM.CONTACTS.PENDING")+"'></i>");cRow.append("</div>")}cRow.append("</div>"),cRow.append("</div>"),cRow.append("</div>")}retHTML=cRow.toString();var $html=$(retHTML);return $html.get(0).__zc_contact=contact,$html},openChat:function(contactZuid,event){WebMessanger.chat(contactZuid),event.stopPropagation()},inviteChat:function(event,contactId,status){var msg;status==ContactStatus.NO_CHAT&&(msg="IAM.CONTACTS.ERROR.SURE.INVITE"),(status==ContactStatus.DELETED||status==ContactStatus.REJECTED)&&(msg="IAM.CONTACTS.ERROR.SURE.REINVITE"),0==status&&(msg="IAM.CONTACTS.SURE.INVITE.ZOHO"),zmsDialog.confirm(I18N.get(msg),{onOk:function(){new URI(ZContacts.InviteChat,ZContacts.getCurrentAccount().getAccountId(),contactId).POST(ZContacts.InviteChat.create({})).then(function(response){return 200==response.status_code?(zmUtil.succErrMsg("s",I18N.get("IAM.CONTACTS.ERROR.INVITED.SUCC")),void $(event.target).attr("class","msi-chat-pending")):void zmUtil.succErrMsg("s",I18N.get("IAM.ERROR.GENERAL"))},function(json){zmUtil.succErrMsg("e",ZContacts.getMessageFromResponse(json))})}}),event.stopPropagation()},select:function(event){var selectedCount,t=$(event.target),menuNode=zmsuite.getCenter()[0].getNodes()[0],currentElem=t.parents(".SC_cont");if(currentElem.hasClass("SC_check")){if(event.shiftKey){var elem;if(ZContacts._prevContact){if(currentElem.prevAll("#"+ZContacts._prevContact.attr("id")).length)for(elem=ZContacts._prevContact;elem.attr("id")!=currentElem.attr("id");)elem=elem.next(),elem.removeClass("SC_check"),elem.find(".msi-check").removeClass().addClass("msi-uncheck"),elem.find(".msi-uncheck").removeClass().addClass("msi-uncheck");else if(currentElem.nextAll("#"+ZContacts._prevContact.attr("id")).length)for(elem=ZContacts._prevContact;elem.attr("id")!=currentElem.attr("id");)elem=elem.prev(),elem.removeClass("SC_check"),elem.find(".msi-check").removeClass().addClass("msi-uncheck"),elem.find(".msi-uncheck").removeClass().addClass("msi-uncheck");ZContacts._prevContact.hasClass("SC_check")&&(ZContacts._prevContact.removeClass("SC_check"),ZContacts._prevContact.find(".msi-check").removeClass().addClass("msi-uncheck"))}}currentElem.hasClass("SC_check")&&(currentElem.removeClass("SC_check"),t.removeClass("msi-check").addClass("msi-uncheck")),ZContacts._prevContact=currentElem,selectedCount=$(".zmL.SC_cont.SC_check").length,zmcontact.updateHeaderBand(zmcontact.getCategory(ZContacts._currentCategoryId),selectedCount,!1)}else{var currentElem=$(event.target).parents(".SC_cont");if(event.shiftKey){var elem;if(ZContacts._prevContact){if(currentElem.prevAll("#"+ZContacts._prevContact.attr("id")).length)for(elem=ZContacts._prevContact;elem.attr("id")!=currentElem.attr("id");)elem=elem.next(),elem.addClass("SC_check"),elem.find(".msi-check").removeClass().addClass("msi-check"),elem.find(".msi-uncheck").removeClass().addClass("msi-check");else if(currentElem.nextAll("#"+ZContacts._prevContact.attr("id")).length)for(elem=ZContacts._prevContact;elem.attr("id")!=currentElem.attr("id");)elem=elem.prev(),elem.addClass("SC_check"),elem.find(".msi-check").removeClass().addClass("msi-check"),elem.find(".msi-uncheck").removeClass().addClass("msi-check");ZContacts._prevContact.hasClass("SC_check")||(ZContacts._prevContact.addClass("SC_check"),ZContacts._prevContact.find(".msi-uncheck").removeClass().addClass("msi-check"))}}currentElem.hasClass("SC_check")||(currentElem.addClass("SC_check"),t.removeClass("msi-uncheck").addClass("msi-check")),ZContacts._prevContact=currentElem,selectedCount=$(".zmL.SC_cont.SC_check").length,zmcontact.updateHeaderBand(zmcontact.getCategory(ZContacts._currentCategoryId),selectedCount,!1)}ZContacts.getCurrentAccount().isWritable&&(menuNode.showGroup("delete"),isRootFolder()||menuNode.showGroup("clearcategory"),2>selectedCount?menuNode.hideGroup("merge"):menuNode.showGroup("merge")),menuNode.showGroup("addto"),menuNode.showGroup("mail");var contCount=$(".zmL.SC_cont").length;menuNode.hideGroup("sort"),selectedCount==contCount?menuNode.$el.find(".msi-uncheck").removeClass().addClass("msi-check zcs-check"):0==selectedCount?(menuNode.$el.find(".msi-check").removeClass().addClass("msi-uncheck zcs-check"),menuNode.$el.find(".msi-partcheck").removeClass().addClass("msi-uncheck zcs-check"),menuNode.hideGroup("delete"),menuNode.hideGroup("mail"),menuNode.hideGroup("addto"),menuNode.hideGroup("clearcategory"),zmTab.currentTab!=ZContacts.ZMailConstants.SEARCH_WORKSPACE_APP_ID&&menuNode.showGroup("sort")):zmcontact.partiallyCheck(),event.stopPropagation()},partiallyCheck:function(){var menuNode=zmsuite.getCenter()[0].getNodes()[0];menuNode.$el.find(".msi-uncheck").removeClass().addClass("msi-uncheck msi-partcheck zcs-check"),menuNode.$el.find(".msi-check").removeClass().addClass("msi-uncheck msi-partcheck zcs-check")},createContactInTab:function(contactEditor){if(zmsuite.isWorkspaceAvailable(ZContacts.ZMailConstants.WORKSPACE_APP_ID))zmsuite.showWorkSpace(ZContacts.ZMailConstants.WORKSPACE_APP_ID);else{var contactsTabObj={appname:"Create Contact",appId:ZContacts.ZMailConstants.WORKSPACE_APP_ID,appIcon:"msi-edit",searchPlaceHolder:I18N.get("IAM.CONTACTS.SEARCH.CONTACTS"),data:{CNodes:"3"}};zmsuite.setWorkSpace(contactsTabObj),zmsuite.showWorkSpace(ZContacts.ZMailConstants.WORKSPACE_APP_ID)}var workspaceCenter=zmsuite.getCenter(ZContacts.ZMailConstants.WORKSPACE_APP_ID),centerNodes=workspaceCenter[0].getNodes();centerNodes[0].push([]);var headerObj={left:{leftHTML:I18N.get("IAM.CONTACTS.ADD.CONTACT")},right:[]};centerNodes[1].push(headerObj);var headericon={left:[],right:[{actionArr:[{iconList:["msi-close"],tooltip:I18N.get("IAM.CONTACTS.CLOSE.TAB")}]}]};centerNodes[0].push(headericon),centerNodes[0].setListener("click",function(ev,iconName){"msi-close"==iconName&&zmsuite.closeWorkspace("zm_createContact")});var listingCenter=centerNodes[2],$containerDiv=$("<div>").addClass("SC_PUcen").width("600px");contactEditor.rerender($containerDiv,!1),listingCenter.$el.append($containerDiv),listingCenter.$el.addClass("zcs-editor-form"),zmsuite.renderWorkSpace(),$(".zcs-editor-form").keypress(function(e){13==e.which&&$(this).find("#zcs-save-btn")[0].click()}),zmsuite.getCenter()[0].getNodes()[2].$el.find('[data-field-type="first_name"]')[0].focus()},restrictClick:function(elements,isRestrict){isRestrict?elements.attr("disabled","disabled"):elements.removeAttr("disabled")}},loadZCon=function(){if(zmsuite.isWorkspaceAvailable("zm_Contacts")){var curAppObj=zmsuite.getAppObj("zm_Contacts");zmTab.setTabForApp(curAppObj.obj),zmsuite.showApp("zm_Contacts"),zcon.contactLeft.setListener("click",function(data){zmcontact.bindLeftActions(data)}),zcon.contactLeft.setListener("contextmenu",function(data){zmcontact.bindLeftActions(data)})}else zmcontact.initContactSuite()},formatMessage=function(){var msg=arguments[0];if(msg)for(var i=1;i<arguments.length;i++)msg=msg.replace("{"+(i-1)+"}",arguments[i]);return msg};doAllowClick=function(element){return"disabled"==element.attr("disabled")?!1:!0};var logout=function(){var server_url=ZContacts.meta.serviceInfo.contacts_server_url,f=$('<form name="logoutForm" method="POST" action="'+server_url+'/logout"><input type="hidden" name="'+ZContacts.meta.serviceInfo.csrf_param_name+'" value="'+ZContacts.Cookie.getCSRFValue()+'"/></form>');$("body").append(f),f.submit()};return $.subscribe("contacts/metaDataLoaded",function(ev,obj){var metaJson=obj.data;ZContacts.meta=metaJson,new URI(ZContacts.Accounts).include("user.categories").include("groups").include("org").include("contacts.total_count").GETS().then(function(resp){ZContacts.AccountsList=[];for(var i=0;i<resp.length;i++){var acc=resp[i];ZContacts.AccountsVsRootFolderMap[acc.getRootFolderId()]=acc,ZContacts.AccountsVsRootFolderMap[acc.getAccountId()]=acc.getRootFolderId(),ZContacts.AccountsList.push({id:acc.getAccountId(),name:acc.getName(),display_text:acc.getName()}),acc.getType()==ZContacts.ZMailConstants.PERSONAL_ACCOUNT&&(ZContacts.user=acc),acc.getType()==ZContacts.ZMailConstants.ORG_ACCOUNT&&(ZContacts.org=acc),acc.getType()==ZContacts.ZMailConstants.GROUP_ACCOUNT&&(ZContacts.groups||(ZContacts.groups=[]),ZContacts.groups.push(acc))}ZContacts.setAccount(ZContacts.user),ZContacts.loadI18N=$.get(ZContacts.getContextPath()+"/new/jsp/i18n.jsp?"+metaJson.i18n_query_param),ZContacts.loadI18N.then(function(data){I18N.load(data),zmail.forContactsApp&&obj.showApp&&(loadZCon(),$("#ms_load").remove())})}),ZContacts.sortBy=4==ZContacts.meta.user.sort_by?"lname":"fname"}),$.subscribe("/contacts/load",function(){ZContacts.user&&ZContacts.loadI18N.then(function(){loadZCon()})}),$.subscribe("/contacts/logout",function(){logout()}),initObj}();ZContacts.ContactEditor=function(quickCreate,contacts,options){ZContacts.Utils.encodeHTML;this.contact=contacts;var I18N=ZContacts.I18N;this.quickCreate=quickCreate,this.options=options,this.setOptions=function(options){this.options=options},this.getHTML=function(){var html=new ZContacts.StringBuilder;html.append('<form class="SC_PUcen zcs-form2 zcs-editor" autocomplete="off"><div>'),this.options.actions.merge&&zmTab.currentTab==ZContacts.ZMailConstants.CLEAN_WORKSPACE_APP_ID&&(html.append('<div id="zcs-top-btn" class="zcs-field-group zcs-editor-qkcreate-hide SC_PUbtm"><span data-field-type="zcs-merge-btn" >').append(I18N.get("IAM.MERGE")).append("</span>"),html.append('<span style="margin-left: 10px;" data-field-type="zcs-delete-btn" data-val="Cancel">').append(I18N.get("IAM.DELETE")).append("</span>"),html.append('<span style="margin-left: 10px;" data-field-type="zcs-skip-btn" data-val="Cancel">').append(I18N.get("IAM.SKIP")).append("</span>"),html.append('<span style="margin-left: 10px;" data-val="Cancel" data-field-type="zcs-cancel-btn" data-val="Cancel">'+I18N.get("IAM.CANCEL")+"</span>"),html.append("</div>")),html.append('<div class="zcs-field-group"><label>').append(I18N.get("IAM.CONTACTS.NAME")).append("</label>"),html.append('<div class="zcs-field-row zcs-editor-name-cntnr">'),html.append('<input type="text" name="first_name" class="zcs_tiput zcs-mr5" data-field-type="first_name" placeholder="').append(I18N.get("IAM.CONTACTS.FIRSTNAME")).append('">'),html.append('<input type="text" name="middle_name" data-field-type="middle_name" class="zcs_tiput zcs-editor-qkcreate-hide zcs-ml5 zcs-mr10" placeholder="').append(I18N.get("IAM.CONTACTS.MIDDLENAME")).append('">'),html.append('<input type="text" name="last_name" data-field-type="last_name" class="zcs_tiput zcs-mt10" placeholder="').append(I18N.get("IAM.CONTACTS.LASTNAME")).append('">'),html.append('<input type="text" name="nick_name" data-field-type="nick_name" class="zcs_tiput zcs-editor-qkcreate-hide  zcs-ml10 zcs-mt10 zcs-mr5" placeholder="').append(I18N.get("IAM.CONTACTS.BASIC.NNAME")).append('">'),html.append("</div></div>"),html.append('<div class="zcs-editor-qkcreate-hide" style="padding-top:10px;padding-bottom:10px"></div>'),html.append('<div style="clear:both;" class="zcs-field-group"><label>').append(I18N.get("IAM.EMAIL.IDS")).append("</label>"),html.append('<div class="zcs-mfield" data-field-type="emails"  data-max-fields-count="5">'),html.append('<div class="zcs-mfield-row"><input type="text" data-field-type="email_id" name="email_id" class="zcs_tiput">'),html.append('<i class="msi-fav SC_fav zcs-fav zcs-ml5"></i><i class="msi-close zcs-close-mrow zcs-ml10"></i>'),html.append("</div></div></div>"),html.append('<div class="zcs-field-group"><label>').append(I18N.get("IAM.CONTACTS.BASIC.PHONE")).append("</label>"),html.append('<div class="zcs-mfield" data-field-type="phones"  data-max-fields-count="7">'),html.append('<div class="zcs-mfield-row"><input type="text" name="number" data-field-type="number" class="zcs_tiput">'),html.append('<div class="SC_select" style="width: 150px; margin-left: 5px; height: 33px;  margin-top: -2px;">'),html.append('<select class= select zcs-phtype" name="type">'),html.append('<option value="mobile">').append(I18N.get("IAM.CONTACTS.BASIC.MOBILE")).append("</option>"),html.append('<option value="home">').append(I18N.get("IAM.CONTACTS.BASIC.HOME")).append("</option>"),html.append('<option value="work">').append(I18N.get("IAM.CONTACTS.BASIC.WORK")).append("</option>"),html.append('<option value="fax">').append(I18N.get("IAM.CONTACTS.BASIC.FAX")).append("</option>"),html.append('<option value="others">').append(I18N.get("IAM.CONTACTS.OTHERS")).append("</option>"),html.append("</select>"),html.append("</div>"),html.append('<i class="msi-close zcs-close-mrow zcs-ml10"></i>'),html.append("</div></div></div>"),html.append('<div class="zcs-editor-qkcreate-hide">'),html.append('<div class="zcs-field-group"><label>').append(I18N.get("IAM.CONTACTS.IM.FULL")).append("</label>"),html.append('<div class="zcs-mfield" data-field-type="ims" data-max-fields-count="8">'),html.append('<div class="zcs-mfield-row"><input type="text" name="address" data-field-type="address" class="zcs_tiput">'),html.append('<div class="SC_select" style="width: 150px; margin-left: 5px; height: 33px;  margin-top: -2px;">'),html.append('<select class= select zcs-phtype" name="type">'),html.append('<option value="google">').append(I18N.get("IAM.CONTACTS.IM.GOOGLE")).append("</option>"),html.append('<option value="yahoo">').append(I18N.get("IAM.CONTACTS.IM.YAHOO")).append("</option>"),html.append('<option value="skype">').append(I18N.get("IAM.CONTACTS.IM.SKYPE")).append("</option>"),html.append('<option value="aol">').append(I18N.get("IAM.CONTACTS.IM.AOL")).append("</option>"),html.append('<option value="icq">').append(I18N.get("IAM.CONTACTS.IM.ICQ")).append("</option>"),html.append('<option value="msn">').append(I18N.get("IAM.CONTACTS.IM.MSN")).append("</option>"),html.append('<option value="jabber">').append(I18N.get("IAM.CONTACTS.IM.JABBER")).append("</option>"),html.append('<option value="others">').append(I18N.get("IAM.CONTACTS.OTHERS")).append("</option>"),html.append("</select>"),html.append("</div>"),html.append('<i class="msi-close zcs-close-mrow zcs-ml10"></i>'),html.append("</div></div></div>"),html.append('<div class="zcs-field-group"><label>').append(I18N.get("IAM.CONTACTS.URLS")).append("</label>"),html.append('<div class="zcs-mfield" data-field-type="urls"  data-max-fields-count="8">'),html.append('<div class="zcs-mfield-row"><input type="text" name="url" data-field-type="url" class="zcs_tiput">'),html.append('<div class="SC_select" style="width: 150px; margin-left: 5px; height: 33px;  margin-top: -2px;">'),html.append('<select class= select zcs-phtype" name="type">'),html.append('<option value="home">').append(I18N.get("IAM.CONTACTS.EXPORT.PERSONALWEB.ADDRESS")).append("</option>"),html.append('<option value="work">').append(I18N.get("IAM.CONTACTS.EXPORT.COMPANYWEB.ADDRESS")).append("</option>"),html.append('<option value="blog">').append(I18N.get("IAM.CONTACTS.BLOG.URL")).append("</option>"),html.append('<option value="linkedin">').append(I18N.get("IAM.CONTACTS.LINKEDIN.URL")).append("</option>"),html.append('<option value="facebook">').append(I18N.get("IAM.CONTACTS.FACEBOOK.URL")).append("</option>"),html.append('<option value="twitter">').append(I18N.get("IAM.CONTACTS.TWITTER.URL")).append("</option>"),html.append('<option value="amazon">').append(I18N.get("IAM.CONTACTS.AMAZON.URL")).append("</option>"),html.append('<option value="flickr">').append(I18N.get("IAM.CONTACTS.FLICKR.URL")).append("</option>"),html.append('<option value="delicious">').append(I18N.get("IAM.CONTACTS.DELICIOUS.URL")).append("</option>"),html.append('<option value="others">').append(I18N.get("IAM.CONTACTS.OTHERS")).append("</option>"),html.append("</select>"),html.append("</div>"),html.append('<i class="msi-close zcs-close-mrow zcs-ml10"></i>'),html.append("</div></div></div>"),html.append('<div class="zcs-field-group zcs-mt10"><label>').append(I18N.get("IAM.CONTACTS.PERSONAL")).append("</label>"),html.append('<div class="zcs-field-row">'),html.append('<label class="zcs-m0" style="display: inline-block;"><input type="radio" name="gender" value="M" class="zcs-mr5">').append(I18N.get("IAM.CONTACTS.GENDER.MALE")).append("</label>"),html.append('<label class="zcs-m0" style="display: inline-block;"><input type="radio" name="gender" value="F" class="zcs-ml30 zcs-mr5">').append(I18N.get("IAM.CONTACTS.GENDER.FEMALE")).append("</label></div>"),html.append('<div class="zcs-field-row"><div class="SC_select"  style="width: 75px;">'),html.append('<select class="select zcs-phtype" name="birth_day" >'),html.append('<option value="DD">').append(I18N.get("IAM.CONTACTS.DAY")).append("</option>");for(var i=1;31>=i;i++){var c=10>i?"0"+i:i;html.append("<option value="+c+">"+c+"</option>")}html.append("</select></div>"),html.append('<div class="SC_select" style="width: 125px; margin-left: 5px;" >'),html.append('<select class="select zcs-phtype" name="birth_month" >'),html.append('<option value="MM">').append(I18N.get("IAM.CONTACTS.MONTH")).append("</option>");for(var i=1;12>=i;i++){var c=10>i?"0"+i:i;html.append("<option value="+c+">").append(I18N.get("IAM.CONTACTS.MONTH."+c)).append("</option>")}return html.append("</select></div>"),html.append('<div style="display:inline-block;"><input type="text" style="margin-left: 5px;width: 75px;" name="birth_year"/></div></div>'),html.append('<div class="zcs-single-field-row"><textarea name="notes" class="zcs_tiput" rows="4" autocomplete="off" placeholder="').append(I18N.get("IAM.CONTACTS.NOTES")).append('"></textarea></div>'),html.append("</div>"),html.append('<div class="zcs-field-group" data-field-type="address/home"><label>').append(I18N.get("IAM.CONTACTS.OTHERS.HADDRESS")).append("</label>"),html.append('<div class="zcs-single-field-row"><input type="text" data-field-type="hme_street_addr" name="street_addr" placeholder="').append(I18N.get("IAM.CONTACTS.ST.ADDRESS")).append('" class="zcs_tiput">'),html.append("</div>"),html.append('<div class="zcs-single-field-row"><input type="text" data-field-type="hme_street_addr1" name="street_addr1" placeholder="').append(I18N.get("IAM.CONTACTS.ST.ADDRESS1")).append('" class="zcs_tiput">'),html.append("</div>"),html.append('<div class="zcs-field-row"><input type="text" data-field-type="hme_city" name="city" placeholder="').append(I18N.get("IAM.CONTACTS.WORK.CITY")).append('" class="zcs_tiput">'),html.append('<input type="text" data-field-type="hme_state" name="state" placeholder="').append(I18N.get("IAM.CONTACTS.WORK.STATE")).append('" class="zcs_tiput zcs-ml10">'),html.append("</div>"),html.append('<div class="zcs-field-row"><input type="text" data-field-type="hme_country" name="country" placeholder="').append(I18N.get("IAM.CONTACTS.WORK.COUNTRY")).append('" class="zcs_tiput">'),html.append('<input type="text" data-field-type="hme_postal_code" name="postal_code" placeholder="').append(I18N.get("IAM.CONTACTS.WORK.ZIP.POSTAL")).append('" class="zcs_tiput zcs-ml10">'),html.append("</div>"),html.append("</div>"),html.append('<div style="clear: both" class="zcs-field-group" data-field-type="address/work"><label>').append(I18N.get("IAM.CONTACTS.EXPORT.WORK.ADDRESS")).append("</label>"),html.append('<div class="zcs-single-field-row"><input type="text" data-field-type="company" name="company" placeholder="').append(I18N.get("IAM.CONTACTS.COMPANY")).append('" class="zcs_tiput">'),html.append("</div>"),html.append('<div style="clear: both" class="zcs-field-row"><input type="text" name="job_title" data-field-type="job_title" placeholder="').append(I18N.get("IAM.CONTACTS.JOBTITLE")).append('" class="zcs_tiput">'),html.append('<input type="text" name="designation" data-field-type="designation" placeholder="').append(I18N.get("IAM.CONTACTS.DESIGNATION")).append('" class="zcs_tiput zcs-ml10">'),html.append("</div>"),html.append('<div style="clear: both" class="zcs-single-field-row"><input type="text" data-field-type="wrk_street_addr" name="street_addr" placeholder="').append(I18N.get("IAM.CONTACTS.ST.ADDRESS")).append('" class="zcs_tiput">'),html.append("</div>"),html.append('<div class="zcs-single-field-row"><input type="text" data-field-type="wrk_street_addr1" name="street_addr1" placeholder="').append(I18N.get("IAM.CONTACTS.ST.ADDRESS1")).append('" class="zcs_tiput">'),html.append("</div>"),html.append('<div style="clear: both" class="zcs-field-row"><input type="text" data-field-type="wrk_city" name="city" placeholder="').append(I18N.get("IAM.CONTACTS.WORK.CITY")).append('" class="zcs_tiput">'),html.append('<input type="text" data-field-type="wrk_state" name="state" placeholder="').append(I18N.get("IAM.CONTACTS.WORK.STATE")).append('" class="zcs_tiput zcs-ml10">'),html.append("</div>"),html.append('<div style="clear: both" class="zcs-field-row"><input type="text" data-field-type="wrk_country" name="country" placeholder="').append(I18N.get("IAM.CONTACTS.WORK.COUNTRY")).append('" class="zcs_tiput">'),html.append('<input type="text" data-field-type="wrk_postal_code" name="postal_code" placeholder="').append(I18N.get("IAM.CONTACTS.WORK.ZIP.POSTAL")).append('" class="zcs_tiput zcs-ml10">'),html.append("</div>"),html.append("</div>"),html.append("</div>"),html.append('<div class="SC_lnk zcs-add-moreinfo zcs-editor-qkcreate-show">').append(I18N.get("IAM.CONTACTS.ADDMORE")).append("</div>"),html.append('<br/><div class="zcs-field-group zcs-editor-qkcreate-hide SC_PUbtm">'),this.options.actions.merge&&zmTab.currentTab==ZContacts.ZMailConstants.CLEAN_WORKSPACE_APP_ID?(html.append('<span id="zcs-merge-btn" data-field-type="zcs-merge-btn" >').append(I18N.get("IAM.MERGE")).append("</span>"),html.append('<span style="margin-left: 10px;" data-field-type="zcs-delete-btn" id="zcs-delete-btn" data-val="Cancel">').append(I18N.get("IAM.DELETE")).append("</span>"),html.append('<span style="margin-left: 10px;" data-field-type="zcs-skip-btn" id="zcs-skip-btn" data-val="Cancel">').append(I18N.get("IAM.SKIP")).append("</span>")):this.options.actions.merge?html.append('<span id="zcs-merge-btn" data-field-type="zcs-merge-btn" >').append(I18N.get("IAM.MERGE")).append("</span>"):html.append('<span id="zcs-save-btn" data-field-type="zcs-save-btn">').append(I18N.get("IAM.SAVE")).append("</span>"),html.append('<span data-val="Cancel" data-field-type="zcs-cancel-btn" id="zcs-cancel-btn" style="margin-left: 10px;" data-val="Cancel">'+I18N.get("IAM.CANCEL")+"</span>"),html.append("</div>"),html.append("</div></form>"),html.toString()},this.bindEvents=function(){$(".zcs-mfield").each(function(){var $mfields=$(this);1==$mfields.find(".zcs-mfield-row").size()&&$mfields.find(".zcs-close-mrow").hide()}),this.$e.find('[data-field-type="emails"] .zcs-fav').click(function(){var $this=$(this);$this.parent(".zcs-mfield-row").siblings().find(".SC_fav").removeClass("SC_fav"),$this.addClass("SC_fav")}),this.$e.find(".zcs-mfield .zcs_tiput").keyup(function(){var $row=$(this).parent(".zcs-mfield-row"),$siblings=$row.siblings(),maxFields=parseInt($(this).parents(".zcs-mfield").attr("data-max-fields-count"));if(zmTab.currentTab==ZContacts.ZMailConstants.CLEAN_WORKSPACE_APP_ID&&1!=quickCreate||!(maxFields<=$siblings.size()+1)){var $input=$(this);if(!($input.val().trim().length<1||$siblings.size()>0&&!$row.is(":last-child"))){0==$siblings.size()&&$row.find(".zcs-close-mrow").show();var $newRow=$row.clone(!0);$newRow.find(".zcs_tiput").val(""),$newRow.find(".zcs-fav").removeClass("SC_fav"),$newRow.insertAfter($row)}}}),this.$e.find(".zcs-mfield .zcs-close-mrow").click(function(){var $row=$(this).parent(".zcs-mfield-row"),$siblings=$row.siblings(),findIcon=$row.find(".SC_fav");0!=findIcon.length&&$($siblings[0]).find(".zcs-fav").addClass("SC_fav"),1==$siblings.size()&&($siblings.find(".zcs-close-mrow").hide(),$siblings.find(".zcs-fav").addClass("SC_fav")),$row.remove()});var _this=this;this.$e.find(".zcs-add-moreinfo").click(function(){zmcontact.createContactInTab(_this),zmsDialog.remove()}),this.$e.find("span[data-field-type=zcs-save-btn]").click(function(){_this.options&&_this.options.actions&&_this.options.actions.save&&_this.options.actions.save.apply(_this)}),this.$e.find("span[data-field-type=zcs-cancel-btn]").click(function(){_this.options&&_this.options.actions&&_this.options.actions.cancel&&_this.options.actions.cancel.apply(_this)}),this.$e.find("span[data-field-type=zcs-skip-btn]").click(function(event){_this.options&&_this.options.actions&&_this.options.actions.skip&&(_this.options.actions.skip.apply(_this),event.stopPropagation())}),this.$e.find("span[data-field-type=zcs-delete-btn]").click(function(event){_this.options&&_this.options.actions&&_this.options.actions.deleteContact&&(_this.options.actions.deleteContact.apply(_this),event.stopPropagation())}),this.$e.find("span[data-field-type=zcs-merge-btn]").click(function(){_this.options&&_this.options.actions&&_this.options.actions.merge&&_this.options.actions.merge.apply(_this)})},this.handleQuickCreate=function(){this.quickCreate?this.$e.addClass("zcs-editor-qkcreate"):this.$e.removeClass("zcs-editor-qkcreate")},this.render=function($containerEle,override){this.$e=$(this.getHTML()),override?$containerEle.html(this.$e):$containerEle.append(this.$e),this.bindEvents(),this.handleQuickCreate(),this.setValue()},this.rerender=function($containerEle,quickCreate){this.quickCreate=quickCreate,this.handleQuickCreate(),$containerEle.append(this.$e)},this.toContactsModel=function(contact){contact.set("first_name",this.$e.find('[name="first_name"]').val()),contact.set("company",this.$e.find('[name="company"]').val().trim());for(var $mailRows=this.$e.find('[data-field-type="emails"] .zcs-mfield-row'),emailSize=0,i=0;i<$mailRows.size();i++){var $mRow=$($mailRows[i]),$input=$mRow.find('[name="email_id"]'),mailid=$input.val().trim(),primary=$mRow.find(".zcs-fav").hasClass("SC_fav");if(mailid){if(emailSize++,emailSize>5)return $input.focus(),void zmUtil.succErrMsg("e",I18N.get("IAM.CONTACTS.ERROR.EMAIL.LIMIT.REACHED"));if(!ZContacts.Utils.isEmailId(mailid))return $input.focus(),void zmUtil.succErrMsg("e",I18N.get("IAM.ERROR.VALID.EMAIL"));var emailModel=ZContacts.Emails.create({email_id:mailid,is_primary:primary});contact.addSubResource(emailModel)}}var fname=contact.first_name.trim(),company=contact.company.trim(),hasEmail=!contact.get("emails")||!contact.get("emails").length;if(!fname&&hasEmail&&!company)return this.$e.find('[name="first_name"]').focus(),zmUtil.succErrMsg("e",I18N.get("IAM.CONTACTS.FIRST.NAME.REQUIRED")),null;contact.set("middle_name",this.$e.find('[name="middle_name"]').val()),contact.set("last_name",this.$e.find('[name="last_name"]').val()),contact.set("nick_name",this.$e.find('[name="nick_name"]').val());for(var $phoneRows=this.$e.find('[data-field-type="phones"] .zcs-mfield-row'),phoneSize=0,i=0;i<$phoneRows.size();i++){var $pRow=$($phoneRows[i]),$input=$pRow.find('[name="number"]'),phNo=$input.val().trim();if(phNo){if(!ZContacts.Utils.isValidPhoneNumber(phNo))return $input.focus(),void zmUtil.succErrMsg("e",ZContacts.I18N.formatMessage(I18N.get("IAM.ERROR.INVALID.PHONE.NUMBERS"),phNo));if(phoneSize++,phoneSize>8)return void zmUtil.succErrMsg("e",I18N.get("IAM.CONTACTS.ERROR.PHONE.LIMIT.REACHED"));var phoneModel=ZContacts.PhoneNumbers.create({number:phNo,type:$pRow.find('[name="type"]').val()});contact.addSubResource(phoneModel)}}for(var $ImsRows=this.$e.find('[data-field-type="ims"] .zcs-mfield-row'),imsSize=0,i=0;i<$ImsRows.size();i++){var $imsRow=$($ImsRows[i]),$input=$imsRow.find('[name="address"]'),Ims=$input.val().trim();if(Ims&&!ZContacts.isUserNameRex(Ims)&&!ZContacts.isEmailIdRex(Ims))return $input.focus(),void zmUtil.succErrMsg("e",ZContacts.I18N.formatMessage(I18N.get("IAM.ERROR.INVALID.IM"),Ims));if(Ims){if(imsSize++,imsSize>8)return void zmUtil.succErrMsg("e",I18N.get("IAM.CONTACTS.ERROR.IMS.LIMIT.REACHED"));var ims=ZContacts.Ims.create({address:Ims,type:$imsRow.find('[name="type"]').val()});contact.addSubResource(ims)}}for(var $urlRows=this.$e.find('[data-field-type="urls"] .zcs-mfield-row'),urlSize=0,i=0;i<$urlRows.size();i++){var $urlRow=$($urlRows[i]),$input=$urlRow.find('[name="url"]'),urls=$input.val().trim();if(urls){if(urlSize++,urlSize>8)return void zmUtil.succErrMsg("e",I18N.get("IAM.CONTACTS.ERROR.URLS.LIMIT.REACHED"));var urlModel=ZContacts.Urls.create({url:urls,type:$urlRow.find('[name="type"]').val()});contact.addSubResource(urlModel)}}contact.set("gender",this.$e.find('[name="gender"]:checked').val());var birthMonth=this.$e.find('[name="birth_month"] option:selected').val(),birthDate=this.$e.find('[name="birth_day"] option:selected').val(),birthYear=this.$e.find('[name="birth_year"]').val().trim();if(birthYear&&(isNaN(birthYear)||4!=birthYear.length))return zmUtil.succErrMsg("e",I18N.get("IAM.CONTACTS.INVALID.BIRTH.YEAR")),void this.$e.find('[name="birth_year"]').focus();if(birthYear){if("DD"==birthDate||"MM"==birthMonth)return void zmUtil.succErrMsg("e",I18N.get("IAM.CONTACTS.ENTER.VALID.BDATE"));contact.set("birth_year",birthYear)}if("DD"!=birthDate||"MM"!=birthMonth){if("DD"==birthDate||"MM"==birthMonth)return void zmUtil.succErrMsg("e",I18N.get("IAM.CONTACTS.ENTER.VALID.BDATE"));contact.set("birth_month",birthMonth),contact.set("birth_day",birthDate)}contact.set("job_title",this.$e.find('[name="job_title"]').val().trim()),contact.set("designation",this.$e.find('[name="designation"]').val().trim()),contact.set("notes",this.$e.find('[name="notes"]').val().trim());var $home_address=this.$e.find('[data-field-type="address/home"]'),homeAddress=ZContacts.Address.create({street_addr:$home_address.find('[name="street_addr"]').val().trim(),street_addr1:$home_address.find('[name="street_addr1"]').val().trim(),city:$home_address.find('[name="city"]').val().trim(),state:$home_address.find('[name="state"]').val().trim(),country:$home_address.find('[name="country"]').val().trim(),postal_code:$home_address.find('[name="postal_code"]').val().trim(),type:"home"});contact.addSubResource(homeAddress);var $work_address=this.$e.find('[data-field-type="address/work"]'),workAddress=ZContacts.Address.create({street_addr:$work_address.find('[name="street_addr"]').val().trim(),street_addr1:$work_address.find('[name="street_addr1"]').val().trim(),city:$work_address.find('[name="city"]').val().trim(),state:$work_address.find('[name="state"]').val().trim(),country:$work_address.find('[name="country"]').val().trim(),postal_code:$work_address.find('[name="postal_code"]').val().trim(),type:"work"});return contact.addSubResource(workAddress),contact},this.setValue=function(){this.contact&&this.setValueInContainer(this.$e,this.contact)},this.setValueInContainer=function($container,obj){for(var k in obj)if(obj.hasOwnProperty(k)&&"categories"!=k){var value=obj.get(k);if(value)if($.isArray(value))if("address"===k)for(var i=0;i<value.length;i++){var addr=value[i],$addressContainer=$container.find('[data-field-type="address/'+addr.get("type")+'"]');this.setValueInContainer($addressContainer,addr)}else for(var $multiContainer=$container.find('[data-field-type="'+k+'"]'),vi=0,i=0;i<value.length;i++){var vObj=value[i];for(var k1 in vObj)if(vObj.hasOwnProperty(k1)){var v1=vObj.get(k1),$input=$multiContainer.find('[name="'+k1+'"]').eq(vi);$input.size()>0&&(this.setValueToInput($input,v1),$input.keyup()),"is_primary"===k1&&"emails"===k&&v1&&$multiContainer.find(".zcs-fav").eq(vi).click()}vi++}else{var $input=$container.find('[name="'+k+'"]');this.setValueToInput($input,value)}}},this.setValueToInput=function($input,value){if($input.size()>1){if($input.is(":radio"))for(var i=0;i<$input.size();i++){var elem=$input.get(i);elem.value===value&&(elem.checked=!0)}}else $input.val(value)}};var zmContactsSearch=function(){"use strict";function ContactsSearchCollection(obj){this.searchQueryArr=[],this.advSearchStr=obj&&obj.advSearchStr||[],this.searchList={},this.searchOrder=[],this.hasNext=1,this.limit=50,this.sending=!1}function ContactsSearchView(){}ContactsSearchCollection.prototype={setAdvSearchStr:function(str){this.advSearchStr=str},setSearchQueryArr:function(arr){this.searchQueryArr=arr;var sString=this.getSearchQueryFromArr(this.searchQueryArr);this.setAdvSearchStr(sString)},addSearchList:function(searchObj){zmcontact.contactsList(searchObj,!1,!1),searchObj.order||(searchObj.order=[]),searchObj.list||(searchObj.list={})},sendRequest:function(squery){var params={},curObj=this;if(!this.sending&&this.hasNext&&zmSearch.hasSearchableText(this.advSearchStr)||squery){this.sending=!0;var start=this.searchOrder.length||1;params.start=start,params.limit=this.limit,params.search=this.advSearchStr.length>0?this.advSearchStr:squery,zmcontact.searchValue=params.search,params.taction="searchContacts",params.isPrev="false",params.groupId=zmail.zuid;var searchRequest=function(){var URI=ZContacts.URI;return new URI(ZContacts.Contacts,ZContacts.getCurrentAccount().getAccountId()).include("emails").include("phones").addSearchQuery(params.search).setPagination("1","50").GETS().then(function(json){curObj.searchResponse(json)},function(json){zmUtil.succErrMsg("e",ZContacts.getMessageFromResponse(json))})};searchRequest()}},searchResponse:function(resp){this.sending=!1,this.addSearchList(resp)},flushData:function(){},getSearchQueryFromArr:function(){return this.searchQueryArr[0].All?this.searchQueryArr[0].All:this.searchQueryArr[0].Name?this.searchQueryArr[0].Name:this.searchQueryArr[0].Phone?this.searchQueryArr[0].Phone:this.searchQueryArr[0].Email?this.searchQueryArr[0].Email:this.searchQueryArr[0].Address?this.searchQueryArr[0].Address:this.searchQueryArr[0].Notes?this.searchQueryArr[0].Notes:this.searchQueryArr[0].Company?this.searchQueryArr[0].Company:void 0},getSearchVal:function(){}};var viewObj={getHeaderObj:function(){var headerObj={left:{leftHTML:"<b>"+ZContacts.I18N.get("IAM.CONTACTS.SEARCH.RESULTS")+"</b>"},right:[]};return headerObj},getActionObj:function(){var actionObj={list:{left:zmcontact.getActionMenuList(),right:[{actionArr:[{iconList:["msi-close"],tooltip:"Close Tab"}]}]}};return actionObj},getActionObjHandler:function(event,iconName){zmcontact.bindHeaderIcons(event,iconName)},constructCenter:function(){var centerNodes=zmsuite.getCenter()[0].getNodes();centerNodes[1].push(viewObj.getActionObj()),centerNodes[2].setListener("click",function(event){zmcontact.bindEventsContactsRow(event)}),centerNodes[2].setListener("contextmenu",function(){}),zmsuite.renderCenter()},bind:function(){viewObj.constructCenter()}};return ContactsSearchView.prototype=Object.create(SearchOuterView.prototype),$.extend(ContactsSearchView.prototype,viewObj),{contactsCollection:ContactsSearchCollection,contactsView:ContactsSearchView}}();ZContacts.store_value=function(){},ZContacts.importResponse=function(data){var contactImport=new ZContacts.contactimport;contactImport.createPageContent(getHtmlForFinishImport(data),!1),$("#testzc").click(confirm_response,function(){var requst=$("#testzc").attr("data-val");ZContacts.contactimport.EmailDetailsPopup(confirm_response,requst)})},ZContacts.contactimport=function(){var encodeHTML=ZContacts.Utils.encodeHTML;getHtmlForImport=function(){var syncUrl=ZContacts.meta.syncUrls;ZContacts.current_step=0;var html=new ZContacts.StringBuilder,rootFolderId=zmcontact.getRootFolderId(ZContacts._currentCategoryId),acc=ZContacts.AccountsVsRootFolderMap[rootFolderId];return html.append('<span class = "zcs_loadingband"></span><br><div style="display: inline-block;">'),"Personal"==acc.name?(html.append('<div><p class="zcs_imp_header_one">'+ZContacts.I18N.get("IAM.CONTACTS.IMPORT.STEPONE.HEADER")+"</p>"),html.append('<p class="zcs_imp_header_two">'+ZContacts.I18N.get("IAM.CONTACTS.IMPORT.STEPONE.HEADER.TWO")+"</p></div>")):html.append('<div><p class="zcs_imp_header_one">'+ZContacts.I18N.get("IAM.CONTACTS.IMPORT.ORG.AND.GROUP.HEADER")+"</p></div>"),html.append('<ul class="zcs_im_tabs">'),html.append('<li class="zcs_im_local zcs_ims_box">'),html.append('<br><span class="msi-localDrive zcs_im_local_icons"></span>'),html.append('<br><span style="font-size: 18px; padding: 15px;">'+ZContacts.I18N.get("IAM.CONTACTS.IMPORT.LOCAL.DRIVE")+"</span>"),html.append('<br><form name="importlocalForm" id="importlocalFormId" enctype="multipart/form-data" method="Post" style="max-width:205px">'),html.append('<label style="cursor: pointer;"><input type="file" name="importcontact" id="impcont" onchange="ZContacts.contactimport.importContacts()" style="visibility: hidden; width: 99%;"/>'),html.append('<font color="#0073e8" style="margin-left: 15px;">'+ZContacts.I18N.get("IAM.CONTACTS.CHOOSE.FILE")+"</font></label></br></br>"),html.append('<span style="margin-left: 15px;color: #878787;">'+ZContacts.I18N.get("IAM.CONTACTS.SUPPORT.FORMATES")+"</span></br>"),html.append('<span style="margin-left: 15px;color: #878787;">'+ZContacts.I18N.get("IAM.CONTACTS.CSV.AND.VCF")+"</span></form>"),html.append("</li>"),"Personal"==acc.name&&(html.append('<li class="zcs_im_gmail zcs_ims_box" onclick = "ZContacts.contactimport.syncAccounts(\''+syncUrl.google+"','"+ZContacts.I18N.get("IAM.CONTACTS.GMAIL")+"')\">"),html.append('<br><span class="msi-gmail zcs_im_icons"></span>'),html.append('<br><span style="font-size: 20px; margin-left: 12px; color: white;">'+ZContacts.I18N.get("IAM.CONTACTS.GMAIL")+"</span>"),html.append('<br></br><div style="margin-left: 3%; padding: 10px 5px 0px 9px; max-width:205px" ><span style="color: white; font-size: 15px;">'+ZContacts.I18N.get("IAM.CONTACTS.GOOGLE.ACCOUNT.SIZE")+" </span></div></br>"),html.append("</li>"),html.append('<li class="zcs_im_yahoo zcs_ims_box" onclick= "ZContacts.contactimport.syncAccounts(\''+syncUrl.yahoo+"','"+ZContacts.I18N.get("IAM.CONTACTS.YAHOO")+"')\">"),html.append('<br><span class="msi-yahoo zcs_im_icons"></span></br>'),html.append('<span style="font-size: 20px; margin-left: 13px;color: white;">'+ZContacts.I18N.get("IAM.CONTACTS.YAHOO")+"</span></br></br>"),html.append('<div style="margin-left: 5%; padding: 9px 0px 0px 2px; max-width:205px"><span style="color: white; font-size: 15px;">'+ZContacts.I18N.get("IAM.CONTACTS.YAHOO.ACCOUNT")+"</span></div></br>"),html.append("</li>"),html.append('<li class="zcs_im_outlook zcs_ims_box" onclick ="ZContacts.contactimport.syncAccounts(\''+syncUrl.windowsLiveUrl+"','"+ZContacts.I18N.get("IAM.CONTACTS.OUTLOOK")+"')\">"),html.append('<br><span class="msi-outlook zcs_im_icons"></span></br>'),html.append('<span style="font-size: 19px; margin-left: 10px;color: white;">'+ZContacts.I18N.get("IAM.CONTACTS.OUTLOOK")+"</span></br></br>"),html.append('<div style="margin-left: 8%; padding: 9px 0px 0px 0px; max-width:205px"><span style="color: white; font-size: 15px;">'+ZContacts.I18N.get("IAM.CONTACTS.OUTLOOK.ACCOUNT")+"</span></div></br>"),html.append("</li>")),html.append("</ul>"),html.append("</div>"),html.toString()},getHtmlForMapping=function(response,preview){var html=new ZContacts.StringBuilder;if(html.append('<div class ="zcs_mapping_main">'),1==preview){ZContacts.current_step=1;{var headers=response.importcontacts.headers;response.importcontacts.headersMap}ZContacts.store_value.mapping_response=response,html.append('<div id="mappingPage" class ="zcs_mapping_page">'),html.append('<span class="zcs_header_loadingband"></span><br>'),html.append('<div><span class="zcs_mapping_header_one">'+ZContacts.I18N.get("IAM.CONTACTS.MAPING.HEADER")+"</span><br></br>"),html.append('<span class="zcs_mapping_header_two">'+ZContacts.I18N.get("IAM.CONTACTS.FIELD.MAPPING")+" </span></div>"),html.append('<div class="zcs_mapping_main_div"><br>'),html.append('<div class="zcs_mapping_border_header">'),html.append('<span class="zcs_mapping_field_header">'+ZContacts.I18N.get("IAM.CONTACTS.FIELDS.HEADER")+"</span>"),html.append('<span style="margin-left: 5px;">'+ZContacts.I18N.get("IAM.CONTACTS.IMPORT.FIELD")+"</span>"),html.append("</div>"),html.append('<div class="zcs_mapping_scroll_div"><form id="mappingForm">'),html.append("<div><br>"),html.append('<div style="font-size: 15px;">'),html.append('<div><span class="zcs_mapping_info_lft"> '+ZContacts.I18N.get("IAM.CONTACTS.FIRSTNAME")+" :</span> "),html.append('<span class="zcs_mapping_info_right SC_select" name="first_name">'+getSelectBox(response,"FIRST_NAME")+"</span></span>"),html.append('<span class="zcs_mapping_info_lft" style="padding-left: 60px"> '+ZContacts.I18N.get("IAM.CONTACTS.MIDDLENAME")+" :</span> "),html.append('<span class="zcs_mapping_info_right SC_select" name="middle_name">'+getSelectBox(response,"MIDDLE_NAME")+"</span></div><br></br><br>"),html.append('<span class="zcs_mapping_info_lft"> '+ZContacts.I18N.get("IAM.CONTACTS.LASTNAME")+" :</span> "),html.append('<span class="zcs_mapping_info_right SC_select" name="last_name">'+getSelectBox(response,"LAST_NAME")+"</span>"),html.append('<span class="zcs_mapping_info_lft" style="padding-left: 60px"> '+ZContacts.I18N.get("IAM.CONTACTS.BASIC.NNAME")+" :</span> "),html.append('<span class="zcs_mapping_info_right SC_select" name="nick_name">'+getSelectBox(response,"NICK_NAME")+"</span><br></br><br></br>"),html.append('<span class="zcs_mapping_info_lft"> '+ZContacts.I18N.get("IAM.CONTACTS.CATEGORIES")+" :</span>"),html.append('<span class="zcs_mapping_info_right SC_select">'+getSelectBox(response,"CATEGORIES")+"</span><br></br><br></br>"),html.append('<div class="zcs_email_div pack_block">'),html.append('<div class="zcs_mapping_info_lft""> '+ZContacts.I18N.get("IAM.CONTACTS.EMAIL")+" :</div>"),html.append('<div class="zcs_mapping_fld_grp" style="width: 100%;min-height: 30px;"><div class="zcs_mapping_info_lft zcs_mapping_info_lft_empty" style="height: 30px;display: none !important;"></div>'),html.append('<div class="zcs_siblings" style="display: block;width: 100%;min-width: 597px;">'),html.append('<div class="zcs_mapping_info_right SC_select" name="email" style="display: inline-block;">'+getSelectBox(response,"EMAIL")+"</div>"),html.append('<div class="msi-plus" style="display: inline-block;float: left;margin-top: 10px;margin-left: 10px;" onclick="ZContacts.contactimport.createExtraRows(this, 5, \'zcs_email_div\', \'email\')"></div>'),html.append("</div></div>"),html.append("</div><br></br>"),html.append('<div class="zcs_phone_div pack_block">'),html.append('<div class="zcs_mapping_info_lft""> '+ZContacts.I18N.get("IAM.CONTACTS.BASIC.PHONE")+" :</div>");for(var mobileIndex=0,phone_map=ZContacts.ImportMapConstants.PHONE_Map,phones=[],i=0;i<headers.length;i++){var header=headers[i].name,PhoneMap=phone_map[header];if(PhoneMap){var headerType=PhoneMap.split("-")[0],headerName=PhoneMap.split("-")[1],contentStr="";contentStr+='<div class="zcs_mapping_fld_grp" style="width: 100%;min-height: 30px; margin-top: 15px;">',contentStr+=0==mobileIndex?'<div class="zcs_mapping_info_lft zcs_mapping_info_lft_empty" style="height: 30px;display: none !important;"></div>':'<div class="zcs_mapping_info_lft zcs_mapping_info_lft_empty" style="height: 30px;"></div>',contentStr+='<div class="zcs_siblings" style="display: block;width: 100%;min-width: 597px;">',contentStr+='<div class="zcs_mapping_info_right SC_select" name="phone" style="display: inline-block;">'+getSelectBox(response,headerName)+"</div>",contentStr+='<div class="zcs-left SC_select" style="margin-left: 10px;">'+getTypeSelectBox(headerType,"ph")+"</div>",phones.push(contentStr),mobileIndex++}}if(0==phones.length&&(html.append('<div class="zcs_mapping_fld_grp" style="width: 100%;min-height: 30px;"><div class="zcs_mapping_info_lft zcs_mapping_info_lft_empty" style="height: 30px;display: none !important;"></div>'),html.append('<div class="zcs_siblings" style="display: block;width: 100%;min-width: 597px;">'),html.append('<div class="zcs_mapping_info_right SC_select" name="phone" style="display: inline-block;">'+getSelectBox(response,"phone")+"</div>"),html.append('<div class="zcs-left SC_select" style="margin-left: 10px;">'+getTypeSelectBox(headerType,"ph")+"</div>"),html.append('<div class="msi-plus" style="display: inline-block;float: left;margin-top: 10px;margin-left: 10px;" onclick="ZContacts.contactimport.createExtraRows(this, 7, \'zcs_phone_div\', \'phone\')"></div>'),html.append("</div></div>"),html.append("</div><br></br>")),phones.length){for(var i=0;i<phones.length;i++){var ph_index=phones[i];if(0==phones.length)var testee=ph_index.concat('<div class="msi-plus" style="display: inline-block;float: left;margin-top: 10px;margin-left: 10px;" onclick="ZContacts.contactimport.createExtraRows(this,7, \'zcs_phone_div\', \'phone\')"></div>');else if(phones.length===i+1&&phones.length<7){var testee=ph_index.concat('<div class="msi-plus" style="display: inline-block;float: left;margin-top: 10px;margin-left: 10px;" onclick="ZContacts.contactimport.createExtraRows(this,7, \'zcs_phone_div\', \'phone\')"></div>');testee+='<div class="msi-close zcs_msi_close" style="display: inline-block;float: left;margin-top: 10px;margin-left: 10px;" onclick="ZContacts.contactimport.createExtraRows(this,7, \'zcs_phone_div\', \'phone\')"></div>'}else var testee=ph_index.concat('<div class="msi-close" style="display: inline-block;float: left;margin-top: 10px;margin-left: 10px;" onclick="ZContacts.contactimport.createExtraRows(this,7, \'zcs_phone_div\', \'phone\')"></div>');var end_line="</div></div>",phone_div_complet=testee.concat(end_line);html.append(phone_div_complet)}html.append("</div></br></br>")}html.append('<div class="zcs_ims_div pack_block">'),html.append('<div class="zcs_mapping_info_lft""> '+ZContacts.I18N.get("IAM.CONTACTS.IMS")+" :</div>");for(var imsIndex=0,ims=[],ims_map=ZContacts.ImportMapConstants.IMS_Map,i=0;i<headers.length;i++){var header=headers[i].name,ImsMap=ims_map[header];if(ImsMap){var imsHeaderType=ImsMap,imsHeaderName=ImsMap.toUpperCase()+"_IM",contentStr="";contentStr+='<div class="zcs_mapping_fld_grp" style="width: 100%;min-height: 30px; margin-top: 15px;">',contentStr+=0==imsIndex?'<div class="zcs_mapping_info_lft zcs_mapping_info_lft_empty" style="height: 30px;display: none !important"></div>':'<div class="zcs_mapping_info_lft zcs_mapping_info_lft_empty" style="height: 30px;"></div>',contentStr+='<div class="zcs_siblings" style="display: block;width: 100%;min-width: 597px;">',contentStr+='<div class="zcs_mapping_info_right SC_select" name="ims" style="display: inline-block;">'+getSelectBox(response,imsHeaderName)+"</div>",contentStr+='<div class="zcs-left SC_select" style="margin-left: 10px;">'+getTypeSelectBox(imsHeaderType,"ims")+"</div>",ims.push(contentStr),imsIndex++}}if(0==ims.length&&(html.append('<div class="zcs_mapping_fld_grp" style="width: 100%;min-height: 30px;"><div class="zcs_mapping_info_lft zcs_mapping_info_lft_empty" style="height: 30px;display: none !important;"></div>'),html.append('<div class="zcs_siblings" style="display: block;width: 100%;min-width: 597px;">'),html.append('<div class="zcs_mapping_info_right SC_select" name="ims" style="display: inline-block;">'+getSelectBox(response,"ims")+"</div>"),html.append('<div class="zcs-left SC_select" style="margin-left: 10px;">'+getTypeSelectBox(headerType,"ims")+"</div>"),html.append('<div class="msi-plus" style="display: inline-block;float: left;margin-top: 10px;margin-left: 10px;" onclick="ZContacts.contactimport.createExtraRows(this, 8, \'zcs_ims_div\', \'ims\')"></div>'),html.append("</div></div>"),html.append("</div><br></br>")),ims.length){for(var i=0;i<ims.length;i++){var ims_index=ims[i];if(0==ims.length)var testee=ims_index.concat('<div class="msi-plus" style="display: inline-block;float: left;margin-top: 10px;margin-left: 10px;" onclick="ZContacts.contactimport.createExtraRows(this,8, \'zcs_ims_div\', \'ims\')"></div>');else if(ims.length===i+1&&ims.length<8){var testee=ims_index.concat('<div class="msi-plus" style="display: inline-block;float: left;margin-top: 10px;margin-left: 10px;" onclick="ZContacts.contactimport.createExtraRows(this,8, \'zcs_ims_div\', \'ims\')"></div>');testee+='<div class="msi-close zcs_msi_close" style="display: inline-block;float: left;margin-top: 10px;margin-left: 10px;" onclick="ZContacts.contactimport.createExtraRows(this,8, \'zcs_ims_div\', \'ims\')"></div>'}else var testee=ims_index.concat('<div class="msi-close" style="display: inline-block;float: left;margin-top: 10px;margin-left: 10px;" onclick="ZContacts.contactimport.createExtraRows(this,8, \'zcs_ims_div\', \'ims\')"></div>');var end_line="</div></div>",ims_div_complet=testee.concat(end_line);html.append(ims_div_complet)}html.append("</div></br>")}html.append('<div class="zcs_urls_div pack_block">'),html.append('<div class="zcs_mapping_info_lft""> '+ZContacts.I18N.get("IAM.CONTACTS.URLS")+" :</div>");for(var urlsIndex=0,urls=[],urlsHeaderType="",urls_map=ZContacts.ImportMapConstants.URLS_Map,i=0;i<headers.length;i++){var header=headers[i].name,UrlsMap=urls_map[header];if(UrlsMap){urlsHeaderType=UrlsMap;var urlsHeaderName=UrlsMap.toUpperCase()+"_WEB",contentStr="";contentStr+='<div class="zcs_mapping_fld_grp" style="width: 100%;min-height: 30px; margin-top: 15px;">',contentStr+=0==urlsIndex?'<div class="zcs_mapping_info_lft zcs_mapping_info_lft_empty" style="height: 30px;display: none !important"></div>':'<div class="zcs_mapping_info_lft zcs_mapping_info_lft_empty" style="height: 30px;"></div>',contentStr+='<div class="zcs_siblings" style="display: block;width: 100%;min-width: 597px;">',contentStr+='<div class="zcs_mapping_info_right SC_select" name="urls" style="display: inline-block;">'+getSelectBox(response,urlsHeaderName)+"</div>",contentStr+='<div class="zcs-left SC_select" style="margin-left: 10px;">'+getTypeSelectBox(urlsHeaderType,"urls")+"</div>",urls.push(contentStr),urlsIndex++}}if(0==urls.length&&(html.append('<div class="zcs_mapping_fld_grp" style="width: 100%;min-height: 30px;"><div class="zcs_mapping_info_lft zcs_mapping_info_lft_empty" style="height: 30px;display: none !important;"></div>'),html.append('<div class="zcs_siblings" style="display: block;width: 100%;min-width: 597px;">'),html.append('<div class="zcs_mapping_info_right SC_select" name="urls" style="display: inline-block;">'+getSelectBox(response,"urls")+"</div>"),html.append('<div class="zcs-left SC_select" style="margin-left: 10px;">'+getTypeSelectBox(urlsHeaderType,"urls")+"</div>"),html.append('<div class="msi-plus" style="display: inline-block;float: left;margin-top: 10px;margin-left: 10px;" onclick="ZContacts.contactimport.createExtraRows(this, 10, \'zcs_urls_div\', \'urls\')"></div>'),html.append("</div></div>"),html.append("</div><br></br>")),urls.length){for(var i=0;i<urls.length;i++){var urls_index=urls[i];if(0==urls.length)var testee=urls_index.concat('<div class="msi-plus" style="display: inline-block;float: left;margin-top: 10px;margin-left: 10px;" onclick="ZContacts.contactimport.createExtraRows(this,10, \'zcs_urls_div\', \'urls\')"></div>');else if(urls.length===i+1&&urls.length<10){var testee=urls_index.concat('<div class="msi-plus" style="display: inline-block;float: left;margin-top: 10px;margin-left: 10px;" onclick="ZContacts.contactimport.createExtraRows(this,10, \'zcs_urls_div\', \'urls\')"></div>');testee+='<div class="msi-close zcs_msi_close" style="display: inline-block;float: left;margin-top: 10px;margin-left: 10px;" onclick="ZContacts.contactimport.createExtraRows(this,10, \'zcs_urls_div\', \'urls\')"></div>'}else var testee=urls_index.concat('<div class="msi-close" style="display: inline-block;float: left;margin-top: 10px;margin-left: 10px;" onclick="ZContacts.contactimport.createExtraRows(this,10, \'zcs_urls_div\', \'urls\')"></div>');var end_line="</div></div>",urls_div_complet=testee.concat(end_line);html.append(urls_div_complet)}html.append("</div></br>")}html.append('<div style="padding-top: 20px;"><span class="zcs_header">'+ZContacts.I18N.get("IAM.CONTACTS.PERSONAL")+"</span><br></br>"),html.append('<div style="font-size: 15px;">'),html.append('<span class="zcs_mapping_info_lft"> '+ZContacts.I18N.get("IAM.CONTACTS.GENDER")+" :</span>"),html.append('<span class="zcs_mapping_info_right SC_select" >'+getSelectBox(response,"GENDER")+"</span>"),html.append('<span class="zcs_mapping_info_lft" style="padding-left: 60px"> '+ZContacts.I18N.get("IAM.CONTACTS.COMPANY")+" :</span> "),html.append('<span class="zcs_mapping_info_right SC_select">'+getSelectBox(response,"COMPANY_NAME")+"</span><br></br></br>"),html.append('<span class="zcs_mapping_info_lft"> '+ZContacts.I18N.get("IAM.CANTACTS.DOB")+" :</span> "),html.append('<span class="zcs_mapping_info_right_bday SC_select">'+getSelectBox(response,"BIRTH_DAY")+"</span>"),html.append('<span class="zcs_mapping_info_right_bday SC_select">'+getSelectBox(response,"BIRTH_MONTH")+"</span>"),html.append('<span class="zcs_mapping_info_right_bday SC_select">'+getSelectBox(response,"BIRTH_YEAR")+"</span>"),html.append('<span class="zcs_mapping_info_lft" style="padding-left: 60px"> '+ZContacts.I18N.get("IAM.CONTACTS.JOBTITLE")+" :</span> "),html.append('<span class="zcs_mapping_info_right SC_select">'+getSelectBox(response,"JOB_TITLE")+"</span><br></br></br>"),html.append('<span class="zcs_mapping_info_lft"> '+ZContacts.I18N.get("IAM.CONTACTS.NOTES")+" :</span> "),html.append('<span class="zcs_mapping_info_right SC_select">'+getSelectBox(response,"NOTES")+"</span>"),html.append('<span class="zcs_mapping_info_lft" style="padding-left: 60px"> '+ZContacts.I18N.get("IAM.CONTACTS.DESIGNATION")+" :</span> "),html.append('<span class="zcs_mapping_info_right SC_select">'+getSelectBox(response,"DESIGNATION")+"</span>"),html.append("</div></div><br></br></br>"),html.append('<div style="padding-top: 20px;"><span class="zcs_header">'+ZContacts.I18N.get("IAM.CONTACTS.OTHERS.HADDRESS")+"</span><br></br>"),html.append('<div style="font-size: 15px;">'),html.append('<span class="zcs_mapping_info_lft"> '+ZContacts.I18N.get("IAM.CONTACTS.ST.ADDRESS")+" :</span> "),html.append('<span class="zcs_mapping_info_right SC_select">'+getSelectBox(response,"HOME_ADDR")+"</span>"),html.append('<span class="zcs_mapping_info_lft" style="padding-left: 60px"> '+ZContacts.I18N.get("IAM.CONTACTS.ST.ADDRESS1")+" :</span> "),html.append('<span class="zcs_mapping_info_right SC_select">'+getSelectBox(response,"HOME_ADDR1")+"</span><br></br></br>"),html.append('<span class="zcs_mapping_info_lft"> '+ZContacts.I18N.get("IAM.CONTACTS.WORK.CITY")+" :</span> "),html.append('<span class="zcs_mapping_info_right SC_select">'+getSelectBox(response,"HOME_CITY")+"</span>"),html.append('<span class="zcs_mapping_info_lft" style="padding-left: 60px"> '+ZContacts.I18N.get("IAM.CONTACTS.WORK.STATE")+" :</span> "),html.append('<span class="zcs_mapping_info_right SC_select">'+getSelectBox(response,"HOME_STATE")+"</span><br></br></br>"),html.append('<span class="zcs_mapping_info_lft"> '+ZContacts.I18N.get("IAM.CONTACTS.WORK.COUNTRY")+" :</span> "),html.append('<span class="zcs_mapping_info_right SC_select">'+getSelectBox(response,"HOME_COUNTRY")+"</span>"),html.append('<span class="zcs_mapping_info_lft" style="padding-left: 60px"> '+ZContacts.I18N.get("IAM.CONTACTS.WORK.ZIP.POSTAL")+" :</span> "),html.append('<span class="zcs_mapping_info_right SC_select">'+getSelectBox(response,"HOME_ZIPCODE")+"</span><br></br></br>"),html.append("</div></div><br></br>"),html.append('<div><span class="zcs_header">'+ZContacts.I18N.get("IAM.CONTACTS.EXPORT.WORK.ADDRESS")+"</span><br></br>"),html.append('<div style="font-size: 15px;">'),html.append('<span class="zcs_mapping_info_lft"> '+ZContacts.I18N.get("IAM.CONTACTS.ST.ADDRESS")+" :</span> "),html.append('<span class="zcs_mapping_info_right SC_select">'+getSelectBox(response,"WORK_ADDR")+"</span>"),html.append('<span class="zcs_mapping_info_lft" style="padding-left: 60px"> '+ZContacts.I18N.get("IAM.CONTACTS.ST.ADDRESS1")+" :</span> "),html.append('<span class="zcs_mapping_info_right SC_select">'+getSelectBox(response,"WORK_ADDR1")+"</span><br></br></br>"),html.append('<span class="zcs_mapping_info_lft"> '+ZContacts.I18N.get("IAM.CONTACTS.WORK.CITY")+" :</span> "),html.append('<span class="zcs_mapping_info_right SC_select">'+getSelectBox(response,"WORK_CITY")+"</span>"),html.append('<span class="zcs_mapping_info_lft" style="padding-left: 60px"> '+ZContacts.I18N.get("IAM.CONTACTS.WORK.STATE")+" :</span> "),html.append('<span class="zcs_mapping_info_right SC_select">'+getSelectBox(response,"WORK_STATE")+"</span> <br></br></br>"),html.append('<span class="zcs_mapping_info_lft"> '+ZContacts.I18N.get("IAM.CONTACTS.WORK.COUNTRY")+" :</span> "),html.append('<span class="zcs_mapping_info_right SC_select">'+getSelectBox(response,"WORK_COUNTRY")+"</span>"),html.append('<span class="zcs_mapping_info_lft" style="padding-left: 60px"> '+ZContacts.I18N.get("IAM.CONTACTS.WORK.ZIP.POSTAL")+" :</span> "),html.append('<span class="zcs_mapping_info_right SC_select">'+getSelectBox(response,"WORK_ZIPCODE")+"</span> <br></br></br>"),html.append("</div></div>"),html.append("</div>"),html.append("</form> </div> </div>"),html.append('<div class="zcs_mapping_save_div">'),html.append('<div class="SC_PUbtm zcs_mapping_submit_buttons">'),html.append('<span onclick="ZContacts.contactimport.mappingContacts(mappingForm);" class="zcs_mapping_next">'+ZContacts.I18N.get("IAM.CONTACTS.NEXT")+"</span>"),html.append('<span data-val="Cancel" onclick="ZContacts.contactimport.importHomePage()" >'+ZContacts.I18N.get("IAM.CANCEL")+"</span>"),html.append("</div></div>")}else{ZContacts.current_step=2,this.data=response.importcontacts,confirm_response=data;var button_check=!1,categoryId=ZContacts._currentCategoryId,rootFolderId=zmcontact.getRootFolderId(categoryId);rootFolderId==categoryId&&(name=ZContacts.I18N.get("IAM.CONTACTS.ALL.CONTACTS"));var acc=ZContacts.AccountsVsRootFolderMap[rootFolderId],html=new ZContacts.StringBuilder;html.append('<div class="zcs_confirm_page_main"><span class="zcs_im_main_div">'),data.TOTAL_CONTACT==data.EMPTY_FIELD?(html.append('<div><span class="zcs_im_align" style="color:red">'+ZContacts.I18N.get("IAM.OOPS")+"</span><br></br>"),html.append('<span class="zcs_im_align">'+ZContacts.I18N.get("IAM.CONTACTS.MAPPING.FIELD.EMPTY")+"</span></div>"),html.append('<span class="zcs_im_border_bottom"></span><br></br>'),button_check=!0):0!=data.TOTAL_CONTACT&&(html.append('<div><span class="zcs_im_confirm_header_one">'+ZContacts.I18N.formatMessage(ZContacts.I18N.get("IAM.CONTACTS.CONFIRM.HEADER"),data.TOTAL_CONTACT)+"</span></div><br>"),html.append('<div> <form id="confirmationForm">'),html.append('<div><span class="zcs_im_align">'+ZContacts.I18N.get("IAM.CONTACTS.WHERE.IMPORT")+"</span><br></br>"),html.append('<span class="zcs_im_align">'+ZContacts.I18N.get("IAM.CONTACTS.WHICH.CATEGORY")+"</span><br></br>"),html.append('<div class="SC_flt" id="zcs_account" style="margin-left: 7%">'),html.append('<b id="zcs_account"><input class="zcs_tiput" id='+acc.getAccountId()+' name="'+acc.getName()+'" placeholder="'+encodeHTML(acc.getName())+'" onclick="getWriteScrollList(this, \'account\')" readonly=readonly style="width: 200px;cursor: pointer;"></b>'),html.append('<b id="zcs_category"><input class="zcs_tiput" id='+categoryId+' name="'+name+'" placeholder="'+name+"\" onclick=\"getWriteScrollList(this,  'category', '"+rootFolderId+'\')" readonly=readonly style="width: 200px;margin-left: 30px;cursor: pointer;"></b>'),html.append("</div><br></br>"),html.append('<span class="zcs_im_border_bottom"></span>'),html.append("</div><br>")),0!=data.DUPLICATE_COUNT&&(html.append('<div style="margin-top: 2%;"><span class="zcs_im_align">'+ZContacts.I18N.get("IAM.CONTACTS.MERGE")+"</span><br></br>"),html.append('<span class="zcs_im_align">'+ZContacts.I18N.formatMessage(ZContacts.I18N.get("IAM.CONTACTS.DUPLICATE.CONTACTS.DETAILS"),data.DUPLICATE_COUNT,acc.getName())+"</span>"),html.append('<span data-val="duplicate_email" onclick="details_popup(this)" class="SC_lnk zcs_show_popup">'+ZContacts.I18N.get("IAM.CONTACTS.VIEW.DETAILS")+"</span></br>"),html.append('<br><div class="zcs_im_align"><span class="zcs_im_checkbox"><input id="overwritebox" type="checkbox"/></span><span class="zcs_im_overwirte_pending">'+ZContacts.I18N.get("IAM.CONTACTS.OVERWRITE.CONTACTS")+"</span></div>"),html.append('<span class="zcs_im_border_bottom"></span>'),html.append("</div></br>")),0!=data.RECORD_DUPLICATE_COUNT&&(html.append('<div style="margin-top: 2%;"><span class="zcs_im_align">'+ZContacts.I18N.get("IAM.CONTACTS.RECORD.DUPLICATE.HEADER")+"</span><br></br>"),html.append('<span class="zcs_im_align">'+ZContacts.I18N.formatMessage(ZContacts.I18N.get("IAM.CONTACTS.RECORD.DUPLICATE.DETAILS"),data.RECORD_DUPLICATE_COUNT)+"</span>"),html.append('<span data-val="record_duplicate" onclick="details_popup(this)" class="SC_lnk zcs_show_popup">'+ZContacts.I18N.get("IAM.CONTACTS.VIEW.DETAILS")+"</span></br><br>"),html.append('<span class="zcs_im_border_bottom"></span>'),html.append("</div></br>")),(0!=data.EMPTY_FIELD||0!=data.INVALID_COUNT)&&(html.append('<div style="margin-top: 2%;"><span class="zcs_im_align">'+ZContacts.I18N.get("IAM.CONTACTS.IMPORT.DETAILS.INSUFFICIENT")+"</span><br></br>"),0!=data.EMPTY_FIELD&&html.append('<span class="zcs_im_align">'+ZContacts.I18N.formatMessage(ZContacts.I18N.get("IAM.CONTACTS.SKIPPED.CONTACTS.COUNT"),data.EMPTY_FIELD)+"</span><br></br>"),0!=data.INVALID_COUNT&&(html.append('<span class="zcs_im_align">'+ZContacts.I18N.formatMessage(ZContacts.I18N.get("IAM.CONTACTS.INVALID.EMAIL.ADDRESS"),data.INVALID_COUNT)+"</span>"),html.append('<span data-val="invalid_email" onclick="details_popup(this)" class="SC_lnk zcs_show_popup">'+ZContacts.I18N.get("IAM.CONTACTS.VIEW.DETAILS")+"</span></br><br>")),html.append('<span class="zcs_im_border_bottom"></span>'),html.append("</div></br>")),html.append('<br><div class="zcs_im_save_div"><span class="SC_PUbtm" style="margin-left: 30%">'),0==data.TOTAL_CONTACT||button_check?html.append('<span data-val="Done" onclick="ZContacts.contactimport.importHomePage()">'+ZContacts.I18N.get("IAM.CONTACTS.DONE")+"</span>"):(".csv"==ZContacts.store_value.temp_file_format&&html.append('<span onclick="ZContacts.contactimport.goBackMappingPage()">'+ZContacts.I18N.get("IAM.CONTACTS.PREV")+"</span>"),html.append('<span data-val="Next" onclick="ZContacts.contactimport.importConfirmation(confirmationForm,data)">'+ZContacts.I18N.get("IAM.CONTACTS.NEXT")+"</span>"),html.append('<span data-val="Cancel" onclick="ZContacts.contactimport.importHomePage()">'+ZContacts.I18N.get("IAM.CANCEL")+"</span>")),html.append("</span></div>"),html.append("</form></div>"),html.append("</span></div>")}return html.append("</div>"),html.toString()},getHtmlForFinishImport=function(response){ZContacts.current_step=3;var data=response.importcontacts;confirm_response=data;var html=new ZContacts.StringBuilder;return html.append('<div class="zcs_im_fnis_main_div">'),0!=data.ADD_CONTACT_COUNT?(html.append('<div><span class="zcs_im_fnis_header">'+ZContacts.I18N.formatMessage(ZContacts.I18N.get("IAM.CONTACTS.FINSHE.IMPORET.HEADER"),data.ADD_CONTACT_COUNT,data.TOTAL_CONTACT)+"</span></div><br>	</br>"),zmUtil.succErrMsg("s",ZContacts.I18N.get("IAM.CONTACTS.ERROR.ADDED.SUCCESS"))):0!=data.UPDATE_DUPLICATE_COUNT&&0==data.ADD_CONTACT_COUNT?(html.append('<div><span class="zcs_im_fnis_header">'+ZContacts.I18N.formatMessage(ZContacts.I18N.get("IAM.CONTACTS.FINISH.OVERWRITE"),data.UPDATE_DUPLICATE_COUNT,data.TOTAL_CONTACT)+"</span></div><br>	</br>"),zmUtil.succErrMsg("s",ZContacts.I18N.get("IAM.CONTACTS.OVERWRITE.SUCCESS"))):html.append('<div><span class="zcs_im_fnis_header" style="color:red">'+ZContacts.I18N.get("IAM.OOPS")+"</span></div></br>"),0!=data.INVALID_COUNT&&html.append('<span class="zcs_im_fnis_align">'+ZContacts.I18N.formatMessage(ZContacts.I18N.get("IAM.CONTACTS.FINISH.INVALID.CONTACT"),data.INVALID_COUNT)+'</span><span data-val="invalid_email" onclick="details_popup(this)" class="SC_lnk"> '+ZContacts.I18N.get("IAM.CONTACTS.VIEW.DETAILS")+"</span><br></br><br>"),0!=data.DUPLICATE_COUNT&&html.append('<span class="zcs_im_fnis_align">'+ZContacts.I18N.formatMessage(ZContacts.I18N.get("IAM.CONTACTS.DUPLICATE.CONTACTS.DETAIL"),data.DUPLICATE_COUNT)+'</span><span data-val="duplicate_email" onclick="details_popup(this)" class="SC_lnk"> '+ZContacts.I18N.get("IAM.CONTACTS.VIEW.DETAILS")+"</span><br></br><br>"),0!=data.EMPTY_FIELD&&html.append('<span class="zcs_im_fnis_align">'+ZContacts.I18N.formatMessage(ZContacts.I18N.get("IAM.CONTACTS.FINISH.SKIPPED.CONTACT"),data.EMPTY_FIELD)+"</span><br></br></br>"),0!=data.RECORD_DUPLICATE_COUNT&&html.append('<span class="zcs_im_fnis_align">'+ZContacts.I18N.formatMessage(ZContacts.I18N.get("IAM.CONTACTS.RECORD.DUPLICATE.DETAILS"),data.RECORD_DUPLICATE_COUNT)+'</span><span data-val="record_duplicate" onclick="details_popup(this)" class="SC_lnk zcs_show_popup">'+ZContacts.I18N.get("IAM.CONTACTS.VIEW.DETAILS")+"</span></br><br>"),html.append('<div style="padding: 20px;">'),html.append('<div class="SC_PUbtm zcs_im_fnis_submit_buttons">'),html.append("<span onclick=\"ZContacts.contactimport.contactsImported('"+data.CATEGORY_ID+"', '"+data.ZID+"')\">"+ZContacts.I18N.get("IAM.CONTACTS.DONE")+"</span>"),html.append('<span data-val="im-more" onclick="ZContacts.contactimport.importHomePage()">'+ZContacts.I18N.get("IAM.CONTACTS.IMPORT.MORE")+"</span>"),html.append("</div></div>"),html.append("</form></div></div>"),html.toString()},details_popup=function(data){var requst=$(data).attr("data-val");ZContacts.contactimport.EmailDetailsPopup(confirm_response,requst)},getWriteScrollList=function(parentEle,operation,rootFolderId){var contactsNode=zmsuite.getCenter()[0].getNodes()[2],viewCategoriesList=(zmcontact.getSelectedContactIds(contactsNode.$el),null),config={};config.parentDOM=parentEle,config.displayAs="dropdown",config.hltPar=!0,config.offsets={left:0,top:0},config.onSelect="account"!=operation?function(id,elem){"category"==operation&&id&&$("#zcs_category").find("input").attr({id:id,placeholder:elem.display_text,name:elem.name}),viewCategoriesList.hide()}:function(id){var rootFolderId=ZContacts.AccountsVsRootFolderMap[id],acc=ZContacts.AccountsVsRootFolderMap[rootFolderId];$("#zcs_account").find("input").attr({id:id,name:encodeHTML(acc.name),placeholder:encodeHTML(acc.name)});var onclickValue='zmcontact.getScrollList(this, "category", "'+rootFolderId+'")';$("#zcs_category").find("input").attr({onclick:onclickValue,id:ZContacts.AccountsVsRootFolderMap[id],name:ZContacts.I18N.get("IAM.CONTACTS.ALL.CONTACTS"),placeholder:ZContacts.I18N.get("IAM.CONTACTS.ALL.CONTACTS")}),viewCategoriesList.hide()},config.dataCallback=function(){if("account"==operation){for(var sksk=ZContacts.respWriteList,rootId=ZContacts.AccountsVsRootFolderMap[ZContacts._currentCategoryId],AccountsList=[],int=0;int<sksk.length;int++){var acc=sksk[int];rootId.account_id==acc.account_id&&acc.isWritable&&AccountsList.push({id:acc.getAccountId(),name:acc.getName(),display_text:acc.getName()})}return AccountsList}return zmcontact.getCategoriesList(rootFolderId,operation)},viewCategoriesList=zmUtil.createFLComp("generic",config),viewCategoriesList.show()},getTypeSelectBox=function(data,type_model){var type_array="";"ph"==type_model?type_array=ZContacts.MappingType.Phone_Type:"ims"==type_model?type_array=ZContacts.MappingType.Ims_Type:"urls"==type_model&&(type_array=ZContacts.MappingType.Urls_Type);var selectTypeBox='<select class="zcs-list-type zcs_'+type_model+'_type" name="type">';selectTypeBox+='<option value="none">None</option>';for(var i=0;i<type_array.length;i++){var newdata=ZContacts.I18N.get("IAM.CONTACTS."+type_model.toUpperCase()+".TYPE."+type_array[i].toUpperCase());selectTypeBox+='<option value="'+type_array[i]+'" ',data&&data==type_array[i]&&(selectTypeBox+='selected = "true"'),selectTypeBox+=">"+newdata+"</option>"}return selectTypeBox+="</select>"},getSelectBox=function(response,data){var headers=response.importcontacts.headers,headers_map=response.importcontacts.headersMap,valueIndex=headers_map[data],selectBox='<select id="'+data+'_field" class="zcs_mapping_select_box select">';selectBox+='<option value="-1">None</option>';for(var i=0;i<headers.length;i++)selectBox+='<option value="'+i+'" ',-1!=valueIndex&&valueIndex===i&&(selectBox+='selected = "true"'),selectBox+=">"+headers[i].name+" ("+i+")</option>";return selectBox+="</select>"},this.createPageContent=function(content){ZContacts.contactimport.$containerElem.html($(content))},this.createAppendPageContent=function(content){ZContacts.contactimport.$containerElem.append($(content))},this.mappingValues=function(data){var mapping=ZContacts.Mapping.create();mapping.set("None",$(data).find("#FIRST_NAME_field option:selected").val()),mapping.set("first_name",$(data).find("#FIRST_NAME_field option:selected").val()),mapping.set("middle_name",$(data).find("#MIDDLE_NAME_field option:selected").val()),mapping.set("last_name",$(data).find("#LAST_NAME_field option:selected").val()),mapping.set("nick_name",$(data).find("#NICK_NAME_field option:selected").val()),mapping.set("categories",$(data).find("#CATEGORIES_field option:selected").val());for(var $emailLength=$(data).find(".zcs_email_div").find(".zcs_mapping_fld_grp").find(".zcs_siblings").find("select"),storeEmailArray=[],i=0;i<$emailLength.length;i++){var getEmailIndex=$($emailLength[i]).val();storeEmailArray.push(getEmailIndex)}mapping.set("emails",storeEmailArray);for(var $phoneRows=$(data).find(".zcs_phone_div").find(".zcs_mapping_fld_grp"),i=0;i<$phoneRows.length;i++){var phone=$($phoneRows[i]).find(".zcs_siblings").find('[name="phone"]').find("select").val(),types=$($phoneRows[i]).find(".zcs_siblings").find('[name="type"]').val(),phoneModel=ZContacts.MappingPhone.create({number:phone,type:types});mapping.addSubResource(phoneModel)}for(var $imsRows=$(data).find(".zcs_ims_div").find(".zcs_mapping_fld_grp"),i=0;i<$imsRows.length;i++){var ims=$($imsRows[i]).find(".zcs_siblings").find('[name="ims"]').find("select").val(),types=$($imsRows[i]).find(".zcs_siblings").find('[name="type"]').val(),imsModel=ZContacts.MappingIms.create({ims:ims,type:types});mapping.addSubResource(imsModel)}for(var $urlRows=$(data).find(".zcs_urls_div").find(".zcs_mapping_fld_grp"),i=0;i<$urlRows.length;i++){var url=$($urlRows[i]).find(".zcs_siblings").find('[name="urls"]').find("select").val(),types=$($urlRows[i]).find(".zcs_siblings").find('[name="type"]').val(),urlModel=ZContacts.MappingUrls.create({urls:url,type:types});mapping.addSubResource(urlModel)}mapping.set("gender",$(data).find("#GENDER_field option:selected").val()),mapping.set("birth_date",$(data).find("#BIRTH_DAY_field option:selected").val()),mapping.set("birth_month",$(data).find("#BIRTH_MONTH_field option:selected").val()),mapping.set("birth_year",$(data).find("#BIRTH_YEAR_field option:selected").val()),mapping.set("notes",$(data).find("#NOTES_field option:selected").val()),mapping.set("company",$(data).find("#COMPANY_NAME_field option:selected").val()),mapping.set("job_title",$(data).find("#JOB_TITLE_field option:selected").val()),mapping.set("designation",$(data).find("#DESIGNATION_field option:selected").val());var homeAddress=ZContacts.Address.create({street_addr:$(data).find("#HOME_ADDR_field option:selected").val(),street_addr1:$(data).find("#HOME_ADDR1_field option:selected").val(),city:$(data).find("#HOME_CITY_field option:selected").val(),state:$(data).find("#HOME_STATE_field option:selected").val(),country:$(data).find("#HOME_COUNTRY_field option:selected").val(),postal_code:$(data).find("#HOME_ZIPCODE_field option:selected").val(),type:"home"});mapping.addSubResource(homeAddress);var workAddress=ZContacts.Address.create({street_addr:$(data).find("#WORK_ADDR_field option:selected").val(),street_addr1:$(data).find("#WORK_ADDR1_field option:selected").val(),city:$(data).find("#WORK_CITY_field option:selected").val(),state:$(data).find("#WORK_STATE_field option:selected").val(),country:$(data).find("#WORK_COUNTRY_field option:selected").val(),postal_code:$(data).find("#WORK_ZIPCODE_field option:selected").val(),type:"work"});return mapping.addSubResource(workAddress),mapping},this.mappingConfirmation=function(data){var mappingConfirmation=ZContacts.MappingConfirmation.create();return mappingConfirmation.set("account_name",$(data).find("#zcs_account input")[0].name),mappingConfirmation.set("account_id",$(data).find("#zcs_account input")[0].id),mappingConfirmation.set("category_id",$(data).find("#zcs_category input")[0].id),mappingConfirmation.set("category_name",$(data).find("#zcs_category input")[0].placeholder),mappingConfirmation.set("overwrite_duplicate",$(data).find("#overwritebox").is(":checked")),mappingConfirmation.set("file_format",ZContacts.store_value.temp_file_format),mappingConfirmation},ZContacts.contactimport.EmailDetailsPopup=function(data,resp){var EmailsDetails={};if("duplicate_email"==resp?(EmailsDetails.title=ZContacts.I18N.get("IAM.CONTACTS.DUPLICATE.E_ADDRESS"),EmailsDetails.name=resp):"invalid_email"==resp?(EmailsDetails.title=ZContacts.I18N.get("IAM.CONTACTS.INVALID.E_ADDRESS"),EmailsDetails.name=resp):"record_duplicate"==resp&&(EmailsDetails.title=ZContacts.I18N.get("IAM.CONTACTS.RECORD.DUPLICATE.E_ADDRESS"),EmailsDetails.name=resp),EmailsDetails.mask=!0,EmailsDetails.buttons=[{isCancel:!0,txt:ZContacts.I18N.get("IAM.CONTACTS.DONE"),callback:function(){zmsDialog.remove(),$("#zcs_emailDetailsPopup").remove()}}],EmailsDetails.closeaction=function(){zmsDialog.remove(),$("#zcs_emailDetailsPopup").remove()},EmailsDetails.pos="center",createFolElem=$("<div id='zcs_emailDetailsPopup' style='max-height: 500px;'></div>"),!$("#zcs_emailDetailsPopup").length){var email_list="<div class='zcs_Emaildetails_main'>",emailCount=1;if("duplicate_email"==resp){for(var i=0;i<=data.DUPLICATE_EMAILS.length-1;i++){var count=emailCount++;email_list=email_list+"<div><span>"+count+".</span><span style='margin-left: 5px;'>"+data.DUPLICATE_EMAILS[i]+"</span></div></br>"}email_list+="</div>"}else if("record_duplicate"==resp)for(var i=0;i<=data.RECORD_DUPLICATE.length-1;i++){var count=emailCount++;email_list=email_list+"<div><span>"+count+".</span><span style='margin-left: 5px;'>"+data.RECORD_DUPLICATE[i]+"</span></div></br>"}else{for(var i=0;i<=data.INVALID_EMAIL.length-1;i++){var count=emailCount++;email_list=email_list+"<div><span>"+count+".</span><span style='margin-left: 5px;'>"+data.INVALID_EMAIL[i]+"</span></div></br>"}email_list+="</div>"}createFolElem.append(email_list),$(document.body).append(createFolElem)}zmsDialog.create("zcs_emailDetailsPopup",EmailsDetails)},ZContacts.contactimport.importContacts=function(){var importForm=ZContacts.Import.create({__form:"#importlocalFormId",step:0}),getImportFile=document.getElementById("impcont").files[0];if(getImportFile.size>1024e3)return zmUtil.succErrMsg("e",ZContacts.I18N.formatMessage(ZContacts.I18N.get("IAM.UPLOAD.NOTE2"),1024)),$("#impcont").replaceWith($("#impcont").val("").clone(!0)),!0;var getFileName=getImportFile.name.trim(),fileFormat=getFileName.substring(getFileName.lastIndexOf("."),getFileName.length).toLowerCase().trim();ZContacts.store_value.temp_file_format=fileFormat,ZContacts.store_value.is_loading=!0;var centerNode=zmsuite.getCenter()[0].getNodes()[2].$el,loading_div=zmComponent.loadingBand({container:centerNode.find(".zcs_im_local").get(0),type:"pagination"});return $("#impcont").prop("disabled",!0),".csv"!=fileFormat&&".vcf"!=fileFormat&&".ldif"!=fileFormat?(zmUtil.succErrMsg("e",ZContacts.I18N.get("IAM.CONTACTS.INVALID.FILE.FORMAT")),$(".SC_sld").remove(),$("#impcont").prop("disabled",!1),$("#impcont").replaceWith($("#impcont").val("").clone(!0)),!0):void new ZContacts.URI(ZContacts.Import,ZContacts.getCurrentAccount().getAccountId()).POST(importForm).then(function(response){if(200!=response.status_code)return 204==response.status_code?zmUtil.succErrMsg("e",ZContacts.I18N.get("IAM.CONTACTS.EMPTY.FILE")):zmUtil.succErrMsg("e",ZContacts.I18N.get("IAM.ERROR.GENERAL")),$(".SC_sld").remove(),$("#impcont").prop("disabled",!1),$("#impcont").replaceWith($("#impcont").val("").clone(!0)),!0;loading_div();var contactImport=new ZContacts.contactimport;ZContacts.current_step===importForm.step&&(".csv"==fileFormat?contactImport.createPageContent(getHtmlForMapping(response,!0),!1):(".vcf"==fileFormat||".ldif"==fileFormat)&&contactImport.createPageContent(getHtmlForMapping(response,!1),!1)),ZContacts.store_value.is_loading=!1,fileFormat=""})},ZContacts.contactimport.mappingContacts=function(map){var mappingForm=ZContacts.Mapping.create({step:1}),contactImport=new ZContacts.contactimport,mappingFieds=contactImport.mappingValues(map);if("-1"==mappingFieds.first_name&&"-1"==mappingFieds.emails[0]&&"-1"==mappingFieds.company)return zmUtil.succErrMsg("e",ZContacts.I18N.get("IAM.CONTACTS.FIRST.NAME.REQUIRED")),void $("#first_name_field").focus();ZContacts.store_value.is_loading=!0;var centerNode=zmsuite.getCenter()[0].getNodes()[2].$el,mapping_loading=zmComponent.loadingBand({container:centerNode.find(".zcs_header_loadingband").get(0),type:"listing",notToSetInnerHTML:!0});new ZContacts.URI(ZContacts.Mapping,ZContacts.getCurrentAccount().getAccountId()).POST(mappingFieds).then(function(response){if(mapping_loading(),200==response.status_code){var contactImport=new ZContacts.contactimport;$("#mappingPage").hide(),ZContacts.store_value.is_loading=!1,ZContacts.current_step===mappingForm.step&&contactImport.createAppendPageContent(getHtmlForMapping(response,!1),!1)}else zmUtil.succErrMsg("e",ZContacts.I18N.get("IAM.ERROR.GENERAL"))})},ZContacts.contactimport.importConfirmation=function(data){var ConfirmationForm=ZContacts.MappingConfirmation.create({step:2});if(!ZContacts.store_value.is_loading){ZContacts.store_value.is_loading=!0;var centerNode=zmsuite.getCenter()[0].getNodes()[2].$el,confirm_Loadingband=zmComponent.loadingBand({container:centerNode.find(".zcs_confirm_page_main").get(0),type:"listing",notToSetInnerHTML:!0}),contactImport=new ZContacts.contactimport,confirmFieds=contactImport.mappingConfirmation(data);new ZContacts.URI(ZContacts.MappingConfirmation,ZContacts.getCurrentAccount().getAccountId()).POST(confirmFieds).then(function(response){if(confirm_Loadingband(),201==response.status_code){var contactImport=new ZContacts.contactimport;ZContacts.store_value.is_loading=!1,ZContacts.current_step===ConfirmationForm.step&&(contactImport.createPageContent(getHtmlForFinishImport(response),!1),$("#testzc").click(confirm_response,function(){var requst=$("#testzc").attr("data-val");ZContacts.contactimport.EmailDetailsPopup(confirm_response,requst)}))}else zmUtil.succErrMsg("e",ZContacts.I18N.get("IAM.ERROR.GENERAL"))})}},ZContacts.contactimport.contactsImported=function(catagoryId,zid){var rootFolderId=ZContacts.AccountsVsRootFolderMap[zid];category=zmcontact.getCategory(-1!=catagoryId?catagoryId:ZContacts._currentCategoryId),$("#impcont").replaceWith($("#impcont").val("").clone(!0)),zmcontact.loadFirstPage(category),zmsuite.closeWorkspace("zm_ImportContact"),new ZContacts.URI(ZContacts.Categories,zid).GETS().then(function(json){for(var layer=zmcontact.getCategoriesListLayer(rootFolderId),i=0;i<json.length;i++)if(!layer.childObject[rootFolderId].CH[json[i].category_id]){ZContacts._parentObj[rootFolderId]||(ZContacts._parentObj[rootFolderId]=[]),ZContacts._parentObj[rootFolderId].push(json[i]);var rowInfo={};rowInfo[json[i].category_id]={category_id:json[i].category_id,category_name:json[i].category_name,E:0,HC:!1,SE:2};var categoryMapObj={id:"category_id",name:"category_name",count:"count",hasChild:"HC",expChild:"E",sequence:"SE",parentId:"p",notBold:"notBold"};layer.insertNodeBefore(rowInfo,categoryMapObj,rootFolderId+"_add",rootFolderId)}}),zmcontact.refreshContactCounts()},ZContacts.contactimport.importHomePage=function(){ZContacts.ImportPage=!0,$("#impcont").replaceWith($("#impcont").val("").clone(!0));var contactImport=new ZContacts.contactimport;contactImport.createPageContent(getHtmlForImport()),zmcontact.refreshContactCounts()},ZContacts.contactimport.syncAccounts=function(url,name){var nWidth=parseInt("80"*screen.width/100),nHight=parseInt("80"*screen.height/100),left=(screen.width-nWidth)/2,top=(screen.height-nHight)/2;url+=-1==url.indexOf("?")?"?":"&";var contextDomain="//"+window.location.host+ZContacts.getContextPath();return zmail.forContactsApp&&(contextDomain=ZContacts.getContextPath()),url+="domain="+contextDomain,window.open(url,name,"height="+nHight+", width="+nWidth+", top="+top+", left="+left+",status=1,toolbar=0,scrollbars=1,resizable=1"),!1},ZContacts.contactimport.goBackMappingPage=function(){$(".zcs_confirm_page_main").remove(),ZContacts.current_step=1,$(".zcs_mapping_page").show()},ZContacts.contactimport.createExtraRows=function(data,size,className,name){if($(data).hasClass("msi-plus")){var $appendRow=$(data).parents().find("."+className),$siblings=$appendRow.find(".zcs_siblings");if($(data).removeClass("msi-plus").addClass("msi-close"),$(data).parent().find(".zcs_msi_close").remove(),$siblings.length<size){var html=new ZContacts.StringBuilder;html.append('<div class="zcs_mapping_fld_grp" style="width: 100%;min-height: 30px;margin-top: 15px;"><div class="zcs_mapping_info_lft zcs_mapping_info_lft_empty" style="height: 30px;"></div>'),html.append('<div class="zcs_siblings" style="display: block;width: 100%;min-width: 597px;">'),html.append("<div name="+name+' class="zcs_mapping_info_right SC_select">'+getSelectBox(ZContacts.store_value.mapping_response,name)+"</div>"),"phone"==name?(html.append('<div class="zcs-left SC_select" style="margin-left: 10px;">'+getTypeSelectBox(name,"ph")+"</div>"),6==$siblings.length?html.append('<div class="msi-close zcs_msi_close" style="display: inline-block;float: left;margin-top: 10px;margin-left: 10px;" onclick="ZContacts.contactimport.createExtraRows(this, 7, \'zcs_phone_div\', \'phone\')"></div>'):(html.append('<div class="msi-plus" style="display: inline-block;float: left;margin-top: 10px;margin-left: 10px;" onclick="ZContacts.contactimport.createExtraRows(this, 7, \'zcs_phone_div\', \'phone\')"></div>'),html.append('<div class="msi-close zcs_msi_close" style="display: inline-block;float: left;margin-top: 10px;margin-left: 10px;" onclick="ZContacts.contactimport.createExtraRows(this, 7, \'zcs_phone_div\', \'phone\')"></div>'))):"ims"==name?(html.append('<div class="zcs-left SC_select" style="margin-left: 10px;">'+getTypeSelectBox(name,"ims")+"</div>"),7==$siblings.length?html.append('<div class="msi-close zcs_msi_close" style="display: inline-block;float: left;margin-top: 10px;margin-left: 10px;" onclick="ZContacts.contactimport.createExtraRows(this, 8, \'zcs_ims_div\', \'ims\')"></div>'):(html.append('<div class="msi-plus" style="display: inline-block;float: left;margin-top: 10px;margin-left: 10px;" onclick="ZContacts.contactimport.createExtraRows(this, 8, \'zcs_ims_div\', \'ims\')"></div>'),html.append('<div class="msi-close zcs_msi_close" style="display: inline-block;float: left;margin-top: 10px;margin-left: 10px;" onclick="ZContacts.contactimport.createExtraRows(this, 8, \'zcs_ims_div\', \'ims\')"></div>'))):"urls"==name?(html.append('<div class="zcs-left SC_select" style="margin-left: 10px;">'+getTypeSelectBox(name,"urls")+"</div>"),9==$siblings.length?html.append('<div class="msi-close zcs_msi_close" style="display: inline-block;float: left;margin-top: 10px;margin-left: 10px;" onclick="ZContacts.contactimport.createExtraRows(this, 10, \'zcs_urls_div\', \'urls\')"></div>'):(html.append('<div class="msi-plus" style="display: inline-block;float: left;margin-top: 10px;margin-left: 10px;" onclick="ZContacts.contactimport.createExtraRows(this, 10, \'zcs_urls_div\', \'urls\')"></div>'),html.append('<div class="msi-close zcs_msi_close" style="display: inline-block;float: left;margin-top: 10px;margin-left: 10px;" onclick="ZContacts.contactimport.createExtraRows(this, 10, \'zcs_urls_div\', \'urls\')"></div>'))):4==$siblings.length?html.append('<div class="msi-close zcs_msi_close" style="display: inline-block;float: left;margin-top: 10px;margin-left: 10px;" onclick="ZContacts.contactimport.createExtraRows(this, 5, \'zcs_email_div\', \'email\')"></div>'):(html.append('<div class="msi-plus" style="display: inline-block;float: left;margin-top: 10px;margin-left: 10px;" onclick="ZContacts.contactimport.createExtraRows(this, 5, \'zcs_email_div\', \'email\')"></div>'),html.append('<div class="msi-close zcs_msi_close" style="display: inline-block;float: left;margin-top: 10px;margin-left: 10px;" onclick="ZContacts.contactimport.createExtraRows(this, 5, \'zcs_email_div\', \'email\')"></div>')),html.append("</div></div>"),$appendRow.append(html.toString())}}else if($(data).hasClass("msi-close")){var $appendRow=$(data).parents().find("."+className),$siblingElem=$(data).parents(".zcs_siblings"),$delElm=$siblingElem.parent(".zcs_mapping_fld_grp"),$maindiv=$delElm.parent(".pack_block");$delElm.remove(),$maindiv.find(".zcs_mapping_info_lft_empty:first").css("display","none");var sksk=$appendRow.find(".zcs_siblings");if(sksk.length<=size){var parrentChildDiv=sksk.last();$(parrentChildDiv).find(".msi-close").removeClass("msi-close").removeClass("zcs_msi_close").addClass("msi-plus");var plusIconLen=$(parrentChildDiv).find(".msi-plus");plusIconLen.length>1&&plusIconLen.slice(1).remove(),sksk.length>1&&$(parrentChildDiv).append('<div class="msi-close zcs_msi_close" style="display: inline-block;float: left;margin-top: 10px;margin-left: 10px;" onclick="ZContacts.contactimport.createExtraRows(this, '+size+", '"+className+"', '"+name+"')\"></div>")}}}};