!function(a){"use strict";var b,c=function(){var a={};return $.extend(a,zmText.get("attachmentUtility"),zmText.get("attachComponent"),!0),a}();return function(){var a=Boolean(window.chrome)&&Boolean(window.chrome.webstore),d=Boolean(window.opr)&&Boolean(window.opr.addons)||Boolean(window.opera)||navigator.userAgent.indexOf(" OPR/")>=0,e=navigator.userAgent.toLowerCase().indexOf("firefox")>-1;b=a||d||e?zmText.applyArgs(c.desktopMsg,{command:"ctrl+v"}):c.desktopMsgWithoutPaste}(),a.templates=a.templates||{},$.extend(a.templates,{docsOption:['<div class="SC_frt">'+c.label.insertAs+'<div data-readval="write" data-read="'+c.button.asAttach+'" data-write="'+c.button.asLink+'" class="SC_rwToggle attToggTemp"></div></div>'],docinsertAs:['<label style="padding-right:4px;padding-top:5px;float: right">'+c.label.insertAs+"</label>"],dragdropArea:['<div class="SC_drop SC_dropW100"><div class="SC_drag wht" style="height:100%;top:0"><span>'+b+"</span></div></div>"].join(""),dropMsgTemplate:['<div style="display:none; height: 100%; width: 100%; left: 0px; top: 0px; position: absolute;">','<div class="SC_drag" style="height:70%"><span>'+c.dropMsg+"</span></div></div>"].join(""),filterInfo:['<font class="SC_lnk" style="display:none"></font>'].join(""),cloudFrame:'<iframe frameborder="0" id="cloudIframe" style="height:100%;width:100%"></iframe>',browseInputEle:function(a,b){return'<input type="file" id="'+a+'" name="'+b+'" style="visibility:hidden;width:1px;height:1px">'},canvasTextArea:['<div style="position: absolute">','<textarea style="height:100px;width: 250px"></textarea>','<div class="SC_PUbtm" id="gpcrt">','<span id="zmTextDone" class="sel">'+c.button.done+"</span>",'<span id="zmTextCancel" class="sel" data-val="Cancel">'+c.button.cancel+"</span>","</div>","</div>"].join(""),colorPallete:['<div id="zmAnnonate_Color" class="SC_PUcen"style="position:absolute;background-color: white;border: 1px solid #017FBE;display:none;padding-top:10px;padding-left:10px;border-radius: 10px">',"<div>","<ul>","<li>",'<ul class="SC_cp">',"<li>",'<div style="background-color:#e5e5e5"></div>','<div style="background-color:#f9baab"></div>','<div style="background-color:#f9d3a2"></div>','<div style="background-color:#fef86a"></div>','<div style="background-color:#d7f3b0"></div>','<div style="background-color:#c8e5fb"></div>','<div style="background-color:#e0ceef"></div>','<div style="background-color:#f6d0e6"></div>','<div style="background-color:#c4c4c4"></div>','<div style="background-color:#e07861"></div>','<div style="background-color:#ecb772"></div>','<div style="background-color:#f6e565"></div>','<div style="background-color:#badf88"></div>','<div style="background-color:#96ccf5"></div>','<div style="background-color:#b99fce"></div>','<div style="background-color:#e099c2"></div>','<div style="background-color:#808080"></div>','<div id="zmAnnotate_selColor" class="sel" style="background-color:#ce232c"></div>','<div style="background-color:#dd902f"></div>','<div style="background-color:#d0c04b"></div>','<div style="background-color:#90ca40"></div>','<div style="background-color:#70abec"></div>','<div style="background-color:#a97ac6"></div>','<div style="background-color:#c26a9d"></div>','<div style="background-color:#000000"></div>','<div style="background-color:#9d1812"></div>','<div style="background-color:#a56016"></div>','<div style="background-color:#a69646"></div>','<div style="background-color:#5b8828"></div>','<div style="background-color:#4c76a2"></div>','<div style="background-color:#8343a0"></div>','<div style="background-color:#ba3682"></div>',"</li>","</ul>","</li>","</ul>","</div>","</div>"].join(""),leftHeaderHtml:['<div class="SC_flt"></div>'].join(""),docsTab:['<b id="attachFromDocs">'+c.cloudServiceName.zDocs+"</b>"].join(""),cloudTab:['<b id="attachFromCloud">'+c.cloudServiceName.otherCloud+"</b>"].join(""),desktopTab:['<b id="zmDesktop">'+c.cloudServiceName.desktop+"</b>"].join(""),dragtheme:['<div style="height:3px" class="dragtheme"></div>'],desktopListTemplate:['<div class="zmL zmAch SC_mlst">','<div class="zmLst">','<div draggable="true" class="zmFlt"><i class="msi-drag"></i></div>','<div class="zmDtl">','<div class="zmDate">',"<span></span>","</div>",'<div class="zmImg"></div>','<div class="zmSze">','<span class="sum Sc_lnk">'+c.UserMsg.download+"</span>","</div>",'<div class="zmFdr">',"<span></span>","</div>",'<div class="zmFrm">',"<div>",'<span contentEditable="true" id="listView"></span>',"</div>","</div>",'<div class="zmSub">','<span id="zmSubView" class="sum SC_thm">'+c.attachTemplateText.view+"</span>",'<span id="zmSubAnnotate" class="sum SC_thm">'+c.attachTemplateText.annotate+"</span>",'<span id="zmSubDownload" class="sum SC_thm">'+c.attachTemplateText.download+"</span>",'<span id="zmSubRemove" class="sum SC_thm">'+c.attachTemplateText.remove+"</span>",'<span id="zmWrnMsg" class="sum"></span>',"</div>",'<div class="SC_icn"></div>','<div class="zm_lbl"></div>',"</div>",'<div class="zmFrt"></div>',"</div>","</div>"].join(""),annonateBox:function(){var a=c.annotatebox.title,b=[["DIV",{attrs:{id:"zmAnnonateBox","class":"SC_Pop blk SC_cent tempAttPop"},child:[["DIV",{attrs:{"class":"SC_pe"},child:[["DIV",{attrs:{id:"sand","class":"SC_oh"},child:[["DIV",{attrs:{id:"zmCanvasCont",style:"overflow: auto;position:relative"},child:[["CANVAS",{attrs:{id:"zmCanvas"}}],["CANVAS",{attrs:{id:"zmtempCanvas",style:"position:absolute;top:0px;left:0px;"}}]]}],["DIV",{attrs:{"class":"SC_PUbtm",id:"gpcrt"},child:[["SPAN",{attrs:{id:"zmImgEditDone","class":"sel"},child:[["text",c.button.done]]}],["SPAN",{attrs:{id:"zmImgEditCancel","class":"sel","data-val":"Cancel"},child:[["text",c.button.cancel]]}]]}]]}],["DIV",{attrs:{id:"lightnav"},child:[["DIV",{attrs:{"class":"At_nme"}}],["DIV",{attrs:{"class":"At_cls"},child:[["I",{attrs:{"class":"msi-close",iscancel:"true"}}]]}]]}]]}],["DIV",{attrs:{"class":"SC_tool",style:"left:-40px"},child:[["UL",{child:[["LI",{attrs:{"class":"sc_tb_hd"}}],["LI",{attrs:{id:"zmAttUndo",title:a.undo},child:[["I",{attrs:{"class":"msi-undo"}}]]}],["LI",{attrs:{id:"zmAttRedo",title:a.redo},child:[["I",{attrs:{"class":"msi-redo"}}]]}]]}],["UL",{child:[["LI",{attrs:{id:"zmAttSquare",title:a.square},child:[["I",{attrs:{"class":"msi-box"}}]]}],["LI",{attrs:{id:"zmAttHide",title:a.mask},child:[["I",{attrs:{"class":"msi-mask"}}]]}]]}],["UL",{child:[["LI",{attrs:{id:"zmAttCircle",title:a.circle},child:[["I",{attrs:{"class":"msi-ellipse"}}]]}],["LI",{attrs:{id:"zmAttLine",title:a.line},child:[["I",{attrs:{"class":"msi-line"}}]]}],["LI",{attrs:{id:"zmAttPen",title:a.pen},child:[["I",{attrs:{"class":"msi-pen"}}]]}]]}],["UL",{child:[["LI",{attrs:{id:"zmAttCrop",title:a.crop},child:[["I",{attrs:{"class":"msi-crop"}}]]}],["LI",{attrs:{id:"zmAttText",title:a.text},child:[["I",{attrs:{"class":"msi-text"}}]]}],["LI",{attrs:{id:"zmAttColor",title:a.color},child:[["I",{attrs:{"class":"msi-nclr"}}]]}],["LI",{attrs:{"class":"sc_tb_hd"}}]]}]]}]]}]];return $(_zm.getDOM(b))},cloudAttTempLoadingBox:['<div class="zmL SC_Pbar" id="attloading">','<div class="zmLst">','<div class="zmDtl">','<div class="zmSze">','<span class="sum">&nbsp;</span>',"</div>",'<div class="zmSub">','<span data-name="rename">'+c.UserMsg.rename+"</span>",'<span data-name="download">'+c.UserMsg.download+"</span>","</div>",'<div class="zmFrm">','<span data-name="filename"></span>',"</div>",'<div class="zmImg">','<i class="msi-attothers SC_big"></i>',"</div>",'<div class="SC_icn">','<i class="msi-close"></i>',"</div>",'<div class="zm_lbl">','<div id="progressbar" style="width:0%"></div>',"</div>","</div>","</div>","</div>"].join(""),attachFromPopup:['<div class="SC_Pop SC_cent SC_add wht" id="zmAttachCompWhtPopup">','<div class="SC_pe">','<div class="SC_PU" style="max-width:1000px;">','<div class="SC_PUcen">','<div class="SCmc SC_attachviewer">','<div class="SC_mhd">','<div class="SC_flt">','<span id="zmACTabContainer" class="SC_mtb"></span>',"</div>","</div>",'<div class="SCmb">','<div class="SC_frt">',"<ul>",'<li style="display:none;" class="zmAttCompHideThis">','<b><span><i class="msi-filter"></i></span></b>',"</li>",'<li style="display:none;" class="zmAttCompHideThis">','<b class="SC_sel"><span><i class="msi-thumbview"></i></span></b>',"</li>",'<li style="display:none;" class="zmAttCompHideThis">','<b><span><i class="msi-listview"></i></span></b>',"</li>","<li>",'<b><span><i class="msi-close"></i></span></b>',"</li>","</ul>","</div>",'<div class="SC_flt"></div>',"</div>",'<div style="display:none;" class="SC_mclst SC_ren" id="zmattDesktop"></div>','<div id="zmattViewBrowse" class="SC_drop" style="width:100%"><span>'+zmText.applyArgs(c.desktopMsg,{command:"ctrl+v"})+"</span></div>",'<div id="zmattImport" style="display:none; height: 100%; width: 100%;left: 0px; top: 0px; position: absolute;"><div class="SC_drag" style="height:70%"><span>'+c.dropMsg+"</span></div></div>",'<div class="SC_mclst" id="zmattView"></div>','<div class="SC_mclst" id="zmMyDocs" style="display:none"></div>','<div class="SC_mclst" id="zmMyCloud" style="display:none;overflow:hidden"></div>',"</div>","</div>",'<div class="SC_PUbtm">','<span id="zmattViewAttach" class="sel">'+c.button.attach+"</span>",'<span id="zmattViewCancel" data-val="Cancel">'+c.button.cancel+"</span>",'<span id="zmattViewAsAtt" style="float:right" class="SC_vh">'+c.button.asAttach+"</span>",'<span id="zmattViewAsLink" style="float:right" class="SC_vh" data-val="Cancel">'+c.button.asLink+"</span>","</div>","</div>","</div>","</div>"].join(""),insertImageLoading:['<div id="progressbar" style="display: none" class="upldProgBar">','<div id="progressIndicator"></div>',"</div>"].join(""),insertImageMaskBtn:['<div id="blkMaskWthBtn" class="blkMask" style="opacity:0; display:none">','<div class="blkMaskBtn" style="left: 38%;">'+c.attachTemplateText.annotate+"</div>",'<div class="blkMaskBtn" style="left: 48%;">'+c.attachTemplateText.remove+"</div></div>"].join(""),blackMask:["<div id='uploadMask' style='display:none' class='blkMask'></div>"].join(""),selectedFile:['<span class="SC_fileSel"><span data-name="filename"></span><i class="msi-close"></i></span>'].join("")},!0),a}(window.zmAttachment=window.zmAttachment||{}),function(a){"use strict";return a.utility=a.utility||{},a.utility.setDragDrop=function(){function a(a){this.$centerEle=a.$centerEle,this.onDrop=a.onDrop,this.onDragover=a.onDragover,this.onDragLeave=a.onDragLeave}return a.prototype.init=function(){this.bindDropListener(),this.bindDragOver(),this.bindDragLeave()},a.prototype.bindDropListener=function(){var a=this;this.$centerEle.on("drop",function(b){var c,d;return b.preventDefault(),c=b.originalEvent.dataTransfer,d=c&&c.files,d&&d.length&&a.onDrop(d,a.$centerEle),!1})},a.prototype.bindDragOver=function(){var a=this;this.$centerEle.on("dragover dragenter",function(b){var c=b.originalEvent.dataTransfer,d=a.$centerEle.find(".SC_drop");return b.preventDefault(),(null!==c.types||c.files&&c.files.length>0)&&(c.files&&c.files.length>0||(c.types.indexOf?c.types.indexOf("Files")!==-1:c.types.contains("application/x-moz-file"))||c.types.length&&"Files"===c.types[0])&&(c.dropEffect="copy","function"==typeof a.onDragover?a.onDragover():d.hasClass("SC_dropW100")||d.addClass("SC_dropW100")),!1})},a.prototype.bindDragLeave=function(){var a=this;this.$centerEle.find(".SC_drop").on("dragleave",function(b){return b.preventDefault(),"function"==typeof a.onDragLeave&&a.onDragLeave(),!1})},function(b){var c=new a(b);c.init()}}(),a.utility.createObjectURL=function(b,c){var d;if(window.URL=window.URL||window.webkitURL,window.URL&&b)return d=window.URL.createObjectURL(b),c&&window.setTimeout(function(){a.utility.revokeObjectURL(d)},c),d},a.utility.revokeObjectURL=function(a){window.URL=window.URL||window.webkitURL,window.URL&&a&&window.URL.revokeObjectURL(a)},a.utility.isFunction=function(a){return"function"==typeof a},a.utility.renameHelper=function(){function b(b){var c=this.config;60===b.which||62===b.which?b.preventDefault():13===b.which&&(b.preventDefault(),c.$ele.trigger("blur")),a.utility.isFunction(c.onKeypress)&&c.onKeypress(b)}function c(a){a.preventDefault()}function d(b){var c,d=this.config,e=d.$ele,f=e.closest("."+d.parentClass),g=d.orginalFileName,h=g.lastIndexOf(".");27===b.which?(b.preventDefault(),c=h!==-1?g.substring(0,h):g,e.text(c),e.blur()):c=e.text(),c&&c.length&&(h!==-1&&(c+=g.substring(h,g.length)),f.attr("title",_zm.escapeTags(c)),a.utility.isFunction(d.onChange)&&d.onChange.call(d.context||null,c,d.handbackData)),a.utility.isFunction(d.onKeyup)&&d.onKeyup(b)}function e(b){var c,d=this.config,e=d.$ele,f=d.orginalFileName,g=f.lastIndexOf(".");"true"===e.attr("contenteditable")&&(c=e.text(),c&&c.length?g!==-1&&(c+=f.substring(g,f.length)):c=f,e.text(zmUtil.getSubString(20,c)).attr("contenteditable",!1),this.config.orginalFileName=c,a.utility.isFunction(d.onBlur)&&d.onBlur(b))}function f(){var a=this.config.$ele;a.on("keypress",b.bind(this)),a.on("paste",c),a.on("keyup",d.bind(this)),a.blur(e.bind(this))}function g(a,b){"true"!==a.attr("contenteditable")&&(a.attr("contenteditable",!0),window.setTimeout(function(){var c,d,e,f;a.focus(),e=b.attr("title"),f=e.lastIndexOf("."),f!==-1&&a.text(e.substring(0,f)),document.createRange?(c=document.createRange(),c.selectNodeContents(a[0]),c.collapse(!1),d=window.getSelection(),d.removeAllRanges(),d.addRange(c)):document.selection&&(c=document.body.createTextRange(),c.moveToElementText(a[0]),c.collapse(!1),c.select())},10))}function h(a){a&&a.constructor===Object?(this.config=a,f.call(this)):zmUtil.debugLog("Rename attachment: Invalid config")}return{init:function(a){return new h(a)},onRenameAction:g}}(),a}(window.zmAttachComponent=window.zmAttachComponent||{}),function(a){"use strict";function b(){var a={allowDefaultScope:!1,shortcuts:[{uid:"close",keyStr:"esc",actions:[function(){Q()}]}],scope:"imageAnnotate"};M=zmComponent.keybindings.getScope(),zmComponent.keybindings.registerAll(a),zmComponent.keybindings.setScope("imageAnnotate")}function c(a,b,c,d,e,f){for(var g=b.split("\n"),h=0,i=g.length;h<i;h++){for(var j="",k=g[h].split(" "),l=0,m=k.length;l<m;l++){var n=j+k[l]+" ",o=a.measureText(n),p=o.width;p>e?(a.fillText(j,c,d),j=k[l]+" ",d+=f):j=n}a.fillText(j,c,d),d+=f}}function d(a,b){var c=b.offset(),d=b.position(),e=a.clientX,f=a.clientY,g=e-c.left+d.left,h=f-c.top+d.top,i=$("#zmAnnonateBox #zmCanvasCont");return g+=i.scrollLeft(),h+=i.scrollTop(),{realX:g,realY:h}}function e(){P.undoList.length?$("#zmAttUndo").addClass("sel"):$("#zmAttUndo").removeClass("sel"),P.redoList.length?$("#zmAttRedo").addClass("sel"):$("#zmAttRedo").removeClass("sel")}function f(a){var b=document.createElement("canvas"),c=$("#zmCanvas")[0];b.height=c.height,b.width=c.width,b.getContext("2d").drawImage(c,0,0),a.push(b),e()}function g(a,b){a.getContext("2d").drawImage(b,0,0),b.getContext("2d").clearRect(0,0,b.width,b.height)}function h(a){P.isDragging=!1;var b=$("#zmtempCanvas"),c=$("#zmCanvas")[0];b.off("mousemove.zmAttWidget"),b.off("mouseup.zmAttWidget"),f(P.undoList),a&&a(),g(c,b[0])}function i(a){var b=$("#zmCanvas")[0],c=b.getContext("2d"),d=$("#zmtempCanvas")[0],e=d.getContext("2d");c.beginPath(),c.clearRect(0,0,b.width,b.height),b.width=a.width,b.height=a.height,e.clearRect(0,0,d.width,d.height),d.width=a.width,d.height=a.height,c.drawImage(a,0,0)}function j(){if(P.undoList.length){var a=P.undoList[P.undoList.length-1];f(P.redoList),i(a),P.undoList.pop(),e()}}function k(){if(P.redoList.length){var a=P.redoList[P.redoList.length-1];f(P.undoList),i(a),P.redoList.pop(),e()}}function l(a,b){var e,f,g,i=d(a,b),j=i.realY,k=i.realX,l=$("#zmAnnonateBox"),m=l.find("#zmtempCanvas"),n=m.height(),o=m.width();n>=60&&j+50>n&&(j=n-60),o>=210&&k+200>o&&(k=o-210),f=o-k-20,g=n-j-20;var p=function(a){var b=m[0],d=b.getContext("2d"),g=parseFloat(e.css("left")),i=parseFloat(e.css("top"))+15;d.beginPath(),d.fillStyle=P.selectedColor,d.font="bold 16px sans-serif",d.textBaseline="bottom",c(d,a,g,i,f,16),d.closePath(),h()};if($("#zmCanvTxtArea").length){e=$("#zmCanvTxtArea");var q=e.val();q.length&&p(q),$("#zmCanvTxtArea").remove()}else e=$("<textarea style='width: 200px; position: absolute;'></textarea>"),e.attr("id","zmCanvTxtArea").css({top:j,left:k}),e.css({"max-width":f,"max-height":g,border:"none",color:P.selectedColor}),l.find("#zmCanvasCont").append(e),e.focus(),e.on("change keyup",function(){zmail.Utils.TextAreaResizer.resize(this,{maxHeight:g,maxWidth:f})})}function m(a){var b=a.find("#zmAnnonate_Color");b.hide()}function n(a,b){b.find(".SC_tool").find("li").removeClass("sel"),a.addClass("sel")}function o(a){var b=$("#zmAnnonateBox"),c=b.find("#zmtempCanvas");a.cursorType&&c.css("cursor",a.cursorType),a.offEvents&&c.off(a.offEvents),a.onEvents&&c.on(a.onEvents,function(c){c.preventDefault(),m(b),a.onCallback&&a.onCallback(c,$(this))})}function p(a){P.startX=a.realX,P.startY=a.realY,P.stopX=P.startX,P.stopY=P.startY,P.isDragging=!0}function q(a){P.stopX=a.realX,P.stopY=a.realY}function r(a){var b=$("#zmtempCanvas"),c=b[0].getContext("2d"),d=P.stopX-P.startX,e=P.stopY-P.startY,f=5;c.clearRect(0,0,b[0].width,b[0].height),c.beginPath(),c.rect(P.startX,P.startY,d,e),c.lineWidth=f,a?(a.lineWidth&&(c.lineWidth=a.lineWidth),a.strokeStyle&&(c.strokeStyle=a.strokeStyle),a.fillStyle&&(c.fillStyle=a.fillStyle,c.fill()),a.setLineDash&&c.setLineDash&&(c.setLineDash(a.setLineDash),c.lineDashOffset=2)):c.strokeStyle=P.selectedColor,c.stroke()}function s(a,b){a.preventDefault(),P.isDragging&&(q(d(a,b)),r())}function t(a){var b={};b.strokeStyle=a,b.fillStyle=a,r(b)}function u(a,b){P.isDragging&&(q(d(a,b)),t(P.selectedColor))}function v(a,b){var c,e=$("#zmtempCanvas");e.on("mousemove.zmAttWidget",function(a){a.preventDefault(),s(a,$(this))}),e.on("mouseup.zmAttWidget",function(a){a.preventDefault(),h()}),c=d(a,b),p(c),r()}function w(a,b){var c,e=$("#zmtempCanvas");e.on("mousemove.zmAttWidget",function(a){a.preventDefault(),u(a,$(this))}),e.on("mouseup.zmAttWidget",function(a){a.preventDefault(),h()}),c=d(a,b),p(c),t(P.selectedColor)}function x(){var a,b,c,d,e=$("#zmtempCanvas"),f=e[0].getContext("2d"),g=Math.abs(P.stopX-P.startX),h=Math.abs(P.stopY-P.startY);f.clearRect(0,0,e[0].width,e[0].height),f.beginPath(),f.ellipse?f.ellipse(P.stopX,P.stopY,g,h,0,0,2*Math.PI):(b=Math.max(g,h),c=g/b,d=h/b,a=g>h?g:h,f.save(),f.translate(P.stopX,P.stopY),f.scale(c,d),f.beginPath(),f.arc(0,0,a,0,2*Math.PI,!1),f.restore()),f.lineWidth=5,f.strokeStyle=P.selectedColor,f.stroke()}function y(a,b){P.isDragging&&(q(d(a,b)),x())}function z(a,b){var c,e=$("#zmtempCanvas");e.on("mousemove.zmAttWidget",function(a){a.preventDefault(),y(a,$(this))}),e.on("mouseup.zmAttWidget",function(a){a.preventDefault(),h()}),c=d(a,b),p(c),x()}function A(){var a=$("#zmtempCanvas")[0];if(a.getContext){var b=a.getContext("2d");b.beginPath(),b.strokeStyle=P.selectedColor,b.clearRect(0,0,a.width,a.height),b.moveTo(Math.floor(P.startX),Math.floor(P.startY)),b.lineTo(Math.floor(P.stopX),Math.floor(P.stopY)),b.lineWidth=5,b.lineJoin="round",b.lineCap="round",b.fillStyle=P.selectedColor,b.stroke(),b.closePath()}}function B(a,b){P.isDragging&&(q(d(a,b)),A())}function C(a,b){var c,e=$("#zmtempCanvas");e.on("mousemove.zmAttWidget",function(a){a.preventDefault(),B(a,$(this))}),e.on("mouseup.zmAttWidget",function(a){a.preventDefault(),h()}),c=d(a,b),p(c),A()}function D(a,b){if(P.isDragging){var c=$("#zmtempCanvas"),e=c[0].getContext("2d"),f=d(a,b);f.realY+=O,q(f),e.lineTo(P.stopX,P.stopY),e.stroke()}}function E(a,b){var c,e=$("#zmtempCanvas"),f=e[0].getContext("2d");e.on("mousemove.zmAttWidget",function(a){a.preventDefault(),D(a,$(this))}),e.on("mouseup.zmAttWidget",function(a){a.preventDefault(),f.closePath(),h()}),c=d(a,b),c.realY+=O,f.beginPath(),f.lineWidth=2,f.shadowBlur=1,f.strokeStyle=P.selectedColor,p(c),f.moveTo(P.startX,P.startY)}function F(){var a=$("#zmtempCanvas"),b=a[0].getContext("2d"),c={},d={};P.startX<P.stopX?(c.startX=P.startX,c.stopX=P.stopX):(c.startX=P.stopX,c.stopX=P.startX),P.startY<P.stopY?(d.startY=P.startY,d.stopY=P.stopY):(d.startY=P.stopY,d.stopY=P.startX),b.clearRect(0,0,a[0].width,a[0].height),a[0].width=Math.abs(P.startX-P.stopX),a[0].height=Math.abs(P.startY-P.stopY),b.drawImage($("#zmCanvas")[0],c.startX,d.startY,Math.abs(c.startX-c.stopX),Math.abs(d.startY-d.stopY),0,0,Math.abs(c.startX-c.stopX),Math.abs(d.startY-d.stopY))}function G(a,b){P.isDragging&&(q(d(a,b)),r({setLineDash:[2,5],strokeStyle:"Black",lineWidth:2}))}function H(a,b){var c,e=$("#zmtempCanvas");e.on("mousemove.zmAttWidget",function(a){a.preventDefault(),G(a,$(this))}),e.on("mouseup.zmAttWidget",function(a){a.preventDefault(),Math.abs(P.startX-P.stopX)?(F(),h(function(){$("#zmCanvas")[0].getContext("2d").clearRect(0,0,$("#zmCanvas")[0].width,$("#zmCanvas")[0].height),$("#zmCanvas")[0].width=Math.abs(P.startX-P.stopX),$("#zmCanvas")[0].height=Math.abs(P.startY-P.stopY)})):(e.off("mousemove.zmAttWidget"),e.off("mouseup.zmAttWidget"))}),c=d(a,b),p(c),r({setLineDash:[2,5],strokeStyle:"Black",lineWidth:2})}function I(a){var b=a.target||a.srcElement,c=b.className,d=$("#zmAnnonateBox"),f=$(b),g=f.parent(),h={cursorType:"crosshair",offEvents:"mousedown click",onEvents:"mousedown"};switch(c){case"msi-undo":j();break;case"msi-redo":k();break;case"msi-box":n(g,d),h.onCallback=v,h.cursorType="url("+zmail.imgPath+"rectangle.png), crosshair",o(h);break;case"msi-mask":n(g,d),h.onCallback=w,h.cursorType="url("+zmail.imgPath+"blackout.png), crosshair",o(h);break;case"msi-ellipse":n(g,d),h.onCallback=z,h.cursorType="url("+zmail.imgPath+"circle.png), crosshair",o(h);break;case"msi-line":n(g,d),h.onCallback=C,h.cursorType="url("+zmail.imgPath+"line.png), crosshair",o(h);break;case"msi-pen":n(g,d),h.onCallback=E,h.cursorType="url("+zmail.imgPath+"pen.png), auto",o(h);break;case"msi-crop":n(g,d),h.onCallback=H,h.cursorType="url("+zmail.imgPath+"crop.png), crosshair",o(h);break;case"msi-text":n(g,d),h.onCallback=l,h.offEvents="mousedown mousemove mouseup",h.onEvents="click",h.cursorType="auto",o(h);break;case"msi-nclr":var i=d.find("#zmAnnonate_Color"),m=f.offset().top-i.outerHeight()/2;i.show().css("top",m);break;default:n($("#zmAttSquare"),d),h.onCallback=v,h.cursorType="url("+zmail.imgPath+"rectangle.png), crosshair",o(h)}e()}function J(a){var b=a.find(".SC_tool");P.selectedColor=a.find("#zmAnnotate_selColor")[0].style.backgroundColor,b.on("click",I),a.find("#zmAnnonate_Color .SC_cp").find("div").on("click",function(){a.find("#zmAnnotate_selColor").removeAttr("id").removeClass("sel"),$(this).addClass("sel").attr("id","zmAnnotate_selColor"),P.selectedColor=$(this)[0].style.backgroundColor}),b.click()}function K(b){window.URL=window.URL||window.webkitURL;var c=a.utility.createObjectURL(b),d=new Image;$(d).css({visibility:"hidden"}),$("body").append(d),d.onload=function(){S(d),a.utility.revokeObjectURL(c)},d.src=c}function L(){var a=$("#zmAnnonateBox");a.find("#zmCanvasCont, .SC_pe").css({"max-height":a.height()-5,"max-width":a.width()-5})}var M,N={},O=15,P={startX:0,startY:0,stopX:0,stopY:0,isDragging:!1,undoList:[],redoList:[],selectedColor:"#ce232c"};a.imageEditTool={},a.utility=a.utility||{},a.utility.dataURItoBlob=function(a){var b,c,d,e;for(b=a.split(",")[0].indexOf("base64")>=0?atob(a.split(",")[1]):unescape(a.split(",")[1]),c=a.split(",")[0].split(":")[1].split(";")[0],d=new window.Uint8Array(b.length),e=0;e<b.length;e++)d[e]=b.charCodeAt(e);return new Blob([d],{type:c})},N.getAnnonateAreaTemplate=function(){return zmAttachment.templates.annonateBox()},N.getColorPallete=function(){return zmAttachment.templates.colorPallete};var Q=function(){$("#zmAnnonateBox").remove(),P.undoList=[],P.redoList=[],M&&zmComponent.keybindings.setScope(M)},R=function(){$("#zmAnnonateBox").on("mousedown mouseup",function(a){zmUtil.stopEvents(a,!0)})},S=function(a){var b=$("#zmCanvasCont"),c=b.find("#zmCanvas")[0],d=b.find("#zmtempCanvas")[0],e=$(a).height(),f=$(a).width(),g=c.getContext("2d");b.css("overflow","auto"),c.width=f,c.height=e,d.height=e,d.width=f,g.clearRect(0,0,f,e),g.drawImage(a,0,0,f,e),$(a).remove()};a.imageEditTool.init=function(c){var d,e=c.file,f=c.handBckObj;$("body").append(N.getAnnonateAreaTemplate()),d=$("#zmAnnonateBox"),d.append(N.getColorPallete()),b(),R(),L(),d.find(".At_nme").text(e.name||" "),d.find(".At_cls,#zmImgEditCancel").off("click").on("click",function(){Q()}),d.find("#zmImgEditDone").off("click").on("click",function(){var b=d.find("#zmCanvas"),e=b[0].toDataURL(),g=a.utility.dataURItoBlob(e);d.remove(),c.onAttach&&c.onAttach({blob:g,handBckObj:f}),c.onClose&&c.onClose(),P.undoList=[],P.redoList=[]}),$(zmail.win).resize(function(){$("#zmAnnonateBox").length&&L()}),J($("#zmAnnonateBox")),K(e)}}(window.zmAttachComponent=window.zmAttachComponent||{}),function(a){"use strict";function b(a){var b={};a.sN&&(b.aId=this.accId,b.sN=a.sN,b.fP=a.fP,b.mode="d",zmAjq.XHR({u:zmail.conPath+"/attach.do",t:"POST",p:b}))}function c(){return zmail.isBaihui}function d(){return"false"!==zmail.isCloudServiceEnabled}function e(){return!zmUtil.isZohoAccount(zmail.accId)}function f(){document.body.addEventListener("paste",Z)}function g(){document.body.removeEventListener("paste",Z)}function h(a){return a.accId||zmUtil.getZohoAccId()}function i(a,b){var c,d={streams:"p",notes:"n",task:"t",bookmark:"l",mail:"m"},e=a.indexOf("zmEdi_")>=0;if("number"==typeof aa[a])return void("function"==typeof b&&b(aa[a]));if(e&&"number"==typeof aa.mail)return void("function"==typeof b&&b(aa.mail));if(d[a])c=d[a];else{if(!e)return;c="m"}$.ajax({url:zmail.conPath+"/attach.do",type:"POST",success:function(c){c=JSON.parse(c),"number"==typeof c.maxsize&&(e?aa.mail=c.maxsize:aa[a]=c.maxsize,"function"==typeof b&&b(c.maxsize))},data:{entity:c,mode:"maxsize",zmrcsr:zmAjq.getCookie("zmcsr")}})}function j(){this.desktopAttachedSize=void 0,this.dialog=void 0,this.attachUtil=null,this.selectedattachUtilectsArr=[],this.desktopObj=[],this.filenameCountMap={}}function k(a,b){return a.filter(function(a){return a!==b})}function l(){this.isUploadCompleted()&&(this.attachTempArr.tempLocation=k(this.attachTempArr.tempLocation,void 0))}function m(a,b){"function"==typeof this.onAddAttachment&&this.onAddAttachment(a,b)}function n(a){"function"==typeof this.onRemoveAttachment&&this.onRemoveAttachment(a)}function o(a){var b;!function c(){var d=parseInt(a.find("#progressbar")[0].style.width);b&&window.clearTimeout(b),d>=90||(a.find("#progressbar")[0].style.width=d+10+"%",b=window.setTimeout(c,1e3))}()}function p(a,b,c,d){var e,f=zmUtil.isPreviewAvailable(a.fn||a.name);if(f.isPrev&&("myAttachment"===c?a.src=zmUtil.getTheSrc(f.apiName,a):a.src=zmUtil.getSrcForTempAtt(a,this.accId)),e=this.orderedListOfAttachedFile.length,b>e)for(;e<b;)this.orderedListOfAttachedFile[e]=void 0,e++;this.orderedListOfAttachedFile.splice(b,1,a),m.call(this,a,d)}function q(a){var b,c=[];this.orderedListOfAttachedFile=k(this.orderedListOfAttachedFile,void 0),b=this.orderedListOfAttachedFile.indexOf(_.findWhere(this.orderedListOfAttachedFile,a)),this.orderedListOfAttachedFile.forEach(function(a){var b="msi-attimg"===zmUtil.fileTyp(a.fn||a.name)[1]?101:103;c.push({ft:b,fn:a.n||a.fn||a.name,src:a.src})}),zmUtil.initAttSlideShow(c,b,!0)}function r(a){var b,c=this.orderedListOfAttachedFile.indexOf(_.findWhere(this.orderedListOfAttachedFile,a));c>=0&&(this.slideListCount--,b=this.orderedListOfAttachedFile[c],this.orderedListOfAttachedFile.splice(c,1),n.call(this,b))}function s(){var a,b,f,g=this;b=function(){a=g.configJSON.attachFrom.indexOf("otherCloud"),a>=0&&g.configJSON.attachFrom.splice(a,1)},f=function(){a=g.configJSON.attachFrom.indexOf("zDocs"),a>=0&&g.configJSON.attachFrom.splice(a,1)},d()&&!c()||b(),zmAttachUtility.isDocsCompAllowed()||f(),e()&&(a=this.configJSON.attachFrom.indexOf("myAttachchment"),a>=0&&this.configJSON.attachFrom.splice(a,1))}function t(){var a=this.attachUtil;this.dialog.$el.find(".SC_srch").removeClass("shw"),this.dialog.$el.find(".SC_frt").find("b").removeClass("SC_sel"),this.dialog.$el.find(".msi-thumbview").closest("b").addClass("SC_sel"),a.restoreOptions(this.dialog.$el)," "===a.prvFltr.lblId?a.getAttLst(a.groupId,"t",1,a.entity,a.fileType,a.prvFltr,"y",!1):a.getAttLst(a.groupId,"t",1,a.entity,a.fileType,a.prvFltr,"y",a.prvFltr)}function u(){var a=this.attachUtil;this.dialog.$el.find(".SC_srch").removeClass("shw"),this.dialog.$el.find(".SC_frt").find("b").removeClass("SC_sel"),this.dialog.$el.find(".msi-listview").closest("b").addClass("SC_sel"),a.restoreOptions(this.dialog.$el)," "===a.prvFltr.lblId?a.getAttLst(a.groupId,"l",1,a.entity,a.fileType,a.prvFltr,"y",!1):a.getAttLst(a.groupId,"l",1,a.entity,a.fileType,a.prvFltr,"y",a.prvFltr)}function v(){this.dialog.$el.find(".SC_srch").toggleClass("shw"),this.attachUtil.restoreOptions(this.dialog.$el)}function w(){var a=this.attachUtil,b=a.prvFltr.lblId;if("myAttachment"===this.dialog.currentTab())if(a.groupId===zmail.zuid&&"all"===a.entity&&0===a.fileType&&" "===b)this.dialog.$el.find("#zmMyAttachments").hide();else{var c,d=zmail.zuid===a.groupId?da.menuText.me:zmCont.getGroup()[a.groupId].name;c="f"===b?da.menuText.favourites:" "===b?da.menuText.notags:zmail.labInfo[b].dispName,this.dialog.$el.find("#zmMyAttachments").show(),this.dialog.$el.find("#zmMyAttachments").find("b").text(" "+_zm.escapeTags(d)+" - "+zmAttachUtility.entDrpTxtChange(a.entity)+" - "+da.fType[a.fileType]+" - "+_zm.escapeTags(c)+" "),this.dialog.$el.find(".msi-filter").closest("b").addClass("SC_sel")}}function x(b){var c=this;return{id:"myAttachments",text:da.common.me,selected:b,tabName:"myAttachment",onClk:function(a,b,d){d?w.call(c):(c.attachUtil=new zmAttachUtility.AttachmentListing({appName:"attComp",listElem:a.getCenterElem().find(".SC_mclst"),headerElem:a.$el,thumbWidth:95,onFilterAction:w.bind(c)}),c.attachUtil.initAttachViewComp()),a.$el.find(".SC_PUsel_files").show()},forceCall:!0,listingArea:{id:"zmattView",classes:"SC_mclst",styles:{"overflow-y":"scroll"},parEle:$('<div class="SCmc SC_attachviewer"></div>')},icons:[{iconClass:"msi-filter",onClk:function(){v.call(c)}},{iconClass:"msi-thumbview",selected:!0,onClk:function(){t.call(c)}},{iconClass:"msi-listview",onClk:function(){u.call(c)}}],buttons:[{text:da.button.attach,onClk:function(){a.myAttachment.onAttachHandler.call(c)}}]}}function y(b){var c=this,d={id:"attachFromDocs",text:da.cloudServiceName.zDocs,tabName:"zDocs",selected:b,onClk:function(b,d,e){b.$el.find("#zmMyAttachments").hide(),b.$el.find(".SC_PUsel_files").hide(),e||a.zDocs.invokeZDocsComponent.call(c,b.getCenterElem())},forceCall:!0,listingArea:{id:"zmMyDocs",classes:"SCmc SC_attachviewer"},buttons:[]};return this.configJSON.showZDocsAsLinkOption?d.buttons.push({text:da.button.insert,onClk:function(){a.zDocs.attachZDocsDocument.call(c)}}):d.buttons.push({text:da.button.attach,onClk:function(){a.zDocs.attachZDocsDocument.call(c)}}),d}function z(b){var c=this;return{id:"attachFromCloud",text:da.cloudServiceName.otherCloud,tabName:"oCloud",selected:b,onClk:function(b,d,e){b.$el.find("#zmMyAttachments").hide(),b.$el.find(".SC_PUsel_files").hide(),e||a.gagets.invokeGadgetComponent.call(c,b)},forceCall:!0,listingArea:{classes:"SCmc SC_attachviewer"},hideButtons:!0}}function A(b){var c=this;return{id:"zmDesktop",text:da.cloudServiceName.desktop,tabName:"zDesktop",selected:b,onClk:function(b){b.$el.find("#zmMyAttachments").hide(),b.$el.find(".SC_PUsel_files").hide(),"undefined"==typeof c.dialog&&0===c.configJSON.attachFrom.indexOf("desktop")||a.desktop.onTabSelection.call(c)},forceCall:!0,listingArea:{classes:"SC_mclst SC_ren",parEle:$('<div class="SCmc SC_attachviewer"></div>')},buttons:[{text:da.button.attach,onClk:function(){a.desktop.attachBtnHandler.call(c)}}]}}function B(b){return a.insertImage.getTabConfig.call(this,b)}function C(a,b){return"myAttachchment"===a?x.call(this,b):"zDocs"===a?y.call(this,b):"otherCloud"===a?z.call(this,b):"desktop"===a?A.call(this,b):"insertImage"===a?B.call(this,b):void 0}function D(a){var b=[],c=this,d=a.find("#zmAttGrp input"),e=a.find("#zmAttLbl input"),f=a.find("#zmAttEntity input"),g=a.find("#zmAttFilTyp input");
e.val("None").data({dataIndex:"all"}),d.val("Me").data({dataIndex:zmail.zuid}),f.val("All").data({dataIndex:"all"}),g.val("All").data({dataIndex:0}),a.find(".SC_frt").find(".msi-thumbview").closest("b").addClass("SC_sel"),a.find("#zmAttGrp").off("click").on("click",function(){zmAttachUtility.attDropDown("grp",d)}),a.find("#zmAttEntity").on("click",function(){zmAttachUtility.attDropDown("ent",f)}),a.find("#zmAttFilTyp").on("click",function(){zmAttachUtility.attDropDown("tfil",g)}),a.find("#zmAttLbl").on("click",function(){zmAttachUtility.attDropDown("lbl",e)}),a.find("#zmDfltAttView").off("click").on("click",function(){var b=c.attachUtil;a.find(".msi-filter").closest("b").removeClass("SC_sel"),a.find(".SC_srch").removeClass("shw"),b.prvFltr.lblId=" ",b.getAttLst(zmail.zuid,b.dType,1,"all",0,b.prvFltr,"y",!0)}),a.find("#attFilter").on("click",function(){var h=d.data().dataIndex,i=f.data().dataIndex,j=g.data().dataIndex,k=e.data().dataIndex,l=c.attachUtil;if("all"===k&&(k=" "),a.find(".SC_srch").removeClass("shw"),l.groupId!==h||l.fileType!==j||l.entity!==i||l.prvFltr.lblId!==k){if(" "===k)return b.mthd=" ",b.lblId=" ",void l.getAttLst(h,l.dType,1,i,j,l.prvFltr,"y",!0);"f"===k?(b.mthd="listFavourite",b.lblId=k):(b.mthd="labelListing",b.lblId=k),l.getAttLst(h,l.dType,1,i,j,l.prvFltr,"y",b)}}),a.find("#filterCncl").on("click",function(){var b=c.attachUtil;a.find(".SC_srch").removeClass("shw"),b.restoreOptions(a)})}function E(b){var c=this;b.getCenterElem("myAttachment").on("click",".zmAch",function(b){a.myAttachment.toggleSelectedStatus.call(c,b,this)}),D.call(this,b.$el)}function F(b){function c(c){var d=b.getCenterElem("zDesktop").find(".SC_drop");d.removeClass("SC_dropW100");for(var f=function(b){var c=!1;return a.desktop.validateFile.call(e,b,b.name,function(d){d.status&&a.desktop.appendList.call(e,b)===!1&&(c=!0)}),c},g=0;g<c.length&&!f(c[g]);g++);0===e.desktopObj.length&&d.addClass("SC_dropW100")}function d(){e.desktopObj.length&&b.getCenterElem("zDesktop").find(".SC_drop").removeClass("SC_dropW100")}var e=this;b.getCenterElem("zDesktop").find(".SC_drop").click(function(){a.desktop.attachFromDesktopTab.call(e)}),a.utility.setDragDrop({onDrop:c,onDragLeave:d,$centerEle:b.getCenterElem("zDesktop")})}function G(b){var c=this.configJSON.attachFrom.indexOf("desktop"),d=this.configJSON.attachFrom.indexOf("insertImage");this.configJSON.attachFrom.indexOf("myAttachchment")>=0&&E.call(this,b),(c>=0||d>=0)&&f(),c>=0&&F.call(this,b),d>=0&&a.insertImage.bindEventsToTab.call(this,b)}function H(){var b,c=this;$("body").append("<div style='max-height:1px;max-width:1px'id='zmpastefirefox' contentEditable=true></div>"),b=new window.MutationObserver(function(b){b.forEach(function(b){"childList"===b.type&&b.addedNodes&&b.addedNodes.length&&Array.prototype.forEach.call(b.addedNodes,function(b){if("IMG"===b.tagName){var d=$(b),e=a.utility.dataURItoBlob(d.attr("src"));e.name="ScreenShot_"+(new Date).getMilliseconds()+".png",d.remove(),"desktop"===c.dialog.currentTab()?a.desktop.appendList.call(c,e):"insertImage"===c.dialog.currentTab()&&a.insertImage.pasteHandler(e,c.dialog)}})})}),b.observe($("#zmpastefirefox")[0],{childList:!0})}function I(b){var c,d=this,e=b.$el.find("."+b.contentClass),f=this.configJSON.attachFrom,g="none";if(this.dialog=b,(window.ActiveXObject||"ActiveXObject"in window)&&b.$el.find("."+b.contentWrapperClass).css({opacity:1}),f.indexOf("desktop")>=0&&(b.getCenterElem("zDesktop").append(zmAttachment.templates.dragdropArea),this.desktop.autoBrowse&&(b.$el.hide(),a.desktop.attachFromDesktopTab.call(this,!0))),f.indexOf("myAttachchment")>=0&&(b.$el.find("."+b.headerClass).after('<div id="zmMyAttachments" style="display:none;position:absolute; margin-top:-17px;padding-left:10px;">Filter By:<b></b><font class="SC_lnk" style="" id="zmDfltAttView">(Clear Filter)</font></div>'),"myAttachment"===b.currentTab()&&(g="block"),b.$el.find("."+b.contentClass).after('<div style = "display:'+g+'" class="SC_PUsel_files"><label>Selected Files</label></div>'),b.getCenterElem("myAttachment").append(Y.getFilterDropTemplate())),b.$el.find("."+b.contentClass).css({overflow:"hidden",width:""}),b.$el.find(".SCmc.SC_attachviewer").css({"max-height":e.css("max-height"),"max-width":e.css("max-width")}),this.configJSON.showZDocsAsLinkOption){var h;b.getButtonContainer("zDocs").append(zmAttachment.templates.docsOption),h=b.getButtonContainer("zDocs").find(".SC_frt div"),h.click(function(){var a=$(this);a.hasClass("SC_rwWrite")?(d.asLink=!1,ATTACHDIALOG.asAttachment(),b.hideSuccErrMsg("zDocs")):(d.asLink=!0,ATTACHDIALOG.asLink(),b.showSuccErrMsg("w",da.zohoDocs.aslinkwmsg,"zDocs")),a.toggleClass("SC_rwWrite")})}f.indexOf("insertImage")>=0&&a.insertImage.dialogDidMount(b),c=window.navigator.userAgent.toLowerCase().indexOf("firefox")>-1,Z=function(e){c?$("#zmpastefirefox").html("").focus():(e.preventDefault(),"zDesktop"===d.dialog.currentTab()?a.desktop.onPaste.call(d,e):"insertImage"===d.dialog.currentTab()&&a.insertImage.pasteHandler(e,b))},c&&H.call(this),G.call(this,b)}function J(){return"/zm/attach.do?mode=temp"}function K(){return{type:"f",accId:this.accId,tSize:0}}function L(){return ba}function M(){return ca}function N(){return{extension:["ade","adp","bat","chm","cmd","com","cpl","exe","hta","ins","isp","jar","jse","lib","lnk","mde","msc","msp","mst","pif","scr","sct","shb","sys","vb","vbe","vbs","vxd","wsc","wsf","wsh"]}}function O(){var a={},b=this.configJSON.desktop;return b?(a.uploadAPI=b.uploadAPI||J(),a.requireParamToUpload=b.requireParamToUpload||K.call(this),a.uploadCallBack=b.uploadCallBack,a.autoBrowse=b.autoBrowse,b.allowedType&&(a.allowedFileType=b.allowedType.type,a.fileTypeErr=b.allowedType.error||da.desktop.invalidFormat),"boolean"==typeof b.multiple?a.multiple=b.multiple:a.multiple="true","function"==typeof b.beforeAttach&&(a.beforeAttach=b.beforeAttach),b.excludeType instanceof Object?a.excludeType=b.excludeType:a.excludeType=N(),a):(a.uploadAPI=J(),a.requireParamToUpload=K.call(this),a.multiple="true",a.excludeType=N(),a)}function P(a){return a instanceof $?a:$("#"+a)}function Q(a,b){var c,d,e={},f={},g=b.from,h=b.uuid;if("temp"===g)c=this.attachTempArr.tempLocation,f=e={fP:h};else{if("myAttachment"!==g)return;c=this.attachTempArr.myAttachment,e={uniqueId:h},f={uuid:h}}d=c.indexOf(_.findWhere(c,e)),d>=0&&(c[d].n=a),d=this.orderedListOfAttachedFile.indexOf(_.findWhere(this.orderedListOfAttachedFile,f)),d>=0&&(this.orderedListOfAttachedFile[d].n=a)}function R(){var a=this;$.subscribe("attachment/cloudUpload",function b(c,d,e,f){$.unsubscribe("attachment/cloudUpload",b),a.cloudUpload(d,e,f)}),$.subscribe("attachment/cloudClose",function c(){$.unsubscribe("attachment/cloudClose",c),a.closeThisAppView()}),$.subscribe("attachment/markSelectedAttachmentInUI",a.subMarkAttachment)}function S(){var a={},b=this.configJSON.attachFrom,c=!1;a.id="zmAttachCompWhtPopup",a.tabs=[];for(var d=0,e=b.length;d<e;d++)c=0===d,a.tabs.push(C.call(this,b[d],c));a.onClose=this.closeThisAppView.bind(this,!0),a.dialogDidMount=I.bind(this),a.onMouseDown=function(){$("#zm_flpopup, #zmAtt_dropDown").remove()},a.classes="SC_add",this.dialog=zmsDialog.createTabPopupDialog(a)}function T(b){var c,d,e,f,g,h=b.success,i=h.length;void 0!==this.$ele&&this.$ele.length||(this.$ele=P(this.configJSON.eleId)),g=this.$ele;for(var j=0;j<i;j++)f=void 0,c=$(zmAttachment.templates.attListingTemplate),this.configJSON.renameSupport||c.find('.zmSub span[data-name="rename"]').remove(),d=zmUtil.getDummyFilename(h[j].name),e=zmUtil.isPreviewAvailable(d),"msi-attimg"===zmUtil.fileTyp(h[j].name)[1]&&(h[j].src?f=h[j].src:(f=zmail.conPath+"/"+e.apiName+"/"+d,f+="?mode=tmpview&entityType=1&accId="+this.accId+"&fpath="+h[j].fP+"&fstorename="+h[j].sN)),c.find(".zmSze span").eq(0).text(zmUtil.sizeConv(h[j].size)),c.find(".zmFrm span").text(zmUtil.getSubString(20,h[j].name)),c.find(".zmImg").append(zmPreviewTemplate.attPrevInr({fn:h[j].name,thn:f},!0)),c.attr("title",_zm.escapeTags(h[j].name)),g.append(c),a.core.storeTempAttachments.call(this,h[j],c,this.fromDesktopCount++,this.slideListCount++);a.core.onAppend.call(this)}function U(b,c,d,e){var f=this,g={},h=b.find(".zmFrm span"),i=c.name||c.fn;"temp"===d?(e=c.fP,g={fP:e}):"myAttachment"===d&&e&&(g={uuid:e}),b.on("click",function(b){var c,e,h=$(b.target||b.srcElement),j=zmUtil.encodeFileName(i),k=zmUtil.isPreviewAvailable(j);"filename"===h.attr("data-name")&&f.configJSON.renameSupport?a.utility.renameHelper.onRenameAction(h,h.closest(".zmL")):h.hasClass("zmFrm")&&f.configJSON.renameSupport?(h=h.find("span"),a.utility.renameHelper.onRenameAction(h,h.closest(".zmL"))):"rename"===h.attr("data-name")&&f.configJSON.renameSupport?(h=h.closest(".zmL").find(".zmFrm span"),a.utility.renameHelper.onRenameAction(h,h.closest(".zmL"))):"download"!==h.attr("data-name")&&k.isPrev?a.utility.initSlideshow.call(f,g):(c=f.orderedListOfAttachedFile.indexOf(_.findWhere(f.orderedListOfAttachedFile,g)),c>=0&&(e=f.orderedListOfAttachedFile[c],"temp"===d?zmUtil.downloadTempAttachment({accId:f.accId,fP:e.fP,sN:e.sN,name:e.n||e.name}):zmUtil.downloadAttachment(e)))}),a.utility.renameHelper.init({context:this,$ele:h,onChange:Q,handbackData:{from:d,uuid:e||c.fP},orginalFileName:i,parentClass:"zmL"})}function V(){this.asLink=!1}function W(){var a=this.configJSON;this.actionMode=a.actionMode||0,a.$actionEle&&(this.$actionEle=a.$actionEle),a.classToRemove&&(this.classToRemove=a.classToRemove),a.classToAdd&&(this.classToAdd=a.classToAdd),"function"==typeof a.onRemoveAttachment&&(this.onRemoveAttachment=a.onRemoveAttachment),"function"==typeof a.onAddAttachment&&(this.onAddAttachment=a.onAddAttachment),"function"==typeof a.onRemoveElement&&(this.onRemoveElement=a.onRemoveElement),"function"==typeof a.onAddElement&&(this.onAddElement=a.onAddElement),a.$dropCenter&&(this.$dropCenter=a.$dropCenter),a.insertImage&&a.insertImage.constructor===Object&&(this.insertImage=a.insertImage),void 0===a.maxAttachedSize&&(this.configJSON.maxAttachedSize=L(),i(a.componentId,function(a){this.configJSON.maxAttachedSize=a}.bind(this))),void 0===a.currentAttachedSize&&(this.configJSON.currentAttachedSize=M())}function X(a){this.dialog=void 0,this.isAttachingCount=0,this.fromDesktopCount=0,this.slideListCount=0,this.attachTempArr={tempLocation:[],myAttachment:[]},this.attachUtil=null,this.selectedattachUtilectsArr=[],this.asLink=!1,this.orderedListOfAttachedFile=[],this.streaViewCount=0,this.desktopObj=[],this.filenameCountMap={},this.updateConfig(a)}var Y={},Z=function(){},aa={},ba=10485760,ca=0,da=function(){var a={};return $.extend(a,zmText.get("attachmentUtility"),zmText.get("attachComponent"),!0),a}();a.core={},a.utility=a.utility||{},Y.getTempLoadingTemplate=function(){return zmAttachment.templates.cloudAttTempLoadingBox},Y.getFilterDropTemplate=function(){return zmAttachUtility.getFilterDropTemplate()},a.utility.isAttachmentSelected=function(a){return!!a||(zmUtil.succErrMsg("e",da.selectAttach),!1)};var ea={initDragDropArea:function(){var b=$(zmAttachment.templates.dropMsgTemplate),c=this;this.$dropCenter instanceof $&&(b.on("drop",function(d){var e,f,g,h;if(h=function(b){var d=!1;return a.desktop.validateFile.call(c,b,b.name,function(e){e.status?a.desktop.uploadToTempLocation.call(c,[{file:b,fileName:e.name}]):d=!e["continue"]}),d},b.hide(),d.preventDefault(),e=d.originalEvent.dataTransfer,f=e&&e.files)for(g=0;g<f.length&&!h(f[g]);g++);return!1}),this.$dropCenter.on("dragover dragenter",function(a){var c=a.originalEvent.dataTransfer;if((null!==c.types||c.files&&c.files.length>0)&&(c.files&&c.files.length>0||(c.types.indexOf?c.types.indexOf("Files")!==-1:c.types.contains("application/x-moz-file"))||c.types.length&&"Files"===c.types[0]))return a.preventDefault(),c.dropEffect="copy",b.show(),!1}),b.on("dragleave",function(){return b.hide(),!1}),this.$dropCenter.append(b))},createActionMenu:function(){var a=this.$actionEle,b=this;if(this.desktop.autoBrowse)this.browseDesktop();else{var c,d=a,e={par:d,parWidth:!0},f=75,g=[{htm:da.attachDropMenu.quickAttach,data:{action:"desktop"}},{htm:da.attachDropMenu.compAttach,data:{action:"cloud"}}];d.find("b").addClass("SC_ddn"),e.list=g,e.divId="zmAtt_dropDown",e.clk=function(a){zmUtil.hideMenu(),"desktop"===a.action?b.browseDesktop():b.init()},c=$("body").height()-a.offset().top>=f?"up":"bottom",e.align="pleft",e.direction=c,zmsuite.showMenu(e)}},bindClickEventToActionEle:function(){var a=this;this.$actionEle.click(function(b){var c=b.target||b.srcElement;0===a.actionMode?"msi-barrow"===c.className?ea.createActionMenu.call(a):a.browseDesktop():1===a.actionMode?a.browseDesktop():a.init()})},addTempLocationAttachment:function(a){T.call(this,{success:[a]})},appendPreAttachedFile:function(b){b.fP?ea.addTempLocationAttachment.call(this,b):a.myAttachment.appendMyAttachmentFile.call(this,b)},processPreAttachedFile:function(a){var b=a||this.configJSON.preAttachedFile;b instanceof Array&&b.forEach(function(a){ea.appendPreAttachedFile.call(this,a)},this)},doInitialAction:function(){this.$dropCenter instanceof $&&ea.initDragDropArea.call(this),this.autoLaunch?this.init():this.$actionEle instanceof $?ea.bindClickEventToActionEle.call(this):1===this.actionMode&&this.browseDesktop(),this.configJSON.preAttachedFile&&ea.processPreAttachedFile.call(this)}};a.core.incrementAttachCount=function(){this.isAttachingCount++},a.core.decrementAttachCount=function(){this.isAttachingCount>0&&this.isAttachingCount--},a.core.addRemoveClassToParentDom=function(){var a=this.attachTempArr.myAttachment,b=this.attachTempArr.tempLocation;this.isAttachingCount||b.length||a.length?(this.classToAdd&&this.$ele.addClass(this.classToAdd),this.classToRemove&&this.$ele.removeClass(this.classToRemove)):this.classToRemove&&this.$ele.addClass(this.classToRemove)},a.core.onAppend=function(){"function"==typeof this.onAddElement&&this.onAddElement()},a.core.onRemove=function(){"function"==typeof this.onRemoveElement&&this.onRemoveElement()},a.core.storeTempAttachments=function(c,d,e,f){var g=this,h=this.attachTempArr.tempLocation,i=h.length;if(e>i)for(;i<e;)h[i]=void 0,i++;this.configJSON.currentAttachedSize+=zmAttachUtility.parseToNumber(c.size||0),h.splice(e,1,c);var j=function(){var e,f=g.attachTempArr.tempLocation,h=f.indexOf(_.findWhere(f,{fP:c.fP}))||0;h>=0&&(d.remove(),e=f[h],g.configJSON.currentAttachedSize-=zmAttachUtility.parseToNumber(c.size),f.splice(h,1),g.fromDesktopCount--,a.core.addRemoveClassToParentDom.call(g),b.call(g,e),a.core.onRemove.call(g)),a.utility.modifySlideshowArray.call(g,{fP:c.fP})};d.data({uniqueId:c.fP}),d.find(".SC_icn").off("click").on("click",j),U.call(this,d,c,"temp"),a.utility.storeAttListForSlideshow.call(this,c,f,"tempAttachment",d)},X.prototype={init:function(){1===this.actionMode?this.browseDesktop():(s.call(this),V.call(this),S.call(this),R.call(this))},updateConfig:function(a){null!==a&&"object"==typeof a&&("object"==typeof this.configJSON?$.extend(!0,this.configJSON,a):this.configJSON=a,this.componentId=this.configJSON.componentId,this.autoLaunch="undefined"==typeof this.configJSON.autoLaunch||this.configJSON.autoLaunch,this.$ele=P(this.configJSON.eleId),this.accId=h(this.configJSON),this.desktop=O.call(this),W.call(this))},browseDesktop:function(){a.desktop.browseDesktop.call(this)},uploadFiles:function(b){var c=this,d=function(b){var d=!1;return a.desktop.validateFile.call(c,b,b.name,function(e){e.status?a.desktop.uploadToTempLocation.call(c,[{file:b,fileName:e.name}]):d=!e["continue"]}),d};if(b instanceof window.File)d(b);else if(b.length)for(var e=0,f=b.length;e<f&&!d(b[e]);e++);},addFiles:function(a){a instanceof Array&&a.length&&ea.processPreAttachedFile.call(this,a)},isStreamView:function(){return this.streaViewCount>0},closeThisAppView:function(b){this.dialog&&(b||this.dialog.close(),$.unsubscribe("attachment/cloudClose"),$.unsubscribe("attachment/cloudUpload"),$.unsubscribe("attachment/markSelectedAttachmentInUI",this.subMarkAttachment),g(),j.call(this),this.configJSON.onClose&&this.configJSON.onClose(),a.insertImage.clear(),$("#zmpastefirefox").remove())},cloudUpload:function(b,c,d,e){var f,g,h,i,j=this;h=$(Y.getTempLoadingTemplate()),h.find(".zmSub").html(""),this.closeThisAppView(),a.core.incrementAttachCount.call(this),this.$ele&&!this.$ele.length&&(this.$ele=P(this.configJSON.eleId)),i=function(b,c){if(a.core.decrementAttachCount.call(j),b.success&&b.success.length){var e,f,g,i=j.configJSON.maxAttachedSize,k=j.configJSON.currentAttachedSize,l=da,m={};for(e=0,f=b.success.length;e<f;e++)if(k+=zmAttachUtility.parseToNumber(b.success[e].size||0),k>i){b.success=b.success.splice(0,e);var n=i/1048576,o=f-e;g=zmText.applyArgs(l.maxsizeerr,{size:n+"MB",leftfiles:o}),zmUtil.succErrMsg("e",g);break}if(h.remove(),m.tmpObj=b,m.eprm=c,m.loadType="attachment",T.call(j,b),b.failure&&b.failure.length){var p=b.failure,q=p.length,r="";for(g=da.ajaxErr,e=0;e<q;e++)r+=0===e?p[0].fileName:","+p[0].fileName;_zm.succErrMsg("e",g.attFromCloudPartialErr1+" "+r+" "+g.attFromCloudPartialErr2)}}else b.failure&&b.failure.length&&(h.remove(),"object"==typeof b.failure[0]&&"string"==typeof b.failure[0].msg?_zm.succErrMsg("e",b.failure[0].msg):_zm.succErrMsg("e",da.ajaxErr.attFromCloud),j.configJSON.onCloudAttachAbort&&j.configJSON.onCloudAttachAbort(d,j.configJSON.handBckObj),a.core.onRemove.call(j))},h.find(".msi-close").on("click",function(){f.abort(),a.core.decrementAttachCount.call(j),a.core.addRemoveClassToParentDom.call(j),a.core.onRemove.call(j)}),e="z"!==e?da.cloudServiceName.otherCloud:da.cloudServiceName.zDocs,g=zmText.applyArgs(da.attachingfrom,{filecount:c,servicename:e}),h.find(".zmFrm span").text(g),this.$ele.append(h),a.core.addRemoveClassToParentDom.call(this),a.core.onAppend.call(this);var k={docs:b,method:"attachFromCloud",groupId:zmail.zuid,entityType:1,accId:j.accId},l={cmpId:d,tol:c};this.configJSON.handBckObj&&(l.handBckObj=this.configJSON.handBckObj);var m={u:zmail.conPath+"/postAttach.do",t:"POST",fn:i,p:k,ep:l,csr:"s",efn:function(b,c,e){h.remove(),a.core.onRemove.call(j),"abort"!==e.statusText&&_zm.succErrMsg("e",da.ajaxErr.attFromCloud),j.configJSON.onCloudAttachAbort&&j.configJSON.onCloudAttachAbort(d,j.configJSON.handBckObj)}};f=zmAjq.XHR(m),o(h)},isUploadCompleted:function(){return 0===this.isAttachingCount},isUploadInProgress:function(){return!this.isUploadCompleted()},getStoreAttachments:function(a){var b,c,d,e,f={},g={},h={fP:!0,sN:!0,size:!0,n:!0};if(this.isUploadCompleted()||a){for(l.call(this),f.tempLocation=[],c=0,d=this.attachTempArr.tempLocation.length;c<d;c++){g={};for(e in this.attachTempArr.tempLocation[c])h[e]?g[e]=this.attachTempArr.tempLocation[c][e]:"name"!==e||this.attachTempArr.tempLocation[c].n||(g.n=this.attachTempArr.tempLocation[c][e]);$.isEmptyObject(g)||f.tempLocation.push(g)}for(f.myAttachment=[],b=0,d=this.attachTempArr.myAttachment.length;b<d;b++){g={};for(e in this.attachTempArr.myAttachment[b])"uniqueId"!==e&&(g[e]=this.attachTempArr.myAttachment[b][e]);f.myAttachment.push(g)}return f}return!1},getAllAttachedList:function(){var a=k(this.orderedListOfAttachedFile,void 0);return a},clearStoreAttachments:function(){this.attachTempArr.tempLocation=[],this.attachTempArr.myAttachment=[],this.orderedListOfAttachedFile=[],this.configJSON.currentAttachedSize=0,this.fromDesktopCount=0,this.slideListCount=0,this.streaViewCount=0}},a.init=function(b,c){var d;if(c)d=c;else{var e=function(){a.myAttachment.markSelectedAttachmentInUI.call(d)};X.prototype.subMarkAttachment=e,d=new X(b)}return ea.doInitialAction.call(d),d},a.cloudUpload=function(a,b,c){$.publish("attachment/cloudUpload",[a,b,c])},a.closeThisAppView=function(a){$.publish("attachment/cloudClose",[a])},a.markSelectedAttachmentInUI=function(a){$.publish("attachment/markSelectedAttachmentInUI",[a])},a.core.bindTempListedAttachment=U,a.getAttachComponent=X,a._i18N=da,a.utility.getElementReference=P,a.utility.initSlideshow=q,a.utility.modifySlideshowArray=r,a.utility.storeAttListForSlideshow=p}(window.zmAttachComponent=window.zmAttachComponent||{}),function(a){"use strict";function b(a,b){var c,d,e=this.desktopObj;a<b?e.splice(b,0,e.splice(a,1)[0]):a>b&&(0===b?(c=e.splice(a,1),this.desktopObj=c.concat(e)):(c=e.splice(0,b),d=e.splice(a-b,1),this.desktopObj=c.concat(d.concat(e))))}var c,d={},e=!1;a.utility=a.utility||{},a.utility.fileReorder={},a.utility.fileReorder.handleDragStart=function(a){var b=a.target||a.srcElement,f=$(b).closest(".zmL"),g=this.desktopObj[f.index()].fileName,h=document.createElement("div");g=zmUtil.getSubString(20,g),navigator.userAgent.toLowerCase().indexOf("firefox")>-1&&a.originalEvent.dataTransfer.setData("text/plain",g),"function"==typeof a.originalEvent.dataTransfer.setDragImage&&($("#zacdummydrag").remove(),h.id="zacdummydrag",h.className="SC_dg",h.style.top="0px",h.style.left="-1000px",h.innerText=g,document.body.appendChild(h),a.originalEvent.dataTransfer.setDragImage(h,0,0)),e=!0,c=this.dialog.$el,d.dragElement=f,d.dragElementIndex=f.index()},a.utility.fileReorder.handleDragOver=function(a){var b,f;e&&(b=a.target||a.srcElement,f=$(b).closest(".zmL"),c.find(".dragtheme").remove(),d.dragOverElement=f,d.dragOverElementIndex=f.index(),d.dragElementIndex<d.dragOverElementIndex?f.after(zmAttachment.templates.dragtheme):d.dragElementIndex>d.dragOverElementIndex&&f.before(zmAttachment.templates.dragtheme))},a.utility.fileReorder.handleDragEnd=function(){var a;c.find(".dragtheme").remove(),d.dragElementIndex<d.dragOverElementIndex?(a=d.dragElement.detach(),d.dragOverElement.after(a),b.call(this,d.dragElementIndex,d.dragOverElementIndex)):d.dragElementIndex>d.dragOverElementIndex&&(a=d.dragElement.detach(),d.dragOverElement.before(a),b.call(this,d.dragElementIndex,d.dragOverElementIndex))}}(window.zmAttachComponent=window.zmAttachComponent||{}),function(a){"use strict";function b(b){var c=a.utility.createObjectURL(b.file,5e3),d=document.createElement("a");document.body.appendChild(d),d.style="display: none",d.href=c,d.download=b.fileName,d.click(),$(d).remove()}function c(b,c){window.URL=window.URL||window.webkitURL;var d={startIndex:c||0,attObjList:[],hideAllOptions:!0,ignoreThumb:!0};d.onCancel=function(){d.attObjList.forEach(function(b){b.src&&a.utility.revokeObjectURL(b.src)})},Array.isArray(b)&&b.forEach(function(b,c){var e,f=b.file,g=zmUtil.fileTyp(f.name),h={pdf:0,html:0,htm:0},i=zmUtil.isPreviewAvailable(f.name);return i.isPrev&&"FileDownload"===i.apiName?(h[g[2]]&&"text/plain"!==f.type&&"msi-attimg"!==g[1]&&(f=new Blob([f],{type:"text/plain"})),e=a.utility.createObjectURL(f),void d.attObjList.push({ft:"msi-attimg"===g[1]?101:103,fn:b.fileName,src:e})):void(c<=d.startIndex&&(d.startIndex-=1))}),zmUtil.initAttSlideShow(d)}function d(b,c){var d=a.utility.createObjectURL(c,4e3);b.find(".zmImg img").attr("src",d)}function e(b){function c(a){var c=a.blob;c.name=b.find("#listView").text(),g.desktopObj[b.index()]={file:c,fileName:e.fileName},d(b,c)}var e=this.desktopObj[b.index()],f=e.file,g=this;a.imageEditTool.init({file:f,handBckObj:e,onAttach:c})}function f(a){var b=this.dialog.getCenterElem("zDesktop").find(".SC_mclst"),c=a.index();this.desktopAttachedSize-=zmAttachUtility.parseToNumber(this.desktopObj[c].file.size||0),this.desktopObj.splice(c,1),1===b.children().length?this.dialog.getCenterElem("zDesktop").find(".SC_drop").addClass("SC_dropW100"):0===c&&a.next().find(".zmFrm").find("span").addClass("sel"),a.remove()}function g(a){var b,c,d=0,e=this.filenameCountMap,f=a.lastIndexOf(".");return e[a]?(d=e[a],e[a]+=1):e[a]=1,d>0&&(c=zmUtil.fileTyp(a)[2],b=f!==-1?a.substr(0,f):a,1===d?b+="_(copy)":b=b+"_(copy"+(d-1)+")",a=c.length?b+"."+c:b),a}function h(a,b,c){var d=r.desktop,e=a.text(),f=function(c,d){a.text(c),b.find(".zmSub").find("#zmWrnMsg").text(d),b.addClass("SC_renErr"),window.setTimeout(function(){b.removeClass("SC_renErr")},2e3)};e.indexOf(">")>=0||e.indexOf("<")>=0?f(c,r.desktop.charnotallowed):e.length?(e=g.call(this,e),a.text(e),this.desktopObj[b.index()].fileName=e):f(c,d.fileNameErr)}function i(a){var b,c,d=!1,e=zmUtil.fileTyp(a.name)[2];return this.desktop.allowedFileType&&(c=this.desktop.allowedFileType.split(",")),"undefined"!=typeof c?(b=a.type.substr(0,a.type.lastIndexOf("/")+1)+"*",c.indexOf(a.type)>=0||c.indexOf(b)>=0||c.indexOf("."+e)>=0?d=!0:zmUtil.succErrMsg("e",this.desktop.fileTypeErr)):this.desktop.excludeType&&(this.desktop.excludeType.extension.indexOf(e)<0?d=!0:zmUtil.succErrMsg("e",a.name+" can not be attached due to attachment policy")),d}function j(a){var b=this.configJSON.currentAttachedSize;return b+=zmAttachUtility.parseToNumber(a.size||0),a.size<=0?(zmUtil.succErrMsg("e",zmText.applyArgs(r.desktop.zero_size,{name:a.name})),!1):!(b>this.configJSON.maxAttachedSize)||(zmUtil.succErrMsg("e",r.maxSizeErr1+zmUtil.sizeConv(this.configJSON.maxAttachedSize)),!1)}function k(a,b,c){var d=i.call(this,a),e=j.call(this,a);d&&e?(b=b.replace(/[<>]/g,""),c({status:!0,name:b})):c({status:!1,name:b,"continue":e})}function l(b,c){var d,e,f,g=b.target||b.srcElement,h=g.files,i=h.length,j=!1,k="function"==typeof c?c:a.desktop.appendList.bind(this);for(f=function(a){a.status&&k(d,a.name)===!1&&(j=!0)},e=0;e<i&&(d=h[e],a.desktop.validateFile.call(this,d,d.name,f),!j);e++);}function m(b){var c=this;b.find(".zmFlt").on("drag",function(a){zmUtil.stopEvents(a,!0)}),b.find(".zmFlt").on("dragstart",function(b){zmUtil.stopEvents(b,!0),a.utility.fileReorder.handleDragStart.call(c,b)}),b.on("dragover",function(b){zmUtil.stopEvents(b),a.utility.fileReorder.handleDragOver.call(c,b)}),b.on("dragend",function(b){zmUtil.stopEvents(b),a.utility.fileReorder.handleDragEnd.call(c,b)})}function n(){var a=this;$("body").off("mousedown.attCmp").on("mousedown.attCmp",function(){$("body").off("mousedown.attCmp"),a.dialog&&"none"===a.dialog.$el.css("display")&&a.closeThisAppView()})}function o(){try{return new window.XMLHttpRequest}catch(a){}}function p(){try{return new window.ActiveXObject("Microsoft.XMLHTTP")}catch(a){}}function q(){return o()||p()}var r=a._i18N,s={};a.desktop={},a.utility=a.utility||{},s.getListTemplate=function(){return zmAttachment.templates.desktopListTemplate},s.getTempLoadingTemplate=function(){return zmAttachment.templates.cloudAttTempLoadingBox},a.utility.createXHR=function(){return window.ActiveXObject?q():o()},a.desktop.onTabSelection=function(){this.desktopObj.length||this.desktop.autoBrowse||a.desktop.attachFromDesktopTab.call(this)},a.desktop.onPaste=function(b){var c,d,e,f=b.clipboardData.items,g=this,h=!1;for(e=function(b){b.status&&a.desktop.appendList.call(g,c)===!1&&(h=!0)},d=0;d<f.length&&("file"!==f[d].kind||f[d].type.indexOf("image/")===-1||(c=f[d].getAsFile(),!c||(c.name="ScreenShot_"+(new Date).getMilliseconds()+".png",a.desktop.validateFile.call(this,c,c.name,e),!h)));++d);},a.desktop.formUpload=function(b,c,d){var e,f,g,h,i,j=a.utility.createXHR(),k=new window.FormData,l=zmAjq.getCookie("zmcsr"),m=this;if(this.configJSON.currentAttachedSize+=zmAttachUtility.parseToNumber(d||0),this.configJSON.currentAttachedSize>this.configJSON.maxAttachedSize)return zmUtil.succErrMsg("e",r.maxSizeErr1+zmUtil.sizeConv(this.configJSON.maxAttachedSize)),this.configJSON.currentAttachedSize-=zmAttachUtility.parseToNumber(d||0),!1;a.core.incrementAttachCount.call(this),void 0!==this.$ele&&this.$ele.length||(this.$ele=a.utility.getElementReference(this.configJSON.eleId)),k.append("fileName",encodeURIComponent(c)),k.append("attach",b,encodeURIComponent(c)),k.append("zmrcsr",l);for(i in this.desktop.requireParamToUpload)k.append(i,this.desktop.requireParamToUpload[i]);m.configJSON.eleId&&(e=$(s.getTempLoadingTemplate()),g=this.fromDesktopCount++,h=this.slideListCount++,m.configJSON.renameSupport||e.find('.zmSub span[data-name="rename"]').remove(),e.find(".SC_icn").on("click",function(){j.abort(),m.configJSON.currentAttachedSize-=zmAttachUtility.parseToNumber(d||0),a.core.decrementAttachCount.call(m),a.core.addRemoveClassToParentDom.call(m),e.remove(),a.core.onRemove.call(m)}),"msi-attimg"===zmUtil.fileTyp(c)[1]&&(f=a.utility.createObjectURL(b,4e3)),e.find(".zmFrm span").text(zmUtil.getSubString(20,c)),e.find(".zmImg").html(zmPreviewTemplate.attPrevInr({fn:c,thn:f},!0)),e.attr("title",_zm.escapeTags(c)),e.find(".zmSub").addClass("SC_vh"),j.upload.addEventListener("loadstart",function(){m.$ele.append(e),a.core.addRemoveClassToParentDom.call(m),a.core.onAppend.call(m)},!1),j.upload.addEventListener("progress",function(a){var b=Math.round(100*a.loaded/a.total);e.find("#progressbar").width(b+"%")},!1)),j.onreadystatechange=function(){if(4===j.readyState)if(200===j.status){var b=$.parseJSON(j.responseText);m.configJSON.currentAttachedSize-=zmAttachUtility.parseToNumber(d||0),a.core.decrementAttachCount.call(m),b.fP||1===b[0]?(m.configJSON.eleId&&(e.find("#progressbar").remove(),e.find(".zmSub").removeClass("SC_vh"),e.find(".zmSze span").text(zmUtil.sizeConv(d)),a.core.storeTempAttachments.call(m,b,e,g,h)),m.desktop.uploadCallBack&&m.desktop.uploadCallBack(b,e)):(0===b[0]?_zm.succErrMsg("e",r.ajaxErr.attFromCloudPartialErr1):b.emsg&&"string"==typeof b.emsg&&_zm.succErrMsg("e",b.emsg.replace(/\\x20/g," ")),e.remove(),a.core.onRemove.call(m))}else 500!==j.status&&400!==j.status||(m.configJSON.currentAttachedSize-=zmAttachUtility.parseToNumber(d||0),a.core.decrementAttachCount.call(m),e.remove(),_zm.succErrMsg("e",r.ajaxErr.attFromCloudPartialErr1),a.core.onRemove.call(m))},j.open("POST",this.desktop.uploadAPI,!0),j.send(k)},a.desktop.attachFromDesktopTab=function(a){var b,c=this;$("#zmAttach_file_Desktop").remove(),$("body").append(zmAttachment.templates.browseInputEle("zmAttach_file_Desktop","zmAttach_Desktop")),b=$("#zmAttach_file_Desktop"),this.desktop.multiple&&b.attr("multiple","true"),this.desktop.allowedFileType&&b.attr("accept",this.desktop.allowedFileType),b.off("change").on("change",function(b){return l.call(c,b,a),c.desktopObj.length&&c.desktop.autoBrowse&&"boolean"==typeof a&&c.dialog.$el.show(),this.value="",!1}),this.desktop.autoBrowse&&n.call(this),b.click()},a.desktop.appendList=function(d){var i,j=$(s.getListTemplate()),k=this,l=zmUtil.isPreviewAvailable(d.name),n=d.name,o=zmUtil.fileTyp(n),p=this.dialog.getCenterElem("zDesktop").find(".SC_mclst");if(n=n.replace(/[<>]/g,""),n=g.call(this,n),void 0===this.desktopAttachedSize&&(this.desktopAttachedSize=this.configJSON.currentAttachedSize),this.desktopAttachedSize+=zmAttachUtility.parseToNumber(d.size||0),this.desktopAttachedSize>this.configJSON.maxAttachedSize)return zmUtil.succErrMsg("e",r.maxSizeErr1+zmUtil.sizeConv(this.configJSON.maxAttachedSize)),this.desktopAttachedSize-=zmAttachUtility.parseToNumber(d.size||0),!1;if(this.desktopObj.push({file:d,fileName:n}),j.find(".zmSze").find("span").text(zmUtil.sizeConv(d.size)),j.find("#listView").text(zmUtil.getSubString(60,n)),d.type.indexOf("image/")!==-1){var q=a.utility.createObjectURL(d,4e3);i="<img src='"+q+"'></img>"}else i="<i class='"+o[1]+"'></i>";j.find(".zmImg").append(i),p.append(j),m.call(this,j),1===p.children().length&&(j.find(".zmFrm").find("span").addClass("sel"),this.dialog.getCenterElem("zDesktop").find(".SC_drop").removeClass("SC_dropW100")),l.isPrev&&"FileDownload"===l.apiName&&"html"!==o[2]&&"htm"!==o[2]||j.find(".zmSub").find("span").eq(0).hide(),"msi-attimg"!==zmUtil.fileTyp(d.name)[1]&&j.find(".zmSub").find("span").eq(1).hide(),j.click(function(a){var d=a.target||a.srcElement,g=d.id;switch(g){case"zmSubDownload":b(k.desktopObj[j.index()]);break;case"zmSubView":c(k.desktopObj,j.index());break;case"zmSubAnnotate":e.call(k,j);break;case"zmSubRemove":f.call(k,j)}});var t,u,v=j.find("#listView");v.focus(function(){var a=$(this);t=a.text(),u=t.lastIndexOf("."),u!==-1&&a.text(t.substring(0,u)),a.addClass("sel")}),v.keypress(function(a){13===a.which&&(a.preventDefault(),$(this).blur())}),v.keyup(function(a){var b;27===a.which&&(a.preventDefault(),b=u!==-1?t.substring(0,t.lastIndexOf(".")):t,v.text(b),v.blur())}),v.blur(function(){var a=$(this);u!==-1&&a.text(a.text()+t.substring(u,t.length)),j.index()&&a.removeClass("sel"),t!==a.text()&&h.call(k,a,j,t)})},a.desktop.showRenameDialog=function(a,b){
var c,d=zmUtil.fileTyp(a);a=a.substr(0,a.lastIndexOf(".")),a=a.replace(/[<>]/g,"");var e={title:r.renamefile,$content:$(r.desktop.charnotallowed+".<br><br><div class='SC_tiput' contentEditable=true>"+a+"</div>"),dialogWillMount:function(a){setTimeout(function(){var b=$(a.$els.$contentWrapper).find(".SC_PUcen div");b.focus(),b.on("keypress",function(a){60!==a.which&&62!==a.which||a.preventDefault()}),b.on("paste",function(a){a.preventDefault()})},500),$(a.$els.$content).filter(".SC_PUcen").css({"font-size":"13px",color:"grey"})},buttons:[{name:r.button.done,callback:function(){var a=$(c.$els.$contentWrapper).find(".SC_PUcen div").text()+"."+d[2];c.remove(),b(a)}}]};c=Dialog["new"](e)},a.desktop.uploadToTempLocation=function(b){var c,d,e=b||this.desktopObj,f=this;if(e.length)for(var g=0,h=e.length;g<h;g++)window.FormData?(d=e[g].file,c=e[g].fileName||d.name,a.desktop.formUpload.call(f,d,c,d.size)):zmUtil.succErrMsg("e",r.desktop.upload_unsupport_browser);else zmUtil.succErrMsg("e",r.desktop.pleaseattach)},a.desktop.browseDesktop=function(){var b=this;a.desktop.attachFromDesktopTab.call(this,function(c,d){"function"==typeof b.desktop.beforeAttach&&1===b.actionMode?b.desktop.beforeAttach(function(){a.desktop.uploadToTempLocation.call(b,[{file:c,fileName:d}])}):a.desktop.uploadToTempLocation.call(b,[{file:c,fileName:d}])})},a.desktop.attachBtnHandler=function(){var b=this;this.desktopObj&&this.desktopObj.length?"function"==typeof this.desktop.beforeAttach?this.desktop.beforeAttach(function(){a.desktop.uploadToTempLocation.call(b),b.closeThisAppView()}):(a.desktop.uploadToTempLocation.call(this),this.closeThisAppView()):zmUtil.succErrMsg("e",r.desktop.pleaseattach)},a.desktop.validateFile=k}(window.zmAttachComponent=window.zmAttachComponent||{}),function(a){"use strict";var b=a._i18N;a.myAttachment={};var c=function(){return"xxxxxxxx-xxxy-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(a){var b=Math.floor(16*Math.random());return"x"!==a&&(b=3&b|8),b.toString(16)})},d=function(b,d){var e=this,f=this.attachTempArr.myAttachment,g={};g.e=b.e,g.et=b.et,g.Id=b.Id,g.ft=b.ft,b.n&&(g.n=b.n),b.sid?g.groupId=b.sid:b.gId&&(g.groupId=b.gId),(b.sid||b.gId&&b.gId!==zmail.zuid)&&(g.streamsView=!0,this.streaViewCount++),b.uuid=g.uniqueId=c(),f.push(g),this.configJSON.currentAttachedSize+=zmAttachUtility.parseToNumber(b.fs);var h=function(){var c=f.indexOf(_.findWhere(f,{uniqueId:g.uniqueId}))||0;c>=0&&(d.remove(),e.configJSON.currentAttachedSize-=zmAttachUtility.parseToNumber(b.fs),f.splice(c,1),g.streamsView&&e.streaViewCount--,a.core.addRemoveClassToParentDom.call(e),a.core.onRemove.call(e),a.utility.modifySlideshowArray.call(e,{uuid:g.uniqueId}))};d.data({uniqueId:g.uniqueId}),d.find(".SC_icn").off("click").on("click",h),a.core.bindTempListedAttachment.call(this,d,b,"myAttachment",g.uniqueId),a.utility.storeAttListForSlideshow.call(this,b,this.slideListCount++,"myAttachment",d)},e=function(b){var c,e,f,g=b.length,h=0;for(void 0!==this.$ele&&this.$ele.length||(this.$ele=a.utility.getElementReference(this.configJSON.eleId)),e=this.$ele,h=0;h<g;h++)c=$(zmAttachment.templates.attListingTemplate),this.configJSON.renameSupport||c.find('.zmSub span[data-name="rename"]').remove(),f=b[h],c.find(".zmSze span").eq(0).text(zmUtil.sizeConv(f.fs)),c.find(".zmFrm span").text(zmUtil.getSubString(20,f.n||f.fn)),c.find(".zmImg").append(zmPreviewTemplate.attPrevInr(f,!0)),c.attr("title",_zm.escapeTags(f.n||f.fn)),e.append(c),d.call(this,f,c);a.core.addRemoveClassToParentDom.call(this),a.core.onAppend.call(this)},f=function(a,b){var c,d=b.attachmentID;c=this.selectedattachUtilectsArr.indexOf(_.findWhere(this.selectedattachUtilectsArr,{uniqueId:d})),c>=0&&(this.selectedattachUtilectsArr[c].n=a),c=this.orderedListOfAttachedFile.indexOf(_.findWhere(this.orderedListOfAttachedFile,{uuid:d})),c>=0&&(this.orderedListOfAttachedFile[c].n=a)},g=function(b){var c=$(b.target||b.srcElement);c.hasClass("msi-close")?a.myAttachment.modifyCheckedAttachmentArray.call(this,c.closest(".SC_fileSel").attr("data-attid")):this.configJSON.renameSupport&&a.utility.renameHelper.onRenameAction(c,c.closest(".SC_fileSel"))},h=function(b){var c=$(zmAttachment.templates.selectedFile),d=this.attachUtil.attDet[b],e=c.find('span[data-name="filename"]'),h=d.fn;c.attr({"data-attid":b,title:_zm.escapeTags(h)}),e.text(zmUtil.getSubString(10,d.fn)),this.dialog.$el.find(".SC_PUsel_files").append(c),c.click(g.bind(this)),a.utility.renameHelper.init({context:this,$ele:e,onChange:f,handbackData:{attachmentID:b},orginalFileName:h,parentClass:"SC_fileSel"})},i=function(a){var b=this.dialog.$el.find('.SC_PUsel_files span[data-attid="'+a+'"]');b.remove(),this.dialog.getCenterElem("myAttachment").find('.zmL[data-atid="'+a+'"]').removeClass("SC_check")};a.myAttachment.toggleSelectedStatus=function(b,c){var d,e=$(c),f=$(b.target||b.srcElement),g=!0,h=f.attr("id");"thumbView"!==h&&"listView"!==h||(g=!1),g?(e.toggleClass("SC_check"),this.dialog.$el.find(".SC_srch").removeClass("shw"),a.myAttachment.modifyCheckedAttachmentArray.call(this,e.attr("data-atid"))):(d=this.attachUtil.attDet[f.closest(".zmL").attr("data-atid")],d&&d.constructor===Object&&zmUtil.initAttSlideShow({attObjList:[d],startIndex:0,hideAllOptions:!0}))},a.myAttachment.appendMyAttachmentFile=function(a){e.call(this,[a])},a.myAttachment.modifyCheckedAttachmentArray=function(a){var b=a,c=this.selectedattachUtilectsArr.indexOf(_.findWhere(this.selectedattachUtilectsArr,{uniqueId:b}));c>=0?(this.selectedattachUtilectsArr.splice(c,1),i.call(this,b)):(this.selectedattachUtilectsArr.push(this.attachUtil.attDet[b]),h.call(this,b))},a.myAttachment.markSelectedAttachmentInUI=function(){var a,b,c,d;for(c=0,d=this.selectedattachUtilectsArr.length;c<d;c++)a=this.selectedattachUtilectsArr[c].uniqueId,b=this.dialog.$el.find("div[data-atid='"+a+"']"),b.length&&b.addClass("SC_check")},a.myAttachment.onAttachHandler=function(){var c,d,f,g,h,i,j,k;if(a.utility.isAttachmentSelected(this.selectedattachUtilectsArr.length)){for(c=this.selectedattachUtilectsArr,d=this.configJSON.maxAttachedSize,f=this.configJSON.currentAttachedSize,g=b,j=0,k=c.length;j<k;j++)if(f+=zmAttachUtility.parseToNumber(c[j].fs||0),f>d){c=c.splice(0,j),h=d/1048576,i=k-j,this.dialog.showSuccErrMsg("e",g.maxSizeErr1+" "+h+" "+g.maxSizeErr2+" ,"+i+" "+g.maxSizeErr3,void 0,5e3);break}this.closeThisAppView(),e.call(this,c)}}}(window.zmAttachComponent=window.zmAttachComponent||{}),function(a){"use strict";a.zDocs={},a.zDocs.invokeZDocsComponent=function(a){var b=a.attr("id"),c=zmComponent.loadingBand({container:a[0],type:"pagination"}),d={servicename:"zmail",docsURL:"//"+zmail.urls.docsURL,container_id:b,isnewui:!0};ZDDialog.closePopUp("zdattachcontainer"),d.height=a.height()+100,d.width=a.width();var e=new MutationObserver(function(a){c(),a.forEach(function(a){"childList"===a.type&&a.addedNodes&&a.addedNodes.length&&Array.prototype.forEach.call(a.addedNodes,function(a){"zdattachcontainer"===$(a).attr("id")&&($(a).find("#mainPanelforservicefiles").css("margin","0px"),e.disconnect())})})});e.observe(a[0],{childList:!0}),ATTACHDIALOG.showAttachFileDialog(d)},a.zDocs.attachZDocsDocument=function(){var b=ATTACHDIALOG.getSelectedDocs(),c=[],d={},e=b.length;if(a.utility.isAttachmentSelected(e)){ZDDialog.closePopUp("zdattachcontainer"),this.closeThisAppView();for(var f=0;f<e;f++){var g=b[f],h={};h.docId=g.docId,h.docName=g.docName,h.docType="zw"!==g.service?g.service:"writer",c.push(h)}if(d.zohodocs=c,d=JSON.stringify(d),this.asLink){var i={};i.docObj=d,i.eprm={cmpId:zmUtil.zmsubStr(this.configJSON.componentId,"zmEdi_"),tol:e},i.loadType="link",this.configJSON.insertDocsLink(i)}else this.cloudUpload(d,e,zmUtil.zmsubStr(this.configJSON.componentId,"zmEdi_"),"z")}}}(window.zmAttachComponent=window.zmAttachComponent||{}),function(a){"use strict";a.gagets={},a.gagets.invokeGadgetComponent=function(a){var b,c=a.getCenterElem(),d="Cmp1",e=$(zmAttachment.templates.cloudFrame),f=zmComponent.loadingBand({container:c[0],type:"pagination"});b=zmail.urls.gadURL+"/CloudPicker?sources=gdrive,dropbox,skydrive,box,evernote&purpose=mailView&zservice=zmail&serURL=",b+=location.protocol+"//"+window.location.hostname+zmail.conPath+"/jsp/cloudPicker.jsp?cmpId="+d,e.attr("src",b),e.on("load",function(){f()}),c.append(e)}}(window.zmAttachComponent=window.zmAttachComponent||{}),function(a){"use strict";function b(a){var b,c,d=!1;return c=o.TYPE.split(","),b=a.type.substr(0,a.type.lastIndexOf("/")+1)+"*",(c.indexOf(a.type)>=0||c.indexOf(b)>=0||c.indexOf("."+zmUtil.fileTyp(a.name)[2])>=0)&&(d=!0),d}function c(a){return b(a)}function d(a){return a.size<=o.MAX_SIZE}function e(a){a.find("#blkMaskWthBtn").show(),a.on("mouseover",function(){a.find("#blkMaskWthBtn").css("opacity",1)}),a.on("mouseleave",function(){a.find("#blkMaskWthBtn").css("opacity",0)})}function f(a){a.off("mouseover mouseleave")}function g(b,c){var d,f,g=$("<img>"),h=a.utility.createObjectURL(b),i=15;n=b,d=c instanceof $?c:c.getCenterElem("insertImage"),f=d.find(".SC_mclst"),g[0].onload=function(){d.find(".SC_drop.SC_dropW100").hide(),e(d),a.utility.revokeObjectURL(h)},g.attr("src",h).css({maxWidth:f.width()-i,maxHeight:f.height()-i}).addClass("upldIMG"),f.append(g)}function h(a,b){var e;c(a)?d(a)?g(a,b):(e=p.maxSizeErr1+zmUtil.sizeConv(o.MAX_SIZE),zmUtil.succErrMsg("e",e)):(e=zmText.applyArgs(p.insertImage.typeerror,{ftype:"[JPG/JPEG/PNG/GIF]"}),zmUtil.succErrMsg("e",e))}function i(a,b){var c,d,e=a.clipboardData.items;for(d=0;d<e.length;++d)"file"===e[d].kind&&e[d].type.indexOf("image/")!==-1&&(c=e[d].getAsFile(),c&&(c.name=o.filename+".png",h(c,b)))}function j(a){var b;$("#zmAttach_file_Desktop").remove(),$("body").append(zmAttachment.templates.browseInputEle("zmAttach_file_Desktop","zmAttach_Desktop")),b=$("#zmAttach_file_Desktop"),b.attr("accept",o.TYPE),b.off("change").on("change",function(b){var c=b.target||b.srcElement;return h(c.files[0],a),this.value="",!1}),b.click()}function k(){var b=this;a.imageEditTool.init.call(this,{file:n,onAttach:function(a){var c=b.dialog.getCenterElem("insertImage");n=a.blob,n.name=o.filename+".png",c.find(".SC_mclst img").remove(),g(n,c)}})}function l(){var a=this.dialog.getCenterElem("insertImage");a.find(".SC_mclst img").remove(),a.find("#blkMaskWthBtn").hide(),a.find(".SC_drop.SC_dropW100").show(),f(a)}function m(){var b,c,d=this,g=a.utility.createXHR(),h=new window.FormData,i=zmAjq.getCookie("zmcsr"),j=o.filename+"."+zmUtil.fileTyp(n.name)[2],k=this.insertImage.requireParamToUpload;h.append("fileName",encodeURIComponent(j)),h.append("attach",n,j),h.append("zmrcsr",i);for(c in k)k.hasOwnProperty(c)&&h.append(c,k[c]);b=function(){var a=d.dialog.getCenterElem("insertImage");a.find("#uploadMask").hide(),a.find("#progressbar").hide(),e(a)},g.upload.addEventListener("loadstart",function(){var a=d.dialog.getCenterElem("insertImage");q=!0,a.find("#uploadMask").show(),a.find("#progressbar").show(),a.find("#progressIndicator").width("1%"),f(a)},!1),g.upload.addEventListener("progress",function(a){var b=Math.round(100*a.loaded/a.total);d.dialog.getCenterElem("insertImage").find("#progressIndicator").width(b+"%")},!1),g.onreadystatechange=function(){if(4===g.readyState){if(200===g.status){var a=$.parseJSON(g.responseText);q=!1,a.fP||1===a[0]?(d.insertImage.onUpload(a),d.closeThisAppView()):"string"==typeof a.emsg?(d.dialog.showSuccErrMsg("e",a.emsg.replace(/\\x20/g," ")),b()):(d.dialog.showSuccErrMsg("e",p.insertImage.inserterror),b())}}else 500!==g.status&&400!==g.status||(q=!1,d.dialog.showSuccErrMsg("e",p.insertImage.inserterror),b())},g.open("POST",this.insertImage.uploadAPI,!0),g.send(h)}a.insertImage={};var n,o={MAX_SIZE:3145728,TYPE:".png,.jpg,.jpeg,.gif",filename:"inline"},p=zmText.get("attachComponent"),q=!1,r=function(){return zmAttachment.templates.insertImageLoading};return a.insertImage.clear=function(){n=void 0,q=!1},a.insertImage.getTabConfig=function(a){var b=this,c={id:"insertImage",text:p.cloudServiceName.insertImage,tabName:"insertImage",selected:a,listingArea:{classes:"SC_mclst",styles:{overflow:"hidden"},parEle:$('<div class="SCmc SC_attachviewer"></div>')},buttons:[{text:p.button.insert,onClk:function(){q||(n?m.call(b):zmUtil.succErrMsg("e",p.insertImage.pleaseattach))}}]};return c},a.insertImage.dialogDidMount=function(a){var b=a.getCenterElem("insertImage");b.append(zmAttachment.templates.dragdropArea),b.find(".SC_mclst").append(zmAttachment.templates.insertImageMaskBtn,zmAttachment.templates.blackMask,r())},a.insertImage.pasteHandler=function(){var a;arguments[0]instanceof window.Blob?(a=arguments[0],a.name=o.filename+".png",h(a,arguments[1])):i(arguments[0],arguments[1])},a.insertImage.bindEventsToTab=function(b){function c(a){var c=a[0];h(c,b)}var d,e=b.getCenterElem("insertImage");e.find(".SC_drop").click(function(){j(b)}),a.utility.setDragDrop({onDrop:c,onDragLeave:function(){},onDragover:function(){},$centerEle:b.getCenterElem("insertImage")}),d=e.find("#blkMaskWthBtn .blkMaskBtn"),d.eq(0).on("click",k.bind(this)),d.eq(1).on("click",l.bind(this)),this.insertImage.type&&(o.TYPE=this.insertImage.type),this.insertImage.maxSize&&(o.MAX_SIZE=this.insertImage.maxSize)},a.insertImage.isUploading=function(){return!0},a}(window.zmAttachComponent=window.zmAttachComponent||{});